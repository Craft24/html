<?php
# admin.php - CCMS administration page
#
# Copyright (C) 2010  Matt Florell <vicidial@gmail.com>    LICENSE: AGPLv2
# 
session_start();
require("dbconnect.php");
require("function_util.php");
######################################################################################################
######################################################################################################
#######   static variable settings for display options
######################################################################################################
######################################################################################################

######################################################################################################
######################################################################################################
#######   7 series, filter count preview and script preview
######################################################################################################
######################################################################################################
require_once("admin_part1.php");



######################
# ADD=73 view dialable leads from a filter and a campaign
######################

if ($ADD==73)
	{
	if ($LOGmodify_campaigns==1)
		{
		echo "</title>\n";
		echo "</head>\n";
		echo "<BODY BGCOLOR=white marginheight=0 marginwidth=0 leftmargin=0 topmargin=0>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT dial_statuses,local_call_time,lead_filter_id,drop_lockout_time from vicidial_campaigns where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$dial_statuses =		$row[0];
		$local_call_time =		$row[1];
		$drop_lockout_time =	$row[3];
		if ($lead_filter_id=='')
			{
			$lead_filter_id =	$row[2];
			if ($lead_filter_id=='') 
				{
				$lead_filter_id='NONE';
				}
			}

		$stmt="SELECT list_id,active,list_name from vicidial_lists where campaign_id='$campaign_id'";
		$rslt=mysql_query($stmt, $link);
		$lists_to_print = mysql_num_rows($rslt);
		$camp_lists='';
		$o=0;
		while ($lists_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$o++;
			if (ereg("Y", $rowx[1])) {$camp_lists .= "'$rowx[0]',";}
			}
		$camp_lists = eregi_replace(".$","",$camp_lists);

		$filterSQL = $filtersql_list[$lead_filter_id];
		$filterSQL = preg_replace("/\\\\/","",$filterSQL);
		$filterSQL = eregi_replace("^and|and$|^or|or$","",$filterSQL);
		if (strlen($filterSQL)>4)
			{$fSQL = "and $filterSQL";}
		else
			{$fSQL = '';}


		echo "<BR><BR>\n";
		echo "<B>Show Dialable Leads Count</B> -<BR><BR>\n";
		echo "<B>CAMPAIGN:</B> $campaign_id<BR>\n";
		echo "<B>LISTS:</B> $camp_lists<BR>\n";
		echo "<B>Call Result:</B> $dial_statuses<BR>\n";
		echo "<B>FILTER:</B> $lead_filter_id<BR>\n";
		echo "<B>CALL TIME:</B> $local_call_time<BR><BR>\n";

		### call function to calculate and print dialable leads
		dialable_leads($DB,$link,$local_call_time,$dial_statuses,$camp_lists,$drop_lockout_time,$fSQL);

		echo "<BR><BR>\n";
		echo "</BODY></HTML>\n";

		exit;
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=7111111 view sample script with test variables
######################

if ($ADD==7111111)
	{
	##### TEST VARIABLES #####
	$vendor_lead_code = 'VENDOR:LEAD;CODE';
	$list_id = 'LISTID';
	$list_name = 'LISTNAME';
	$list_description = 'LISTDESCRIPTION';
	$gmt_offset_now = 'GMTOFFSET';
	$phone_code = '1';
	$phone_number = '7275551212';
	$title = 'Mr.';
	$first_name = 'JOHN';
	$middle_initial = 'Q';
	$last_name = 'PUBLIC';
	$address1 = '1234 Main St.';
	$address2 = 'Apt. 3';
	$address3 = 'ADDRESS3';
	$city = 'CHICAGO';
	$state = 'IL';
	$province = 'PROVINCE';
	$postal_code = '33760';
	$country_code = 'USA';
	$gender = 'M';
	$date_of_birth = '1970-01-01';
	$alt_phone = '3125551111';
	$email = 'test@test.com';
	$security_phrase = 'SECUTIRY';
	$comments = 'COMMENTS FIELD';
	$RGfullname = 'JOE AGENT';
	$RGuser = '6666';
	$RGlead_id = '1234';
	$RGcampaign = 'TESTCAMP';
	$RGphone_login = 'gs102';
	$RGgroup = 'TESTCAMP';
	$RGchannel_group = 'TESTCAMP';
	$RGSQLdate = date("Y-m-d H:i:s");
	$RGepoch = date("U");
	$RGuniqueid = '1163095830.4136';
	$RGcustomer_zap_channel = 'Zap/1-1';
	$RGserver_ip = '10.10.10.15';
	$RGSIPexten = 'SIP/gs102';
	$RGsession_id = '8600051';
	$RGdialed_number = '3125551111';
	$RGdialed_label = 'ALT';
	$RGrank = '99';
	$RGowner = '6666';
	$RGcamp_script = 'TESTSCRIPT';
	$RGin_script = '';
	$script_width = '600';
	$script_height = '400';
	$recording_filename = '20091204-1639_6666_7275551212';
	$recording_id = '1235';
	$user_custom_one = 'custom one';
	$user_custom_two = 'custom two';
	$user_custom_three = 'custom three';
	$user_custom_four = 'custom four';
	$user_custom_five = 'custom five';
	$preset_number_a = 'preset_a';
	$preset_number_b = 'preset_b';
	$preset_number_c = 'preset_c';
	$preset_number_d = 'preset_d';
	$preset_number_e = 'preset_e';
	$preset_number_f = 'preset_f';
	$preset_dtmf_a = 'preset_dtmf_a';
	$preset_dtmf_b = 'preset_dtmf_b';

	echo "</title>\n";
	echo "</head>\n";
	echo "<BODY BGCOLOR=white marginheight=0 marginwidth=0 leftmargin=0 topmargin=0>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT script_id,script_name,script_comments,script_text,active from vicidial_scripts where script_id='$script_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	$script_name =		$row[1];
	$script_text =		stripslashes($row[3]);

	if (eregi("iframe src",$script_text))
		{
		$vendor_lead_code = eregi_replace(' ','+',$vendor_lead_code);
		$list_id = eregi_replace(' ','+',$list_id);
		$list_name = eregi_replace(' ','+',$list_name);
		$list_description = eregi_replace(' ','+',$list_description);
		$gmt_offset_now = eregi_replace(' ','+',$gmt_offset_now);
		$phone_code = eregi_replace(' ','+',$phone_code);
		$phone_number = eregi_replace(' ','+',$phone_number);
		$title = eregi_replace(' ','+',$title);
		$first_name = eregi_replace(' ','+',$first_name);
		$middle_initial = eregi_replace(' ','+',$middle_initial);
		$last_name = eregi_replace(' ','+',$last_name);
		$address1 = eregi_replace(' ','+',$address1);
		$address2 = eregi_replace(' ','+',$address2);
		$address3 = eregi_replace(' ','+',$address2);
		$city = eregi_replace(' ','+',$city);
		$state = eregi_replace(' ','+',$state);
		$province = eregi_replace(' ','+',$province);
		$postal_code = eregi_replace(' ','+',$postal_code);
		$country_code = eregi_replace(' ','+',$country_code);
		$gender = eregi_replace(' ','+',$gender);
		$date_of_birth = eregi_replace(' ','+',$date_of_birth);
		$alt_phone = eregi_replace(' ','+',$alt_phone);
		$email = eregi_replace(' ','+',$email);
		$security_phrase = eregi_replace(' ','+',$security_phrase);
		$comments = eregi_replace(' ','+',$comments);
		$RGfullname = eregi_replace(' ','+',$RGfullname);
		$RGuser = eregi_replace(' ','+',$RGuser);
		$RGlead_id = eregi_replace(' ','+',$RGlead_id);
		$RGcampaign = eregi_replace(' ','+',$RGcampaign);
		$RGphone_login = eregi_replace(' ','+',$RGphone_login);
		$RGgroup = eregi_replace(' ','+',$RGgroup);
		$RGchannel_group = eregi_replace(' ','+',$RGchannel_group);
		$RGSQLdate = eregi_replace(' ','+',$RGSQLdate);
		$RGepoch = eregi_replace(' ','+',$RGepoch);
		$RGuniqueid = eregi_replace(' ','+',$RGuniqueid);
		$RGcustomer_zap_channel = eregi_replace(' ','+',$RGcustomer_zap_channel);
		$RGserver_ip = eregi_replace(' ','+',$RGserver_ip);
		$RGSIPexten = eregi_replace(' ','+',$RGSIPexten);
		$RGsession_id = eregi_replace(' ','+',$RGsession_id);
		$RGdialed_number = eregi_replace(' ','+',$RGdialed_number);
		$RGdialed_label = eregi_replace(' ','+',$RGdialed_label);
		$RGrank = eregi_replace(' ','+',$RGrank);
		$RGowner = eregi_replace(' ','+',$RGowner);
		$RGcamp_script = eregi_replace(' ','+',$RGcamp_script);
		$RGin_script = eregi_replace(' ','+',$RGin_script);
		$script_width = eregi_replace(' ','+',$script_width);
		$script_height = eregi_replace(' ','+',$script_height);
		$recording_filename = eregi_replace(' ','+',$recording_filename);
		$recording_id = eregi_replace(' ','+',$recording_id);
		$user_custom_one = eregi_replace(' ','+',$user_custom_one);
		$user_custom_two = eregi_replace(' ','+',$user_custom_two);
		$user_custom_three = eregi_replace(' ','+',$user_custom_three);
		$user_custom_four = eregi_replace(' ','+',$user_custom_four);
		$user_custom_five = eregi_replace(' ','+',$user_custom_five);
		$preset_number_a = eregi_replace(' ','+',$preset_number_a);
		$preset_number_b = eregi_replace(' ','+',$preset_number_b);
		$preset_number_c = eregi_replace(' ','+',$preset_number_c);
		$preset_number_d = eregi_replace(' ','+',$preset_number_d);
		$preset_number_e = eregi_replace(' ','+',$preset_number_e);
		$preset_number_f = eregi_replace(' ','+',$preset_number_f);
		$preset_dtmf_a = eregi_replace(' ','+',$preset_dtmf_a);
		$preset_dtmf_b = eregi_replace(' ','+',$preset_dtmf_b);
		}

	$script_text = eregi_replace('--A--vendor_lead_code--B--',"$vendor_lead_code",$script_text);
	$script_text = eregi_replace('--A--list_id--B--',"$list_id",$script_text);
	$script_text = eregi_replace('--A--list_name--B--',"$list_name",$script_text);
	$script_text = eregi_replace('--A--list_description--B--',"$list_description",$script_text);
	$script_text = eregi_replace('--A--gmt_offset_now--B--',"$gmt_offset_now",$script_text);
	$script_text = eregi_replace('--A--phone_code--B--',"$phone_code",$script_text);
	$script_text = eregi_replace('--A--phone_number--B--',"$phone_number",$script_text);
	$script_text = eregi_replace('--A--title--B--',"$title",$script_text);
	$script_text = eregi_replace('--A--first_name--B--',"$first_name",$script_text);
	$script_text = eregi_replace('--A--middle_initial--B--',"$middle_initial",$script_text);
	$script_text = eregi_replace('--A--last_name--B--',"$last_name",$script_text);
	$script_text = eregi_replace('--A--address1--B--',"$address1",$script_text);
	$script_text = eregi_replace('--A--address2--B--',"$address2",$script_text);
	$script_text = eregi_replace('--A--address3--B--',"$address3",$script_text);
	$script_text = eregi_replace('--A--city--B--',"$city",$script_text);
	$script_text = eregi_replace('--A--state--B--',"$state",$script_text);
	$script_text = eregi_replace('--A--province--B--',"$province",$script_text);
	$script_text = eregi_replace('--A--postal_code--B--',"$postal_code",$script_text);
	$script_text = eregi_replace('--A--country_code--B--',"$country_code",$script_text);
	$script_text = eregi_replace('--A--gender--B--',"$gender",$script_text);
	$script_text = eregi_replace('--A--date_of_birth--B--',"$date_of_birth",$script_text);
	$script_text = eregi_replace('--A--alt_phone--B--',"$alt_phone",$script_text);
	$script_text = eregi_replace('--A--email--B--',"$email",$script_text);
	$script_text = eregi_replace('--A--security_phrase--B--',"$security_phrase",$script_text);
	$script_text = eregi_replace('--A--comments--B--',"$comments",$script_text);
	$script_text = eregi_replace('--A--fullname--B--',"$RGfullname",$script_text);
	$script_text = eregi_replace('--A--fronter--B--',"$RGuser",$script_text);
	$script_text = eregi_replace('--A--user--B--',"$RGuser",$script_text);
	$script_text = eregi_replace('--A--lead_id--B--',"$RGlead_id",$script_text);
	$script_text = eregi_replace('--A--campaign--B--',"$RGcampaign",$script_text);
	$script_text = eregi_replace('--A--phone_login--B--',"$RGphone_login",$script_text);
	$script_text = eregi_replace('--A--group--B--',"$RGgroup",$script_text);
	$script_text = eregi_replace('--A--channel_group--B--',"$RGchannel_group",$script_text);
	$script_text = eregi_replace('--A--SQLdate--B--',"$RGSQLdate",$script_text);
	$script_text = eregi_replace('--A--epoch--B--',"$RGepoch",$script_text);
	$script_text = eregi_replace('--A--uniqueid--B--',"$RGuniqueid",$script_text);
	$script_text = eregi_replace('--A--customer_zap_channel--B--',"$RGcustomer_zap_channel",$script_text);
	$script_text = eregi_replace('--A--server_ip--B--',"$RGserver_ip",$script_text);
	$script_text = eregi_replace('--A--SIPexten--B--',"$RGSIPexten",$script_text);
	$script_text = eregi_replace('--A--session_id--B--',"$RGsession_id",$script_text);
	$script_text = eregi_replace('--A--dialed_number--B--',"$RGdialed_number",$script_text);
	$script_text = eregi_replace('--A--dialed_label--B--',"$RGdialed_label",$script_text);
	$script_text = eregi_replace('--A--rank--B--',"$RGrank",$script_text);
	$script_text = eregi_replace('--A--owner--B--',"$RGowner",$script_text);
	$script_text = eregi_replace('--A--camp_script--B--',"$RGcamp_script",$script_text);
	$script_text = eregi_replace('--A--in_script--B--',"$RGin_script",$script_text);
	$script_text = eregi_replace('--A--script_width--B--',"$script_width",$script_text);
	$script_text = eregi_replace('--A--script_height--B--',"$script_height",$script_text);
	$script_text = eregi_replace('--A--recording_filename--B--',"$recording_filename",$script_text);
	$script_text = eregi_replace('--A--recording_id--B--',"$recording_id",$script_text);
	$script_text = eregi_replace('--A--user_custom_one--B--',"$user_custom_one",$script_text);
	$script_text = eregi_replace('--A--user_custom_two--B--',"$user_custom_two",$script_text);
	$script_text = eregi_replace('--A--user_custom_three--B--',"$user_custom_three",$script_text);
	$script_text = eregi_replace('--A--user_custom_four--B--',"$user_custom_four",$script_text);
	$script_text = eregi_replace('--A--user_custom_five--B--',"$user_custom_five",$script_text);
	$script_text = eregi_replace('--A--preset_number_a--B--',"$preset_number_a",$script_text);
	$script_text = eregi_replace('--A--preset_number_b--B--',"$preset_number_b",$script_text);
	$script_text = eregi_replace('--A--preset_number_c--B--',"$preset_number_c",$script_text);
	$script_text = eregi_replace('--A--preset_number_d--B--',"$preset_number_d",$script_text);
	$script_text = eregi_replace('--A--preset_number_e--B--',"$preset_number_e",$script_text);
	$script_text = eregi_replace('--A--preset_number_f--B--',"$preset_number_f",$script_text);
	$script_text = eregi_replace('--A--preset_dtmf_a--B--',"$preset_dtmf_a",$script_text);
	$script_text = eregi_replace('--A--preset_dtmf_b--B--',"$preset_dtmf_b",$script_text);
	$script_text = eregi_replace("\n","<BR>",$script_text);


	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	echo "Preview Script: $script_id<BR>\n";
	echo "<TABLE WIDTH=600><TR><TD>\n";
	echo "<center><B>$script_name</B><BR></center>\n";
	echo "$script_text\n";
	echo "</TD></TR></TABLE></center>\n";

	echo "</BODY></HTML>\n";

	exit;
	}

if($ccms_admin_modules=='forecast_outbound_handle')$hh='client';
elseif($ADD==371)$hh='campaigns';
$ADMIN=$PHP_SELF;
require("admin_header.php");





######################################################################################################
######################################################################################################
#######   1 series, ADD NEW forms for inserting new records into the database
######################################################################################################
######################################################################################################


######################
# ADD=1 display the ADD NEW USER FORM SCREEN
######################

if ($ADD=="1")
	{
	
	if ($LOGadd_new_users==0)
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	else
		{
		
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_users' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####
		
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
		echo "<br>ADD A NEW USER<form action=$PHP_SELF method=POST name=userform id=userform>\n";
		echo "<input type=hidden name=ADD value=2>\n";
		echo "<input type=hidden name=user_toggle id=user_toggle value=0>\n";
		
		echo "<input type=hidden name=view_reports id=view_reports value=0>\n";
		echo "<input type=hidden name=alter_agent_interface_options id=alter_agent_interface_options value=0>\n";
		echo "<input type=hidden name=modify_users id=modify_users value=0>\n";
		echo "<input type=hidden name=change_agent_campaign id=change_agent_campaign value=0>\n";
		echo "<input type=hidden name=delete_users id=delete_users value=0>\n";
		echo "<input type=hidden name=modify_usergroups id=modify_usergroups value=0>\n";
		echo "<input type=hidden name=delete_user_groups id=delete_user_groups value=0>\n";
		echo "<input type=hidden name=modify_lists id=modify_lists value=0>\n";
		echo "<input type=hidden name=delete_lists id=delete_lists value=0>\n";
		echo "<input type=hidden name=load_leads id=load_leads value=0>\n";
		echo "<input type=hidden name=modify_leads id=modify_leads value=0>\n";
		echo "<input type=hidden name=download_lists id=download_lists value=0>\n";
		echo "<input type=hidden name=export_reports id=export_reports value=0>\n";
		echo "<input type=hidden name=delete_from_dnc id=delete_from_dnc value=0>\n";
		echo "<input type=hidden name=modify_campaigns id=modify_campaigns value=0>\n";
		echo "<input type=hidden name=campaign_detail id=campaign_detail value=0>\n";
		echo "<input type=hidden name=delete_campaigns id=delete_campaigns value=0>\n";
		echo "<input type=hidden name=modify_ingroups id=modify_ingroups value=0>\n";
		echo "<input type=hidden name=delete_ingroups id=delete_ingroups value=0>\n";
		echo "<input type=hidden name=modify_inbound_dids id=modify_inbound_dids value=0>\n";
		echo "<input type=hidden name=delete_inbound_dids id=delete_inbound_dids value=0>\n";
		echo "<input type=hidden name=modify_remoteagents id=modify_remoteagents value=0>\n";
		echo "<input type=hidden name=delete_remote_agents id=delete_remote_agents value=0>\n";
		echo "<input type=hidden name=modify_scripts id=modify_scripts value=0>\n";
		echo "<input type=hidden name=delete_scripts id=delete_scripts value=0>\n";
		echo "<input type=hidden name=modify_filters id=modify_filters value=0>\n";
		echo "<input type=hidden name=delete_filters id=delete_filters value=0>\n";
		echo "<input type=hidden name=ast_admin_access id=ast_admin_access value=0>\n";
		echo "<input type=hidden name=ast_delete_phones id=ast_delete_phones value=0>\n";
		echo "<input type=hidden name=modify_call_times id=modify_call_times value=0>\n";
		echo "<input type=hidden name=delete_call_times id=delete_call_times value=0>\n";
		echo "<input type=hidden name=modify_servers id=modify_servers value=0>\n";
		echo "<input type=hidden name=vdc_agent_api_access id=vdc_agent_api_access value=1>\n";
		echo "<input type=hidden name=add_timeclock_log id=add_timeclock_log value=0>\n";
		echo "<input type=hidden name=modify_timeclock_log id=modify_timeclock_log value=0>\n";
		echo "<input type=hidden name=delete_timeclock_log id=delete_timeclock_log value=0>\n";
		echo "<input type=hidden name=manager_shift_enforcement_override id=manager_shift_enforcement_override value=0>\n";
		
		echo "<input type=hidden name=add_new_users id=add_new_users value=0>\n";
		echo "<input type=hidden name=add_new_campaigns id=add_new_campaigns value=0>\n";
		echo "<input type=hidden name=add_new_lists id=add_new_lists value=0>\n";
		echo "<input type=hidden name=add_new_usergroups id=add_new_usergroups value=0>\n";
		echo "<input type=hidden name=add_from_dnc id=add_from_dnc value=0>\n";
		echo "<input type=hidden name=view_historical_reports id=view_historical_reports value=0>\n";
		echo "<input type=hidden name=live_monitor id=live_monitor value=0>\n";
		echo "<input type=hidden name=search_historical_call id=search_historical_call value=0>\n";
		echo "<input type=hidden name=search_voice_mail id=search_voice_mail value=0>\n";
		
		echo "<input type=hidden name=vicidial_transfers id=vicidial_transfers value=1>\n";
		echo "<input type=hidden name=agentcall_manual id=agentcall_manual value=1>\n";
		echo "<input type=hidden name=view_agent_status id=view_agent_status value='N'>\n";
		echo "<input type=hidden name=allow_alerts id=allow_alerts value=0>\n";
		echo "<input type=hidden name=grab_calls_in_queue id=grab_calls_in_queue value='N'>\n";
		echo "<input type=hidden name=scheduled_callbacks id=scheduled_callbacks value=1>\n";
		echo "<input type=hidden name=agentonly_callbacks id=agentonly_callbacks value=1>\n";
		echo "<input type=hidden name=vicidial_recording id=vicidial_recording value=1>\n";
		echo "<input type=hidden name=vicidial_recording_override id=vicidial_recording_override value=\"DISABLED\">\n";
		echo "<input type=hidden name=active id=active value='Y'>\n";//新添加user默认active值为Y by akin
		
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>User Number: </td><td align=left>Auto-Generated <input type=hidden name=user id=user value=\"99999\">$NWB#vicidial_users-user$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>User Number: </td><td align=left><input type=text name=user id=user size=20 maxlength=20 onBlurxxx=\"javascript:CheckUserNumber()\"> <input type=button name=auto_user value=\"AUTO-GENERATE\" onClick=\"user_auto()\"> $NWB#vicidial_users-user$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Password: </td><td align=left><input type=text name=pass size=20 maxlength=20 onfocus=\"javascript:CheckUserNumber()\">$NWB#vicidial_users-pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Full Name: </td><td align=left><input type=text name=full_name size=20 maxlength=100 onfocus=\"javascript:CheckUserNumber()\">$NWB#vicidial_users-full_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>User Level(Role): </td><td align=left><select size=1 name=user_level onfocus=\"javascript:CheckUserNumber()\" onchange=\"CHANGE_ADMIN_INTERFACE_OPTIONS2();\">";
		$h=1;
		$user_level_arr = array("5"=>"Agent","6"=>"QA","7"=>"Supervisor","8"=>"Manager","9"=>"Admin");
		foreach($user_level_arr as $k=>$v){
			if($k<=$LOGuser_level){
				echo "<option value=\"".$k."\">" . $v . "</option>";
			}
		}

		echo "</select>$NWB#vicidial_users-user_level$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>User Group: </td><td align=left><select size=1 name=user_group onfocus=\"javascript:CheckUserNumber()\">\n";
		/*
		if($LOGuser_level==9){
			$stmt="SELECT user_group,group_name from vicidial_user_groups order by user_group";
		}else{
			$stmt="SELECT user_group,group_name from vicidial_user_groups where supervisor='$LOGuser_name_id' or manager='$LOGuser_name_id' order by user_group";
		}
		*/
		$stmt = getUserGroupsList($LOGuser_level,$LOGuser_name_id,1);
		$rslt=mysql_query($stmt, $link);
		$Ugroups_to_print = mysql_num_rows($rslt);
		$Ugroups_list='';

		$o=0;
		while ($Ugroups_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$Ugroups_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "$Ugroups_list";
		echo "<option SELECTED>$user_group</option>\n";
		echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Phone Login: </td><td align=left><input type=text name=phone_login size=20 maxlength=20 onfocus=\"javascript:CheckUserNumber()\">$NWB#vicidial_users-phone_login$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Phone Pass: </td><td align=left><input type=text name=phone_pass size=20 maxlength=20 onfocus=\"javascript:CheckUserNumber()\">$NWB#vicidial_users-phone_pass$NWE</td></tr>\n";
		echo "</select>$NWB#vicidial_users-user_group$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=button name=SUBMIT value=SUBMIT onClick=\"user_submit()\"></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	}


######################
# ADD=1A display the COPY USER FORM SCREEN
######################

if ($ADD=="1A")
	{
	if ($LOGmodify_users==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_users' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>COPY USER<form action=$PHP_SELF method=POST name=userform id=userform>\n";
		echo "<input type=hidden name=ADD value=2A>\n";
		echo "<input type=hidden name=user_toggle id=user_toggle value=0>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>User Number: </td><td align=left>Auto-Generated <input type=hidden name=user id=user value=\"99999\">$NWB#vicidial_users-user$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>User Number: </td><td align=left><input type=text name=user id=user size=20 maxlength=20> <input type=button name=auto_user value=\"AUTO-GENERATE\" onClick=\"user_auto()\"> $NWB#vicidial_users-user$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Password: </td><td align=left><input type=text name=pass size=20 maxlength=20 onfocus=\"javascript:CheckUserNumber()\">$NWB#vicidial_users-pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Full Name: </td><td align=left><input type=text name=full_name size=20 maxlength=100 onfocus=\"javascript:CheckUserNumber()\">$NWB#vicidial_users-full_name$NWE</td></tr>\n";
		/*
		if ($LOGuser_level==9) {$levelMAX=10;}
		else {$levelMAX=$LOGuser_level;}
		*/
		echo "<tr bgcolor=#FFFFFF><td align=right>Source User: </td><td align=left><select size=1 name=source_user_id onfocus=\"javascript:CheckUserNumber()\">\n";
		
		/*comment by heibo 2011-4-22 9:40:29 统一成一个函数
		$wherecondition_sql = "";
		if($LOGuser_level == 9){
			$wherecondition_sql = " where 1 $SQLstatus $SQLorder";
		}else{
			$wherecondition_sql = " where user_level<=$LOGuser_level and user_group in (select distinct(user_group) from vicidial_user_groups where manager='$LOGuser_name_id' or supervisor='$LOGuser_name_id') $SQLstatus $SQLorder";
		}
		$stmt="SELECT user,full_name from vicidial_users $wherecondition_sql";
		*/
		$stmt = getUsersList($LOGuser_level,$LOGuser_name_id,$SQLstatus,$SQLorder);
		
		//$stmt="SELECT user,full_name from vicidial_users where user_level < $levelMAX order by full_name;";
		$rslt=mysql_query($stmt, $link);
		$Uusers_to_print = mysql_num_rows($rslt);
		$Uusers_list='';

		$o=0;
		while ($Uusers_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$Uusers_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "$Uusers_list";
		echo "</select>$NWB#vicidial_users-user$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=button name=SUBMIT value=SUBMIT onClick=\"user_submit()\"></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}



######################
# ADD=2C adds the batch copied new user to the system
######################

if ($ADD=="2C")
{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$user_name_prefix = trim($user_name_prefix);
	$user_name_suffix_from = trim($user_name_suffix_from);
	$user_name_suffix_to =trim($user_name_suffix_to);
	$pass = trim($pass);
//	$active;

	$suffix_length = max(strlen($user_name_suffix_from),strlen($user_name_suffix_to));
	$user_name_length = strlen($user_name_prefix.$user_name_suffix_from);

	$user_name_suffix_start	= suffix_number($user_name_suffix_from);
	$user_name_suffix_end	= suffix_number($user_name_suffix_to);
	if( ($user_name_length< 2) or ($user_name_length >8) or (strlen($user_name_suffix_from) <2) or (strlen($user_name_suffix_from) >8) or (strlen($user_name_suffix_to) <2) or (strlen($user_name_suffix_to) >8) or (strlen($pass) < 2) )
	{
		echo "<br><b>USER NOT COPIED</b> - Please go back and look at the data you entered\n";
		echo "<br>'User Number Prefix + User Number Suffix From/To' must be between 2 and 8 characters long\n";
		echo "<br>Password must be at least 2 characters long\n";
		echo "<br><!-- |$user_name_prefix|$user_name_suffix_from|$user_name_suffix_to|$pass|$active| -->\n";	
	}
	elseif(intval($user_name_suffix_end) < intval($user_name_suffix_start))
	{
		echo "<BR><b>USER NOT COPIED</b> - Please go back and look at the data you entered\n";
		echo "<BR>The data you entered of 'User Number Suffix To' <br>must greater than 'User Number Suffix From'\n";
	}
	else
	{
		$itotal = 0;
		for($add_user_suffix=$user_name_suffix_start; $add_user_suffix<=$user_name_suffix_end; $add_user_suffix++)
		{	
			$add_user_suffix	= str_pad($add_user_suffix,$suffix_length,0,STR_PAD_LEFT);
			$add_user_name	= $user_name_prefix.$add_user_suffix;
			$user = $add_user_name;
			$full_name = $add_user_name;
			$stmt="SELECT count(*) from vicidial_users where user='$user';";
			$rslt=mysql_query($stmt, $link);
			$row=mysql_fetch_row($rslt);
			if ($row[0] > 0)
			{
//				echo "<br>USER NOT ADDED - there is already a user in the system with this user number\n";
				$arr_exit_user[] = $user;
				continue;
			}
			else
			{

				$vicidial_users_sql_field = "user_level,user_group,phone_login,phone_pass,delete_users,delete_user_groups,delete_lists,delete_campaigns,delete_ingroups,delete_remote_agents,load_leads,campaign_detail,ast_admin_access,ast_delete_phones,delete_scripts,modify_leads,hotkeys_active,change_agent_campaign,agent_choose_ingroups,closer_campaigns,scheduled_callbacks,agentonly_callbacks,agentcall_manual,vicidial_recording,vicidial_transfers,delete_filters,alter_agent_interface_options,closer_default_blended,delete_call_times,modify_call_times,modify_users,add_new_users,modify_campaigns,add_new_campaigns,modify_lists,add_new_lists,modify_scripts,modify_filters,modify_ingroups,modify_usergroups,add_new_usergroups,modify_remoteagents,modify_servers,view_reports,search_historical_call,search_voice_mail,live_monitor,view_historical_reports,vicidial_recording_override,alter_custdata_override,qc_enabled,qc_user_level,qc_pass,qc_finish,qc_commit,add_timeclock_log,modify_timeclock_log,delete_timeclock_log,alter_custphone_override,vdc_agent_api_access,modify_inbound_dids,delete_inbound_dids,alert_enabled,download_lists,agent_shift_enforcement_override,manager_shift_enforcement_override,shift_override_flag,export_reports,delete_from_dnc,add_from_dnc,email,user_code,territory,allow_alerts,agent_choose_territories,custom_one,custom_two,custom_three,custom_four,custom_five,disabled_campaigns,grab_calls_in_queue,view_agent_status";
				$stmt="INSERT INTO vicidial_users (user,pass,full_name,active,$vicidial_users_sql_field) SELECT \"$user\",\"$pass\",\"$full_name\",\"$active\",$vicidial_users_sql_field from vicidial_users where user=\"$source_user_id\";";
				$rslt=mysql_query($stmt, $link);

				$stmtA="INSERT INTO vicidial_inbound_group_agents (user,group_id,group_rank,group_weight,calls_today) SELECT \"$user\",group_id,group_rank,group_weight,\"0\" from vicidial_inbound_group_agents where user=\"$source_user_id\";";
				$rslt=mysql_query($stmtA, $link);

				$stmtA="INSERT INTO vicidial_campaign_agents (user,campaign_id,campaign_rank,campaign_weight,calls_today) SELECT \"$user\",campaign_id,campaign_rank,campaign_weight,\"0\" from vicidial_campaign_agents where user=\"$source_user_id\";";
				$rslt=mysql_query($stmtA, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='USERS', event_type='COPY', record_id='$user', event_code='ADMIN BATCH COPY USER', event_sql=\"$SQL_log\", event_notes='user: $user';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);

				###############################################################
				##### START SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
				$stmt = "SELECT enable_vtiger_integration,vtiger_server_ip,vtiger_dbname,vtiger_login,vtiger_pass,vtiger_url FROM vicidial_campaigns where campaign_id='$campaign_id';";
				$rslt=mysql_query($stmt, $link);
				if ($DB) {echo "$stmt\n";}
				$ss_conf_ct = mysql_num_rows($rslt);
				if ($ss_conf_ct > 0)
				{
					$row=mysql_fetch_row($rslt);
					$enable_vtiger_integration =	$row[0];
					$vtiger_server_ip	=			$row[1];
					$vtiger_dbname =				$row[2];
					$vtiger_login =					$row[3];
					$vtiger_pass =					$row[4];
					$vtiger_url =					$row[5];
				}
				##### END SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
				#############################################################

				if ($enable_vtiger_integration > 0)
				{
					### connect to your vtiger database
					$linkV=mysql_connect("$vtiger_server_ip", "$vtiger_login","$vtiger_pass");
					if (!$linkV) {die("Could not connect: $vtiger_server_ip|$vtiger_dbname|$vtiger_login|$vtiger_pass" . mysql_error());}
					echo 'Connected successfully';
					mysql_select_db("$vtiger_dbname", $linkV);

					$user_name =		$user;
					$user_password =	$pass;
					$last_name =		$full_name;
					$is_admin =			'off';
					$roleid =			'H5';
					$status =			'Active';
					$groupid =			'1';
					if ($user_level >= 7) {$roleid = 'H3';}
					if ($user_level >= 8) {$roleid = 'H4';}
					if ($user_level >= 9) {$roleid = 'H2';}
					if ($user_level >= 9) {$is_admin = 'on';}
					$salt = substr($user_name, 0, 2);
					$salt = '$1$' . $salt . '$';
					$encrypted_password = crypt($user_password, $salt);

					######################################
					##### BEGIN Add/Update group info in Vtiger
					$stmt="SELECT count(*) from vtiger_groups where groupname='$user_group';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$group_found_count = $row[0];

					### group exists in vtiger, update it
					if ($group_found_count > 0)
					{
						$stmt="SELECT groupid from vtiger_groups where groupname='$user_group';";
						$rslt=mysql_query($stmt, $linkV);
						if ($DB) {echo "$stmt\n";}
						if (!$rslt) {die('Could not execute: ' . mysql_error());}
						$row=mysql_fetch_row($rslt);
						$groupid = $row[0];
					}

					### user doesn't exist in vtiger, insert it
					else
					{
						#### BEGIN CREATE NEW GROUP RECORD IN VTIGER
						# Get next available id from vtiger_users_seq to use as groupid
						$stmt="SELECT id from vtiger_users_seq;";
						if ($DB) {echo "$stmt\n";}
						$rslt=mysql_query($stmt, $linkV);
						$row=mysql_fetch_row($rslt);
						$groupid = ($row[0] + 1);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						# Increase next available groupid with 1 so next record gets proper id
						$stmt="UPDATE vtiger_users_seq SET id = '$groupid';";
						if ($DB) {echo "$stmt\n";}
						$rslt=mysql_query($stmt, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						$stmtA = "INSERT INTO vtiger_groups SET groupid='$groupid',groupname='$user_group',description='';";
						if ($DB) {echo "|$stmtA|\n";}
						$rslt=mysql_query($stmtA, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						#### END CREATE NEW GROUP RECORD IN VTIGER
					}
					##### END Add/Update group info in Vtiger
					######################################

					######################################
					##### BEGIN Add/Update user info in Vtiger
					$stmt="SELECT count(*) from vtiger_users where user_name='$user_name';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$found_count = $row[0];

					### user exists in vtiger, update it
					if ($found_count > 0)
					{
						$stmt="SELECT id from vtiger_users where user_name='$user_name';";
						$rslt=mysql_query($stmt, $linkV);
						if ($DB) {echo "$stmt\n";}
						if (!$rslt) {die('Could not execute: ' . mysql_error());}
						$row=mysql_fetch_row($rslt);
						$userid = $row[0];

						$stmt="SELECT count(*) from vtiger_users2group WHERE userid='$userid' and groupid='$groupid';";
						$rslt=mysql_query($stmt, $linkV);
						if ($DB) {echo "$stmt\n";}
						if (!$rslt) {die('Could not execute: ' . mysql_error());}
						$row=mysql_fetch_row($rslt);
						$usergroupcount = $row[0];
						mysql_query("set names utf8");
						$stmtA = "UPDATE vtiger_users SET user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status' where id='$userid';";
						if ($DB) {echo "|$stmtA|\n";}
						$rslt=mysql_query($stmtA, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						$stmtB = "UPDATE vtiger_user2role SET roleid='$roleid' where userid='$userid';";
						if ($DB) {echo "|$stmtB|\n";}
						$rslt=mysql_query($stmtB, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						if ($usergroupcount < 1)
						{
							$stmt="SELECT user_group FROM vicidial_user_groups;";
							$rslt=mysql_query($stmt, $link);
							if ($DB) {echo "$stmt\n";}
							$VD_groups_ct = mysql_num_rows($rslt);
							$k=0;
							$VD_groups_list='';
							while ($k < $VD_groups_ct)
							{
								$row=mysql_fetch_row($rslt);
								$VD_groups_list .= "'$row[0]',";
								$k++;
							}
							$VD_groups_list = preg_replace("/.$/",'',$VD_groups_list);

							$stmtC = "DELETE FROM vtiger_users2group WHERE userid='$userid' and groupid IN(SELECT groupid from vtiger_groups where groupname IN($VD_groups_list));";
							if ($DB) {echo "|$stmtC|\n";}
							$rslt=mysql_query($stmtC, $linkV);
							if (!$rslt) {die('Could not execute: ' . mysql_error());}

							$stmtD = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
							if ($DB) {echo "|$stmtD|\n";}
							$rslt=mysql_query($stmtD, $linkV);
							if (!$rslt) {die('Could not execute: ' . mysql_error());}
						}
					}

					### user doesn't exist in vtiger, insert it
					else
					{
						#### BEGIN CREATE NEW USER RECORD IN VTIGER
						$stmtA = "INSERT INTO vtiger_users SET user_name='$user_name',user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status',date_format='yyyy-mm-dd',first_name='',reports_to_id='',description='',title='',department='',phone_home='',phone_mobile='',phone_work='',phone_other='',phone_fax='',email1='',email2='',yahoo_id='',signature='',address_street='',address_city='',address_state='',address_country='',address_postalcode='',user_preferences='',imagename='';";
						if ($DB) {echo "|$stmtA|\n";}
						$rslt=mysql_query($stmtA, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}
						$userid = mysql_insert_id($linkV);
					
						$stmtB = "INSERT INTO vtiger_user2role SET userid='$userid',roleid='$roleid';";
						if ($DB) {echo "|$stmtB|\n";}
						$rslt=mysql_query($stmtB, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						$stmtC = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
						if ($DB) {echo "|$stmtC|\n";}
						$rslt=mysql_query($stmtC, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						$stmtD = "UPDATE vtiger_users_seq SET id='$userid';";
						if ($DB) {echo "|$stmtD|\n";}
						$rslt=mysql_query($stmtD, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						#### END CREATE NEW USER RECORD IN VTIGER
					}
					##### END Add/Update user info in Vtiger
					######################################
				}
				### END vtiger integration
				$itotal ++;
			}

		}
		sort($arr_exit_user);
		$exit_user_list = implode(", " , $arr_exit_user);
		$exit_user_string = "<br>The User of '".$exit_user_list."' is already a User Name in the system\n";
		if($exit_user_list != '') echo $exit_user_string;
		echo "<br><B>USER COPIED SUCCEEDED : $itotal Users copied from $source_user_id</B>\n";
		echo "<br><br>\n";
		echo "</FONT>\n";

###### start Synchronize users with CRM 2011-09-21 add by pie;
		$stmt="SELECT user_group from vicidial_users where user='$source_user_id' limit 1;";
	//	echo $stmt."<br>";
		$rslt=mysql_query("SET NAMES 'UTF8'");
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$user_group					=$row[0];
	//	echo $user_group."<br>";
######  同步Users 到CRM的另一种方式：即批量添加完Users后，再单击以下链接进行同步;
//		echo " <br><B><a href=\"./integrate_vtiger_group.php?user_group=$user_group\" target=\"_blank\">Click here to Synchronize users with CRM</a></B>\n";
################################################################## 
		$stmt="SELECT ccms_url from system_settings;";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$ccms_url_link = $row[0];
	//	echo $ccms_url_link."<br>";
		$url_link = $ccms_url_link."integrate_vtiger_group.php?user_group=".$user_group;
	//	echo $url_link."<br>";
		file("$url_link");
###### end Synchronize users with CRM;

	}
	$ADD="1C";
}



######################
# ADD=1C display the BATCH COPY USER FORM SCREEN
######################

if ($ADD=="1C")
{
	if ($LOGmodify_users==1)
	{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
//		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_users' and active='1';";
//		$rslt=mysql_query($stmt, $link);
//		$voi_ct = mysql_num_rows($rslt);
//		if ($voi_ct > 0)
//		{
//			$row=mysql_fetch_row($rslt);
//			$voi_count = "$row[0]";
//		}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
		echo "<br>BATCH COPY USER<form onSubmit=\"return contentFilter('User Number Suffix From,user_name_suffix_from,3&&&To,user_name_suffix_to,3')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=2C>\n";
		echo "<input type=hidden name=user_toggle id=user_toggle value=0>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>User Number Prefix: </td><td align=left><input type=text name=user_name_prefix id=user_name_prefix size=20 maxlength=20>$NWB#user-number-prefix$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>User Number Suffix From: </td><td align=left><input type=text name=user_name_suffix_from id=user_name_suffix_from size=20 maxlength=20>&nbsp;&nbsp;&nbsp;&nbsp;To:&nbsp;<input type=text name=user_name_suffix_to id=user_name_suffix_to size=20 maxlength=20 >$NWB#user-number-suffix$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Password: </td><td align=left><input type=text name=pass size=20 maxlength=20 >$NWB#user-number-password$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active ><option selected=\"selected\">Y</option><option>N</option></select>$NWB#user-number-active$NWE</td></tr>\n";
		/*
		if ($LOGuser_level==9) {$levelMAX=10;}
		else {$levelMAX=$LOGuser_level;}
		*/
		echo "<tr bgcolor=#FFFFFF><td align=right>Source User: </td><td align=left><select size=1 name=source_user_id >\n";
		
		/*comment by heibo 2011-4-22 9:40:29 统一成一个函数
		$wherecondition_sql = "";
		if($LOGuser_level == 9){
			$wherecondition_sql = " where 1 $SQLstatus $SQLorder";
		}else{
			$wherecondition_sql = " where user_level<=$LOGuser_level and user_group in (select distinct(user_group) from vicidial_user_groups where manager='$LOGuser_name_id' or supervisor='$LOGuser_name_id') $SQLstatus $SQLorder";
		}
		$stmt="SELECT user,full_name from vicidial_users $wherecondition_sql";
		*/
		$stmt = getUsersList($LOGuser_level,$LOGuser_name_id,$SQLstatus,$SQLorder);
		
		//$stmt="SELECT user,full_name from vicidial_users where user_level < $levelMAX order by full_name;";
		$rslt=mysql_query($stmt, $link);
		$Uusers_to_print = mysql_num_rows($rslt);
		$Uusers_list='';

		$o=0;
		while ($Uusers_to_print > $o) 
		{
			$rowx=mysql_fetch_row($rslt);
			$Uusers_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
		}
		echo "$Uusers_list";
		echo "</select>$NWB#user-number-source-user$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
	}
	else
	{
		echo "You do not have permission to view this page\n";
		exit;
	}
}



######################
# ADD=11 display the ADD NEW CAMPAIGN FORM SCREEN
######################

if ($ADD==11)
	{
	
	if ($LOGadd_new_campaigns==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_campaigns' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW CAMPAIGN<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=21>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Campaign ID: </td><td align=left>Auto-Generated $NWB#vicidial_campaigns-campaign_id$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Campaign ID: </td><td align=left><input type=text name=campaign_id size=10 maxlength=8>$NWB#vicidial_campaigns-campaign_id$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Name: </td><td align=left><input type=text name=campaign_name size=30 maxlength=30>$NWB#vicidial_campaigns-campaign_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Description: </td><td align=left><input type=text name=campaign_description size=30 maxlength=255>$NWB#vicidial_campaigns-campaign_description$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option>N</option></select>$NWB#vicidial_campaigns-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Park Extension: </td><td align=left><input type=text name=park_ext size=10 maxlength=10>$NWB#vicidial_campaigns-park_ext$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Park Filename: </td><td align=left><input type=text name=park_file_name size=10 maxlength=10>$NWB#vicidial_campaigns-park_file_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Web Form: </td><td align=left><input type=text name=web_form_address size=70 maxlength=1055>$NWB#vicidial_campaigns-web_form_address$NWE</td></tr>\n";
		if ($SSoutbound_autodial_active > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Allow Closers: </td><td align=left><select size=1 name=allow_closers><option>Y</option><option>N</option></select>$NWB#vicidial_campaigns-allow_closers$NWE</td></tr>\n";
			echo "<tr bgcolor=#C2C2C2><td align=right>Hopper Level: </td><td align=left><select size=1 name=hopper_level><option>1</option><option>5</option><option>10</option><option>20</option><option>50</option><option>100</option><option>200</option><option>500</option><option>1000</option><option>2000</option></select>$NWB#vicidial_campaigns-hopper_level$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>Auto Dial Level: </td><td align=left><select size=1 name=auto_dial_level><option selected>$auto_dial_level</option>\n";
			$adl=0;
			while($adl <= $SSauto_dial_limit)
				{
				echo "<option>$adl</option>\n";
				if ($adl < 1)
					{$adl = ($adl + 1);}
				else
					{
					if ($adl < 3)
						{$adl = ($adl + 0.1);}
					else
						{
						if ($adl < 4)
							{$adl = ($adl + 0.25);}
						else
							{
							if ($adl < 5)
								{$adl = ($adl + 0.5);}
							else
								{
								if ($adl < 10)
									{$adl = ($adl + 1);}
								else
									{
									if ($adl < 20)
										{$adl = ($adl + 2);}
									else
										{
										if ($adl < 40)
											{$adl = ($adl + 5);}
										else
											{
											if ($adl < 200)
												{$adl = ($adl + 10);}
											else
												{
												if ($adl < 400)
													{$adl = ($adl + 50);}
												else
													{
													if ($adl < 1000)
														{$adl = ($adl + 100);}
													else
														{$adl = ($adl + 1);}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			echo "<option>$adl</option></select>(0 = off)$NWB#vicidial_campaigns-auto_dial_level$NWE</td></tr>\n";
			}

		echo "<tr bgcolor=#FFFFFF><td align=right>Next Agent Call: </td><td align=left><select size=1 name=next_agent_call><option>random</option><option $auto_display>oldest_call_start</option><option $auto_display>oldest_call_finish</option><option $auto_display>overall_user_level</option><option $auto_display>campaign_rank</option><option $auto_display>fewest_calls</option><option>longest_wait_time</option>";
		if($inbound_mode=='ring')
			{
		    echo "<option>roundrobin</option><option>ringall</option>";
			}
		echo "</select>$NWB#vicidial_campaigns-next_agent_call$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Local Call Time: </td><td align=left><select size=1 name=local_call_time>";
		echo "$call_times_list";
		echo "</select>$NWB#vicidial_campaigns-local_call_time$NWE</td></tr>\n";
		if ($SSoutbound_autodial_active > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Voicemail: </td><td align=left><input type=text name=voicemail_ext size=10 maxlength=10 value=\"$voicemail_ext\">$NWB#vicidial_campaigns-voicemail_ext$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Script: </td><td align=left><select size=1 name=script_id>\n";
		echo "$scripts_list";
		echo "</select>$NWB#vicidial_campaigns-campaign_script$NWE</td></tr>\n";

		$eswHTML='';
		if ($SSenable_second_webform > 0)
			{$eswHTML = '<option>WEBFORMTWO</option>';}
		echo "<tr bgcolor=#FFFFFF><td align=right>Get Call Launch: </td><td align=left><select size=1 name=get_call_launch><option selected>NONE</option><option>SCRIPT</option><option>WEBFORM</option>$eswHTML</select>$NWB#vicidial_campaigns-get_call_launch$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=12 display the COPY CAMPAIGN FORM SCREEN
######################

if ($ADD==12)
	{
	if ($LOGmodify_campaigns==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_campaigns' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>COPY A CAMPAIGN<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=20>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Campaign ID: </td><td align=left>Auto-Generated $NWB#vicidial_campaigns-campaign_id$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Campaign ID: </td><td align=left><input type=text name=campaign_id size=10 maxlength=8>$NWB#vicidial_campaigns-campaign_id$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Name: </td><td align=left><input type=text name=campaign_name size=30 maxlength=30>$NWB#vicidial_campaigns-campaign_name$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Source Campaign: </td><td align=left><select size=1 name=source_campaign_id>\n";

		//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
		$stmt=getCampaignSql($LOGuser_level,$LOGuser_name_id);
		$rslt=mysql_query($stmt, $link);
		$campaigns_to_print = mysql_num_rows($rslt);
		$campaigns_list='';

		$o=0;
		while ($campaigns_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$campaigns_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "$campaigns_list";
		echo "</select>$NWB#vicidial_campaigns-campaign_id$NWE</td></tr>\n";
		
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2>NOTE: Copying a campaign will copy all settings from the master campaign you select, but it will not copy a campaign-specific DNC list if there was one on the selected master campaign.</td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=111 display the ADD NEW LIST FORM SCREEN
######################

if ($ADD==111)
	{
	
	if ($LOGadd_new_lists==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_lists' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW LIST<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=211>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>List ID: </td><td align=left>Auto-Generated $NWB#vicidial_lists-list_id$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>List ID: </td><td align=left><input type=text name=list_id size=8 maxlength=8> (digits only)$NWB#vicidial_lists-list_id$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>List Name: </td><td align=left><input type=text name=list_name size=20 maxlength=20>$NWB#vicidial_lists-list_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>List Description: </td><td align=left><input type=text name=list_description size=30 maxlength=255>$NWB#vicidial_lists-list_description$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign: </td><td align=left><select size=1 name=campaign_id>\n";
		
		$stmt=getCampaignSql($LOGuser_level,$LOGuser_name_id);

		$rslt=mysql_query($stmt, $link);
		$campaigns_to_print = mysql_num_rows($rslt);
		$campaigns_list='';

		$o=0;
		while ($campaigns_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$campaigns_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "$campaigns_list";
		echo "<option SELECTED>$campaign_id</option>\n";
		echo "</select>$NWB#vicidial_lists-campaign_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option SELECTED>N</option></select>$NWB#vicidial_lists-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=121 display the ADD NUMBER TO DNC FORM SCREEN and add a new number
######################

if ($ADD==121)
	{
	if ($LOGadd_from_dnc==1 || $LOGdelete_from_dnc==1)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	if (isset($_GET["dnc_notes"]))			{$dnc_notes=$_GET["dnc_notes"];}	
	elseif (isset($_POST["dnc_notes"]))	{$dnc_notes=$_POST["dnc_notes"];}
	
	$campaigns_list = "<option SELECTED value=\"SYSTEM_INTERNAL\">SYSTEM</option>\n";
	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns where use_campaign_dnc IN('Y','AREACODE') order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id,'Y');
	//echo $stmt;
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);
	$o=0;
	$campaigns_arr_temp = array();
	while ($campaigns_to_print > $o) 
		{
		$rowx=mysql_fetch_row($rslt);
		$campaigns_arr_temp[] = "'" . $rowx[0] . "'";
		$o++;
		}
	$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns where use_campaign_dnc IN('Y','AREACODE') and campaign_id in (" . implode(",",$campaigns_arr_temp) . ") order by campaign_id";
	//echo $stmt;
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);
	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$rowx=mysql_fetch_row($rslt);
		$campaigns_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
		$o++;
		}
	if (strlen($phone_numbers) > 2)
		{
		$PN = explode("\n",$phone_numbers);
		$PNct = count($PN);
		$p=0;
		
		while ($p < $PNct)
			{
			//Add By Fnatic Start

            $PN[$p]=trim($PN[$p]);
			if($PN[$p]!=""){
			$PN[$p] = ereg_replace("\\\\r","",$PN[$p]);
			$PN[$p] = ereg_replace("\\r","",$PN[$p]);
			//Add By Fnatic End
			if ( (ereg('delete',$stage)) and ($LOGdelete_from_dnc > 0) )
				{
				##### BEGIN DELETE FROM DNC #####
				if (ereg('SYSTEM_INTERNAL',$campaign_id))
					{
					$stmt="SELECT count(*) from vicidial_dnc where phone_number='$PN[$p]';";
					$rslt=mysql_query($stmt, $link);
					$row=mysql_fetch_row($rslt);
					if ($row[0] < 1)
						{echo "<br>DNC NOT DELETED - This phone number is not in the Do Not Call List: $PN[$p]\n";}
					else
						{
						$stmt="DELETE FROM vicidial_dnc where phone_number='$PN[$p]';";
						$rslt=mysql_query($stmt, $link);

						echo "<br><B>DNC DELETED: $PN[$p]</B>\n";

						### LOG INSERTION Admin Log Table ###
						$SQL_log = "$stmt|";
						$SQL_log = ereg_replace(';','',$SQL_log);
						$SQL_log = addslashes($SQL_log);
						$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='DELETE', record_id='$PN[$p]', event_code='ADMIN DELETE NUMBER FROM DNC LIST', event_sql=\"$SQL_log\", event_notes='$dnc_notes'";
						if ($DB) {echo "|$stmt|\n";}
						$rslt=mysql_query($stmt, $link);
						}
					}
				else
					{
					$stmt="SELECT count(*) from vicidial_campaign_dnc where phone_number='$PN[$p]' and campaign_id='$campaign_id';";
					$rslt=mysql_query($stmt, $link);
					$row=mysql_fetch_row($rslt);
					if ($row[0] < 1)
						{echo "<br>DNC NOT DELETED - This phone number is not in the Do Not Call List: $PN[$p] $campaign_id\n";}
					else
						{
						$stmt="DELETE FROM vicidial_campaign_dnc where phone_number='$PN[$p]' and campaign_id='$campaign_id';";
						$rslt=mysql_query($stmt, $link);

						echo "<br><B>DNC DELETED: $PN[$p] $campaign_id</B>\n";

						### LOG INSERTION Admin Log Table ###
						$SQL_log = "$stmt|";
						$SQL_log = ereg_replace(';','',$SQL_log);
						$SQL_log = addslashes($SQL_log);
						$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='DELETE', event_notes='$dnc_notes', record_id='$PN[$p]', event_code='ADMIN DELETE NUMBER FROM CAMPAIGN DNC LIST $campaign_id', event_sql=\"$SQL_log\"";
						if ($DB) {echo "|$stmt|\n";}
						$rslt=mysql_query($stmt, $link);
						//echo $stmt;
						}
					}
				##### END DELETE FROM DNC #####
				}
			else
				{
				##### BEGIN ADD TO DNC #####
				if (ereg('SYSTEM_INTERNAL',$campaign_id))
					{
					$stmt="SELECT count(*) from vicidial_dnc where phone_number='$PN[$p]';";
					$rslt=mysql_query($stmt, $link);
					$row=mysql_fetch_row($rslt);
					if ($row[0] > 0)
						{echo "<br>DNC NOT ADDED - This phone number is already in the Do Not Call List: $PN[$p]\n";}
					else
						{
						$stmt="INSERT INTO vicidial_dnc (phone_number) values('$PN[$p]');";
						$rslt=mysql_query($stmt, $link);

						echo "<br><B>DNC ADDED: $PN[$p]</B>\n";

						### LOG INSERTION Admin Log Table ###
						$SQL_log = "$stmt|";
						$SQL_log = ereg_replace(';','',$SQL_log);
						$SQL_log = addslashes($SQL_log);
						$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='ADD', event_notes='$dnc_notes', record_id='$PN[$p]', event_code='ADMIN ADD NUMBER TO DNC LIST', event_sql=\"$SQL_log\"";
//						echo $dnc_notes."<hr>";
//						echo $stmt."<hr>";
						if ($DB) {echo "|$stmt|\n";}
						$rslt=mysql_query($stmt, $link);
						}
					}
				else
					{
					$stmt="SELECT count(*) from vicidial_campaign_dnc where phone_number='$PN[$p]' and campaign_id='$campaign_id';";
					$rslt=mysql_query($stmt, $link);
					$row=mysql_fetch_row($rslt);
					if ($row[0] > 0)
						{echo "<br>DNC NOT ADDED - This phone number is already in the Do Not Call List: $PN[$p] $campaign_id\n";}
					else
						{
						$stmt="INSERT INTO vicidial_campaign_dnc (phone_number,campaign_id) values('$PN[$p]','$campaign_id');";
						$rslt=mysql_query($stmt, $link);

						echo "<br><B>DNC ADDED: $PN[$p] $campaign_id</B>\n";

						### LOG INSERTION Admin Log Table ###
						$SQL_log = "$stmt|";
						$SQL_log = ereg_replace(';','',$SQL_log);
						$SQL_log = addslashes($SQL_log);
						$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='ADD', record_id='$PN[$p]', event_code='ADMIN ADD NUMBER TO CAMPAIGN DNC LIST $campaign_id', event_sql=\"$SQL_log\", event_notes='$dnc_notes';";
						if ($DB) {echo "|$stmt|\n";}
						$rslt=mysql_query($stmt, $link);
						}
					}
				##### END ADD TO DNC #####
				}
			}
			$p++;
			}
		}

	if ($LOGdelete_from_dnc > 0)
		{echo "<br>ADD OR DELETE NUMBERS FROM THE OUTBOUND DNC LIST<form onSubmit=\"return dnc_phone_numbers('phone_numbers')\" action=$PHP_SELF method=POST>\n";}
	else
		{echo "<br>ADD NUMBERS TO THE DNC LIST<form onSubmit=\"return dnc_phone_numbers('phone_numbers')\" action=$PHP_SELF method=POST>\n";}
	echo "<script type=\"text/javascript\" src=\"./new_style/Popup.js\"></script>\n";
	echo "<input type=hidden name=ADD value=121>\n";
	echo "<center><TABLE width=$section_width cellspacing=3>\n";
	echo "<tr bgcolor=#FFFFFF><td align=right>List: </td><td align=left><select size=1 name=campaign_id id=campaign_id  onchange=\"changeDncLinkPara();\">\n";
	echo "$campaigns_list";
	echo "</select>&nbsp;&nbsp;<a href=\"./dnc.php?action=dnc&list=SYSTEM_INTERNAL\" id=\"dnc_detail\" onclick=\"openWindow(this.href);return false;\">Detail</a>&nbsp;&nbsp;<a href=\"./dnc.php?list=SYSTEM_INTERNAL\" id=\"dnc_change_log\" onclick=\"openWindow(this.href);return false;\">Change Log</a></td></tr>\n";
	echo "<tr bgcolor=#FFFFFF><td align=right>Phone Numbers: <BR><BR> (one phone number per line only)<BR>$NWB#vicidial_list-dnc$NWE</td><td align=left><TEXTAREA name=phone_numbers ROWS=20 COLS=20></TEXTAREA></td></tr>\n";
	if (($LOGdelete_from_dnc > 0) && ($LOGadd_from_dnc >0))
	{
		echo "<tr bgcolor=#FFFFFF><td align=right>Add or Delete: </td><td align=left><select size=1 name=stage><option SELECTED>add</option><option>delete</option></select></td></tr>\n";
	}
	if (($LOGdelete_from_dnc ==1) && ($LOGadd_from_dnc == 0))
	{
		echo "<tr bgcolor=#FFFFFF><td align=right>Add or Delete: </td><td align=left><select size=1 name=stage><option SELECTED>delete</option></select></td></tr>\n";
	}
	if (($LOGdelete_from_dnc == 0) && ($LOGadd_from_dnc ==1))
	{
		echo "<tr bgcolor=#FFFFFF><td align=right>Add or Delete: </td><td align=left><select size=1 name=stage><option SELECTED>add</option></select></td></tr>\n";
	}
	echo "<tr bgcolor=#FFFFFF><td align=right>Notes: </td><td align=left><input type=text name=dnc_notes size=60 maxlength=60></td></tr>\n";
	echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
	echo "</TABLE></center>\n";
	}else{
		echo "You do not have permission to view this page\n";
		exit;
	}
	}

if ($ADD==121121)
	{
	if ($LOGadd_from_dnc==1 || $LOGdelete_from_dnc==1)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	if (isset($_GET["dnc_notes"]))			{$dnc_notes=$_GET["dnc_notes"];}	
	elseif (isset($_POST["dnc_notes"]))	{$dnc_notes=$_POST["dnc_notes"];}
	
	$campaigns_list = "<option SELECTED value=\"SYSTEM_INTERNAL\">SYSTEM</option>\n";
	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns where use_campaign_dnc IN('Y','AREACODE') order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id,'Y');
	//echo $stmt;
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);
	$o=0;
	$campaigns_arr_temp = array();
	while ($campaigns_to_print > $o) 
		{
		$rowx=mysql_fetch_row($rslt);
		$campaigns_arr_temp[] = "'" . $rowx[0] . "'";
		$o++;
		}
	$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns where use_campaign_dnc IN('Y','AREACODE') and campaign_id in (" . implode(",",$campaigns_arr_temp) . ") order by campaign_id";
	//echo $stmt;
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);
	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$rowx=mysql_fetch_row($rslt);
		$campaigns_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
		$o++;
		}
	if (strlen($phone_numbers) > 2)
		{
		$PN = explode("\n",$phone_numbers);
		$PNct = count($PN);
		$p=0;
		
		while ($p < $PNct)
			{
			//Add By Fnatic Start

            $PN[$p]=trim($PN[$p]);
			if($PN[$p]!=""){
			$PN[$p] = ereg_replace("\\\\r","",$PN[$p]);
			$PN[$p] = ereg_replace("\\r","",$PN[$p]);
			//Add By Fnatic End
			if ( (ereg('delete',$stage)) and ($LOGdelete_from_dnc > 0) )
				{
				##### BEGIN DELETE FROM DNC #####
				if (ereg('SYSTEM_INTERNAL',$campaign_id))
					{
					$stmt="SELECT count(*) from vicidial_dnc_inbound where phone_number='$PN[$p]';";
					$rslt=mysql_query($stmt, $link);
					$row=mysql_fetch_row($rslt);
					if ($row[0] < 1)
						{echo "<br>DNC NOT DELETED - This phone number is not in the Do Not Call List: $PN[$p]\n";}
					else
						{
						$stmt="DELETE FROM vicidial_dnc_inbound where phone_number='$PN[$p]';";
						$rslt=mysql_query($stmt, $link);

						echo "<br><B>DNC DELETED: $PN[$p]</B>\n";

						### LOG INSERTION Admin Log Table ###
						$SQL_log = "$stmt|";
						$SQL_log = ereg_replace(';','',$SQL_log);
						$SQL_log = addslashes($SQL_log);
						$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='DELETE', record_id='$PN[$p]', event_code='ADMIN DELETE NUMBER FROM DNC LIST', event_sql=\"$SQL_log\", event_notes='$dnc_notes'";
						if ($DB) {echo "|$stmt|\n";}
						$rslt=mysql_query($stmt, $link);
						}
					}
				else
					{
					$stmt="SELECT count(*) from vicidial_campaign_dnc_inbound where phone_number='$PN[$p]' and campaign_id='$campaign_id';";
					$rslt=mysql_query($stmt, $link);
					$row=mysql_fetch_row($rslt);
					if ($row[0] < 1)
						{echo "<br>DNC NOT DELETED - This phone number is not in the Do Not Call List: $PN[$p] $campaign_id\n";}
					else
						{
						$stmt="DELETE FROM vicidial_campaign_dnc_inbound where phone_number='$PN[$p]' and campaign_id='$campaign_id';";
						$rslt=mysql_query($stmt, $link);

						echo "<br><B>DNC DELETED: $PN[$p] $campaign_id</B>\n";

						### LOG INSERTION Admin Log Table ###
						$SQL_log = "$stmt|";
						$SQL_log = ereg_replace(';','',$SQL_log);
						$SQL_log = addslashes($SQL_log);
						$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='DELETE', event_notes='$dnc_notes', record_id='$PN[$p]', event_code='ADMIN DELETE NUMBER FROM CAMPAIGN DNC LIST $campaign_id', event_sql=\"$SQL_log\"";
						if ($DB) {echo "|$stmt|\n";}
						$rslt=mysql_query($stmt, $link);
						//echo $stmt;
						}
					}
				##### END DELETE FROM DNC #####
				}
			else
				{
				##### BEGIN ADD TO DNC #####
				if (ereg('SYSTEM_INTERNAL',$campaign_id))
					{
					$stmt="SELECT count(*) from vicidial_dnc_inbound where phone_number='$PN[$p]';";
					$rslt=mysql_query($stmt, $link);
					$row=mysql_fetch_row($rslt);
					if ($row[0] > 0)
						{echo "<br>DNC NOT ADDED - This phone number is already in the Do Not Call List: $PN[$p]\n";}
					else
						{
						$stmt="INSERT INTO vicidial_dnc_inbound (phone_number) values('$PN[$p]');";
						$rslt=mysql_query($stmt, $link);

						echo "<br><B>DNC ADDED: $PN[$p]</B>\n";

						### LOG INSERTION Admin Log Table ###
						$SQL_log = "$stmt|";
						$SQL_log = ereg_replace(';','',$SQL_log);
						$SQL_log = addslashes($SQL_log);
						$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='ADD', event_notes='$dnc_notes', record_id='$PN[$p]', event_code='ADMIN ADD NUMBER TO DNC LIST', event_sql=\"$SQL_log\"";
//						echo $dnc_notes."<hr>";
//						echo $stmt."<hr>";
						if ($DB) {echo "|$stmt|\n";}
						$rslt=mysql_query($stmt, $link);
						}
					}
				else
					{
					$stmt="SELECT count(*) from vicidial_campaign_dnc_inbound where phone_number='$PN[$p]' and campaign_id='$campaign_id';";
					$rslt=mysql_query($stmt, $link);
					$row=mysql_fetch_row($rslt);
					if ($row[0] > 0)
						{echo "<br>DNC NOT ADDED - This phone number is already in the Do Not Call List: $PN[$p] $campaign_id\n";}
					else
						{
						$stmt="INSERT INTO vicidial_campaign_dnc_inbound (phone_number,campaign_id) values('$PN[$p]','$campaign_id');";
						$rslt=mysql_query($stmt, $link);

						echo "<br><B>DNC ADDED: $PN[$p] $campaign_id</B>\n";

						### LOG INSERTION Admin Log Table ###
						$SQL_log = "$stmt|";
						$SQL_log = ereg_replace(';','',$SQL_log);
						$SQL_log = addslashes($SQL_log);
						$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='ADD', record_id='$PN[$p]', event_code='ADMIN ADD NUMBER TO CAMPAIGN DNC LIST $campaign_id', event_sql=\"$SQL_log\", event_notes='$dnc_notes';";
						if ($DB) {echo "|$stmt|\n";}
						$rslt=mysql_query($stmt, $link);
						}
					}
				##### END ADD TO DNC #####
				}
			}
			$p++;
			}
		}

	if ($LOGdelete_from_dnc > 0)
		{echo "<br>ADD OR DELETE NUMBERS FROM THE INBOUND DNC LIST<form onSubmit=\"return dnc_phone_numbers('phone_numbers')\" action=$PHP_SELF method=POST>\n";}
	else
		{echo "<br>ADD NUMBERS TO THE DNC LIST<form onSubmit=\"return dnc_phone_numbers('phone_numbers')\"  action=$PHP_SELF method=POST>\n";}
	echo "<script type=\"text/javascript\" src=\"./new_style/Popup.js\"></script>\n";
	echo "<input type=hidden name=ADD value=121121>\n";
	echo "<center><TABLE width=$section_width cellspacing=3>\n";
	echo "<tr bgcolor=#FFFFFF><td align=right>List: </td><td align=left><select size=1 name=campaign_id id=campaign_id  onchange=\"changeDncLinkPara2();\">\n";
	echo "$campaigns_list";
	echo "</select>&nbsp;&nbsp;<a href=\"./dnc.php?direction=inbound&action=dnc&list=SYSTEM_INTERNAL\" id=\"dnc_detail\" onclick=\"openWindow(this.href);return false;\">Detail</a>&nbsp;&nbsp;<a href=\"./dnc.php?direction=inbound&list=SYSTEM_INTERNAL\" id=\"dnc_change_log\" onclick=\"openWindow(this.href);return false;\">Change Log</a></td></tr>\n";
	echo "<tr bgcolor=#FFFFFF><td align=right>Phone Numbers: <BR><BR> (one phone number per line only)<BR>$NWB#vicidial_list-dnc$NWE</td><td align=left><TEXTAREA name=phone_numbers ROWS=20 COLS=20></TEXTAREA></td></tr>\n";
	if (($LOGdelete_from_dnc > 0) && ($LOGadd_from_dnc >0))
	{
		echo "<tr bgcolor=#FFFFFF><td align=right>Add or Delete: </td><td align=left><select size=1 name=stage><option SELECTED>add</option><option>delete</option></select></td></tr>\n";
	}
	if (($LOGdelete_from_dnc ==1) && ($LOGadd_from_dnc == 0))
	{
		echo "<tr bgcolor=#FFFFFF><td align=right>Add or Delete: </td><td align=left><select size=1 name=stage><option SELECTED>delete</option></select></td></tr>\n";
	}
	if (($LOGdelete_from_dnc == 0) && ($LOGadd_from_dnc ==1))
	{
		echo "<tr bgcolor=#FFFFFF><td align=right>Add or Delete: </td><td align=left><select size=1 name=stage><option SELECTED>add</option></select></td></tr>\n";
	}
	echo "<tr bgcolor=#FFFFFF><td align=right>Notes: </td><td align=left><input type=text name=dnc_notes size=60 maxlength=60></td></tr>\n";
	echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
	echo "</TABLE></center>\n";
	}else{
		echo "You do not have permission to view this page\n";
		exit;
	}
	}
######################
# ADD=1111 display the ADD NEW INBOUND GROUP SCREEN
######################

if ($ADD==1111)
	{
	if ($LOGmodify_ingroups==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_inbound_groups' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW INBOUND GROUP<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=2111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Group ID: </td><td align=left>Auto-Generated $NWB#vicidial_inbound_groups-group_id$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Group ID: </td><td align=left><input type=text name=group_id size=20 maxlength=20> (no spaces)$NWB#vicidial_inbound_groups-group_id$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Group Name: </td><td align=left><input type=text name=group_name size=30 maxlength=30>$NWB#vicidial_inbound_groups-group_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Group Color: </td><td align=left id=\"group_color_td\"><input type=text name=group_color size=7 maxlength=7>$NWB#vicidial_inbound_groups-group_color$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option SELECTED>Y</option><option>N</option></select>$NWB#vicidial_inbound_groups-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Web Form: </td><td align=left><input type=text name=web_form_address size=70 maxlength=1055 value=\"$web_form_address\">$NWB#vicidial_inbound_groups-web_form_address$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Voicemail: </td><td align=left><input type=text name=voicemail_ext size=10 maxlength=10 value=\"$voicemail_ext\">$NWB#vicidial_inbound_groups-voicemail_ext$NWE</td></tr>\n";
		#Add by fnatic start#
		echo "<tr bgcolor=#BCFF9B><td align=right>Inbound Mode: </td><td align=left><select size=1 id=inbound_mode name=inbound_mode onchange=\"changeRingMode();\">";
		echo "<option>auto</option><option>ring</option>";
		echo "</select>$NWB#vicidial_inbound_groups-inbound_mode$NWE</td></tr>\n";
		#End#

		$ring_display = " style=\"display:none;\"";
		$auto_display = "";

		echo "<tr id=\"ring_tr1\" bgcolor=#BCFF9B $ring_display><td align=right>Ring timeout Seconds: </td><td align=left><input type=text name=ring_timeout_seconds size=5 maxlength=2 value=\"\"></td></tr>\n";

		echo "<tr id=\"ring_tr6\" bgcolor=#FFFFFF $ring_display><td align=right>Next Agent Call: </td><td align=left><select size=1 name=next_agent_call_ring><option>roundrobin</option><option>ringall</option><option>random</option><option>longest_wait_time</option><option>inbound_group_rank</option><option>fewest_calls</option>";
		//echo "<option>longest_wait_time</option><option>random</option><option>roundrobin</option><option>ringall</option>";
		echo "</select>$NWB#vicidial_inbound_groups-next_agent_call$NWE</td></tr>\n";

		
		echo "<tr  id=\"auto_tr1\" bgcolor=#FFFFFF $auto_display><td align=right>Next Agent Call: </td><td align=left><select size=1 name=next_agent_call><option >random</option><option >longest_wait_time</option><option>oldest_call_start</option><option>oldest_call_finish</option><option>overall_user_level</option><option>inbound_group_rank</option><option>campaign_rank</option><option>fewest_calls</option><option>fewest_calls_campaign</option>";
		echo "</select>$NWB#vicidial_inbound_groups-next_agent_call$NWE</td></tr>\n";
			
		echo "<tr bgcolor=#FFFFFF><td align=right>Fronter Display: </td><td align=left><select size=1 name=fronter_display><option SELECTED>Y</option><option>N</option></select>$NWB#vicidial_inbound_groups-fronter_display$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Script: </td><td align=left><select size=1 name=script_id>\n";
		echo "$scripts_list";
		echo "</select>$NWB#vicidial_inbound_groups-ingroup_script$NWE</td></tr>\n";
		$eswHTML='';
		if ($SSenable_second_webform > 0)
			{$eswHTML = '<option>WEBFORMTWO</option>';}
		echo "<tr bgcolor=#FFFFFF><td align=right>Get Call Launch: </td><td align=left><select size=1 name=get_call_launch><option selected>NONE</option><option>SCRIPT</option><option>WEBFORM</option>$eswHTML</select>$NWB#vicidial_inbound_groups-get_call_launch$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=1211 display the COPY INBOUND GROUP SCREEN
######################

if ($ADD==1211)
	{
	if ($LOGmodify_ingroups==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_inbound_groups' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>COPY INBOUND GROUP<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=2011>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Group ID: </td><td align=left>Auto-Generated $NWB#vicidial_inbound_groups-group_id$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Group ID: </td><td align=left><input type=text name=group_id size=20 maxlength=20> (no spaces)$NWB#vicidial_inbound_groups-group_id$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Group Name: </td><td align=left><input type=text name=group_name size=30 maxlength=30>$NWB#vicidial_inbound_groups-group_name$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Source Group ID: </td><td align=left><select size=1 name=source_group_id>\n";

		$stmt="SELECT group_id,group_name from vicidial_inbound_groups order by group_id";
		$rslt=mysql_query($stmt, $link);
		$groups_to_print = mysql_num_rows($rslt);
		$groups_list='';

		$o=0;
		while ($groups_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$groups_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "$groups_list";
		echo "</select>$NWB#vicidial_inbound_groups-group_id$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=1311 display the ADD NEW DID SCREEN
######################

if ($ADD==1311)
	{
	if ($LOGmodify_dids==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW DID<form onSubmit=\"return contentFilter('DID Extension,did_pattern,2')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=2311>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DID Extension: </td><td align=left><input type=text name=did_pattern size=20 maxlength=50> (no spaces or dashes)$NWB#vicidial_inbound_dids-did_pattern$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DID Description: </td><td align=left><input type=text name=did_description size=40 maxlength=50>$NWB#vicidial_inbound_dids-did_description$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=1411 display the COPY DID SCREEN
######################

if ($ADD==1411)
	{
	if ($LOGmodify_dids==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>COPY DID<form onSubmit=\"return contentFilter('DID Extension,did_pattern,2')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=2411>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DID Extension: </td><td align=left><input type=text name=did_pattern size=20 maxlength=50> (no spaces or dashes)$NWB#vicidial_inbound_dids-did_pattern$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DID Description: </td><td align=left><input type=text name=did_description size=40 maxlength=50>$NWB#vicidial_inbound_dids-did_description$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Source DID: </td><td align=left><select size=1 name=source_did>\n";

		$stmt="SELECT did_id,did_pattern,did_description from vicidial_inbound_dids order by did_pattern";
		$rslt=mysql_query($stmt, $link);
		$dids_to_print = mysql_num_rows($rslt);
		$dids_list='';

		$o=0;
		while ($dids_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$dids_list .= "<option value=\"$rowx[0]\">$rowx[1] - $rowx[2]</option>\n";
			$o++;
			}
		echo "$dids_list";
		echo "</select>$NWB#vicidial_inbound_dids-did_pattern$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=1511 display the ADD NEW IVR SCREEN
######################

if ($ADD==1511)
	{
	if ($LOGmodify_dids==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_call_menu' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW IVR<form onSubmit=\"return contentFilter('Menu ID,menu_id,1')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=2511>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Menu ID: </td><td align=left>Auto-Generated $NWB#vicidial_call_menu-menu_id$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Menu ID: </td><td align=left><input type=text name=menu_id value=IVR_ size=40 maxlength=50> (no spaces or special characters)$NWB#vicidial_call_menu-menu_id$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Name: </td><td align=left><input type=text name=menu_name value=IVR_ size=50 maxlength=100>$NWB#vicidial_call_menu-menu_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=1611 display the COPY IVR SCREEN
######################

if ($ADD==1611)
	{
	if ($LOGmodify_dids==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_call_menu' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>COPY IVR<form onSubmit=\"return contentFilter('Menu ID,menu_id,1')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=2611>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Menu ID: </td><td align=left>Auto-Generated $NWB#vicidial_call_menu-menu_id$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Menu ID: </td><td align=left><input type=text name=menu_id size=40 maxlength=50> (no spaces or special characters)$NWB#vicidial_call_menu-menu_id$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Name: </td><td align=left><input type=text name=menu_name size=50 maxlength=100>$NWB#vicidial_call_menu-menu_name$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Source Menu: </td><td align=left><select size=1 name=source_menu>\n";

		$stmt="SELECT menu_id,menu_name from vicidial_call_menu order by menu_id";
		$rslt=mysql_query($stmt, $link);
		$menus_to_print = mysql_num_rows($rslt);
		$menus_list='';

		$o=0;
		while ($menus_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$menus_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "$menus_list";
		echo "</select>$NWB#vicidial_call_menu-menu_id$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=11111 display the ADD NEW REMOTE AGENTS SCREEN
######################

if ($ADD==11111)
	{
	if ($LOGmodify_remoteagents==1)
		{
		
		$stmt="SELECT group_id,group_name from vicidial_remote_agent_groups order by group_id";
		$rslt=mysql_query($stmt, $link);
		$remoteagentgroup_to_print = mysql_num_rows($rslt);
		$remoteagentgroup_list='';
		$o=0;
		while ($remoteagentgroup_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$remoteagentgroup_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW REMOTE AGENTS<form onSubmit=\"return contentFilter('User ID Start,user_start,2&&&Number of Lines,number_of_lines,2&&&External Extension,conf_exten,2')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=21111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>User ID Start: </td><td align=left><input type=text name=user_start size=6 maxlength=6> (numbers only, incremented)$NWB#vicidial_remote_agents-user_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Number of Lines: </td><td align=left><input type=text name=number_of_lines size=3 maxlength=3> (numbers only)$NWB#vicidial_remote_agents-number_of_lines$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server IP: </td><td align=left><select size=1 name=server_ip>\n";
		echo "$servers_list";
		echo "</select>$NWB#vicidial_remote_agents-server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>External Extension: </td><td align=left><input type=text name=conf_exten size=20 maxlength=20> (dial plan number dialed to reach agents)$NWB#vicidial_remote_agents-conf_exten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Status: </td><td align=left><select size=1 name=status><option>ACTIVE</option><option SELECTED>INACTIVE</option></select>$NWB#vicidial_remote_agents-status$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign: </td><td align=left><select size=1 name=campaign_id>\n";
		echo "$campaigns_list";
		echo "</select>$NWB#vicidial_remote_agents-campaign_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Remote Agent Group: </td><td align=left><select size=1 name=remoteagentgroup_id>\n";
		echo "$remoteagentgroup_list";
		echo "</select></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Inbound Groups: </td><td align=left>\n";
		echo "$groups_list";
		echo "$NWB#vicidial_remote_agents-closer_campaigns$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		echo "NOTE: It can take up to 30 seconds for changes submitted on this screen to go live\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=111111 display the ADD NEW USERS GROUP SCREEN
######################

if ($ADD==111111)
	{
	if ($LOGadd_new_usergroups==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_user_groups' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW USERS GROUP<form onSubmit=\"return contentFilter('Group,user_group,1')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=211111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Group: </td><td align=left>Auto-Generated $NWB#vicidial_user_groups-user_group$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Group: </td><td align=left><input type=text name=user_group size=15 maxlength=20> (no spaces or punctuation)$NWB#vicidial_user_groups-user_group$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Description: </td><td align=left><input type=text name=group_name size=40 maxlength=40> (description of group)$NWB#vicidial_user_groups-group_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=1111111 display the ADD NEW SCRIPT SCREEN
######################

if ($ADD==1111111)
	{
	if ($LOGmodify_scripts==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_scripts' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW SCRIPT<form onSubmit=\"return contentFilter('Script ID,script_id,1')\" name=scriptForm action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=2111111>\n";
		echo "<input type=hidden name=DB value=\"$DB\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Script ID: </td><td align=left>Auto-Generated $NWB#vicidial_scripts-script_id$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Script ID: </td><td align=left><input type=text name=script_id size=12 maxlength=10> (no spaces or punctuation)$NWB#vicidial_scripts-script_id$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Script Name: </td><td align=left><input type=text name=script_name size=40 maxlength=50> (title of the script)$NWB#vicidial_scripts-script_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Script Comments: </td><td align=left><input type=text name=script_comments size=50 maxlength=255> $NWB#vicidial_scripts-script_comments$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option SELECTED>Y</option><option>N</option></select>$NWB#vicidial_scripts-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Script Text: </td><td align=left>";
		# BEGIN Insert Field
		echo "<select id=\"selectedField\" name=\"selectedField\">";
		echo "<option>vendor_lead_code</option>";
		echo "<option>source_id</option>";
		echo "<option>list_id</option>";
		echo "<option>list_name</option>";
		echo "<option>list_description</option>";
		echo "<option>gmt_offset_now</option>";
		echo "<option>called_since_last_reset</option>";
		echo "<option>phone_code</option>";
		echo "<option>phone_number</option>";
		echo "<option>title</option>";
		echo "<option>first_name</option>";
		echo "<option>middle_initial</option>";
		echo "<option>last_name</option>";
		echo "<option>address1</option>";
		echo "<option>address2</option>";
		echo "<option>address3</option>";
		echo "<option>city</option>";
		echo "<option>state</option>";
		echo "<option>province</option>";
		echo "<option>postal_code</option>";
		echo "<option>country_code</option>";
		echo "<option>gender</option>";
		echo "<option>date_of_birth</option>";
		echo "<option>alt_phone</option>";
		echo "<option>email</option>";
		echo "<option>security_phrase</option>";
		echo "<option>comments</option>";
		echo "<option>lead_id</option>";
		echo "<option>campaign</option>";
		echo "<option>phone_login</option>";
		echo "<option>group</option>";
		echo "<option>channel_group</option>";
		echo "<option>SQLdate</option>";
		echo "<option>epoch</option>";
		echo "<option>uniqueid</option>";
		echo "<option>customer_zap_channel</option>";
		echo "<option>server_ip</option>";
		echo "<option>SIPexten</option>";
		echo "<option>session_id</option>";
		echo "<option>dialed_number</option>";
		echo "<option>dialed_label</option>";
		echo "<option>rank</option>";
		echo "<option>owner</option>";
		echo "<option>camp_script</option>";
		echo "<option>in_script</option>";
		echo "<option>script_width</option>";
		echo "<option>script_height</option>";
		echo "<option>recording_filename</option>";
		echo "<option>recording_id</option>";
		echo "<option>user_custom_one</option>";
		echo "<option>user_custom_two</option>";
		echo "<option>user_custom_three</option>";
		echo "<option>user_custom_four</option>";
		echo "<option>user_custom_five</option>";
		echo "<option>preset_number_a</option>";
		echo "<option>preset_number_b</option>";
		echo "<option>preset_number_c</option>";
		echo "<option>preset_number_d</option>";
		echo "<option>preset_number_e</option>";
		echo "<option>preset_number_f</option>";
		echo "<option>preset_dtmf_a</option>";
		echo "<option>preset_dtmf_b</option>";
		echo "</select>";
		echo "<input type=\"button\" name=\"insertField\" value=\"Insert\" onClick=\"scriptInsertField();\"><BR>";
		# END Insert Field
		echo "<TEXTAREA NAME=script_text ROWS=20 COLS=50 value=\"\"></TEXTAREA> $NWB#vicidial_scripts-script_text$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=11111111 display the ADD NEW FILTER SCREEN
######################

if ($ADD==11111111)
	{
	if ($LOGmodify_filters==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='vicidial_lead_filters' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW FILTER<form onSubmit=\"return contentFilter('Filter ID,lead_filter_id,1')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=21111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Filter ID: </td><td align=left>Auto-Generated $NWB#vicidial_lead_filters-lead_filter_id$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Filter ID: </td><td align=left><input type=text name=lead_filter_id size=12 maxlength=10> (no spaces or punctuation)$NWB#vicidial_lead_filters-lead_filter_id$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Filter Name: </td><td align=left><input type=text name=lead_filter_name size=30 maxlength=30> (short description of the filter)$NWB#vicidial_lead_filters-lead_filter_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Filter Comments: </td><td align=left><input type=text name=lead_filter_comments size=50 maxlength=255> $NWB#vicidial_lead_filters-lead_filter_comments$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Filter SQL: </td><td align=left><TEXTAREA NAME=lead_filter_sql ROWS=20 COLS=50 value=\"\"></TEXTAREA> $NWB#vicidial_lead_filters-lead_filter_sql$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=111111111 display the ADD NEW CALL TIME SCREEN
######################

if ($ADD==111111111)
	{
	if ($LOGmodify_call_times==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW CALL TIME<form onSubmit=\"return contentFilter('Call Time ID,call_time_id,1')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=211111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Call Time ID: </td><td align=left><input type=text name=call_time_id size=12 maxlength=10> (no spaces or punctuation)$NWB#vicidial_call_times-call_time_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Call Time Name: </td><td align=left><input type=text name=call_time_name size=30 maxlength=30> (short description of the call time)$NWB#vicidial_call_times-call_time_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Call Time Comments: </td><td align=left><input type=text name=call_time_comments size=50 maxlength=255> $NWB#vicidial_call_times-call_time_comments$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2>Day and time options will appear once you have created the Call Time Definition</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=1111111111 display the ADD NEW STATE CALL TIME SCREEN
######################

if ($ADD==1111111111)
	{
	if ($LOGmodify_call_times==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW STATE CALL TIME<form onSubmit=\"return contentFilter('State Call Time ID,call_time_id,1&&&State Call Time State,state_call_time_state,1')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=2111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>State Call Time ID: </td><td align=left><input type=text name=call_time_id size=12 maxlength=10> (no spaces or punctuation)$NWB#vicidial_call_times-call_time_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>State Call Time State: </td><td align=left><input type=text name=state_call_time_state size=4 maxlength=2> (no spaces or punctuation)$NWB#vicidial_call_times-state_call_time_state$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>State Call Time Name: </td><td align=left><input type=text name=call_time_name size=30 maxlength=30> (short description of the call time)$NWB#vicidial_call_times-call_time_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>State Call Time Comments: </td><td align=left><input type=text name=call_time_comments size=50 maxlength=255> $NWB#vicidial_call_times-call_time_comments$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2>Day and time options will appear once you have created the Call Time Definition</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=131111111 display the ADD NEW SHIFT SCREEN
######################

if ($ADD==131111111)
	{
	if ($LOGmodify_call_times==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW SHIFT<form onSubmit=\"return contentFilter('Shift ID,shift_id,1')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=231111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Shift ID: </td><td align=left><input type=text name=shift_id size=22 maxlength=20> (no spaces or punctuation)$NWB#vicidial_shifts-shift_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Shift Name: </td><td align=left><input type=text name=shift_name size=50 maxlength=50> (short description of the shift)$NWB#vicidial_shifts-shift_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Shift Start Time: </td><td align=left><input type=text name=shift_start_time size=5 maxlength=4 id=shift_start_time>\n";
		echo " &nbsp; Shift End Time: <input type=text name=shift_end_time size=5 maxlength=4 id=shift_end_time>\n";
		echo "<input type=button name=shift_calc value=\"Calculate Shift Length\" onClick=\"shift_time();\"> $NWB#vicidial_shifts-shift_start_time$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Shift Length: </td><td align=left><input type=text name=shift_length id=shift_length size=6 maxlength=5> $NWB#vicidial_shifts-shift_length$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Shift Weekdays: <BR>$NWB#vicidial_shifts-shift_weekdays$NWE</td><td align=left>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"0\">Sunday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"1\">Monday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"2\">Tuesday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"3\">Wednesday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"4\">Thursday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"5\">Friday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"6\">Saturday<BR>\n";
		echo "</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=11111111111 display the ADD NEW PHONE SCREEN
######################

if ($ADD==11111111111)
	{
	if ($LOGast_admin_access==1)
		{
		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='phones' and active='1';";
		$rslt=mysql_query($stmt, $link);
		$voi_ct = mysql_num_rows($rslt);
		if ($voi_ct > 0)
			{
			$row=mysql_fetch_row($rslt);
			$voi_count = "$row[0]";
			}
		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW PHONE<form onSubmit=\"return contentFilter('Phone extension,extension,2&&&Dial Plan Number,dialplan_number,2&&&Voicemail Box,voicemail_id,2&&&Outbound CallerID,outbound_cid,2')\"  action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=21111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";

		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		if ($voi_count > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Phone extension: </td><td align=left>Auto-Generated $NWB#phones-extension$NWE</td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Phone extension: </td><td align=left><input type=text name=extension size=20 maxlength=100 value=\"\">$NWB#phones-extension$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Dial Plan Number: </td><td align=left><input type=text name=dialplan_number size=15 maxlength=20> (digits only)$NWB#phones-dialplan_number$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Voicemail Box: </td><td align=left><input type=text name=voicemail_id size=10 maxlength=10> (digits only)$NWB#phones-voicemail_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Outbound CallerID: </td><td align=left><input type=text name=outbound_cid size=10 maxlength=20> (digits only)$NWB#phones-outbound_cid$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phone IP address: </td><td align=left><input type=text name=phone_ip size=20 maxlength=15> (optional)$NWB#phones-phone_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Computer IP address: </td><td align=left><input type=text name=computer_ip size=20 maxlength=15> (optional)$NWB#phones-computer_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server IP: </td><td align=left><select size=1 name=server_ip>\n";

		echo "$servers_list";
		echo "<option SELECTED>$row[5]</option>\n";
		echo "</select>$NWB#phones-server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Login: </td><td align=left><input type=text name=login size=10 maxlength=10>$NWB#phones-login$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Password: </td><td align=left><input type=text name=pass size=10 maxlength=10>$NWB#phones-pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Status: </td><td align=left><select size=1 name=status><option SELECTED>ACTIVE</option><option>SUSPENDED</option><option>CLOSED</option><option>PENDING</option><option>ADMIN</option></select>$NWB#phones-status$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active Account: </td><td align=left><select size=1 name=active><option SELECTED>Y</option><option>N</option></select>$NWB#phones-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phone Type: </td><td align=left><input type=text name=phone_type size=20 maxlength=50>$NWB#phones-phone_type$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Full Name: </td><td align=left><input type=text name=fullname size=20 maxlength=50>$NWB#phones-fullname$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Company: </td><td align=left><input type=text name=company size=10 maxlength=10>$NWB#phones-company$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Picture: </td><td align=left><input type=text name=picture size=20 maxlength=19>$NWB#phones-picture$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Client Protocol: </td><td align=left><select size=1 name=protocol><option SELECTED>SIP</option><option>Zap</option><option>IAX2</option><option>EXTERNAL</option></select>$NWB#phones-protocol$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Local GMT: </td><td align=left><select size=1 name=local_gmt><option>12.75</option><option>12.00</option><option>11.00</option><option>10.00</option><option>9.50</option><option>9.00</option><option SELECTED>8.00</option><option>7.00</option><option>6.50</option><option>6.00</option><option>5.75</option><option>5.50</option><option>5.00</option><option>4.50</option><option>4.00</option><option>3.50</option><option>3.00</option><option>2.00</option><option>1.00</option><option>0.00</option><option>-1.00</option><option>-2.00</option><option>-3.00</option><option>-3.50</option><option>-4.00</option><option>-5.00</option><option>-6.00</option><option>-7.00</option><option>-8.00</option><option>-9.00</option><option>-10.00</option><option>-11.00</option><option>-12.00</option></select> (Do NOT Adjust for DST)$NWB#phones-local_gmt$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}



######################
# ADD=12111111111 display the ADD NEW PHONE ALIAS SCREEN
######################

if ($ADD==12111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW PHONE ALIAS<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=22111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";

		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Alias ID: </td><td align=left><input type=text name=alias_id size=20 maxlength=20 value=\"\">$NWB#phones-alias_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Alias Name: </td><td align=left><input type=text name=alias_name size=30 maxlength=50> $NWB#phones-alias_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phone Logins List: </td><td align=left><input type=text name=logins_list size=50 maxlength=255> (comma separated)$NWB#phones-logins_list$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=13111111111 display the ADD NEW GROUP ALIAS SCREEN
######################

if ($ADD==13111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW GROUP ALIAS<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=23111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";

		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Group Alias ID: </td><td align=left><input type=text name=group_alias_id size=30 maxlength=30 value=\"\">$NWB#phones-group_alias_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Group Alias Name: </td><td align=left><input type=text name=group_alias_name size=30 maxlength=50> $NWB#phones-group_alias_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CallerID Number: </td><td align=left><input type=text name=caller_id_number size=20 maxlength=20> $NWB#phones-caller_id_number$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CallerID Name: </td><td align=left><input type=text name=caller_id_name size=20 maxlength=20> $NWB#phones-caller_id_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option selected>N</option></select></td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}



######################
# ADD=111111111111 display the ADD NEW SERVER SCREEN
######################

if ($ADD==111111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW SERVER<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=211111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server ID: </td><td align=left><input type=text name=server_id size=10 maxlength=10>$NWB#servers-server_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server Description: </td><td align=left><input type=text name=server_description size=30 maxlength=255>$NWB#servers-server_description$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server IP Address: </td><td align=left><input type=text name=server_ip size=20 maxlength=15>$NWB#servers-server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option>N</option></select>$NWB#servers-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Asterisk Version: </td><td align=left><input type=text name=asterisk_version size=20 maxlength=20>$NWB#servers-asterisk_version$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=131111111111 display the ADD NEW CONF TEMPLATE SCREEN
######################

if ($ADD==131111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW CONF TEMPLATE<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=231111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Template ID: </td><td align=left><input type=text name=template_id size=15 maxlength=15>$NWB#vicidial_conf_templates-template_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Template Name: </td><td align=left><input type=text name=template_name size=40 maxlength=50>$NWB#vicidial_conf_templates-template_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Template Contents: </td><td align=left><TEXTAREA NAME=template_contents ROWS=10 COLS=70></TEXTAREA> $NWB#vicidial_conf_templates-template_contents$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=141111111111 display the ADD NEW CARRIER SCREEN
######################

if ($ADD==141111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW CARRIER<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=241111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Carrier ID: </td><td align=left><input type=text name=carrier_id size=15 maxlength=15>$NWB#vicidial_server_carriers-carrier_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Carrier Name: </td><td align=left><input type=text name=carrier_name size=40 maxlength=50>$NWB#vicidial_server_carriers-carrier_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Carrier Description: </td><td align=left><input type=text name=carrier_description size=70 maxlength=255>$NWB#vicidial_server_carriers-carrier_description$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Registration String: </td><td align=left><input type=text name=registration_string size=50 maxlength=255>$NWB#vicidial_server_carriers-registration_string$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Template ID: </td><td align=left><select size=1 name=template_id>\n";
		$stmt="SELECT template_id,template_name from vicidial_conf_templates order by template_id";
		$rslt=mysql_query($stmt, $link);
		$templates_to_print = mysql_num_rows($rslt);
		$templates_list='<option SELECTED>--NONE--</option>';
		$o=0;
		while ($templates_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$templates_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "$templates_list";
		echo "</select>$NWB#vicidial_server_carriers-template_id$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Account Entry: </td><td align=left><TEXTAREA NAME=account_entry ROWS=10 COLS=70></TEXTAREA> $NWB#vicidial_server_carriers-account_entry$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Protocol: </td><td align=left><select size=1 name=protocol><option SELECTED>SIP</option><option>Zap</option><option>IAX2</option><option>EXTERNAL</option></select>$NWB#vicidial_server_carriers-protocol$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Globals String: </td><td align=left><input type=text name=globals_string size=50 maxlength=255>$NWB#vicidial_server_carriers-globals_string$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Dialplan Entry: </td><td align=left><TEXTAREA NAME=dialplan_entry ROWS=10 COLS=70></TEXTAREA> $NWB#vicidial_server_carriers-dialplan_entry$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Server IP: </td><td align=left><select size=1 name=server_ip>\n";
		##### get server listing for dynamic pulldown
		$stmt="SELECT server_ip,server_description from servers order by server_ip";
		$rsltx=mysql_query($stmt, $link);
		$servers_to_print = mysql_num_rows($rsltx);
		$servers_list='';

		$o=0;
		while ($servers_to_print > $o)
			{
			$rowx=mysql_fetch_row($rsltx);
			$servers_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}

		echo "$servers_list";
		echo "</select>$NWB#vicidial_server_carriers-server_ip$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=151111111111 display the ADD NEW TTS ENTRY SCREEN
######################

if ($ADD==151111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW TTS ENTRY<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=251111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>TTS ID: </td><td align=left><input type=text name=tts_id size=30 maxlength=50>$NWB#vicidial_tts_prompts-tts_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>TTS Name: </td><td align=left><input type=text name=tts_name size=50 maxlength=100>$NWB#vicidial_tts_prompts-tts_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>N</option><option>Y</option>$NWB#vicidial_tts_prompts-active$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}

#########
#add by fox about notices 
#########
if ($ADD==424)
	{
		echo "<link rel=\"stylesheet\" href=\"kindeditor/themes/default/default.css\" />\n";
		echo "<link rel=\"stylesheet\" href=\"kindeditor/plugins/code/prettify.css\" />\n";
		echo "<script charset=\"utf-8\" src=\"kindeditor/kindeditor.js\"></script>\n";
		echo "<script charset=\"utf-8\" src=\"kindeditor/lang/zh_CN.js\"></script>\n";
		echo "<script charset=\"utf-8\" src=\"kindeditor/plugins/code/prettify.js\"></script>\n";
		echo "<script charset=\"utf-8\" src=\"js/CalendarPopup.js\"></script>\n";
		
		echo "<script>";
		echo "KindEditor.ready(function(K) {";
		echo "	var editor1 = K.create('textarea[name=\"content1\"]', {";
		echo "		cssPath : '../plugins/code/prettify.css',";
		echo "		uploadJson : '../php/upload_json.php',";
		echo "		fileManagerJson : '../php/file_manager_json.php',";
		echo "		allowFileManager : true,";
		echo "		afterCreate : function() {";
		echo "			var self = this;";
		echo "			K.ctrl(document, 13, function() {";
		echo "				self.sync();";
		echo "				K('form[name=example]')[0].submit();";
		echo "			});";
		echo "			K.ctrl(self.edit.doc, 13, function() {";
		echo "				self.sync();";
		echo "				K('form[name=example]')[0].submit();";
		echo "			});";
		echo "		}";
		echo "	});";
		echo "	prettyPrint();";
		echo "});";		
		echo "</script>";
		
		echo "<script>\n";
		echo "	var cal = new CalendarPopup();";
		echo "</script>\n";
		
		
		
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>NEW NOTICE<form name=\"example\" action=$PHP_SELF method=POST>\n";
		echo "<input type=\"hidden\" name=\"page\" id=\"page\"  value=\"1\">";
		echo "<input type=hidden name=ADD value=426>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>TITLE:</td><td align=left><input type=text name=notice_title size=40 maxlength=50></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CAMPAIGN_ID:</td><td align=left><select size=1 name=user_group>\n";
		$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id,'Y');
		$rslt=mysql_query($stmt, $link);
		$campaigns_to_print = mysql_num_rows($rslt);
		$o=0;
		$campaigns_list='';
		while ($campaigns_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$campaigns_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "$campaigns_list</select></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>ACTIVE_TIME:</td><td align=left><INPUT TYPE=\"tex\t\" NAME=\"date1\" VALUE=\"\" SIZE=25><A HREF=\"#\" onClick=\"cal.select(document.forms['example'].date1,'anchor1','yyyy/MM/dd'); return false;\"  NAME=\"anchor1\" ID=\"anchor1\"><img width=\"16\" height=\"16\" border=\"0\" align=\"absimddle\" src=\"images/icons/cal.gif\"></A></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>NOTICE_CONTENT:</td><td align=left></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><textarea name=\"content1\" style=\"width:700px;height:200px;visibility:hidden;\"></textarea></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
	}
	
	//save notice
	if($ADD==426){
		$title = $_POST['notice_title'];
		$campaign_id = $_POST['user_group'];
		$active_time = $_POST['date1'];
		$content = $_POST['content1'];
		if($title == null){
			echo "Title is null!!!";
			exit;
			}
		if($active_time == null){
			echo "Active_time is null!!!";
			exit;
			}
		if($content == null){
			echo "Content is null!!!";
			exit;
			}
		if(strlen($title)>26){
			echo "The title must be less than 26 characters, <br/>the Chinese must be less than 13 characters!!!";
			exit;
		}
		$stmt = "INSERT INTO ccms_notice(title,content,campaign_id,active_time) VALUES ('$title','$content','$campaign_id','$active_time')";
		$rslt=mysql_query($stmt, $link);
		$num = mysql_affected_rows();
		if ($num == 1) {echo "Insert success!";}
			else {echo " Insert failed !";}
	}
	
	//show notice list
	if($ADD==423){	
		if($PHP_AUTH_USER =='admin'){
			echo "Show all Notice";
			echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";	
			echo "<tr class=\"tr_bg_color\"><td width=40% ><font size=1 color=white><B>TITLE</B></font></td><td width=20% ><font size=1 color=white><B>ADD TIME</B></font></td><td width=20% ><font size=1 color=white><B>ACTIVE TIME</B></font></td><td  width=20% ><font size=1 color=white><B>MODIFY</B></font></td>\n";	
			$page=$_GET['page'];	
			$stmt = "select count(*) from ccms_notice;";
			$rslt=mysql_query($stmt, $link);			
			while ($row=mysql_fetch_row($rslt)){
				$num_rows = $row[0];
			}
			$pages = ceil($num_rows/10);
			if($num_rows<=10) {$start = 0;$end = $num_rows;}
			if($num_rows>10) {$start = ($page-1)*10;$end = $page*10;}	
			$sql = "select id,title,date,active_time from ccms_notice limit $start,$end;";
			$rslt=mysql_query($sql, $link);
			$notice_to_print = mysql_num_rows($rslt);
			$o=0;
			while ($notice_to_print > $o) 
			{
				$row=mysql_fetch_row($rslt);
				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}
				echo "<tr $bgcolor><td><a href=\"admin.php?ADD=427&id=$row[0]\">$row[1]</a></td><td align=center><a //href=\"admin.php?ADD=427&id=$row[0]\">$row[2]</a></td><td align=center><a href=\"admin.php?ADD=427&id=$row[0]\">$row[3]</a></td><td align=center><a  href=\"admin_fox.php?ADD=429&id=$row[0]\" onclick=\"{if(confirm('Are you sure you want to delete?')){return true;}return false;}\">Delete</a></td>\n";
				$o++;
			}
			echo "</TABLE></center>\n";
			echo "<script type=\"text/javascript\" src=\"js/showpage.js\"></script>\n";
			echo "<script language=\"JavaScript\">\n";
			echo "	var pg = new showPages('pg');\n";
			echo "	pg.pageCount =$pages;  // 定义总页数(必要)\n";
			echo "	//pg.argName = 'p';  // 定义参数名(可选,默认为page)\n";
			echo "	pg.printHtml(2);\n";
			echo "</script>\n";			
		}else{
			echo "You do not have permission to view this page\n";
			exit;
		}
	}
	
if ($ADD==427)
	{
		$id = $_GET['id'];
		$stmt = "select title,content,campaign_id,active_time from ccms_notice where id='$id'";	
		$rslt=mysql_query($stmt, $link);
		while ($row=mysql_fetch_row($rslt)){
			$title = $row[0];
			$content = $row[1];
			$campaign_id = $row[2];
			$active_time = $row[3];
		}
		echo "<link rel=\"stylesheet\" href=\"kindeditor/themes/default/default.css\" />\n";
		echo "<link rel=\"stylesheet\" href=\"kindeditor/plugins/code/prettify.css\" />\n";
		echo "<script charset=\"utf-8\" src=\"kindeditor/kindeditor.js\"></script>\n";
		echo "<script charset=\"utf-8\" src=\"kindeditor/lang/zh_CN.js\"></script>\n";
		echo "<script charset=\"utf-8\" src=\"kindeditor/plugins/code/prettify.js\"></script>\n";
		echo "<script charset=\"utf-8\" src=\"js/CalendarPopup.js\"></script>\n";
		
		echo "<script>";
		echo "KindEditor.ready(function(K) {";
		echo "	var editor1 = K.create('textarea[name=\"content1\"]', {";
		echo "		cssPath : 'kindeditor/plugins/code/prettify.css',";
		echo "		uploadJson : 'kindeditor/php/upload_json.php',";
		echo "		fileManagerJson : 'kindeditor/php/file_manager_json.php',";
		echo "		allowFileManager : true,";
		echo "		afterCreate : function() {";
		echo "			var self = this;";
		echo "			K.ctrl(document, 13, function() {";
		echo "				self.sync();";
		echo "				K('form[name=example]')[0].submit();";
		echo "			});";
		echo "			K.ctrl(self.edit.doc, 13, function() {";
		echo "				self.sync();";
		echo "				K('form[name=example]')[0].submit();";
		echo "			});";
		echo "		}";
		echo "	});";
		echo "	prettyPrint();";
		echo "});";		
		echo "</script>";
		
		echo "<script>\n";
		echo "	var cal = new CalendarPopup();";
		echo "</script>\n";
		
		
		
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>NEW NOTICE<form name=\"example\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=428>\n";
		echo "<input type=hidden name=ID value=$id>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>TITLE:</td><td align=left><input type=text value=$title name=notice_title size=40 maxlength=50></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CAMPAIGN_ID:</td><td align=left><select size=1 name=user_group>\n";
		$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id,'Y');
		$rslt=mysql_query($stmt, $link);
		$campaigns_to_print = mysql_num_rows($rslt);
		$o=0;
		$campaigns_list='';
		while ($campaigns_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
				$campaigns_list .= "<option value=\"$rowx[0]\" >$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		$campaigns_list .= "<option value=\"$campaign_id\" selected >$campaign_id</option>\n";
		echo "$campaigns_list</select></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>ACTIVE_TIME:</td><td align=left><INPUT TYPE=\"tex\t\" NAME=\"date1\" VALUE=\"$active_time\" SIZE=25><A HREF=\"#\" onClick=\"cal.select(document.forms['example'].date1,'anchor1','yyyy/MM/dd'); return false;\"  NAME=\"anchor1\" ID=\"anchor1\"><img width=\"16\" height=\"16\" border=\"0\" align=\"absimddle\" src=\"images/icons/cal.gif\"></A></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>NOTICE_CONTENT:</td><td align=left></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><textarea name=\"content1\" style=\"width:700px;height:200px;visibility:hidden;\">$content</textarea></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
	}
if($ADD==428)
	{
		$title = $_POST['notice_title'];
		$campaign_id = $_POST['user_group'];
		$active_time = $_POST['date1'];
		$content = $_POST['content1'];
		if($title == null){
			echo "Title is null!!!";
			exit;
			}
		if($active_time == null){
			echo "Active_time is null!!!";
			exit;
			}
		if($content == null){
			echo "Content is null!!!";
			exit;
			}
		
		$id = $_POST['ID'];
		
		$stmt = "update ccms_notice set title='$title',content='$content',campaign_id='$campaign_id',active_time='$active_time' where id='$id'";
		//echo $stmt;
		$rslt=mysql_query($stmt, $link);
		$num = mysql_affected_rows();
		if ($num == 1) {echo "Update success!";}
			else {echo "Update failed!";}
	}
	if($ADD==429)
	{
		$id = $_GET['id'];
		$stmt = "DELETE FROM ccms_notice WHERE id='$id'";
		//echo $stmt;
		$rslt=mysql_query($stmt, $link);
		$num = mysql_affected_rows();
		if ($num == 1) {echo "Delete success!";}
			else {echo "Delete failed!";}
	}
//end 


	
######################
# ADD=161111111111 display the ADD NEW MUSIC ON HOLD ENTRY SCREEN
######################

if ($ADD==161111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW MUSIC ON HOLD ENTRY<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=261111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Music On Hold ID: </td><td align=left><input type=text name=moh_id size=50 maxlength=100>$NWB#vicidial_music_on_hold-moh_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Music On Hold Name: </td><td align=left><input type=text name=moh_name size=70 maxlength=255>$NWB#vicidial_music_on_hold-moh_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Random Order: </td><td align=left><select size=1 name=random><option>N</option><option>Y</option>$NWB#vicidial_music_on_hold-random$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=171111111111 display the ADD NEW VOICEMAIL BOX SCREEN
######################

if ($ADD==171111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD NEW VOICEMAIL BOX<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=271111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Voicemail ID: </td><td align=left><input type=text name=voicemail_id size=12 maxlength=10>$NWB#vicidial_voicemail-voicemail_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Pass: </td><td align=left><input type=text name=pass size=10 maxlength=10>$NWB#vicidial_voicemail-pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Name: </td><td align=left><input type=text name=fullname size=50 maxlength=100>$NWB#vicidial_voicemail-fullname$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>N</option><option>Y</option>$NWB#vicidial_voicemail-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Email: </td><td align=left><input type=text name=email size=50 maxlength=100>$NWB#vicidial_voicemail-email$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=1111111111111 display the ADD NEW CONFERENCE SCREEN
######################

if ($ADD==1111111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW CONFERENCE<form onSubmit=\"return contentFilter('Conference Number,conf_exten,2')\"  action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=2111111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Conference Number: </td><td align=left><input type=text name=conf_exten size=8 maxlength=7> (digits only)$NWB#conferences-conf_exten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server IP: </td><td align=left><select size=1 name=server_ip>\n";

		echo "$servers_list";
		echo "<option SELECTED>$server_ip</option>\n";
		echo "</select>$NWB#conferences-server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=11111111111111 display the ADD NEW CCMS CONFERENCE SCREEN
######################

if ($ADD==11111111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW CCMS CONFERENCE<form onSubmit=\"return contentFilter('Conference Number,conf_exten,2')\"  action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=21111111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Conference Number: </td><td align=left><input type=text name=conf_exten size=8 maxlength=7> (digits only)$NWB#conferences-conf_exten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server IP: </td><td align=left><select size=1 name=server_ip>\n";

		echo "$servers_list";
		echo "<option SELECTED>$server_ip</option>\n";
		echo "</select>$NWB#conferences-server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}



######################################################################################################
######################################################################################################
#######   2 series, validates form data and inserts the new record into the database
######################################################################################################
######################################################################################################


######################
# ADD=2 adds the new user to the system
######################

if ($ADD=="2")
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_users' and active='1';";
	$rslt=mysql_query($stmt, $link);
	
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$user = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$user' where id_table='vicidial_users' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####
	
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_users where user='$user';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>USER NOT ADDED - there is already a user in the system with this user number\n";}
	else
		{
		if (ereg('AUTOGENERA',$user))
			{
			$user = 'AUTOGENERA';
			}
		if ( (strlen($user) < 2) or (strlen($pass) < 2) or (strlen($full_name) < 2) or (strlen($user_group) < 2) or ( (strlen($user) > 20) and (!ereg('AUTOGENERA',$user)) ) )
			{
			echo "<br>USER NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>user id must be between 2 and 20 characters long\n";
			echo "<br>full name and password must be at least 2 characters long\n";
			echo "<br>you must select a user group\n";
			}
		else
			{
			if (ereg('AUTOGENERA',$user))
				{
				$new_user=0;
				$auto_user_add_value=0;
				while ($new_user < 2)
					{
					if ($new_user < 1)
						{
						$stmt = "SELECT auto_user_add_value FROM system_settings;";
						$rslt=mysql_query($stmt, $link);
						$ss_auav_ct = mysql_num_rows($rslt);
						if ($ss_auav_ct > 0)
							{
							$row=mysql_fetch_row($rslt);
							$auto_user_add_value = $row[0];
							}
						$new_user++;
						}
					$stmt = "SELECT count(*) FROM vicidial_users where user='$auto_user_add_value';";
					$rslt=mysql_query($stmt, $link);
					$row=mysql_fetch_row($rslt);
					if ($row[0] < 1)
						{
						$new_user++;
						}
					else 
						{
						echo "<!-- AG: $auto_user_add_value -->\n";
						$auto_user_add_value = ($auto_user_add_value + 7);
						}
					}
				$user = $auto_user_add_value;
				echo "<br><B>user_id has been auto-generated: $user</B><br>\n";

				$stmt="UPDATE system_settings SET auto_user_add_value='$user';";
				$rslt=mysql_query($stmt, $link);
				}
			echo "<br><B>USER ADDED: $user</B>\n";
			echo "<br><br>\n";
			echo "<a href=\"$PHP_SELF?ADD=3&user=$user\">Click here to go to the user record</a>\n";
			echo "<br><br>\n";
			//$stmt="INSERT INTO vicidial_users (user,pass,full_name,user_level,user_group,phone_login,phone_pass) values('$user','$pass','$full_name','$user_level','$user_group','$phone_login','$phone_pass');";
			$stmt="INSERT INTO vicidial_users (user,pass,full_name,user_level,user_group,phone_login,phone_pass,delete_users,delete_user_groups,delete_lists,delete_campaigns,delete_ingroups,delete_remote_agents,load_leads,campaign_detail,ast_admin_access,ast_delete_phones,delete_scripts,modify_leads,hotkeys_active,change_agent_campaign,agent_choose_ingroups,closer_campaigns,scheduled_callbacks,agentonly_callbacks,agentcall_manual,vicidial_recording,vicidial_transfers,delete_filters,alter_agent_interface_options,closer_default_blended,delete_call_times,modify_call_times,modify_users,add_new_users,modify_campaigns,add_new_campaigns,modify_lists,add_new_lists,modify_scripts,modify_filters,modify_ingroups,modify_usergroups,add_new_usergroups,modify_remoteagents,modify_servers,view_reports,search_historical_call,search_voice_mail,live_monitor,view_historical_reports,vicidial_recording_override,alter_custdata_override,qc_enabled,qc_user_level,qc_pass,qc_finish,qc_commit,add_timeclock_log,modify_timeclock_log,delete_timeclock_log,alter_custphone_override,vdc_agent_api_access,modify_inbound_dids,delete_inbound_dids,active,alert_enabled,download_lists,agent_shift_enforcement_override,manager_shift_enforcement_override,shift_override_flag,export_reports,delete_from_dnc,add_from_dnc,email,user_code,territory,allow_alerts,agent_choose_territories,custom_one,custom_two,custom_three,custom_four,custom_five,disabled_campaigns,grab_calls_in_queue,view_agent_status) values('$user','$pass','$full_name','$user_level','$user_group','$phone_login','$phone_pass','$delete_users','$delete_user_groups','$delete_lists','$delete_campaigns','$delete_ingroups','$delete_remote_agents','$load_leads','$campaign_detail','$ast_admin_access','$ast_delete_phones','$delete_scripts','$modify_leads','$hotkeys_active','$change_agent_campaign','$agent_choose_ingroups','$closer_campaigns','$scheduled_callbacks','$agentonly_callbacks','$agentcall_manual','$vicidial_recording','$vicidial_transfers','$delete_filters','$alter_agent_interface_options','$closer_default_blended','$delete_call_times','$modify_call_times','$modify_users','$add_new_users','$modify_campaigns','$add_new_campaigns','$modify_lists','$add_new_lists','$modify_scripts','$modify_filters','$modify_ingroups','$modify_usergroups','$add_new_usergroups','$modify_remoteagents','$modify_servers','$view_reports','$search_historical_call','$search_voice_mail','$live_monitor','$view_historical_reports','$vicidial_recording_override','$alter_custdata_override','$qc_enabled','$qc_user_level','$qc_pass','$qc_finish','$qc_commit','$add_timeclock_log','$modify_timeclock_log','$delete_timeclock_log','$alter_custphone_override','$vdc_agent_api_access','$modify_inbound_dids','$delete_inbound_dids','$active','$alert_enabled','$download_lists','$agent_shift_enforcement_override','$manager_shift_enforcement_override','$shift_override_flag','$export_reports','$delete_from_dnc','$add_from_dnc','$email','$user_code','$territory','$allow_alerts','$agent_choose_territories','$custom_one','$custom_two','$custom_three','$custom_four','$custom_five','$disabled_campaigns','$grab_calls_in_queue','$view_agent_status');";
			
			//add by fox for lead workflow;
			if($user_level == 5){
				$modify_distribute_lead = 0;
				$modify_call_lead = 1;
				$modify_rollback_lead = 1;
				$modify_archive_lead = 1;
				$modify_abandon_lead = 0;
				$modify_recover_lead = 0;
			}else {
				$modify_distribute_lead = 1;
				$modify_call_lead = 1;
				$modify_rollback_lead = 1;
				$modify_archive_lead = 1;
				$modify_abandon_lead = 1;
				$modify_recover_lead = 1;
			}
			//end;
			$rslt=mysql_query($stmt, $link);
			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='USERS', event_type='ADD', record_id='$user', event_code='ADMIN ADD USER', event_sql=\"$SQL_log\", event_notes='user: $user';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			###############################################################
			##### START SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			$stmt = "SELECT enable_vtiger_integration,vtiger_server_ip,vtiger_dbname,vtiger_login,vtiger_pass,vtiger_url FROM vicidial_campaigns where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			if ($DB) {echo "$stmt\n";}
			$ss_conf_ct = mysql_num_rows($rslt);
			if ($ss_conf_ct > 0)
				{
				$row=mysql_fetch_row($rslt);
				$enable_vtiger_integration =	$row[0];
				$vtiger_server_ip	=			$row[1];
				$vtiger_dbname =				$row[2];
				$vtiger_login =					$row[3];
				$vtiger_pass =					$row[4];
				$vtiger_url =					$row[5];
				}
			##### END SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			#############################################################

			if ($enable_vtiger_integration > 0)
				{
				### connect to your vtiger database
				$linkV=mysql_connect("$vtiger_server_ip", "$vtiger_login","$vtiger_pass");
				if (!$linkV) {die("Could not connect: $vtiger_server_ip|$vtiger_dbname|$vtiger_login|$vtiger_pass" . mysql_error());}
				echo 'Connected successfully';
				mysql_select_db("$vtiger_dbname", $linkV);

				$user_name =		$user;
				$user_password =	$pass;
				$last_name =		$full_name;
				$is_admin =			'off';
				$roleid =			'H5';
				$status =			'Active';
				$groupid =			'1';
					if ($user_level >= 7) {$roleid = 'H3';}
					if ($user_level >= 8) {$roleid = 'H4';}
					if ($user_level >= 9) {$roleid = 'H2';}
					if ($user_level >= 9) {$is_admin = 'on';}
				$salt = substr($user_name, 0, 2);
				$salt = '$1$' . $salt . '$';
				$encrypted_password = crypt($user_password, $salt);

				######################################
				##### BEGIN Add/Update group info in Vtiger
				$stmt="SELECT count(*) from vtiger_groups where groupname='$user_group';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$group_found_count = $row[0];

				### group exists in vtiger, update it
				if ($group_found_count > 0)
					{
					$stmt="SELECT groupid from vtiger_groups where groupname='$user_group';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$groupid = $row[0];
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW GROUP RECORD IN VTIGER
					# Get next available id from vtiger_users_seq to use as groupid
					$stmt="SELECT id from vtiger_users_seq;";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					$row=mysql_fetch_row($rslt);
					$groupid = ($row[0] + 1);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					# Increase next available groupid with 1 so next record gets proper id
					$stmt="UPDATE vtiger_users_seq SET id = '$groupid';";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtA = "INSERT INTO vtiger_groups SET groupid='$groupid',groupname='$user_group',description='';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW GROUP RECORD IN VTIGER
					}
				##### END Add/Update group info in Vtiger
				######################################

				######################################
				##### BEGIN Add/Update user info in Vtiger
				$stmt="SELECT count(*) from vtiger_users where user_name='$user_name';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$found_count = $row[0];

				### user exists in vtiger, update it
				if ($found_count > 0)
					{
					$stmt="SELECT id from vtiger_users where user_name='$user_name';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$userid = $row[0];

					$stmt="SELECT count(*) from vtiger_users2group WHERE userid='$userid' and groupid='$groupid';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$usergroupcount = $row[0];
					mysql_query("set names utf8");
					$stmtA = "UPDATE vtiger_users SET user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status' where id='$userid';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtB = "UPDATE vtiger_user2role SET roleid='$roleid' where userid='$userid';";
					if ($DB) {echo "|$stmtB|\n";}
					$rslt=mysql_query($stmtB, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					if ($usergroupcount < 1)
						{
						$stmt="SELECT user_group FROM vicidial_user_groups;";
						$rslt=mysql_query($stmt, $link);
						if ($DB) {echo "$stmt\n";}
						$VD_groups_ct = mysql_num_rows($rslt);
						$k=0;
						$VD_groups_list='';
						while ($k < $VD_groups_ct)
							{
							$row=mysql_fetch_row($rslt);
							$VD_groups_list .= "'$row[0]',";
							$k++;
							}
						$VD_groups_list = preg_replace("/.$/",'',$VD_groups_list);

						$stmtC = "DELETE FROM vtiger_users2group WHERE userid='$userid' and groupid IN(SELECT groupid from vtiger_groups where groupname IN($VD_groups_list));";
						if ($DB) {echo "|$stmtC|\n";}
						$rslt=mysql_query($stmtC, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						$stmtD = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
						if ($DB) {echo "|$stmtD|\n";}
						$rslt=mysql_query($stmtD, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}
						}
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW USER RECORD IN VTIGER
					mysql_query("set names utf8");
					$stmtA = "INSERT INTO vtiger_users SET user_name='$user_name',user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status',date_format='yyyy-mm-dd',first_name='',reports_to_id='',description='',title='',department='',phone_home='',phone_mobile='',phone_work='',phone_other='',phone_fax='',email1='',email2='',yahoo_id='',signature='',address_street='',address_city='',address_state='',address_country='',address_postalcode='',user_preferences='',imagename='';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$userid = mysql_insert_id($linkV);
				
					$stmtB = "INSERT INTO vtiger_user2role SET userid='$userid',roleid='$roleid';";
					if ($DB) {echo "|$stmtB|\n";}
					$rslt=mysql_query($stmtB, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtC = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
					if ($DB) {echo "|$stmtC|\n";}
					$rslt=mysql_query($stmtC, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtD = "UPDATE vtiger_users_seq SET id='$userid';";
					if ($DB) {echo "|$stmtD|\n";}
					$rslt=mysql_query($stmtD, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW USER RECORD IN VTIGER
					}
				##### END Add/Update user info in Vtiger
				######################################
				}
			### END vtiger integration
			}
		}
###### start Synchronize users with CRM 2011-09-20 add by pie;
	$stmt="SELECT ccms_url from system_settings;";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	$ccms_url_link = $row[0];
//	echo $ccms_url_link."<br>";
//	echo $user."<br>";
	$url_link = $ccms_url_link."integrate_vtiger_user.php?user=".$user;
//	echo $url_link."<br>";
	file("$url_link");
###### end Synchronize users with CRM 2011-09-20 add by pie;
	}

######################
# ADD=2A adds the copied new user to the system
######################

if ($ADD=="2A")
	{
	
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_users' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$user = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$user' where id_table='vicidial_users' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_users where user='$user';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>USER NOT ADDED - there is already a user in the system with this user number\n";}
	else
		{
		if ( (strlen($user) < 2) or (strlen($pass) < 2) or (strlen($full_name) < 2) or (strlen($user) > 20) )
			{
			echo "<br>USER NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>user id must be between 2 and 20 characters long\n";
			echo "<br>full name and password must be at least 2 characters long\n";
			echo "<!-- |$user|$pass|$full_name| -->\n";
			}
		else
			{
			if (ereg('AUTOGEN',$user))
				{
				$new_user=0;
				$auto_user_add_value=0;
				while ($new_user < 2)
					{
					if ($new_user < 1)
						{
						$stmt = "SELECT auto_user_add_value FROM system_settings;";
						$rslt=mysql_query($stmt, $link);
						$ss_auav_ct = mysql_num_rows($rslt);
						if ($ss_auav_ct > 0)
							{
							$row=mysql_fetch_row($rslt);
							$auto_user_add_value = $row[0];
							}
						$new_user++;
						}
					$stmt = "SELECT count(*) FROM vicidial_users where user='$auto_user_add_value';";
					$rslt=mysql_query($stmt, $link);
					$row=mysql_fetch_row($rslt);
					if ($row[0] < 1)
						{
						$new_user++;
						}
					else 
						{
						echo "<!-- AG: $auto_user_add_value -->\n";
						$auto_user_add_value = ($auto_user_add_value + 7);
						}
					}
				$user = $auto_user_add_value;
				echo "<br><B>user_id has been auto-generated: $user</B><br>\n";

				$stmt="UPDATE system_settings SET auto_user_add_value='$user';";
				$rslt=mysql_query($stmt, $link);
				}
			$vicidial_users_sql_field = "user_level,user_group,phone_login,phone_pass,delete_users,delete_user_groups,delete_lists,delete_campaigns,delete_ingroups,delete_remote_agents,load_leads,campaign_detail,ast_admin_access,ast_delete_phones,delete_scripts,modify_leads,hotkeys_active,change_agent_campaign,agent_choose_ingroups,closer_campaigns,scheduled_callbacks,agentonly_callbacks,agentcall_manual,vicidial_recording,vicidial_transfers,delete_filters,alter_agent_interface_options,closer_default_blended,delete_call_times,modify_call_times,modify_users,add_new_users,modify_campaigns,add_new_campaigns,modify_lists,add_new_lists,modify_scripts,modify_filters,modify_ingroups,modify_usergroups,add_new_usergroups,modify_remoteagents,modify_servers,view_reports,search_historical_call,search_voice_mail,live_monitor,view_historical_reports,vicidial_recording_override,alter_custdata_override,qc_enabled,qc_user_level,qc_pass,qc_finish,qc_commit,add_timeclock_log,modify_timeclock_log,delete_timeclock_log,alter_custphone_override,vdc_agent_api_access,modify_inbound_dids,delete_inbound_dids,active,alert_enabled,download_lists,agent_shift_enforcement_override,manager_shift_enforcement_override,shift_override_flag,export_reports,delete_from_dnc,add_from_dnc,email,user_code,territory,allow_alerts,agent_choose_territories,custom_one,custom_two,custom_three,custom_four,custom_five,disabled_campaigns,grab_calls_in_queue,view_agent_status";
			$stmt="INSERT INTO vicidial_users (user,pass,full_name,$vicidial_users_sql_field) SELECT \"$user\",\"$pass\",\"$full_name\",$vicidial_users_sql_field from vicidial_users where user=\"$source_user_id\";";
			$rslt=mysql_query($stmt, $link);

			$stmtA="INSERT INTO vicidial_inbound_group_agents (user,group_id,group_rank,group_weight,calls_today) SELECT \"$user\",group_id,group_rank,group_weight,\"0\" from vicidial_inbound_group_agents where user=\"$source_user_id\";";
			$rslt=mysql_query($stmtA, $link);

			$stmtA="INSERT INTO vicidial_campaign_agents (user,campaign_id,campaign_rank,campaign_weight,calls_today) SELECT \"$user\",campaign_id,campaign_rank,campaign_weight,\"0\" from vicidial_campaign_agents where user=\"$source_user_id\";";
			$rslt=mysql_query($stmtA, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='USERS', event_type='COPY', record_id='$user', event_code='ADMIN COPY USER', event_sql=\"$SQL_log\", event_notes='user: $user';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			###############################################################
			##### START SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			$stmt = "SELECT enable_vtiger_integration,vtiger_server_ip,vtiger_dbname,vtiger_login,vtiger_pass,vtiger_url FROM vicidial_campaigns where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			if ($DB) {echo "$stmt\n";}
			$ss_conf_ct = mysql_num_rows($rslt);
			if ($ss_conf_ct > 0)
				{
				$row=mysql_fetch_row($rslt);
				$enable_vtiger_integration =	$row[0];
				$vtiger_server_ip	=			$row[1];
				$vtiger_dbname =				$row[2];
				$vtiger_login =					$row[3];
				$vtiger_pass =					$row[4];
				$vtiger_url =					$row[5];
				}
			##### END SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			#############################################################

			if ($enable_vtiger_integration > 0)
				{
				### connect to your vtiger database
				$linkV=mysql_connect("$vtiger_server_ip", "$vtiger_login","$vtiger_pass");
				if (!$linkV) {die("Could not connect: $vtiger_server_ip|$vtiger_dbname|$vtiger_login|$vtiger_pass" . mysql_error());}
				echo 'Connected successfully';
				mysql_select_db("$vtiger_dbname", $linkV);

				$user_name =		$user;
				$user_password =	$pass;
				$last_name =		$full_name;
				$is_admin =			'off';
				$roleid =			'H5';
				$status =			'Active';
				$groupid =			'1';
					if ($user_level >= 7) {$roleid = 'H3';}
					if ($user_level >= 8) {$roleid = 'H4';}
					if ($user_level >= 9) {$roleid = 'H2';}
					if ($user_level >= 9) {$is_admin = 'on';}
				$salt = substr($user_name, 0, 2);
				$salt = '$1$' . $salt . '$';
				$encrypted_password = crypt($user_password, $salt);

				######################################
				##### BEGIN Add/Update group info in Vtiger
				$stmt="SELECT count(*) from vtiger_groups where groupname='$user_group';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$group_found_count = $row[0];

				### group exists in vtiger, update it
				if ($group_found_count > 0)
					{
					$stmt="SELECT groupid from vtiger_groups where groupname='$user_group';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$groupid = $row[0];
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW GROUP RECORD IN VTIGER
					# Get next available id from vtiger_users_seq to use as groupid
					$stmt="SELECT id from vtiger_users_seq;";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					$row=mysql_fetch_row($rslt);
					$groupid = ($row[0] + 1);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					# Increase next available groupid with 1 so next record gets proper id
					$stmt="UPDATE vtiger_users_seq SET id = '$groupid';";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtA = "INSERT INTO vtiger_groups SET groupid='$groupid',groupname='$user_group',description='';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW GROUP RECORD IN VTIGER
					}
				##### END Add/Update group info in Vtiger
				######################################

				######################################
				##### BEGIN Add/Update user info in Vtiger
				$stmt="SELECT count(*) from vtiger_users where user_name='$user_name';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$found_count = $row[0];

				### user exists in vtiger, update it
				if ($found_count > 0)
					{
					$stmt="SELECT id from vtiger_users where user_name='$user_name';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$userid = $row[0];

					$stmt="SELECT count(*) from vtiger_users2group WHERE userid='$userid' and groupid='$groupid';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$usergroupcount = $row[0];
					mysql_query("set names utf8");
					$stmtA = "UPDATE vtiger_users SET user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status' where id='$userid';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtB = "UPDATE vtiger_user2role SET roleid='$roleid' where userid='$userid';";
					if ($DB) {echo "|$stmtB|\n";}
					$rslt=mysql_query($stmtB, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					if ($usergroupcount < 1)
						{
						$stmt="SELECT user_group FROM vicidial_user_groups;";
						$rslt=mysql_query($stmt, $link);
						if ($DB) {echo "$stmt\n";}
						$VD_groups_ct = mysql_num_rows($rslt);
						$k=0;
						$VD_groups_list='';
						while ($k < $VD_groups_ct)
							{
							$row=mysql_fetch_row($rslt);
							$VD_groups_list .= "'$row[0]',";
							$k++;
							}
						$VD_groups_list = preg_replace("/.$/",'',$VD_groups_list);

						$stmtC = "DELETE FROM vtiger_users2group WHERE userid='$userid' and groupid IN(SELECT groupid from vtiger_groups where groupname IN($VD_groups_list));";
						if ($DB) {echo "|$stmtC|\n";}
						$rslt=mysql_query($stmtC, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						$stmtD = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
						if ($DB) {echo "|$stmtD|\n";}
						$rslt=mysql_query($stmtD, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}
						}
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW USER RECORD IN VTIGER
					$stmtA = "INSERT INTO vtiger_users SET user_name='$user_name',user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status',date_format='yyyy-mm-dd',first_name='',reports_to_id='',description='',title='',department='',phone_home='',phone_mobile='',phone_work='',phone_other='',phone_fax='',email1='',email2='',yahoo_id='',signature='',address_street='',address_city='',address_state='',address_country='',address_postalcode='',user_preferences='',imagename='';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$userid = mysql_insert_id($linkV);
				
					$stmtB = "INSERT INTO vtiger_user2role SET userid='$userid',roleid='$roleid';";
					if ($DB) {echo "|$stmtB|\n";}
					$rslt=mysql_query($stmtB, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtC = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
					if ($DB) {echo "|$stmtC|\n";}
					$rslt=mysql_query($stmtC, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtD = "UPDATE vtiger_users_seq SET id='$userid';";
					if ($DB) {echo "|$stmtD|\n";}
					$rslt=mysql_query($stmtD, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW USER RECORD IN VTIGER
					}
				##### END Add/Update user info in Vtiger
				######################################
				}
			### END vtiger integration

			echo "<br><B>USER COPIED: $user copied from $source_user_id</B>\n";
			echo "<br><br>\n";
			echo "<a href=\"$PHP_SELF?ADD=3&user=$user\">Click here to go to the user record</a>\n";
			echo "<br><br>\n";

			}
		}
###### start Synchronize users with CRM 2011-09-20 add by pie;
	$stmt="SELECT ccms_url from system_settings;";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	$ccms_url_link = $row[0];
//	echo $ccms_url_link."<br>";
//	echo $user."<br>";
	$url_link = $ccms_url_link."integrate_vtiger_user.php?user=".$user;
//	echo $url_link."<br>";
	file("$url_link");
###### end Synchronize users with CRM 2011-09-20 add by pie;
	exit;
	}



######################
# ADD=21 adds the new campaign to the system
######################

if ($ADD==21)
	{
	
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_campaigns' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$campaign_id = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$campaign_id' where id_table='vicidial_campaigns' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_campaigns where campaign_id='$campaign_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>CAMPAIGN NOT ADDED - there is already a campaign in the system with this ID\n";}
	else
		{
		$stmt="SELECT count(*) from vicidial_inbound_groups where group_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] > 0)
			{echo "<br>CAMPAIGN NOT ADDED - there is already an inbound group in the system with this ID\n";}
		else
			{
			if ( (strlen($campaign_id) < 2) or (strlen($campaign_id) > 8) or (strlen($campaign_name) < 6)  or (strlen($campaign_name) > 40) )
				{
				echo "<br>CAMPAIGN NOT ADDED - Please go back and look at the data you entered\n";
				echo "<br>campaign ID must be between 2 and 8 characters in length\n";
				echo "<br>campaign name must be between 6 and 40 characters in length\n";
				}
			else
				{
				echo "<br><B>CAMPAIGN ADDED: $campaign_id</B>\n";

				$stmt="INSERT INTO vicidial_campaigns (campaign_id,campaign_name,campaign_description,active,dial_status_a,lead_order,park_ext,park_file_name,web_form_address,allow_closers,hopper_level,auto_dial_level,next_agent_call,local_call_time,voicemail_ext,campaign_script,get_call_launch,campaign_changedate,campaign_stats_refresh,list_order_mix,web_form_address_two,start_call_url,dispo_call_url) values('$campaign_id','$campaign_name','$campaign_description','$active','NEW','DOWN','$park_ext','$park_file_name','" . mysql_real_escape_string($web_form_address) . "','$allow_closers','$hopper_level','$auto_dial_level','$next_agent_call','$local_call_time','$voicemail_ext','$script_id','$get_call_launch','$SQLdate','Y','DISABLED','','','');";
				$rslt=mysql_query($stmt, $link);
				
				$stmtA="INSERT INTO vicidial_campaign_stats (campaign_id) values('$campaign_id');";
				$rslt=mysql_query($stmtA, $link);
				
				// add by bear
				$stmtB="insert into ccms_campaigns(campaign_id) values ('$campaign_id');";
				$rslt=mysql_query($stmtB, $link);
				
				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGNS', event_type='ADD', record_id='$campaign_id', event_code='ADMIN ADD CAMPAIGN', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);


				// 开始与vicidial_system_status表同步
				systemStatus_campaigns_synchronous($link);
				}
			}
		}
	$ADD=31;
	}

######################
# ADD=20 adds copied new campaign to the system
######################

if ($ADD==20)
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_campaigns' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$campaign_id = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$campaign_id' where id_table='vicidial_campaigns' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_campaigns where campaign_id='$campaign_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>CAMPAIGN NOT ADDED - there is already a campaign in the system with this ID\n";}
	else
		{
		$stmt="SELECT count(*) from vicidial_inbound_groups where group_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] > 0)
			{echo "<br>CAMPAIGN NOT ADDED - there is already an inbound group in the system with this ID\n";}
		else
			{
			if ( (strlen($campaign_id) < 2) or (strlen($campaign_id) > 8) or  (strlen($campaign_name) < 2) or (strlen($source_campaign_id) < 2) or (strlen($source_campaign_id) > 8) )
				{
				echo "<br>CAMPAIGN NOT ADDED - Please go back and look at the data you entered\n";
				echo "<br>campaign ID must be between 2 and 8 characters in length\n";
				echo "<br>source campaign ID must be between 2 and 8 characters in length\n";
				}
			else
				{
				echo "<br><B>CAMPAIGN COPIED: $campaign_id copied from $source_campaign_id</B>\n";
				$campaign_sql_field = "dial_status_a,dial_status_b,dial_status_c,dial_status_d,dial_status_e,lead_order,park_ext,park_file_name,web_form_address,allow_closers,hopper_level,auto_dial_level,next_agent_call,local_call_time,voicemail_ext,dial_timeout,dial_prefix,campaign_cid,campaign_vdad_exten,campaign_rec_exten,campaign_recording,campaign_rec_filename,campaign_script,get_call_launch,am_message_exten,amd_send_to_vmx,xferconf_a_dtmf,xferconf_a_number,xferconf_b_dtmf,xferconf_b_number,alt_number_dialing,scheduled_callbacks,lead_filter_id,drop_call_seconds,drop_action,safe_harbor_exten,display_dialable_count,wrapup_seconds,wrapup_message,closer_campaigns,use_internal_dnc,allcalls_delay,omit_phone_code,dial_method,available_only_ratio_tally,adaptive_dropped_percentage,adaptive_maximum_level,adaptive_latest_server_time,adaptive_intensity,adaptive_dl_diff_target,concurrent_transfers,auto_alt_dial,auto_alt_dial_statuses,agent_pause_codes_active,campaign_description,campaign_changedate,campaign_stats_refresh,campaign_logindate,dial_statuses,disable_alter_custdata,no_hopper_leads_logins,list_order_mix,campaign_allow_inbound,manual_dial_list_id,default_xfer_group,xfer_groups,queue_priority,drop_inbound_group,qc_enabled,qc_statuses,qc_lists,qc_shift_id,qc_get_record_launch,qc_show_recording,qc_web_form_address,qc_script,survey_first_audio_file,survey_dtmf_digits,survey_ni_digit,survey_opt_in_audio_file,survey_ni_audio_file,survey_method,survey_no_response_action,survey_ni_status,survey_response_digit_map,survey_xfer_exten,survey_camp_record_dir,disable_alter_custphone,display_queue_count,manual_dial_filter,agent_clipboard_copy,agent_extended_alt_dial,use_campaign_dnc,three_way_call_cid,three_way_dial_prefix,web_form_target,vtiger_search_category,vtiger_create_call_record,vtiger_create_lead_record,vtiger_screen_login,cpd_amd_action,agent_allow_group_alias,default_group_alias,vtiger_search_dead,vtiger_status_call,survey_third_digit,survey_third_audio_file,survey_third_status,survey_third_exten,survey_fourth_digit,survey_fourth_audio_file,survey_fourth_status,survey_fourth_exten,drop_lockout_time,quick_transfer_button,prepopulate_transfer_preset,drop_rate_group,view_calls_in_queue,view_calls_in_queue_launch,grab_calls_in_queue,call_requeue_button,pause_after_each_call,no_hopper_dialing,agent_dial_owner_only,agent_display_dialable_leads,web_form_address_two,waitforsilence_options,agent_select_territories,campaign_calldate,crm_popup_login,crm_login_address,timer_action,timer_action_message,timer_action_seconds,start_call_url,dispo_call_url,xferconf_c_number,xferconf_d_number,xferconf_e_number,inbound_mode,enable_vtiger_integration,vtiger_server_ip,vtiger_dbname,vtiger_login,vtiger_pass,vtiger_url,crm_target,xferconf_a_name,xferconf_b_name,xferconf_c_name,xferconf_d_name,xferconf_e_name,xfer_a_name,xfer_b_name,xfer_c_name,xfer_d_name,xfer_e_name";
				$stmt="INSERT INTO vicidial_campaigns (campaign_name,campaign_id,active,$campaign_sql_field) SELECT \"$campaign_name\",\"$campaign_id\",\"N\",$campaign_sql_field from vicidial_campaigns where campaign_id='$source_campaign_id';";
				$rslt=mysql_query($stmt, $link);

				$stmtA="INSERT INTO vicidial_campaign_stats (campaign_id) values('$campaign_id');";
				$rslt=mysql_query($stmtA, $link);
				
//拷贝Campaign时不拷贝Call Result ---2011-09-08 start---;
//				$stmtA="INSERT INTO vicidial_campaign_statuses (status,status_name,selectable,campaign_id,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable) SELECT status,status_name,selectable,\"$campaign_id\",human_answered,category,sale,dnc,customer_contact,not_interested,unworkable from vicidial_campaign_statuses where campaign_id='$source_campaign_id';";
//				$rslt=mysql_query($stmtA, $link);
//-------- end---;

				$stmtA="INSERT INTO vicidial_campaign_hotkeys (status,hotkey,status_name,selectable,campaign_id) SELECT status,hotkey,status_name,selectable,\"$campaign_id\" from vicidial_campaign_hotkeys where campaign_id='$source_campaign_id';";
				$rslt=mysql_query($stmtA, $link);

				$stmtA="INSERT INTO vicidial_lead_recycle (status,attempt_delay,attempt_maximum,active,campaign_id) SELECT status,attempt_delay,attempt_maximum,active,\"$campaign_id\" from vicidial_lead_recycle where campaign_id='$source_campaign_id';";
				$rslt=mysql_query($stmtA, $link);

				$stmtA="INSERT INTO vicidial_pause_codes (pause_code,pause_code_name,billable,campaign_id) SELECT pause_code,pause_code_name,billable,\"$campaign_id\" from vicidial_pause_codes where campaign_id='$source_campaign_id';";
				$rslt=mysql_query($stmtA, $link);
				
				$ccms_campaigns_sql_field = "manual_ring_launch,custom_dispo,custom_dispo_script,webform_button_display,default_pause_code_enable,agent_first_login_time,Conference_Channel_Display,Xfer_Blind_Display,Xfer_Local_Closer_Display,Xfer_Dial_With_Customer_Display,parked_channel_value,im_enable,phone_place_enable,phone_place_db_server_ip,phone_place_db_name,phone_place_db_login,phone_place_db_password,phone_place_default,im_talk_level,im_admin_level,Lead_Preview_Display,Dial_Next_Display,Xfer_Answer_Machine_Message_Display,fast_hangup_xferline_and_grab_custline,Xfer_Target_Unavailable_Remind_Enable,ingroup_change_enable,Skip_Choose_Ingroup_Enable,Incoming_Web_Play_Music_Enable,Incoming_Web_Play_Music_Filename,Xfer_Waiting_Web_Play_Music_Enable,Xfer_Waiting_Web_Play_Music_Filename,Customer_Hangup_Goto_Dispo_Enable,Pause_Code_Selected_Link_Display,Default_Pause_Code,extension_info_sql,extension_info_integration_enable,extension_info_db_server_ip,extension_info_db_name,extension_info_db_login,extension_info_db_password,default_call_result,inbound_dids,inbound_ivr,ccms_project,ccms_agent_window_align,ccms_agent_window_width,auto_submit_dispo,auto_dispo_time,agent_hangup_confirm";
				$stmtA="INSERT INTO ccms_campaigns (campaign_id,$ccms_campaigns_sql_field) select \"$campaign_id\",$ccms_campaigns_sql_field from ccms_campaigns where campaign_id='$source_campaign_id';";
				//echo $stmtA;
				$rslt=mysql_query($stmtA, $link);
				
				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGNS', event_type='COPY', record_id='$campaign_id', event_code='ADMIN COPY CAMPAIGN', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	echo "&nbsp;&nbsp;<a href=\"admin.php?ADD=31&campaign_id=$campaign_id\">modify campaign $campaign_id</a>";
	}

######################
# ADD=22 adds the new campaign status to the system
######################

if ($ADD==22)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_campaign_statuses where campaign_id='$campaign_id' and status='$status_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{
//		echo "<br>CAMPAIGN STATUS NOT ADDED - there is already a campaign-status in the system with this name\n";
		echo "<br><B>CAMPAIGN STATUS NOT ADDED - Status : $status_id has been used by $campaign_id !</B>\n";
		}
	else
		{
		$stmt="SELECT count(*) from vicidial_statuses where status='$status_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] > 0)
			{
//			echo "<br>CAMPAIGN STATUS NOT ADDED - there is already a global-status in the system with this name\n";
			echo "<br><B>CAMPAIGN STATUS NOT ADDED - Status : $status_id has been used by System !</B>\n";
			}
		else
			{
			if ( (strlen($campaign_id) < 2) or (strlen($status_id) < 1) or (strlen($status_name) < 2) )
				{
				echo "<br>CAMPAIGN STATUS NOT ADDED - Please go back and look at the data you entered\n";
				echo "<br>status must be between 1 and 8 characters in length\n";
				echo "<br>status name must be between 2 and 30 characters in length\n";
				}
			else
				{
				echo "<br><B>CAMPAIGN STATUS ADDED: $campaign_id - $status_id</B>\n";

				$stmt="INSERT INTO vicidial_campaign_statuses (status,status_name,selectable,campaign_id,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable,class,status_type) values('$status_id','$status_name','$selectable','$campaign_id','$human_answered','$category','$sale','$dnc','$customer_contact','$not_interested','$unworkable','$status_class','$status_type');";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_STATUS', event_type='ADD', record_id='$campaign_id', event_code='ADMIN ADD CAMPAIGN STATUS', event_sql=\"$SQL_log\", event_notes='Status: $status_id';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	$SUB=22;
	$ADD=31;
	}


######################
# ADD=23 adds the new campaign hotkey to the system
######################

if ($ADD==23)
	{
	$HKstatus_data = explode('-----',$HKstatus);
	$status = $HKstatus_data[0];
	$status_name = $HKstatus_data[1];

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_campaign_hotkeys where campaign_id='$campaign_id' and hotkey='$hotkey' and hotkey='$hotkey';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>CAMPAIGN HOT KEY NOT ADDED - there is already a campaign-hotkey in the system with this hotkey\n";}
	else
		{
		if ( (strlen($campaign_id) < 2) or (strlen($status) < 1) or (strlen($hotkey) < 1) )
			{
			echo "<br>CAMPAIGN HOT KEY NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>hotkey must be a single character between 1 and 9 \n";
			echo "<br>status must be between 1 and 8 characters in length\n";
			}
		else
			{
			echo "<br><B>CAMPAIGN HOT KEY ADDED: $campaign_id - $status - $hotkey</B>\n";

			$stmt="INSERT INTO vicidial_campaign_hotkeys values('$status','$hotkey','$status_name','$selectable','$campaign_id');";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_HOTKEY', event_type='ADD', record_id='$campaign_id', event_code='ADMIN ADD CAMPAIGN HOTKEY', event_sql=\"$SQL_log\", event_notes='Status: $status|HotKey: $hotkey';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$SUB=23;
	$ADD=31;
	}


######################
# ADD=25 adds the new campaign lead recycle entry to the system
######################

if ($ADD==25)
	{
	$status = eregi_replace("-----.*",'',$status);
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_lead_recycle where campaign_id='$campaign_id' and status='$status';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>CAMPAIGN LEAD RECYCLE NOT ADDED - there is already a lead-recycle for this campaign with this status\n";}
	else
		{
		if ( (strlen($campaign_id) < 2) or (strlen($status) < 1) or ($attempt_maximum < 1) or ($attempt_maximum > 10) )//鍙栨秷Attempt Delay鐨勭鏁伴檺鍒讹細($attempt_delay < 120) or ($attempt_delay >= 43200)锛?
			{
			echo "<br>CAMPAIGN LEAD RECYCLE NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>status must be between 1 and 6 characters in length\n";
//			echo "<br>attempt delay must be at least 120 seconds and less than 43200 seconds or 12 hours\n";//鍙栨秷Attempt Delay鐨勭鏁伴檺鍒讹紱
			echo "<br>maximum attempts must be from 1 to 10\n";
			}
		else
			{
			echo "<br><B>CAMPAIGN LEAD RECYCLE ADDED: $campaign_id - $status - $attempt_delay</B>\n";

			$stmt="INSERT INTO vicidial_lead_recycle(campaign_id,status,attempt_delay,attempt_maximum,active) values('$campaign_id','$status','$attempt_delay','$attempt_maximum','$active');";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_RECYCLE', event_type='ADD', record_id='$campaign_id', event_code='ADMIN ADD CAMPAIGN LEAD RECYCLE', event_sql=\"$SQL_log\", event_notes='Status: $status';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$SUB=25;
	$ADD=31;
	}


######################
# ADD=26 adds the new auto alt dial status to the campaign
######################

if ($ADD==26)
	{
	$status = eregi_replace("-----.*",'',$status);
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_campaigns where campaign_id='$campaign_id' and auto_alt_dial_statuses LIKE \"% $status %\";";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>AUTO ALT DIAL STATUS NOT ADDED - there is already an entry for this campaign with this status\n";}
	else
		{
		if ( (strlen($campaign_id) < 2) or (strlen($status) < 1) )
			{
			echo "<br>AUTO ALT DIAL STATUS NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>status must be between 1 and 6 characters in length\n";
			}
		else
			{
			echo "<br><B>AUTO ALT DIAL STATUS ADDED: $campaign_id - $status</B>\n";

			$stmt="SELECT auto_alt_dial_statuses from vicidial_campaigns where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			$row=mysql_fetch_row($rslt);

			if (strlen($row[0])<2) {$row[0] = ' -';}
			$auto_alt_dial_statuses = " $status$row[0]";
			$stmt="UPDATE vicidial_campaigns set auto_alt_dial_statuses='$auto_alt_dial_statuses' where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_ALTDIAL', event_type='ADD', record_id='$campaign_id', event_code='ADMIN ADD CAMPAIGN ALT DIAL', event_sql=\"$SQL_log\", event_notes='Status: $auto_alt_dial_statuses';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$SUB=26;
	$ADD=31;
	}


######################
# ADD=27 adds the new campaign agent pause code entry to the system
######################

if ($ADD==27)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_pause_codes where campaign_id='$campaign_id' and pause_code='$pause_code';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>AGENT PAUSE CODE NOT ADDED - there is already an entry for this campaign with this  pause code\n";}
	else
		{
		if ( (strlen($campaign_id) < 2) or (strlen($pause_code) < 1) or (strlen($pause_code) > 6) or (strlen($pause_code_name) < 2) )
			{
			echo "<br>AGENT PAUSE CODE NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>pause code must be between 1 and 6 characters in length\n";
			echo "<br>pause code name must be between 2 and 30 characters in length\n";
			}
		else
			{
			echo "<br><B>AGENT PAUSE CODE ADDED: $campaign_id - $pause_code - $pause_code_name</B>\n";

			$stmt="INSERT INTO vicidial_pause_codes(campaign_id,pause_code,pause_code_name,billable) values('$campaign_id','$pause_code','$pause_code_name','$billable');";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_PAUSECODE', event_type='ADD', record_id='$campaign_id', event_code='ADMIN ADD CAMPAIGN PAUSE CODE', event_sql=\"$SQL_log\", event_notes='Pause Code: $pause_code';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$SUB=27;
	$ADD=31;
	}


######################
# ADD=28 adds new status to the campaign dial Call Result
######################

if ($ADD==28)
	{
	$status = eregi_replace("-----.*",'',$status);
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_campaigns where campaign_id='$campaign_id' and dial_statuses LIKE \"% $status %\";";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>CAMPAIGN DIAL STATUS NOT ADDED - there is already an entry for this campaign with this status\n";}
	else
		{
		if ( (strlen($campaign_id) < 2) or (strlen($status) < 1) )
			{
			echo "<br>CAMPAIGN DIAL STATUS NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>status must be between 1 and 6 characters in length\n";
			}
		else
			{
			echo "<br><B>CAMPAIGN DIAL STATUS ADDED: $campaign_id - $status</B>\n";

			$stmt="SELECT dial_statuses from vicidial_campaigns where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			$row=mysql_fetch_row($rslt);

			if (strlen($row[0])<2) {$row[0] = ' -';}
			$dial_statuses = " $status$row[0]";
			$stmt="UPDATE vicidial_campaigns set dial_statuses='$dial_statuses' where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_DIALSTATUS', event_type='ADD', record_id='$campaign_id', event_code='ADMIN ADD CAMPAIGN DIAL STATUS', event_sql=\"$SQL_log\", event_notes='Status: $statuses';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	#$SUB=28;
	$ADD=31;
	}


######################
# ADD=211 adds the new list to the system
######################

if ($ADD==211)
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_lists' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$list_id = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$list_id' where id_table='vicidial_lists' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_lists where list_id='$list_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>LIST NOT ADDED - there is already a list in the system with this ID\n";}
	else
		{
		if ( (strlen($campaign_id) < 2) or (strlen($list_name) < 2)  or ($list_id < 100) or (strlen($list_id) > 8) )
			{
			echo "<br>LIST NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>List ID must be between 2 and 8 characters in length\n";
			echo "<br>List name must be at least 2 characters in length\n";
			echo "<br>List ID must be greater than 100\n";
			}
		else
			{
			echo "<br><B>LIST ADDED: $list_id</B>\n";

			$stmt="INSERT INTO vicidial_lists (list_id,list_name,campaign_id,active,list_description,list_changedate) values('$list_id','$list_name','$campaign_id','$active','$list_description','$SQLdate');";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='ADD', record_id='$list_id', event_code='ADMIN ADD LIST', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=311;
	}



######################
# ADD=2111 adds the new inbound group to the system
######################

if ($ADD==2111)
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_inbound_groups' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$group_id = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$group_id' where id_table='vicidial_inbound_groups' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_inbound_groups where group_id='$group_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>GROUP NOT ADDED - there is already a group in the system with this ID\n";}
	else
		{
			if ($inbound_mode == "ring")
			{
				$next_agent_call = $next_agent_call_ring;
			}			
			
		$stmt="SELECT count(*) from vicidial_campaigns where campaign_id='$group_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] > 0)
			{echo "<br>GROUP NOT ADDED - there is already a campaign in the system with this ID\n";}
		else
			{
			if ( (strlen($group_id) < 2) or (strlen($group_name) < 2)  or (strlen($group_color) < 2) or (strlen($group_id) > 20) or (eregi(' ',$group_id)) or (eregi("\-",$group_id)) or (eregi("\+",$group_id)) )
				{
				echo "<br>GROUP NOT ADDED - Please go back and look at the data you entered\n";
				echo "<br>Group ID must be between 2 and 20 characters in length and contain no ' -+'.\n";
				echo "<br>Group name and group color must be at least 2 characters in length\n";
				}
			else
				{
#Modefied by fnatic start#
			#	$stmt="INSERT INTO vicidial_inbound_groups (group_id,group_name,group_color,active,web_form_address,voicemail_ext,next_agent_call,fronter_display,ingroup_script,get_call_launch,web_form_address_two,start_call_url,dispo_call_url) values('$group_id','$group_name','$group_color','$active','" . mysql_real_escape_string($web_form_address) . "','$voicemail_ext','$next_agent_call','$fronter_display','$script_id','$get_call_launch','','','');";
			$stmt="INSERT INTO vicidial_inbound_groups (group_id,group_name,group_color,active,web_form_address,voicemail_ext,next_agent_call,fronter_display,ingroup_script,get_call_launch,web_form_address_two,start_call_url,dispo_call_url,inbound_mode) values('$group_id','$group_name','$group_color','$active','" . mysql_real_escape_string($web_form_address) . "','$voicemail_ext','$next_agent_call','$fronter_display','$script_id','$get_call_launch','','','','$inbound_mode');";
#End#
				$rslt=mysql_query($stmt, $link);

				$stmtA="INSERT INTO vicidial_campaign_stats (campaign_id) values('$group_id');";
				$rslt=mysql_query($stmtA, $link);

				echo "<br><B>GROUP ADDED: $group_id</B>\n";

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='INGROUPS', event_type='ADD', record_id='$group_id', event_code='ADMIN ADD INBOUND GROUP', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	$ADD=3111;
	}


######################
# ADD=2011 adds copied inbound group to the system
######################

if ($ADD==2011)
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_inbound_groups' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$group_id = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$group_id' where id_table='vicidial_inbound_groups' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_inbound_groups where group_id='$group_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>GROUP NOT ADDED - there is already a group in the system with this ID\n";}
	else
		{
		$stmt="SELECT count(*) from vicidial_campaigns where campaign_id='$group_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] > 0)
			{echo "<br>GROUP NOT ADDED - there is already a campaign in the system with this ID\n";}
		else
			{
			if ( (strlen($group_id) < 2) or (strlen($group_name) < 2) or (strlen($group_id) > 20) or (eregi(' ',$group_id)) or (eregi("\-",$group_id)) or (eregi("\+",$group_id)) )
				{
				echo "<br>GROUP NOT ADDED - Please go back and look at the data you entered\n";
				echo "<br>Group ID must be between 2 and 20 characters in length and contain no ' -+'.\n";
				echo "<br>Group name and group color must be at least 2 characters in length\n";
				}
			else
				{
#Modfied by fnatic start#
				#$stmt="INSERT INTO vicidial_inbound_groups (group_id,group_name,group_color,active,web_form_address,voicemail_ext,next_agent_call,fronter_display,ingroup_script,get_call_launch,xferconf_a_dtmf,xferconf_a_number,xferconf_b_dtmf,xferconf_b_number,drop_call_seconds,drop_action,drop_exten,call_time_id,after_hours_action,after_hours_message_filename,after_hours_exten,after_hours_voicemail,welcome_message_filename,moh_context,onhold_prompt_filename,prompt_interval,agent_alert_exten,agent_alert_delay,default_xfer_group,queue_priority,drop_inbound_group,ingroup_recording_override,ingroup_rec_filename,afterhours_xfer_group,qc_enabled,qc_statuses,qc_shift_id,qc_get_record_launch,qc_show_recording,qc_web_form_address,qc_script,play_place_in_line,play_estimate_hold_time,hold_time_option,hold_time_option_seconds,hold_time_option_exten,hold_time_option_voicemail,hold_time_option_xfer_group,hold_time_option_callback_filename,hold_time_option_callback_list_id,hold_recall_xfer_group,no_delay_call_route,play_welcome_message,answer_sec_pct_rt_stat_one,answer_sec_pct_rt_stat_two,default_group_alias,no_agent_no_queue,no_agent_action,no_agent_action_value,web_form_address_two,timer_action,timer_action_message,timer_action_seconds,start_call_url,dispo_call_url,xferconf_c_number,xferconf_d_number,xferconf_e_number) SELECT \"$group_id\",\"$group_name\",group_color,\"N\",web_form_address,voicemail_ext,next_agent_call,fronter_display,ingroup_script,get_call_launch,xferconf_a_dtmf,xferconf_a_number,xferconf_b_dtmf,xferconf_b_number,drop_call_seconds,drop_action,drop_exten,call_time_id,after_hours_action,after_hours_message_filename,after_hours_exten,after_hours_voicemail,welcome_message_filename,moh_context,onhold_prompt_filename,prompt_interval,agent_alert_exten,agent_alert_delay,default_xfer_group,queue_priority,drop_inbound_group,ingroup_recording_override,ingroup_rec_filename,afterhours_xfer_group,qc_enabled,qc_statuses,qc_shift_id,qc_get_record_launch,qc_show_recording,qc_web_form_address,qc_script,play_place_in_line,play_estimate_hold_time,hold_time_option,hold_time_option_seconds,hold_time_option_exten,hold_time_option_voicemail,hold_time_option_xfer_group,hold_time_option_callback_filename,hold_time_option_callback_list_id,hold_recall_xfer_group,no_delay_call_route,play_welcome_message,answer_sec_pct_rt_stat_one,answer_sec_pct_rt_stat_two,default_group_alias,no_agent_no_queue,no_agent_action,no_agent_action_value,web_form_address_two,timer_action,timer_action_message,timer_action_seconds,start_call_url,dispo_call_url,xferconf_c_number,xferconf_d_number,xferconf_e_number from vicidial_inbound_groups where group_id=\"$source_group_id\";";
				#$stmt="INSERT INTO vicidial_inbound_groups (group_id,group_name,group_color,active,web_form_address,voicemail_ext,next_agent_call,fronter_display,ingroup_script,get_call_launch,xferconf_a_dtmf,xferconf_a_number,xferconf_b_dtmf,xferconf_b_number,drop_call_seconds,drop_action,drop_exten,call_time_id,after_hours_action,after_hours_message_filename,after_hours_exten,after_hours_voicemail,welcome_message_filename,moh_context,onhold_prompt_filename,prompt_interval,agent_alert_exten,agent_alert_delay,default_xfer_group,queue_priority,drop_inbound_group,ingroup_recording_override,ingroup_rec_filename,afterhours_xfer_group,qc_enabled,qc_statuses,qc_shift_id,qc_get_record_launch,qc_show_recording,qc_web_form_address,qc_script,play_place_in_line,play_estimate_hold_time,hold_time_option,hold_time_option_seconds,hold_time_option_exten,hold_time_option_voicemail,hold_time_option_xfer_group,hold_time_option_callback_filename,hold_time_option_callback_list_id,hold_recall_xfer_group,no_delay_call_route,play_welcome_message,answer_sec_pct_rt_stat_one,answer_sec_pct_rt_stat_two,default_group_alias,no_agent_no_queue,no_agent_action,no_agent_action_value,web_form_address_two,timer_action,timer_action_message,timer_action_seconds,start_call_url,dispo_call_url,xferconf_c_number,xferconf_d_number,xferconf_e_number,xfer_a_name,xfer_b_name,xfer_c_name,xfer_d_name,xfer_e_name,inbound_mode,ring_timeout_seconds,ring_timeout_action,ring_timeout_exten,ring_timeout_voicemail_ext,ring_timeout_inbound_group) SELECT \"$group_id\",\"$group_name\",group_color,\"N\",web_form_address,voicemail_ext,next_agent_call,fronter_display,ingroup_script,get_call_launch,xferconf_a_dtmf,xferconf_a_number,xferconf_b_dtmf,xferconf_b_number,drop_call_seconds,drop_action,drop_exten,call_time_id,after_hours_action,after_hours_message_filename,after_hours_exten,after_hours_voicemail,welcome_message_filename,moh_context,onhold_prompt_filename,prompt_interval,agent_alert_exten,agent_alert_delay,default_xfer_group,queue_priority,drop_inbound_group,ingroup_recording_override,ingroup_rec_filename,afterhours_xfer_group,qc_enabled,qc_statuses,qc_shift_id,qc_get_record_launch,qc_show_recording,qc_web_form_address,qc_script,play_place_in_line,play_estimate_hold_time,hold_time_option,hold_time_option_seconds,hold_time_option_exten,hold_time_option_voicemail,hold_time_option_xfer_group,hold_time_option_callback_filename,hold_time_option_callback_list_id,hold_recall_xfer_group,no_delay_call_route,play_welcome_message,answer_sec_pct_rt_stat_one,answer_sec_pct_rt_stat_two,default_group_alias,no_agent_no_queue,no_agent_action,no_agent_action_value,web_form_address_two,timer_action,timer_action_message,timer_action_seconds,start_call_url,dispo_call_url,xferconf_c_number,xferconf_d_number,xferconf_e_number,xfer_a_name,xfer_b_name,xfer_c_name,xfer_d_name,xfer_e_name,inbound_mode,ring_timeout_seconds,ring_timeout_action,ring_timeout_exten,ring_timeout_voicemail_ext,ring_timeout_inbound_group from vicidial_inbound_groups where group_id=\"$source_group_id\";";
				$stmt_group_field = "web_form_address,voicemail_ext,next_agent_call,fronter_display,ingroup_script,get_call_launch,xferconf_a_dtmf,xferconf_a_number,xferconf_b_dtmf,xferconf_b_number,drop_call_seconds,drop_action,drop_exten,call_time_id,after_hours_action,after_hours_message_filename,after_hours_exten,after_hours_voicemail,welcome_message_filename,moh_context,onhold_prompt_filename,prompt_interval,agent_alert_exten,agent_alert_delay,default_xfer_group,queue_priority,drop_inbound_group,drop_menu_id,ingroup_recording_override,ingroup_rec_filename,afterhours_xfer_group,qc_enabled,qc_statuses,qc_shift_id,qc_get_record_launch,qc_show_recording,qc_web_form_address,qc_script,play_place_in_line,play_language,play_estimate_hold_time,hold_time_option,hold_time_option_seconds,hold_time_option_exten,hold_time_option_voicemail,hold_time_option_xfer_group,hold_time_option_callback_filename,hold_time_option_callback_list_id,hold_recall_xfer_group,no_delay_call_route,play_welcome_message,answer_sec_pct_rt_stat_one,answer_sec_pct_rt_stat_two,default_group_alias,no_agent_no_queue,no_agent_action,no_agent_action_value,web_form_address_two,timer_action,timer_action_message,timer_action_seconds,start_call_url,dispo_call_url,xferconf_c_number,xferconf_d_number,xferconf_e_number,inbound_mode,ring_timeout_seconds,ring_timeout_action,ring_timeout_exten,ring_timeout_voicemail_ext,ring_timeout_inbound_group,play_agent_info,ring_start_launch,ring_form_address,ring_form_address_two,ring_ingroup_script,agent_follow_up";
				$stmt="INSERT INTO vicidial_inbound_groups (group_id,group_name,group_color,active,$stmt_group_field) SELECT \"$group_id\",\"$group_name\",group_color,\"N\", $stmt_group_field from vicidial_inbound_groups where group_id=\"$source_group_id\";";
#End#
				$rslt=mysql_query($stmt, $link);

				echo "<br><B>GROUP ADDED: $group_id</B>\n";

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='INGROUPS', event_type='COPY', record_id='$group_id', event_code='ADMIN COPY INBOUND GROUP', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	$ADD=3111;
	}


######################
# ADD=2311 adds the new did to the system
######################

if ($ADD==2311)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_inbound_dids where did_pattern='$did_pattern';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>DID NOT ADDED - there is already a DID in the system with this ID\n";}
	else
		{
		$stmt="SELECT count(*) from vicidial_inbound_dids where did_pattern='$did_pattern';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] > 0)
			{echo "<br>DID NOT ADDED - there is already a DID in the system with this extension\n";}
		else
			{
			if ( (strlen($did_pattern) < 2) or (eregi(' ',$did_pattern)) or (eregi('-',$did_pattern)) or (eregi("\+",$did_pattern)) )
				{
				echo "<br>DID NOT ADDED - Please go back and look at the data you entered\n";
				echo "<br>DID Extension must be between 2 and 20 characters in length and contain no ' -+'.\n";
				}
			else
				{
				$stmt="INSERT INTO vicidial_inbound_dids (did_pattern,did_description) values('$did_pattern','$did_description');";
				$rslt=mysql_query($stmt, $link);

				$stmt="SELECT did_id from vicidial_inbound_dids where did_pattern='$did_pattern';";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);
				$did_id = $row[0];

				echo "<br><B>DID ADDED: $did_pattern $did_description    - $did_id</B>\n";

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='DIDS', event_type='ADD', record_id='$did_id', event_code='ADMIN ADD DID', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	$ADD=3311;
	}


######################
# ADD=2411 adds copied did to the system
######################

if ($ADD==2411)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_inbound_dids where did_pattern='$did_pattern';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>DID NOT ADDED - there is already a DID in the system with this extension\n";}
	else
		{
		if ( (strlen($source_did) < 1) or (strlen($did_pattern) < 1) or (eregi(' ',$source_did)) or (eregi(' ',$did_pattern)) or (eregi("\+",$source_did)) )
			{
			echo "<br>DID NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>DID Extension must be between 2 and 20 characters in length and contain no ' -+'.\n";
			}
		else
			{
			$stmt="INSERT INTO vicidial_inbound_dids (did_pattern,did_description,did_active,did_route,extension,exten_context,voicemail_ext,phone,server_ip,user,user_unavailable_action,user_route_settings_ingroup,group_id,call_handle_method,agent_search_method,list_id,campaign_id,phone_code,menu_id) SELECT \"$did_pattern\",\"$did_description\",did_active,did_route,extension,exten_context,voicemail_ext,phone,server_ip,user,user_unavailable_action,user_route_settings_ingroup,group_id,call_handle_method,agent_search_method,list_id,campaign_id,phone_code,menu_id from vicidial_inbound_dids where did_id=\"$source_did\";";
			$rslt=mysql_query($stmt, $link);

			$stmt="SELECT did_id from vicidial_inbound_dids where did_pattern='$did_pattern';";
			$rslt=mysql_query($stmt, $link);
			$row=mysql_fetch_row($rslt);
			$did_id = $row[0];

			echo "<br><B>DID ADDED: $did_pattern     - $did_id</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='DIDS', event_type='COPY', record_id='$did_id', event_code='ADMIN COPY DID', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=3311;
	}


######################
# ADD=2511 adds the new IVR to the system
######################

if ($ADD==2511)
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_call_menu' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$menu_id = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$menu_id' where id_table='vicidial_call_menu' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_call_menu where menu_id='$menu_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>IVR NOT ADDED - there is already a IVR in the system with this ID\n";}
	else
		{
		if ( (strlen($menu_id) < 2) or (eregi(' ',$menu_id)) )
			{
			echo "<br>IVR NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>IVR ID must be between 2 and 50 characters in length and contain no ' '.\n";
			}
		else
			{
			$stmt="INSERT INTO vicidial_call_menu (menu_id,menu_name) values('$menu_id','$menu_name');";
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>IVR ADDED: $menu_id $menu_name</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CALLMENUS', event_type='ADD', record_id='$menu_id', event_code='ADMIN ADD IVR', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=3511;
	}


######################
# ADD=2611 adds copied IVR to the system
######################

if ($ADD==2611)
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_call_menu' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$menu_id = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$menu_id' where id_table='vicidial_call_menu' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_call_menu where menu_id='$menu_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>IVR NOT ADDED - there is already a IVR in the system with this ID\n";}
	else
		{
		if ( (strlen($menu_id) < 2) or (eregi(' ',$menu_id)) or  (strlen($source_menu) < 2) or (eregi(' ',$source_menu)) )
			{
			echo "<br>IVR NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>IVR ID must be between 2 and 50 characters in length and contain no ' '.\n";
			}
		else
			{
			$stmt="INSERT INTO vicidial_call_menu (menu_id,menu_name,menu_prompt,menu_timeout,menu_timeout_prompt,menu_invalid_prompt,menu_repeat,menu_time_check,call_time_id,track_in_vdac,custom_dialplan_entry,tracking_group) SELECT \"$menu_id\",\"$menu_name\",menu_prompt,menu_timeout,menu_timeout_prompt,menu_invalid_prompt,menu_repeat,menu_time_check,call_time_id,track_in_vdac,custom_dialplan_entry,tracking_group from vicidial_call_menu where menu_id=\"$source_menu\";";
			$rslt=mysql_query($stmt, $link);

			$stmtA="INSERT INTO vicidial_call_menu_options (menu_id,option_value,option_description,option_route,option_route_value,option_route_value_context) SELECT \"$menu_id\",option_value,option_description,option_route,option_route_value,option_route_value_context from vicidial_call_menu_options where menu_id='$source_menu';";
			$rslt=mysql_query($stmtA, $link);

			echo "<br><B>IVR ADDED: $menu_id     - $menu_name</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|$stmtA";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CALLMENUS', event_type='COPY', record_id='$menu_id', event_code='ADMIN COPY MENU', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=3511;
	}


######################
# ADD=21111 adds new remote agents to the system
######################

if ($ADD==21111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_remote_agents where server_ip='$server_ip' and user_start='$user_start';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>REMOTE AGENTS NOT ADDED - there is already a remote agents entry starting with this userID\n";}
	else
		{
		if ( (strlen($server_ip) < 2) or (strlen($user_start) < 2)  or (strlen($campaign_id) < 2) or (strlen($conf_exten) < 2) )
			{
			echo "<br>REMOTE AGENTS NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>User ID start and external extension must be at least 2 characters in length\n";
			}
		else
			{
			$group_id = $_REQUEST[remoteagentgroup_id];
			$stmt="INSERT INTO vicidial_remote_agents values('','$user_start','$number_of_lines','$server_ip','$conf_exten','$status','$campaign_id','$groups_value','$group_id');";
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>REMOTE AGENTS ADDED: $user_start</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='REMOTEAGENTS', event_type='ADD', record_id='$user_start', event_code='ADMIN ADD REMOTE AGENT', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=10000;
	}

######################
# ADD=211111 adds new user group to the system
######################

if ($ADD==211111)
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_user_groups' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$user_group = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$user_group' where id_table='vicidial_user_groups' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_user_groups where user_group='$user_group';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>USER GROUP NOT ADDED - there is already a user group entry with this name\n";}
	else
		{
		if ( (strlen($user_group) < 2) or (strlen($group_name) < 2) )
			{
			echo "<br>USER GROUP NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>Group name and description must be at least 2 characters in length\n";
			}
		else
			{
			$stmt="INSERT INTO vicidial_user_groups(user_group,group_name,allowed_campaigns) values('$user_group','$group_name','-ALL-CAMPAIGNS-');";
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>USER GROUP ADDED: $user_group</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='USERGROUPS', event_type='ADD', record_id='$user_group', event_code='ADMIN ADD USER GROUP', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			###############################################################
			##### START SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			$stmt = "SELECT enable_vtiger_integration,vtiger_server_ip,vtiger_dbname,vtiger_login,vtiger_pass,vtiger_url FROM vicidial_campaigns where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			if ($DB) {echo "$stmt\n";}
			$ss_conf_ct = mysql_num_rows($rslt);
			if ($ss_conf_ct > 0)
				{
				$row=mysql_fetch_row($rslt);
				$enable_vtiger_integration =	$row[0];
				$vtiger_server_ip	=			$row[1];
				$vtiger_dbname =				$row[2];
				$vtiger_login =					$row[3];
				$vtiger_pass =					$row[4];
				$vtiger_url =					$row[5];
				}
			##### END SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			#############################################################

			if ($enable_vtiger_integration > 0)
				{
				### connect to your vtiger database
				$linkV=mysql_connect("$vtiger_server_ip", "$vtiger_login","$vtiger_pass");
				if (!$linkV) {die("Could not connect: $vtiger_server_ip|$vtiger_dbname|$vtiger_login|$vtiger_pass" . mysql_error());}
				echo 'Connected successfully';
				mysql_select_db("$vtiger_dbname", $linkV);

				######################################
				##### BEGIN Add/Update group info in Vtiger
				$stmt="SELECT count(*) from vtiger_groups where groupname='$user_group';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$group_found_count = $row[0];

				### group exists in vtiger, update it
				if ($group_found_count > 0)
					{
					$stmt="SELECT groupid from vtiger_groups where groupname='$user_group';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$groupid = $row[0];
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW GROUP RECORD IN VTIGER
					# Get next available id from vtiger_users_seq to use as groupid
					$stmt="SELECT id from vtiger_users_seq;";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					$row=mysql_fetch_row($rslt);
					$groupid = ($row[0] + 1);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					# Increase next available groupid with 1 so next record gets proper id
					$stmt="UPDATE vtiger_users_seq SET id = '$groupid';";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					mysql_query("set names utf8");
					$stmtA = "INSERT INTO vtiger_groups SET groupid='$groupid',groupname='$user_group',description='$group_name';";
					//echo $stmtA."aaaaaaaa";exit;
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW GROUP RECORD IN VTIGER
					}
				##### END Add/Update group info in Vtiger
				######################################
				}
			}
		}
	//$ADD=100000;
	$ADD=311111;
###### start Synchronize users with CRM 2011-09-20 add by pie;
	$stmt="SELECT ccms_url from system_settings;";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	$ccms_url_link = $row[0];
//	echo $ccms_url_link."<br>";
//	echo $user_group."<br>";
	$url_link = $ccms_url_link."integrate_vtiger_group.php?user_group=".$user_group;
//	echo $url_link."<br>";
	file("$url_link");
###### end Synchronize users with CRM 2011-09-20 add by pie;
	}

######################
# ADD=2111111 adds new script to the system
######################

if ($ADD==2111111)
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_scripts' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$script_id = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$script_id' where id_table='vicidial_scripts' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_scripts where script_id='$script_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>SCRIPT NOT ADDED - there is already a script entry with this name\n";}
	else
		{
		if ( (strlen($script_id) < 2) or (strlen($script_name) < 2) or (strlen($script_text) < 2) )
			{
			echo "<br>SCRIPT NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>Script name, description and text must be at least 2 characters in length\n";
			}
		else
			{
			$stmt="INSERT INTO vicidial_scripts values('$script_id','$script_name','$script_comments','" . mysql_real_escape_string($script_text) . "','$active');";
			$rslt=mysql_query($stmt, $link);
			if ($DB > 0) {echo "|$stmt|";}
			echo "<br><B>SCRIPT ADDED: $script_id</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SCRIPTS', event_type='ADD', record_id='$script_id', event_code='ADMIN ADD SCRIPT', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=1000000;
	}


######################
# ADD=21111111 adds new filter to the system
######################

if ($ADD==21111111)
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_lead_filters' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$lead_filter_id = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$lead_filter_id' where id_table='vicidial_lead_filters' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_lead_filters where lead_filter_id='$lead_filter_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>FILTER NOT ADDED - there is already a filter entry with this ID\n";}
	else
		{
		if ( (strlen($lead_filter_id) < 2) or (strlen($lead_filter_name) < 2) or (strlen($lead_filter_sql) < 2) )
			{
			echo "<br>FILTER NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>Filter ID, name and SQL must be at least 2 characters in length\n";
			}
		else
			{
			$stmt="INSERT INTO vicidial_lead_filters SET lead_filter_id='$lead_filter_id',lead_filter_name='$lead_filter_name',lead_filter_comments='$lead_filter_comments',lead_filter_sql='" . mysql_real_escape_string($lead_filter_sql) . "';";
			$rslt=mysql_query($stmt, $link);

			if ($DB > 0) {echo "|$stmt|";}
			echo "<br><B>FILTER ADDED: $lead_filter_id</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='FILTERS', event_type='ADD', record_id='$lead_filter_id', event_code='ADMIN ADD FILTER', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=10000000;
	}


######################
# ADD=211111111 adds new call time definition to the system
######################

if ($ADD==211111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_call_times where call_time_id='$call_time_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>CALL TIME DEFINITION NOT ADDED - there is already a call time entry with this ID\n";}
	else
		{
		if ( (strlen($call_time_id) < 2) or (strlen($call_time_name) < 2) )
			{
			echo "<br>CALL TIME DEFINITION NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>Call Time ID and name must be at least 2 characters in length\n";
			}
		else
			{
			$stmt="INSERT INTO vicidial_call_times SET call_time_id='$call_time_id',call_time_name='$call_time_name',call_time_comments='$call_time_comments';";
			$rslt=mysql_query($stmt, $link);
			if ($DB > 0) {echo "|$stmt|";}

			echo "<br><B>CALL TIME ADDED: $call_time_id</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CALLTIMES', event_type='ADD', record_id='$call_time_id', event_code='ADMIN ADD CALL TIME', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=311111111;
	}


######################
# ADD=2111111111 adds new state call time definition to the system
######################

if ($ADD==2111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_state_call_times where state_call_time_id='$call_time_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>STATE CALL TIME DEFINITION NOT ADDED - there is already a call time entry with this ID\n";}
	else
		{
		if ( (strlen($call_time_id) < 2) or (strlen($call_time_name) < 2) or (strlen($state_call_time_state) < 2) )
			{
			echo "<br>STATE CALL TIME DEFINITION NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>State Call Time ID, name and state must be at least 2 characters in length\n";
			}
		else
			{
			$stmt="INSERT INTO vicidial_state_call_times SET state_call_time_id='$call_time_id',state_call_time_name='$call_time_name',state_call_time_comments='$call_time_comments',state_call_time_state='$state_call_time_state';";
			$rslt=mysql_query($stmt, $link);
			if ($DB > 0) {echo "|$stmt|";}

			echo "<br><B>STATE CALL TIME ADDED: $call_time_id</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CALLTIMES_STATE', event_type='ADD', record_id='$call_time_id', event_code='ADMIN ADD STATE CALL TIME', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=3111111111;
	}


######################
# ADD=231111111 adds new shift definition to the system
######################

if ($ADD==231111111)
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='vicidial_shifts' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$shift_id = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$shift_id' where id_table='vicidial_shifts' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_shifts where shift_id='$shift_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>SHIFT DEFINITION NOT ADDED - there is already a shift entry with this ID\n";}
	else
		{
		$shift_length_test = eregi_replace(':','',$shift_length);
		if ( (strlen($shift_id) < 2) or (strlen($shift_name) < 2) or (strlen($shift_start_time) < 4) or (strlen($shift_start_time) > 4) or (strlen($shift_length) < 5) or (strlen($shift_length) > 5) or ($shift_start_time > 2359) or ($shift_length_test > 2400) )
			{
			echo "<br>SHIFT DEFINITION NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>Shift ID and name must be at least 2 characters in length\n";
			echo "<br>Shift Start Time must be 4 digits in length and be a valid time\n";
			echo "<br>Shift Length must be 5 characters in length and be 24 hours or less\n";
			}
		else
			{
			$p=0;
			$shift_weekdays_ct = count($shift_weekdays);
			while ($p <= $shift_weekdays_ct)
				{
				$SHIFT_weekdays .= "$shift_weekdays[$p]";
				$p++;
				}
			$stmt="INSERT INTO vicidial_shifts SET shift_id='$shift_id',shift_name='$shift_name',shift_start_time='$shift_start_time',shift_length='$shift_length',shift_weekdays='$SHIFT_weekdays';";
			$rslt=mysql_query($stmt, $link);
			if ($DB > 0) {echo "|$stmt|";}

			echo "<br><B>SHIFT ADDED: $shift_id</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SHIFTS', event_type='ADD', record_id='$shift_id', event_code='ADMIN ADD SHIFT', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=331111111;
	}


######################
# ADD=21111111111 adds new phone to the system
######################

if ($ADD==21111111111)
	{
	##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
	$stmt = "SELECT value FROM vicidial_override_ids where id_table='phones' and active='1';";
	$rslt=mysql_query($stmt, $link);
	$voi_ct = mysql_num_rows($rslt);
	if ($voi_ct > 0)
		{
		$row=mysql_fetch_row($rslt);
		$extension = ($row[0] + 1);

		$stmt="UPDATE vicidial_override_ids SET value='$extension' where id_table='phones' and active='1';";
		$rslt=mysql_query($stmt, $link);
		}
	##### END ID override optional section #####

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from phones where extension='$extension' and server_ip='$server_ip';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>PHONE NOT ADDED - there is already a Phone in the system with this extension/server\n";}
	else
		{
		$stmt="SELECT count(*) from phones where login='$login';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] > 0)
			{echo "<br>PHONE NOT ADDED - there is already a Phone in the system with this login\n";}
		else
			{
			$stmt="SELECT count(*) from phones_alias where alias_id='$login';";
			$rslt=mysql_query($stmt, $link);
			$row=mysql_fetch_row($rslt);
			if ($row[0] > 0)
				{echo "<br>PHONE NOT ADDED - there is already a Phone alias in the system with this login\n";}
			else
				{
				$stmt="SELECT count(*) from vicidial_voicemail where voicemail_id='$voicemail_id';";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);
				if ($row[0] > 0)
					{echo "<br>PHONE NOT ADDED - there is already a Voicemail ID in the system with this ID\n";}
				else
					{
					if ( (strlen($extension) < 1) or (strlen($server_ip) < 7) or (strlen($dialplan_number) < 1) or (strlen($login) < 1)  or (strlen($pass) < 1))
						{
						echo "<BR>PHONE NOT ADDED - Please go back and look at the data you entered\n";
						echo "<BR>The following fields must have data: extension, server_ip, dialplan_number, login, pass\n";
						}
					else
						{
						echo "<br>PHONE ADDED\n";

						$stmt="INSERT INTO phones (extension,dialplan_number,voicemail_id,phone_ip,computer_ip,server_ip,login,pass,status,active,phone_type,fullname,company,picture,protocol,local_gmt,outbound_cid) values('$extension','$dialplan_number','$voicemail_id','$phone_ip','$computer_ip','$server_ip','$login','$pass','$status','$active','$phone_type','$fullname','$company','$picture','$protocol','$local_gmt','$outbound_cid');";
						$rslt=mysql_query($stmt, $link);

						$stmtA="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y' and server_ip='$server_ip';";
						$rslt=mysql_query($stmtA, $link);

						### LOG INSERTION Admin Log Table ###
						$SQL_log = "$stmt|";
						$SQL_log = ereg_replace(';','',$SQL_log);
						$SQL_log = addslashes($SQL_log);
						$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='PHONES', event_type='ADD', record_id='$extension', event_code='ADMIN ADD PHONE', event_sql=\"$SQL_log\", event_notes='';";
						if ($DB) {echo "|$stmt|\n";}
						$rslt=mysql_query($stmt, $link);
						}
					}
				}
			}
		}
	$ADD=31111111111;
	}



######################
# ADD=71111111111 batch add new phone to the system
######################

if ($ADD==71111111111)
{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	if ( (strlen(trim($extension_from)) < 2)  or (strlen(trim($extension_to)) < 2) or (strlen(trim($server_ip)) < 7) )
	{
		echo "<BR>PHONE NOT ADDED - Please go back and look at the data you entered\n";
		echo "<BR>The following fields must have the valid data: Phone Extension From, Phone Extension To, ACS Server IP\n";
	}
	elseif(intval($extension_to) < intval($extension_from))
	{
		echo "<BR>PHONE NOT ADDED - Please go back and look at the data you entered\n";
		echo "<BR>The data you entered of 'Phone Extension To' must greater than 'Phone Extension From'\n";
	}
	else
	{
//		echo $extension_from.$extension_to."<br>";
		$count = abs(intval($extension_from)-intval($extension_to)) + 1;
		$add_phones = min($extension_from,$extension_to);
		$local_gmt	= "8.00";		//默认定为8.00;
		$status			= "ACTIVE";	//默认定为ACTIVE;
		$active			= "Y";			//默认定为Y;

		$phone_lists = array();
		for($i = 1; $i <= $count; $i++)
		{
			$add_phone			=  $add_phones;
			$phone_lists[$i]	= "'".$add_phone."'";
			$add_phones ++;
		}
		$new_phones = implode(",",$phone_lists);
//		print_r($phone_lists);
//		echo "<br>".$new_phones;
//		echo "<hr>";

//1、检测是否在表phones存在；
		$stmt="SELECT extension from phones where extension in (".$new_phones.") and server_ip='$server_ip';";
		//echo $stmt."<hr>";
		$rslt=mysql_query($stmt, $link);
		$total = mysql_num_rows($rslt);
		//$row=mysql_fetch_row($rslt);
		$arr_extension = array();
		if ($total > 0)
		{
			while($row	= mysql_fetch_row($rslt))
			{
				$exit_extension	= $row[0];
				$arr_extension[]	= $exit_extension;
			}
			sort($arr_extension);
			$exist_extension_list = implode("," , $arr_extension);
			$exist_extension_string = "<br>The Phone of '".$exist_extension_list."' is already a Phone in the system with this extension/server\n";
//			echo "<br>PHONE NOT ADDED - there is already a Phone in the system with this extension/server\n";
		}

//2、检测要添加的分机是否已被登录；
		$stmt="SELECT login from phones where login in (".$new_phones.");";
		$rslt=mysql_query($stmt, $link);
		$total = mysql_num_rows($rslt);
		//$row=mysql_fetch_row($rslt);
		$arr_login_phone = array();
		if ($total > 0)
		{
			while($row	= mysql_fetch_row($rslt))
			{
				$exit_login_phone				= $row[0];
				$arr_login_phone[] = $exit_login_phone;
			}
			sort($arr_login_phone);
			$exist_login_phone_list = implode("," , $arr_login_phone);
			$exist_login_phone_string = "<br>The Phone of '".$exist_login_phone_list."' is already a Phone in the system with this login\n";
//			echo "<br>PHONE NOT ADDED - there is already a Phone in the system with this login\n";
		}

//3、检测是否在表phones_alias存在；
		$stmt="SELECT alias_id from phones_alias where alias_id in (".$new_phones.");";
		$rslt=mysql_query($stmt, $link);
		$total = mysql_num_rows($rslt);
		//$row=mysql_fetch_row($rslt);
		$arr_alias_id = array();
		if ($total > 0)
		{
			while($row	= mysql_fetch_row($rslt))
			{
				$exit_alias_id				= $row[0];
				$arr_alias_id[] = $exit_alias_id;
			}
			sort($arr_alias_id);
			$exist_alias_id_list = implode("," , $arr_alias_id);
			$exist_alias_id_string = "<br>The Phone of '".$exist_alias_id_list."' is already a Phone alias in the system with this login\n";
//			echo "<br>PHONE NOT ADDED - there is already a Phone alias in the system with this login\n";
		}

//4、检测是否在表voicemail_id中存在；
		$stmt="SELECT voicemail_id from vicidial_voicemail where voicemail_id in (".$new_phones.");";
		$rslt=mysql_query($stmt, $link);
		$total = mysql_num_rows($rslt);
		$arr_voicemail_id = array();
		//$row=mysql_fetch_row($rslt);
		if ($total > 0)
		{
			while($row	= mysql_fetch_row($rslt))
			{
				$exit_voicemail_id				= $row[0];
				$arr_voicemail_id[] = $exit_voicemail_id;
			}
			sort($arr_voicemail_id);
			$exist_voicemail_id_list = implode("," , $arr_voicemail_id);
			$exist_voicemail_id_string = "<br>The Phone of '".$exist_voicemail_id_list."' is already a Voicemail ID in the system with this ID\n";
//			echo "<br>PHONE NOT ADDED - there is already a Voicemail ID in the system with this ID\n";
		}


		$i = 0;
//		echo "1\add_phone".$add_phone."<br>";
		for($add_phone = $extension_from; $add_phone <= $extension_to; $add_phone++)
		{
//			echo "2\add_phone".$add_phone."<br>";
//			print_r($arr_extension);echo "<br>";print_r($arr_login_phone);echo "<br>";
//			print_r($arr_alias_id);echo "<br>";print_r($arr_voicemail_id);	echo "<br>";
			if( in_array($add_phone,$arr_extension) or in_array($add_phone,$arr_login_phone) or in_array($add_phone,$arr_alias_id) or in_array($add_phone,$arr_voicemail_id) )
				continue;
//				echo "3\add_phone".$add_phone."<br>";
				$extension				= $add_phone;
				$dialplan_number	= $add_phone;
				$voicemail_id			= $add_phone ;
				$login						= $add_phone;
				$pass						=	$add_phone;
				$fullname					=	$add_phone;
				$outbound_cid		= $add_phone;
				$conf_secret				= $add_phone;
				
				$stmt="INSERT INTO phones (extension,dialplan_number,voicemail_id,phone_ip,computer_ip,server_ip,login,pass,status,active,phone_type,fullname,company,picture,local_gmt,login_user,login_pass,login_campaign,DBX_server,DBY_server,outbound_cid,email,conf_override,conf_secret) values('$extension','$dialplan_number','$voicemail_id','','','$server_ip','$login','$pass','$status','$active','','$fullname','','','$local_gmt','','','','','','$outbound_cid','','','$conf_secret');";
//				echo $stmt."<hr>";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='PHONES', event_type='ADD', record_id='$extension', event_code='ADMIN BATCH ADD PHONES', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);

			$i ++;
		}
		$stmtA="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y' and server_ip='$server_ip';";
		$rslt=mysql_query($stmtA, $link);

		
		echo "<br>PHONE ADDED SUCCEEDED : ".$i."\n";
		if($exist_extension_list != '')			echo $exist_extension_string;
		if($exist_login_phone_list != '')		echo $exist_login_phone_string;
		if($exist_alias_id_list != '')				echo $exist_alias_id_string;
		if($exist_voicemail_id_list != '')		echo $exist_voicemail_id_string;
		echo "</FONT>\n";
	}
	$ADD=17111111111;
}



######################
# ADD=17111111111 display the ADD A NEW BATCH OF PHONES SCREEN
######################

if ($ADD==17111111111)
	{
	if ($LOGast_admin_access==1)
		{
//		##### BEGIN ID override optional section, if enabled it increments user by 1 ignoring entered value #####
//		$stmt = "SELECT count(*) FROM vicidial_override_ids where id_table='phones' and active='1';";
//		$rslt=mysql_query($stmt, $link);
//		$voi_ct = mysql_num_rows($rslt);
//		if ($voi_ct > 0)
//			{
//			$row=mysql_fetch_row($rslt);
//			$voi_count = "$row[0]";
//			}
//		##### END ID override optional section #####

		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>ADD A NEW BATCH OF PHONES<form onSubmit=\"return contentFilter('Phone Extension From,extension_from,3&&&Phone Extension To,extension_to,3')\"  action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=71111111111>\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phone Extension From: </td><td align=left><input type=text name=extension_from size=15 maxlength=20 value=\"\">$NWB#phone-extension-from$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phone Extension To: </td><td align=left><input type=text name=extension_to size=15 maxlength=20>$NWB#phone-extension-to$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>ACS Server IP: </td><td align=left><select size=1 name=server_ip>\n";
		echo "$servers_list";
		echo "<option SELECTED>$row[5]</option>\n";
		echo "</select>$NWB#ACS-server-IP$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}



######################
# ADD=22111111111 adds new phone alias to the system
######################

if ($ADD==22111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from phones_alias where alias_id='$alias_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>PHONE ALIAS NOT ADDED - there is already a Phone Alias in the system with this ID\n";}
	else
		{
		$stmt="SELECT count(*) from phones where login='$alias_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] > 0)
			{echo "<br>PHONE ALIAS NOT ADDED - there is already a Phone Login in the system with this ID\n";}
		else
			{
			if ( (strlen($alias_id) < 1) or (strlen($alias_name) < 2) )
				{echo "<br>PHONE ALIAS NOT ADDED - Please go back and look at the data you entered\n";}
			else
				{
				echo "<br>PHONE ALIAS ADDED\n";

				$stmt="INSERT INTO phones_alias (alias_id,alias_name,logins_list) values('$alias_id','$alias_name','$logins_list');";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='PHONEALIASES', event_type='ADD', record_id='$alias_id', event_code='ADMIN ADD PHONE ALIAS', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	$ADD=32111111111;
	}


######################
# ADD=23111111111 adds new group alias to the system
######################

if ($ADD==23111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from groups_alias where group_alias_id='$group_alias_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>GROUP ALIAS NOT ADDED - there is already a Phone Alias in the system with this ID\n";}
	else
		{
		if (preg_match("/AGENT_PHONE|CUSTOMER|CAMPAIGN|NONE/",$group_alias_id))
			{echo "<br>GROUP ALIAS NOT ADDED - you cannot use reserved words in group aliases\n";}
		else
			{
			if ( (strlen($group_alias_id) < 1) or (strlen($group_alias_name) < 2) )
				{echo "<br>GROUP ALIAS NOT ADDED - Please go back and look at the data you entered\n";}
			else
				{
				echo "<br>GROUP ALIAS ADDED\n";

				$stmt="INSERT INTO groups_alias (group_alias_id,group_alias_name,caller_id_number,caller_id_name,active) values('$group_alias_id','$group_alias_name','$caller_id_number','$caller_id_name','$active');";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='GROUPALIASES', event_type='ADD', record_id='$group_alias_id', event_code='ADMIN ADD GROUP ALIAS', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	$ADD=33111111111;
	}


######################
# ADD=211111111111 adds new server to the system
######################

if ($ADD==211111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from servers where server_id='$server_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>SERVER NOT ADDED - there is already a server in the system with this ID\n";}
	else
		{
		if ( (strlen($server_id) < 1) or (strlen($server_ip) < 7) )
			{echo "<br>SERVER NOT ADDED - Please go back and look at the data you entered\n";}
		else
			{
			echo "<br>SERVER ADDED\n";

			$stmt="INSERT INTO servers (server_id,server_description,server_ip,active,asterisk_version) values('$server_id','$server_description','$server_ip','$active','$asterisk_version');";
			$rslt=mysql_query($stmt, $link);

			$stmtA="UPDATE servers SET rebuild_conf_files='Y',rebuild_music_on_hold='Y',sounds_update='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y' and server_ip='$server_ip';";
			$rslt=mysql_query($stmtA, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SERVERS', event_type='ADD', record_id='$server_id', event_code='ADMIN ADD SERVER', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=311111111111;
	}


######################
# ADD=221111111111 adds the new CCMS server trunk record to the system
######################

if ($ADD==221111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT max_vicidial_trunks from servers where server_ip='$server_ip';";
	$rslt=mysql_query($stmt, $link);
	$rowx=mysql_fetch_row($rslt);
	$MAXvicidial_trunks = $rowx[0];
	
	$stmt="SELECT sum(dedicated_trunks) from vicidial_server_trunks where server_ip='$server_ip' and campaign_id !='$campaign_id';";
	$rslt=mysql_query($stmt, $link);
	$rowx=mysql_fetch_row($rslt);
	$SUMvicidial_trunks = ($rowx[0] + $dedicated_trunks);
	
	if ($SUMvicidial_trunks > $MAXvicidial_trunks)
		{
		echo "<br>CCMS SERVER TRUNK RECORD NOT ADDED - the number of CCMS trunks is too high: $SUMvicidial_trunks / $MAXvicidial_trunks\n";
		}
	else
		{
		$stmt="SELECT count(*) from vicidial_server_trunks where campaign_id='$campaign_id' and server_ip='$server_ip';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] > 0)
			{echo "<br>CCMS SERVER TRUNK RECORD NOT ADDED - there is already a server-trunk record for this campaign\n";}
		else
			{
			if ( (strlen($campaign_id) < 2) or (strlen($server_ip) < 7) or (strlen($dedicated_trunks) < 1) or (strlen($trunk_restriction) < 1) )
				{
				echo "<br>CCMS SERVER TRUNK RECORD NOT ADDED - Please go back and look at the data you entered\n";
				echo "<br>campaign must be between 3 and 8 characters in length\n";
				echo "<br>server_ip delay must be at least 7 characters\n";
				echo "<br>trunks must be a digit from 0 to 9999\n";
				}
			else
				{
				echo "<br><B>CCMS SERVER TRUNK RECORD ADDED: $campaign_id - $server_ip - $dedicated_trunks - $trunk_restriction</B>\n";

				$stmt="INSERT INTO vicidial_server_trunks(server_ip,campaign_id,dedicated_trunks,trunk_restriction) values('$server_ip','$campaign_id','$dedicated_trunks','$trunk_restriction');";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SERVERS_TRUNK', event_type='ADD', record_id='$server_ip', event_code='ADMIN ADD SERVER TRUNK', event_sql=\"$SQL_log\", event_notes='campaign: $campaign_id';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	$ADD=311111111111;
	}


######################
# ADD=231111111111 adds new conf template to the system
######################

if ($ADD==231111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_conf_templates where template_id='$template_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>CONF TEMPLATE NOT ADDED - there is already a template in the system with this ID\n";}
	else
		{
		if (strlen($template_id) < 2)
			{echo "<br>CONF TEMPLATE NOT ADDED - Please go back and look at the data you entered\n";}
		else
			{
			echo "<br>CONF TEMPLATE ADDED\n";

			$stmt="INSERT INTO vicidial_conf_templates (template_id,template_name,template_contents) values('$template_id','$template_name','$template_contents');";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CONFTEMPLATES', event_type='ADD', record_id='$template_id', event_code='ADMIN ADD CONF TEMPLATE', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=331111111111;
	}


######################
# ADD=241111111111 adds new server carrier to the system
######################

if ($ADD==241111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_server_carriers where carrier_id='$carrier_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>CARRIER NOT ADDED - there is already a carrier in the system with this ID\n";}
	else
		{
		if ( (strlen($carrier_id) < 2) or (strlen($server_ip) < 7) )
			{echo "<br>CARRIER NOT ADDED - Please go back and look at the data you entered\n";}
		else
			{
			echo "<br>CARRIER ADDED\n";

			$stmt="INSERT INTO vicidial_server_carriers (carrier_id,carrier_name,registration_string,template_id,account_entry,protocol,globals_string,dialplan_entry,server_ip,active,carrier_description) values('$carrier_id','$carrier_name','$registration_string','$template_id','$account_entry','$protocol','$globals_string','$dialplan_entry','$server_ip','N','$carrier_description');";
			$rslt=mysql_query($stmt, $link);

			$stmtA="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y' and server_ip='$server_ip';";
			$rslt=mysql_query($stmtA, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CARRIERS', event_type='ADD', record_id='$carrier_id', event_code='ADMIN ADD CARRIER', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=341111111111;
	}


######################
# ADD=251111111111 adds new tts entry to the system
######################

if ($ADD==251111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_tts_prompts where tts_id='$tts_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>TTS ENTRY NOT ADDED - there is already a tts entry in the system with this ID\n";}
	else
		{
		if ( (strlen($tts_id) < 2) or (strlen($tts_name) < 3) )
			{echo "<br>TTS ENTRY NOT ADDED - Please go back and look at the data you entered\n";}
		else
			{
			echo "<br>TTS ENTRY ADDED\n";

			$stmt="INSERT INTO vicidial_tts_prompts SET tts_id='$tts_id',tts_name='$tts_name',active='$active';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='TTS', event_type='ADD', record_id='$tts_id', event_code='ADMIN ADD TTS', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=351111111111;
	}


######################
# ADD=261111111111 adds new music on hold entry to the system
######################

if ($ADD==261111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_music_on_hold where moh_id='$moh_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>MUSIC ON HOLD ENTRY NOT ADDED - there is already a moh entry in the system with this ID\n";}
	else
		{
		if ( (strlen($moh_id) < 2) or (strlen($moh_name) < 3) or ($moh_id=='sounds') or ($moh_id=='agi-bin') or ($moh_id=='astdb') or ($moh_id=='keys') )
			{echo "<br>MUSIC ON HOLD ENTRY NOT ADDED - Please go back and look at the data you entered\n";}
		else
			{
			echo "<br>MUSIC ON HOLD ENTRY ADDED\n";

			$stmt="INSERT INTO vicidial_music_on_hold SET moh_id='$moh_id',moh_name='$moh_name',random='$random';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='MOH', event_type='ADD', record_id='$moh_id', event_code='ADMIN ADD MOH', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=361111111111;
	}


######################
# ADD=271111111111 adds new voicemail box to the system
######################

if ($ADD==271111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_voicemail where voicemail_id='$voicemail_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>VOICEMAIL BOX NOT ADDED - there is already a voicemail box in the system with this ID\n";}
	else
		{
		$stmt="SELECT count(*) from phones where voicemail_id='$voicemail_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] > 0)
			{echo "<br>VOICEMAIL BOX NOT ADDED - there is already a phone in the system with this voicemail ID\n";}
		else
			{
			if ( (strlen($voicemail_id) < 2) or (strlen($pass) < 2) or (strlen($fullname) < 3) )
				{echo "<br>VOICEMAIL BOX NOT ADDED - Please go back and look at the data you entered\n";}
			else
				{
				echo "<br>VOICEMAIL BOX ADDED\n";

				$stmt="INSERT INTO vicidial_voicemail SET voicemail_id='$voicemail_id',pass='$pass',email='$email',fullname='$fullname',active='$active';";
				$rslt=mysql_query($stmt, $link);

				$stmt="SELECT active_voicemail_server from system_settings;";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);
				$active_voicemail_server = $row[0];

				$stmtA="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y' and server_ip='$active_voicemail_server';";
				$rslt=mysql_query($stmtA, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='VOICEMAIL', event_type='ADD', record_id='$voicemail_id', event_code='ADMIN ADD VOICEMAIL', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	$ADD=371111111111;
	}


######################
# ADD=2111111111111 adds new conference to the system
######################

if ($ADD==2111111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from conferences where conf_exten='$conf_exten' and server_ip='$server_ip';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>CONFERENCE NOT ADDED - there is already a conference in the system with this ID and server\n";}
	else
		{
		if ( (strlen($conf_exten) < 1) or (strlen($server_ip) < 7) )
			{echo "<br>CONFERENCE NOT ADDED - Please go back and look at the data you entered\n";}
		else
			{
			echo "<br>CONFERENCE ADDED\n";

			$stmt="INSERT INTO conferences (conf_exten,server_ip) values('$conf_exten','$server_ip');";
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=3111111111111;
	}


######################
# ADD=21111111111111 adds new CCMS conference to the system
######################

if ($ADD==21111111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_conferences where conf_exten='$conf_exten' and server_ip='$server_ip';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>CCMS CONFERENCE NOT ADDED - there is already a CCMS conference in the system with this ID and server\n";}
	else
		{
		if ( (strlen($conf_exten) < 1) or (strlen($server_ip) < 7) )
			{echo "<br>CCMS CONFERENCE NOT ADDED - Please go back and look at the data you entered\n";}
		else
			{
			echo "<br>CCMS CONFERENCE ADDED\n";

			$stmt="INSERT INTO vicidial_conferences (conf_exten,server_ip) values('$conf_exten','$server_ip');";
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=31111111111111;
	}


######################
# ADD=221111111111111 adds the new system status to the system
######################

if ($ADD==221111111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*), campaign_id from vicidial_campaign_statuses where status='$status_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{
//		echo "<br>SYSTEM STATUS NOT ADDED - there is already a campaign-status in the system with this name: $row[0]\n";
		echo "<br><B>SYSTEM STATUS NOT ADDED - Status : $status_id has been used by $row[1] !</B>\n";		
		}
	else
		{
		$stmt="SELECT count(*) from vicidial_statuses where status='$status_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] > 0)
			{
//			echo "<br>SYSTEM STATUS NOT ADDED - there is already a global-status in the system with this name\n";
			echo "<br><B>SYSTEM STATUS NOT ADDED - Status : $status_id has been used by System !</B>\n";
			}
		else
			{
			if ( (strlen($status_id) < 1) or (strlen($status_name) < 2) )
				{
				echo "<br>SYSTEM STATUS NOT ADDED - Please go back and look at the data you entered\n";
				echo "<br>status must be between 1 and 8 characters in length\n";
				echo "<br>status name must be between 2 and 30 characters in length\n";
				}
			else
				{
				echo "<br><B>SYSTEM STATUS ADDED: $status_name - $status_id</B>\n";

				$stmt="INSERT INTO vicidial_statuses (status,status_name,selectable,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable,class,status_type) values('$status_id','$status_name','$selectable','$human_answered','$category','$sale','$dnc','$customer_contact','$not_interested','$unworkable','$status_class','$status_type');";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SYSTEMSTATUSES', event_type='ADD', record_id='$status_id', event_code='ADMIN ADD SYSTEM STATUS', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	$ADD=321111111111111;
	}


######################
# ADD=231111111111111 adds the new status category to the system
######################

if ($ADD==231111111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_status_categories where vsc_id='$vsc_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>STATUS CATEGORY NOT ADDED - there is already a status category in the system with this ID: $row[0]\n";}
	else
		{
		if ( (strlen($vsc_id) < 2) or (strlen($vsc_id) > 20) or (strlen($vsc_name) < 2) )
			{
			echo "<br>STATUS CATEGORY NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>ID must be between 2 and 20 characters in length\n";
			echo "<br>name name must be between 2 and 50 characters in length\n";
			}
		else
			{
			echo "<br><B>STATUS CATEGORY ADDED: $vsc_id - $vsc_name</B>\n";

			$stmt="SELECT count(*) from vicidial_status_categories where tovdad_display='Y' and vsc_id NOT IN('$vsc_id');";
			$rslt=mysql_query($stmt, $link);
			$row=mysql_fetch_row($rslt);
			if ( ($row[0] > 3) and (ereg('Y',$tovdad_display)) )
				{
				$tovdad_display = 'N';
				echo "<br><B>ERROR: There are already 4 Status Categories set to TimeOnVDAD Display</B>\n";
				}

			$stmt="INSERT INTO vicidial_status_categories (vsc_id,vsc_name,vsc_description,tovdad_display,sale_category,dead_lead_category) values('$vsc_id','$vsc_name','$vsc_description','$tovdad_display','$sale_category','$dead_lead_category');";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='STATUSCATEGORIES', event_type='ADD', record_id='$vsc_id', event_code='ADMIN ADD STATUS CATEGORY', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=331111111111111;
	}

######################
# ADD=231111111111111222 adds the new status category to the system
######################

if ($ADD==231111111111111222)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_status_type where type='$vsc_id';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>System Call Result Type NOT ADDED - there is already a System Call Result Type in the system with this  ID: $row[0]\n";}
	else
		{
		if ( (strlen($vsc_id) < 1) or (strlen($vsc_id) > 2) or (strlen($vsc_name) < 2) )
			{
			echo "<br>System Call Result Type NOT ADDED - Please go back and look at the data you entered\n";
			}
		else
			{
			echo "<br><B>System Call Result Type ADDED: $type - $typedescription</B>\n";

			$stmt="INSERT INTO vicidial_status_type (type,typedescription,active,isdel) values('$vsc_id','$vsc_name','$tovdad_display','N');";
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=331111111111111222;
	}

######################
# ADD=241111111111111 adds the new qc status code to the system
######################

if ($ADD==241111111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	$stmt="SELECT count(*) from vicidial_qc_codes where code='$code';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	if ($row[0] > 0)
		{echo "<br>QC STATUS CODE NOT ADDED - there is already a qc status code in the system with this name: $row[0]\n";}
	else
		{
		if ( (strlen($code) < 1) or (strlen($code_name) < 2) )
			{
			echo "<br>QC STATUS CODE NOT ADDED - Please go back and look at the data you entered\n";
			echo "<br>code must be between 1 and 8 characters in length\n";
			echo "<br>code name must be between 2 and 30 characters in length\n";
			}
		else
			{
			echo "<br><B>QC STATUS CODE ADDED: $code_name - $code</B>\n";

			$stmt="INSERT INTO vicidial_qc_codes (code,code_name) values('$code','$code_name');";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='QCSTATUSES', event_type='ADD', record_id='$code', event_code='ADMIN ADD QC STATUS', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	$ADD=341111111111111;
	}



######################################################################################################
######################################################################################################
#######   4 series, record modifications submitted and DB is modified, then on to 3 series forms below
######################################################################################################
######################################################################################################



######################
# ADD=4A submit user modifications to the system - ADMIN
######################

if ($ADD=="4A")
	{
	if (isset($_GET["al_campaign"]))						{$al_campaign=$_GET["al_campaign"];}
	elseif (isset($_POST["al_campaign"]))				{$al_campaign=$_POST["al_campaign"];}
	if (isset($_GET["all_campaigns_hidden"]))						{$all_campaigns_hidden=$_GET["all_campaigns_hidden"];}
	elseif (isset($_POST["all_campaigns_hidden"]))				{$all_campaigns_hidden=$_POST["all_campaigns_hidden"];}
	foreach($al_campaign as $temp){
		$all_campaigns_hidden = str_ireplace($temp . ',',"",$all_campaigns_hidden);
	}
	//echo '---' . $all_campaigns_hidden;
	if ($LOGmodify_users==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($pass) < 2) or (strlen($full_name) < 2) or (strlen($user_level) < 1) )
			{
			echo "<br>USER NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>Password and Full Name each need ot be at least 2 characters in length\n";
			}
		else
			{
			if ($SSoutbound_autodial_active < 1)
				{
				$closer_default_blended =	'0';
				$delete_filters =			'0';
				$load_leads =				'0';
				}
			echo "<br><B>USER MODIFIED - ADMIN: $user</B>\n";
			$add_remoteagentgroups = $_REQUEST[add_remoteagentgroups];
			$modify_remoteagentgroups = $_REQUEST[modify_remoteagentgroups];
			$delete_remoteagentgroups = $_REQUEST[delete_remoteagentgroups];
			$modify_distribute_lead = $_REQUEST[modify_distribute_lead];
			$modify_call_lead = $_REQUEST[modify_call_lead];
			$modify_rollback_lead = $_REQUEST[modify_rollback_lead];
			$modify_archive_lead = $_REQUEST[modify_archive_lead];
			$modify_abandon_lead = $_REQUEST[modify_abandon_lead];
			$modify_recover_lead = $_REQUEST[modify_recover_lead];
			
			$stmt="UPDATE vicidial_users set pass='$pass',full_name='$full_name',user_level='$user_level',user_group='$user_group',phone_login='$phone_login',phone_pass='$phone_pass',delete_users='$delete_users',delete_user_groups='$delete_user_groups',delete_lists='$delete_lists',delete_campaigns='$delete_campaigns',delete_ingroups='$delete_ingroups',delete_remote_agents='$delete_remote_agents',load_leads='$load_leads',campaign_detail='$campaign_detail',ast_admin_access='$ast_admin_access',ast_delete_phones='$ast_delete_phones',delete_scripts='$delete_scripts',modify_leads='$modify_leads',hotkeys_active='$hotkeys_active',change_agent_campaign='$change_agent_campaign',agent_choose_ingroups='$agent_choose_ingroups',closer_campaigns='$groups_value',scheduled_callbacks='$scheduled_callbacks',agentonly_callbacks='$agentonly_callbacks',agentcall_manual='$agentcall_manual',vicidial_recording='1',vicidial_transfers='$vicidial_transfers',delete_filters='$delete_filters',alter_agent_interface_options='$alter_agent_interface_options',closer_default_blended='$closer_default_blended',delete_call_times='$delete_call_times',modify_call_times='$modify_call_times',modify_users='$modify_users',modify_campaigns='$modify_campaigns',modify_lists='$modify_lists',modify_scripts='$modify_scripts',modify_filters='$modify_filters',modify_ingroups='$modify_ingroups',modify_usergroups='$modify_usergroups',modify_remoteagents='$modify_remoteagents',modify_servers='$modify_servers',view_reports='$view_reports',vicidial_recording_override='DISABLED',alter_custdata_override='$alter_custdata_override',qc_enabled='$qc_enabled',qc_user_level='$qc_user_level',qc_pass='$qc_pass',qc_finish='$qc_finish',qc_commit='$qc_commit',add_timeclock_log='$add_timeclock_log',modify_timeclock_log='$modify_timeclock_log',delete_timeclock_log='$delete_timeclock_log',alter_custphone_override='$alter_custphone_override',vdc_agent_api_access='$vdc_agent_api_access',modify_inbound_dids='$modify_inbound_dids',delete_inbound_dids='$delete_inbound_dids',active='$active',download_lists='$download_lists',agent_shift_enforcement_override='$agent_shift_enforcement_override',manager_shift_enforcement_override='$manager_shift_enforcement_override',export_reports='$export_reports',delete_from_dnc='$delete_from_dnc',email='$email',user_code='$user_code',territory='$territory',allow_alerts='$allow_alerts',agent_choose_territories='$agent_choose_territories',custom_one='$custom_one',custom_two='$custom_two',custom_three='$custom_three',custom_four='$custom_four',custom_five='$custom_five',add_new_users='$add_new_users',add_new_campaigns='$add_new_campaigns',add_new_lists='$add_new_lists',add_new_usergroups='$add_new_usergroups',add_from_dnc='$add_from_dnc',view_historical_reports='$view_historical_reports',live_monitor='$live_monitor',search_historical_call='$search_historical_call',search_voice_mail='$search_voice_mail',disabled_campaigns='$all_campaigns_hidden',view_agent_status='$view_agent_status',grab_calls_in_queue='$grab_calls_in_queue',add_remoteagentgroups='$add_remoteagentgroups',modify_remoteagentgroups='$modify_remoteagentgroups',delete_remoteagentgroups='$delete_remoteagentgroups',modify_distribute_lead='$modify_distribute_lead',modify_call_lead='$modify_call_lead',modify_rollback_lead='$modify_rollback_lead',modify_archive_lead='$modify_archive_lead',modify_abandon_lead='$modify_abandon_lead',modify_recover_lead='$modify_recover_lead' where user='$user';";
			
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|$stmt_grp_values|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='USERS', event_type='MODIFY', record_id='$user', event_code='ADMIN MODIFY USER', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			###############################################################
			##### START SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			$stmt = "SELECT enable_vtiger_integration,vtiger_server_ip,vtiger_dbname,vtiger_login,vtiger_pass,vtiger_url FROM vicidial_campaigns where campaign_id='$campaign_id';";
//			echo $stmt."<br>";
			$rslt=mysql_query($stmt, $link);
			if ($DB) {echo "$stmt\n";}
			$ss_conf_ct = mysql_num_rows($rslt);
			if ($ss_conf_ct > 0)
				{
				$row=mysql_fetch_row($rslt);
				$enable_vtiger_integration =	$row[0];
				$vtiger_server_ip	=			$row[1];
				$vtiger_dbname =				$row[2];
				$vtiger_login =					$row[3];
				$vtiger_pass =					$row[4];
				$vtiger_url =					$row[5];
				}
			##### END SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			#############################################################

			if ($enable_vtiger_integration > 0)
				{
				### connect to your vtiger database
				$linkV=mysql_connect("$vtiger_server_ip", "$vtiger_login","$vtiger_pass");
				if (!$linkV) {die("Could not connect: $vtiger_server_ip|$vtiger_dbname|$vtiger_login|$vtiger_pass" . mysql_error());}
				echo 'Connected successfully';
				mysql_select_db("$vtiger_dbname", $linkV);

				$user_name =		$user;
				$user_password =	$pass;
				$last_name =		$full_name;
				$is_admin =			'off';
				$roleid =			'H5';
				$status =			'Active';
				$groupid =			'1';
					if ($user_level >= 7) {$roleid = 'H3';}
					if ($user_level >= 8) {$roleid = 'H4';}
					if ($user_level >= 9) {$roleid = 'H2';}
					if ($user_level >= 9) {$is_admin = 'on';}
				$salt = substr($user_name, 0, 2);
				$salt = '$1$' . $salt . '$';
				$encrypted_password = crypt($user_password, $salt);

				######################################
				##### BEGIN Add/Update group info in Vtiger
				$stmt="SELECT count(*) from vtiger_groups where groupname='$user_group';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$group_found_count = $row[0];

				### group exists in vtiger, update it
				if ($group_found_count > 0)
					{
					$stmt="SELECT groupid from vtiger_groups where groupname='$user_group';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$groupid = $row[0];
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW GROUP RECORD IN VTIGER
					# Get next available id from vtiger_users_seq to use as groupid
					$stmt="SELECT id from vtiger_users_seq;";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					$row=mysql_fetch_row($rslt);
					$groupid = ($row[0] + 1);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					# Increase next available groupid with 1 so next record gets proper id
					$stmt="UPDATE vtiger_users_seq SET id = '$groupid';";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtA = "INSERT INTO vtiger_groups SET groupid='$groupid',groupname='$user_group',description='';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW GROUP RECORD IN VTIGER
					}
				##### END Add/Update group info in Vtiger
				######################################

				######################################
				##### BEGIN Add/Update user info in Vtiger
				$stmt="SELECT count(*) from vtiger_users where user_name='$user_name';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$found_count = $row[0];

				### user exists in vtiger, update it
				if ($found_count > 0)
					{
					$stmt="SELECT id from vtiger_users where user_name='$user_name';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$userid = $row[0];

					$stmt="SELECT count(*) from vtiger_users2group WHERE userid='$userid' and groupid='$groupid';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$usergroupcount = $row[0];
					mysql_query("set names utf8");
					$stmtA = "UPDATE vtiger_users SET user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status' where id='$userid';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtB = "UPDATE vtiger_user2role SET roleid='$roleid' where userid='$userid';";
					if ($DB) {echo "|$stmtB|\n";}
					$rslt=mysql_query($stmtB, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					if ($usergroupcount < 1)
						{
						$stmt="SELECT user_group FROM vicidial_user_groups;";
						$rslt=mysql_query($stmt, $link);
						if ($DB) {echo "$stmt\n";}
						$VD_groups_ct = mysql_num_rows($rslt);
						$k=0;
						$VD_groups_list='';
						while ($k < $VD_groups_ct)
							{
							$row=mysql_fetch_row($rslt);
							$VD_groups_list .= "'$row[0]',";
							$k++;
							}
						$VD_groups_list = preg_replace("/.$/",'',$VD_groups_list);

						$stmtC = "DELETE FROM vtiger_users2group WHERE userid='$userid' and groupid IN(SELECT groupid from vtiger_groups where groupname IN($VD_groups_list));";
						if ($DB) {echo "|$stmtC|\n";}
						$rslt=mysql_query($stmtC, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						$stmtD = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
						if ($DB) {echo "|$stmtD|\n";}
						$rslt=mysql_query($stmtD, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}
						}
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW USER RECORD IN VTIGER
					$stmtA = "INSERT INTO vtiger_users SET user_name='$user_name',user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status',date_format='yyyy-mm-dd',first_name='',reports_to_id='',description='',title='',department='',phone_home='',phone_mobile='',phone_work='',phone_other='',phone_fax='',email1='',email2='',yahoo_id='',signature='',address_street='',address_city='',address_state='',address_country='',address_postalcode='',user_preferences='',imagename='';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$userid = mysql_insert_id($linkV);
				
					$stmtB = "INSERT INTO vtiger_user2role SET userid='$userid',roleid='$roleid';";
					if ($DB) {echo "|$stmtB|\n";}
					$rslt=mysql_query($stmtB, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtC = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
					if ($DB) {echo "|$stmtC|\n";}
					$rslt=mysql_query($stmtC, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtD = "UPDATE vtiger_users_seq SET id='$userid';";
					if ($DB) {echo "|$stmtD|\n";}
					$rslt=mysql_query($stmtD, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW USER RECORD IN VTIGER
					}
				##### END Add/Update user info in Vtiger
				######################################
				}
			### END vtiger integration

			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=3;		# go to user modification below;
###### start Synchronize users with CRM 2011-09-20 add by pie;
	$stmt="SELECT ccms_url from system_settings;";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	$ccms_url_link = $row[0];
//	echo $ccms_url_link."<br>";
//	echo $user."<br>";
	$url_link = $ccms_url_link."integrate_vtiger_user.php?user=".$user;
//	echo $url_link."<br>";
	file("$url_link");
//	$last_line=file("$url_link");
//	echo $last_line[0]."<br>";
###### end Synchronize users with CRM 2011-09-20 add by pie;
	}


######################
# ADD=4B submit user modifications to the system - ADMIN
######################

if ($ADD=="4B")
	{
	if ($LOGmodify_users==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($pass) < 2) or (strlen($full_name) < 2) or (strlen($user_level) < 1) )
			{
			echo "<br>USER NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>Password and Full Name each need ot be at least 2 characters in length\n";
			}
		else
			{
			if ($SSoutbound_autodial_active < 1)
				{
				$closer_default_blended =	'0';
				$delete_filters =			'0';
				$load_leads =				'0';
				}
			echo "<br><B>USER MODIFIED - ADMIN: $user</B>\n";

			$stmt="UPDATE vicidial_users set pass='$pass',full_name='$full_name',user_level='$user_level',user_group='$user_group',phone_login='$phone_login',phone_pass='$phone_pass',hotkeys_active='$hotkeys_active',agent_choose_ingroups='$agent_choose_ingroups',closer_campaigns='$groups_value',scheduled_callbacks='$scheduled_callbacks',agentonly_callbacks='$agentonly_callbacks',agentcall_manual='$agentcall_manual',vicidial_recording='$vicidial_recording',vicidial_transfers='$vicidial_transfers',closer_default_blended='$closer_default_blended',vicidial_recording_override='$vicidial_recording_override',alter_custdata_override='$alter_custdata_override',qc_enabled='$qc_enabled',qc_user_level='$qc_user_level',qc_pass='$qc_pass',qc_finish='$qc_finish',qc_commit='$qc_commit',alter_custphone_override='$alter_custphone_override',active='$active',agent_shift_enforcement_override='$agent_shift_enforcement_override',email='$email',user_code='$user_code',territory='$territory',allow_alerts='$allow_alerts',agent_choose_territories='$agent_choose_territories',custom_one='$custom_one',custom_two='$custom_two',custom_three='$custom_three',custom_four='$custom_four',custom_five='$custom_five' where user='$user';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='USERS', event_type='MODIFY', record_id='$user', event_code='ADMIN MODIFY USER', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			###############################################################
			##### START SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			$stmt = "SELECT enable_vtiger_integration,vtiger_server_ip,vtiger_dbname,vtiger_login,vtiger_pass,vtiger_url FROM vicidial_campaigns where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			if ($DB) {echo "$stmt\n";}
			$ss_conf_ct = mysql_num_rows($rslt);
			if ($ss_conf_ct > 0)
				{
				$row=mysql_fetch_row($rslt);
				$enable_vtiger_integration =	$row[0];
				$vtiger_server_ip	=			$row[1];
				$vtiger_dbname =				$row[2];
				$vtiger_login =					$row[3];
				$vtiger_pass =					$row[4];
				$vtiger_url =					$row[5];
				}
			##### END SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			#############################################################

			if ($enable_vtiger_integration > 0)
				{
				### connect to your vtiger database
				$linkV=mysql_connect("$vtiger_server_ip", "$vtiger_login","$vtiger_pass");
				if (!$linkV) {die("Could not connect: $vtiger_server_ip|$vtiger_dbname|$vtiger_login|$vtiger_pass" . mysql_error());}
				echo 'Connected successfully';
				mysql_select_db("$vtiger_dbname", $linkV);

				$user_name =		$user;
				$user_password =	$pass;
				$last_name =		$full_name;
				$is_admin =			'off';
				$roleid =			'H5';
				$status =			'Active';
				$groupid =			'1';
					if ($user_level >= 7) {$roleid = 'H3';}
					if ($user_level >= 8) {$roleid = 'H4';}
					if ($user_level >= 9) {$roleid = 'H2';}
					if ($user_level >= 9) {$is_admin = 'on';}
				$salt = substr($user_name, 0, 2);
				$salt = '$1$' . $salt . '$';
				$encrypted_password = crypt($user_password, $salt);

				######################################
				##### BEGIN Add/Update group info in Vtiger
				$stmt="SELECT count(*) from vtiger_groups where groupname='$user_group';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$group_found_count = $row[0];

				### group exists in vtiger, update it
				if ($group_found_count > 0)
					{
					$stmt="SELECT groupid from vtiger_groups where groupname='$user_group';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$groupid = $row[0];
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW GROUP RECORD IN VTIGER
					# Get next available id from vtiger_users_seq to use as groupid
					$stmt="SELECT id from vtiger_users_seq;";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					$row=mysql_fetch_row($rslt);
					$groupid = ($row[0] + 1);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					# Increase next available groupid with 1 so next record gets proper id
					$stmt="UPDATE vtiger_users_seq SET id = '$groupid';";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtA = "INSERT INTO vtiger_groups SET groupid='$groupid',groupname='$user_group',description='';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW GROUP RECORD IN VTIGER
					}
				##### END Add/Update group info in Vtiger
				######################################

				######################################
				##### BEGIN Add/Update user info in Vtiger
				$stmt="SELECT count(*) from vtiger_users where user_name='$user_name';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$found_count = $row[0];

				### user exists in vtiger, update it
				if ($found_count > 0)
					{
					$stmt="SELECT id from vtiger_users where user_name='$user_name';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$userid = $row[0];

					$stmt="SELECT count(*) from vtiger_users2group WHERE userid='$userid' and groupid='$groupid';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$usergroupcount = $row[0];
					mysql_query("set names utf8");
					$stmtA = "UPDATE vtiger_users SET user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status' where id='$userid';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtB = "UPDATE vtiger_user2role SET roleid='$roleid' where userid='$userid';";
					if ($DB) {echo "|$stmtB|\n";}
					$rslt=mysql_query($stmtB, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					if ($usergroupcount < 1)
						{
						$stmt="SELECT user_group FROM vicidial_user_groups;";
						$rslt=mysql_query($stmt, $link);
						if ($DB) {echo "$stmt\n";}
						$VD_groups_ct = mysql_num_rows($rslt);
						$k=0;
						$VD_groups_list='';
						while ($k < $VD_groups_ct)
							{
							$row=mysql_fetch_row($rslt);
							$VD_groups_list .= "'$row[0]',";
							$k++;
							}
						$VD_groups_list = preg_replace("/.$/",'',$VD_groups_list);

						$stmtC = "DELETE FROM vtiger_users2group WHERE userid='$userid' and groupid IN(SELECT groupid from vtiger_groups where groupname IN($VD_groups_list));";
						if ($DB) {echo "|$stmtC|\n";}
						$rslt=mysql_query($stmtC, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						$stmtD = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
						if ($DB) {echo "|$stmtD|\n";}
						$rslt=mysql_query($stmtD, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}
						}
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW USER RECORD IN VTIGER
					$stmtA = "INSERT INTO vtiger_users SET user_name='$user_name',user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status',date_format='yyyy-mm-dd',first_name='',reports_to_id='',description='',title='',department='',phone_home='',phone_mobile='',phone_work='',phone_other='',phone_fax='',email1='',email2='',yahoo_id='',signature='',address_street='',address_city='',address_state='',address_country='',address_postalcode='',user_preferences='',imagename='';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$userid = mysql_insert_id($linkV);
				
					$stmtB = "INSERT INTO vtiger_user2role SET userid='$userid',roleid='$roleid';";
					if ($DB) {echo "|$stmtB|\n";}
					$rslt=mysql_query($stmtB, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtC = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
					if ($DB) {echo "|$stmtC|\n";}
					$rslt=mysql_query($stmtC, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtD = "UPDATE vtiger_users_seq SET id='$userid';";
					if ($DB) {echo "|$stmtD|\n";}
					$rslt=mysql_query($stmtD, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW USER RECORD IN VTIGER
					}
				##### END Add/Update user info in Vtiger
				######################################
				}
			### END vtiger integration

			}
		}
		else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=3;		# go to user modification below
	}


######################
# ADD=4 submit user modifications to the system
######################

if ($ADD==4)
	{
	
	if ($LOGmodify_users==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($pass) < 2) or (strlen($full_name) < 2) or (strlen($user_level) < 1) )
			{
			echo "<br>USER NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>Password and Full Name each need ot be at least 2 characters in length\n";
			}
		else
			{
			echo "<br><B>USER MODIFIED: $user</B>\n";
			
			$stmt="UPDATE vicidial_users set pass='$pass',full_name='$full_name',user_level='$user_level',user_group='$user_group',phone_login='$phone_login',phone_pass='$phone_pass',active='$active',email='$email',user_code='$user_code',territory='$territory',delete_users='$delete_users',delete_user_groups='$delete_user_groups',delete_lists='$delete_lists',delete_campaigns='$delete_campaigns',delete_ingroups='$delete_ingroups',delete_remote_agents='$delete_remote_agents',load_leads='$load_leads',campaign_detail='$campaign_detail',ast_admin_access='$ast_admin_access',ast_delete_phones='$ast_delete_phones',delete_scripts='$delete_scripts',modify_leads='$modify_leads',change_agent_campaign='$change_agent_campaign',delete_filters='$delete_filters',alter_agent_interface_options='$alter_agent_interface_options',delete_call_times='$delete_call_times',modify_call_times='$modify_call_times',modify_users='$modify_users',modify_campaigns='$modify_campaigns',modify_lists='$modify_lists',modify_scripts='$modify_scripts',modify_ingroups='$modify_ingroups',modify_usergroups='$modify_usergroups',modify_remoteagents='$modify_remoteagents',modify_servers='$modify_servers',view_reports='$view_reports',add_timeclock_log='$add_timeclock_log',modify_timeclock_log='$modify_timeclock_log',delete_timeclock_log='$delete_timeclock_log',vdc_agent_api_access='$vdc_agent_api_access',modify_inbound_dids='$modify_inbound_dids',delete_inbound_dids='$delete_inbound_dids',download_lists='$download_lists',manager_shift_enforcement_override='$manager_shift_enforcement_override',export_reports='$export_reports',delete_from_dnc='$delete_from_dnc',add_new_users='$add_new_users',add_new_campaigns='$add_new_campaigns',add_new_lists='$add_new_lists',add_new_usergroups='$add_new_usergroups',add_from_dnc='$add_from_dnc',view_historical_reports='$view_historical_reports',live_monitor='$live_monitor',search_historical_call='$search_historical_call',search_voice_mail='$search_voice_mail' where user='$user';";

			$rslt=mysql_query($stmt, $link);
			
			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='USERS', event_type='MODIFY', record_id='$user', event_code='ADMIN MODIFY USER', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			###############################################################
			##### START SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			$stmt = "SELECT enable_vtiger_integration,vtiger_server_ip,vtiger_dbname,vtiger_login,vtiger_pass,vtiger_url FROM vicidial_campaigns where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			if ($DB) {echo "$stmt\n";}
			$ss_conf_ct = mysql_num_rows($rslt);
			if ($ss_conf_ct > 0)
				{
				$row=mysql_fetch_row($rslt);
				$enable_vtiger_integration =	$row[0];
				$vtiger_server_ip	=			$row[1];
				$vtiger_dbname =				$row[2];
				$vtiger_login =					$row[3];
				$vtiger_pass =					$row[4];
				$vtiger_url =					$row[5];
				}
			##### END SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			#############################################################

			if ($enable_vtiger_integration > 0)
				{
				### connect to your vtiger database
				$linkV=mysql_connect("$vtiger_server_ip", "$vtiger_login","$vtiger_pass");
				if (!$linkV) {die("Could not connect: $vtiger_server_ip|$vtiger_dbname|$vtiger_login|$vtiger_pass" . mysql_error());}
				echo 'Connected successfully';
				mysql_select_db("$vtiger_dbname", $linkV);

				$user_name =		$user;
				$user_password =	$pass;
				$last_name =		$full_name;
				$is_admin =			'off';
				$roleid =			'H5';
				$status =			'Active';
				$groupid =			'1';
					if ($user_level >= 7) {$roleid = 'H3';}
					if ($user_level >= 8) {$roleid = 'H4';}
					if ($user_level >= 9) {$roleid = 'H2';}
					if ($user_level >= 9) {$is_admin = 'on';}
				$salt = substr($user_name, 0, 2);
				$salt = '$1$' . $salt . '$';
				$encrypted_password = crypt($user_password, $salt);

				######################################
				##### BEGIN Add/Update group info in Vtiger
				$stmt="SELECT count(*) from vtiger_groups where groupname='$user_group';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$group_found_count = $row[0];

				### group exists in vtiger, update it
				if ($group_found_count > 0)
					{
					$stmt="SELECT groupid from vtiger_groups where groupname='$user_group';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$groupid = $row[0];
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW GROUP RECORD IN VTIGER
					# Get next available id from vtiger_users_seq to use as groupid
					$stmt="SELECT id from vtiger_users_seq;";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					$row=mysql_fetch_row($rslt);
					$groupid = ($row[0] + 1);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					# Increase next available groupid with 1 so next record gets proper id
					$stmt="UPDATE vtiger_users_seq SET id = '$groupid';";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtA = "INSERT INTO vtiger_groups SET groupid='$groupid',groupname='$user_group',description='';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW GROUP RECORD IN VTIGER
					}
				##### END Add/Update group info in Vtiger
				######################################

				######################################
				##### BEGIN Add/Update user info in Vtiger
				$stmt="SELECT count(*) from vtiger_users where user_name='$user_name';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$found_count = $row[0];

				### user exists in vtiger, update it
				if ($found_count > 0)
					{
					$stmt="SELECT id from vtiger_users where user_name='$user_name';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$userid = $row[0];

					$stmt="SELECT count(*) from vtiger_users2group WHERE userid='$userid' and groupid='$groupid';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$usergroupcount = $row[0];
					mysql_query("set names utf8");
					$stmtA = "UPDATE vtiger_users SET user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status' where id='$userid';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtB = "UPDATE vtiger_user2role SET roleid='$roleid' where userid='$userid';";
					if ($DB) {echo "|$stmtB|\n";}
					$rslt=mysql_query($stmtB, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					if ($usergroupcount < 1)
						{
						$stmt="SELECT user_group FROM vicidial_user_groups;";
						$rslt=mysql_query($stmt, $link);
						if ($DB) {echo "$stmt\n";}
						$VD_groups_ct = mysql_num_rows($rslt);
						$k=0;
						$VD_groups_list='';
						while ($k < $VD_groups_ct)
							{
							$row=mysql_fetch_row($rslt);
							$VD_groups_list .= "'$row[0]',";
							$k++;
							}
						$VD_groups_list = preg_replace("/.$/",'',$VD_groups_list);

						$stmtC = "DELETE FROM vtiger_users2group WHERE userid='$userid' and groupid IN(SELECT groupid from vtiger_groups where groupname IN($VD_groups_list));";
						if ($DB) {echo "|$stmtC|\n";}
						$rslt=mysql_query($stmtC, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}

						$stmtD = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
						if ($DB) {echo "|$stmtD|\n";}
						$rslt=mysql_query($stmtD, $linkV);
						if (!$rslt) {die('Could not execute: ' . mysql_error());}
						}
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW USER RECORD IN VTIGER
					$stmtA = "INSERT INTO vtiger_users SET user_name='$user_name',user_password='$encrypted_password',last_name='$last_name',is_admin='$is_admin',status='$status',date_format='yyyy-mm-dd',first_name='',reports_to_id='',description='',title='',department='',phone_home='',phone_mobile='',phone_work='',phone_other='',phone_fax='',email1='',email2='',yahoo_id='',signature='',address_street='',address_city='',address_state='',address_country='',address_postalcode='',user_preferences='',imagename='';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$userid = mysql_insert_id($linkV);
				
					$stmtB = "INSERT INTO vtiger_user2role SET userid='$userid',roleid='$roleid';";
					if ($DB) {echo "|$stmtB|\n";}
					$rslt=mysql_query($stmtB, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtC = "INSERT INTO vtiger_users2group SET userid='$userid',groupid='$groupid';";
					if ($DB) {echo "|$stmtC|\n";}
					$rslt=mysql_query($stmtC, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					$stmtD = "UPDATE vtiger_users_seq SET id='$userid';";
					if ($DB) {echo "|$stmtD|\n";}
					$rslt=mysql_query($stmtD, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW USER RECORD IN VTIGER
					}
				##### END Add/Update user info in Vtiger
				######################################
				}
			### END vtiger integration

			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=3;		# go to user modification below
	}

######################
# ADD=41 submit campaign modifications to the system - DETAIL
######################

if ($ADD==41)
	{
	
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
		
		//var_dump($groups);exit;
		if ($SSoutbound_autodial_active < 1)
			{
			$adaptive_dl_diff_target =		'0';
			$adaptive_dropped_percentage =	'99';
			$adaptive_intensity =			'0';
			$adaptive_latest_server_time =	'2359';
			$adaptive_maximum_level =		'1.0';
			$agent_extended_alt_dial =		'N';
			$alt_number_dialing =			'N';
			$am_message_exten =				'8320';
			$amd_send_to_vmx =				'N';
			$auto_alt_dial =				'N';
			$auto_dial_level =				'1.0';
			$available_only_ratio_tally =	'Y';
			$campaign_allow_inbound =		'Y';
			$campaign_vdad_exten =			'8368';
			$concurrent_transfers =			'AUTO';
			$dial_method =					'RATIO';
			$dial_status =					'';
			$dial_timeout =					'60';
			$drop_action =					'HANGUP';
			$drop_call_seconds =			'5';
			$drop_inbound_group =			'---NONE---';
			$drop_menu_id =					'---NONE---';
			$force_reset_hopper =			'N';
			$hopper_level =					'5';
			$lead_filter_id =				'NONE';
			$lead_order =					'DOWN';
			$list_order_mix =				'DISABLED';
			$no_hopper_leads_logins =		'Y';
			$queue_priority =				'50';
			$safe_harbor_exten =			'8300';
			$survey_camp_record_dir =		'/home/survey';
			$survey_dtmf_digits =			'1238';
			$survey_first_audio_file =		'US_pol_survey_hello';
			$survey_method =				'AGENT_XFER';
			$survey_ni_audio_file =			'';
			$survey_ni_digit =				'8';
			$survey_ni_status =				'NI';
			$survey_no_response_action =	'OPTIN';
			$survey_opt_in_audio_file =		'US_pol_survey_transfer';
			$survey_response_digit_map =	'1-DEMOCRAT|2-REPUBLICAN|3-INDEPENDANT|8-OPTOUT|X-NO RESPONSE|';
			$survey_xfer_exten =			'8300';
			$voicemail_ext =				'';
			$cpd_amd_action =				'DISABLED';
			$drop_lockout_time =			'0';
			}
		if (ereg('list_activation',$stage))
			{
			$p=0;
			echo "<BR>ACTIVE LISTS CHANGED";
			$list_active_change_ct = count($list_active_change);
			while ($p < $list_active_change_ct)
				{
				$LIST_ACTIVATE .= "'$list_active_change[$p]',";
				$p++;
				}
			
			$stmt = "UPDATE vicidial_lists SET active='Y' where list_id IN($LIST_ACTIVATE'') and campaign_id='$campaign_id';";
			$stmtB = "UPDATE vicidial_lists SET active='N' where list_id NOT IN($LIST_ACTIVATE'') and campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			$rslt=mysql_query($stmtB, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|$stmtB|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGNS', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN ACTIVE LISTS', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			if ($DB > 0) {echo "|$stmt|\n|$stmtB|\n";}
			}
		else
			{
			if ( (strlen($campaign_name) < 6) or (strlen($active) < 1) )
				{
				echo "<br>CAMPAIGN NOT MODIFIED - Please go back and look at the data you entered\n";
				echo "<br>the campaign name needs to be at least 6 characters in length\n";
				echo "<br>|$campaign_name|$active|\n";
				}
			else
				{
				echo "<br><B>CAMPAIGN MODIFIED: $campaign_id</B>\n";

				if ( ($dial_method != 'MANUAL') and ($dial_method != 'INBOUND_MAN') )
					{
					$no_hopper_dialing='N';
					$agent_dial_owner_only='NONE';
					}
				if ($no_hopper_dialing == 'Y')
					{
					$auto_alt_dial='NONE';
					$list_order_mix='DISABLED';
					}
				if ($dial_method == 'MANUAL') 
					{
					$auto_dial_level='0';
					$adlSQL = "auto_dial_level='0',";
					$campaign_allow_inbound='N';
					}
				else
					{
					if ($dial_level_override > 0)
						{
						$adlSQL = "auto_dial_level='$auto_dial_level',";
						}
					else
						{
						if ($dial_method == 'RATIO')
							{
							if ($auto_dial_level < 1) {$auto_dial_level = "1.0";}
							$adlSQL = "auto_dial_level='$auto_dial_level',";
							}
						else
							{
							$adlSQL = "";
							if ($auto_dial_level < 1) 
								{
								$auto_dial_level = "1.0";
								$adlSQL = "auto_dial_level='$auto_dial_level',";
								}
							}
						}
					}
				if ( (!ereg("DISABLED",$list_order_mix)) and ($hopper_level < 100) )
					{$hopper_level='100';}

				$stmtA="UPDATE vicidial_campaigns set campaign_name='$campaign_name',active='$active',dial_status_a='$dial_status_a',dial_status_b='$dial_status_b',dial_status_c='$dial_status_c',dial_status_d='$dial_status_d',dial_status_e='$dial_status_e',lead_order='$lead_order',allow_closers='$allow_closers',hopper_level='$hopper_level', $adlSQL next_agent_call='$next_agent_call', local_call_time='$local_call_time', voicemail_ext='$voicemail_ext', dial_timeout='$dial_timeout', dial_prefix='$dial_prefix', campaign_cid='$campaign_cid', campaign_vdad_exten='$campaign_vdad_exten', web_form_address='" . mysql_real_escape_string($web_form_address) . "', park_ext='$park_ext', park_file_name='$park_file_name', campaign_rec_exten='$campaign_rec_exten', campaign_recording='$campaign_recording', campaign_rec_filename='$campaign_rec_filename', campaign_script='$script_id', get_call_launch='$get_call_launch', am_message_exten='$am_message_exten', amd_send_to_vmx='$amd_send_to_vmx', xferconf_a_dtmf='$xferconf_a_dtmf',xferconf_a_number='$xferconf_a_number',xferconf_b_dtmf='$xferconf_b_dtmf',xferconf_b_number='$xferconf_b_number',lead_filter_id='$lead_filter_id',alt_number_dialing='$alt_number_dialing',scheduled_callbacks='$scheduled_callbacks',drop_action='$drop_action',drop_call_seconds='$drop_call_seconds',safe_harbor_exten='$safe_harbor_exten',wrapup_seconds='$wrapup_seconds',wrapup_message='$wrapup_message',closer_campaigns='$groups_value',use_internal_dnc='$use_internal_dnc',allcalls_delay='$allcalls_delay',omit_phone_code='$omit_phone_code',dial_method='$dial_method',available_only_ratio_tally='$available_only_ratio_tally',adaptive_dropped_percentage='$adaptive_dropped_percentage',adaptive_maximum_level='$adaptive_maximum_level',adaptive_latest_server_time='$adaptive_latest_server_time',adaptive_intensity='$adaptive_intensity',adaptive_dl_diff_target='$adaptive_dl_diff_target',concurrent_transfers='$concurrent_transfers',auto_alt_dial='$auto_alt_dial',agent_pause_codes_active='$agent_pause_codes_active',campaign_description='$campaign_description',campaign_changedate='$SQLdate',campaign_stats_refresh='$campaign_stats_refresh',disable_alter_custdata='$disable_alter_custdata',no_hopper_leads_logins='$no_hopper_leads_logins',list_order_mix='$list_order_mix',campaign_allow_inbound='$campaign_allow_inbound',manual_dial_list_id='$manual_dial_list_id',default_xfer_group='$default_xfer_group',xfer_groups='$XFERgroups_value',queue_priority='$queue_priority',drop_inbound_group='$drop_inbound_group',disable_alter_custphone='$disable_alter_custphone',display_queue_count='$display_queue_count',manual_dial_filter='$manual_dial_filter',agent_clipboard_copy='$agent_clipboard_copy',agent_extended_alt_dial='$agent_extended_alt_dial',use_campaign_dnc='$use_campaign_dnc',three_way_call_cid='$three_way_call_cid',three_way_dial_prefix='$three_way_dial_prefix',web_form_target='$web_form_target',vtiger_search_category='$vtiger_search_category',vtiger_create_call_record='$vtiger_create_call_record',vtiger_create_lead_record='$vtiger_create_lead_record',vtiger_screen_login='$vtiger_screen_login',cpd_amd_action='$cpd_amd_action',agent_allow_group_alias='$agent_allow_group_alias',default_group_alias='$default_group_alias',vtiger_search_dead='$vtiger_search_dead',vtiger_status_call='$vtiger_status_call',drop_lockout_time='$drop_lockout_time',quick_transfer_button='$quick_transfer_button',prepopulate_transfer_preset='$prepopulate_transfer_preset',drop_rate_group='$drop_rate_group',view_calls_in_queue='$view_calls_in_queue',view_calls_in_queue_launch='$view_calls_in_queue_launch',grab_calls_in_queue='$grab_calls_in_queue',call_requeue_button='$call_requeue_button',pause_after_each_call='$pause_after_each_call',no_hopper_dialing='$no_hopper_dialing',agent_dial_owner_only='$agent_dial_owner_only',agent_display_dialable_leads='$agent_display_dialable_leads',web_form_address_two='" . mysql_real_escape_string($web_form_address_two) . "',waitforsilence_options='$waitforsilence_options',agent_select_territories='$agent_select_territories',crm_popup_login='$crm_popup_login',crm_login_address='" . mysql_real_escape_string($crm_login_address) . "',timer_action='$timer_action',timer_action_message='$timer_action_message',timer_action_seconds='$timer_action_seconds',start_call_url='" . mysql_real_escape_string($start_call_url) . "',dispo_call_url='" . mysql_real_escape_string($dispo_call_url) . "',xferconf_c_number='$xferconf_c_number',xferconf_d_number='$xferconf_d_number',xferconf_e_number='$xferconf_e_number',xfer_a_name='$xfer_a_name',xfer_b_name='$xfer_b_name',xfer_c_name='$xfer_c_name',xfer_d_name='$xfer_d_name',xfer_e_name='$xfer_e_name',inbound_mode='$campaign_inbound_mode',enable_vtiger_integration='$enable_vtiger_integration',vtiger_server_ip='$vtiger_server_ip',vtiger_dbname='$vtiger_dbname',vtiger_login='$vtiger_login',vtiger_pass='$vtiger_pass',vtiger_url='$vtiger_url',crm_target='$crm_target' where campaign_id='$campaign_id';";
				
				$rslt=mysql_query($stmtA, $link);
				
				if ($reset_hopper == 'Y')
					{
					echo "<br>RESETTING CAMPAIGN LEAD HOPPER\n";
					echo "<br> - Wait 1 minute before dialing next number\n";
					$stmt="DELETE from vicidial_hopper where campaign_id='$campaign_id' and status IN('READY','QUEUE','DONE');";
					$rslt=mysql_query($stmt, $link);

					### LOG INSERTION Admin Log Table ###
					$SQL_log = "$stmt|";
					$SQL_log = ereg_replace(';','',$SQL_log);
					$SQL_log = addslashes($SQL_log);
					$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGNS', event_type='RESET', record_id='$campaign_id', event_code='ADMIN RESET CAMPAIGN LEAD HOPPER', event_sql=\"$SQL_log\", event_notes='';";
					if ($DB) {echo "|$stmt|\n";}
					$rslt=mysql_query($stmt, $link);
					}

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmtA|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGNS', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=31;	# go to campaign modification form below
	}


######################
# ADD=42 modify/delete campaign status in the system
######################

if ($ADD==42)
	{
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($campaign_id) < 2) or (strlen($status) < 1) )
			{
			echo "<br>CAMPAIGN STATUS NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>the campaign id needs to be at least 2 characters in length\n";
			echo "<br>the campaign status needs to be at least 1 characters in length\n";
			}
		else
			{
			if (ereg('delete',$stage))
				{
				echo "<br><B>CUSTOM CAMPAIGN STATUS DELETED: $campaign_id - $status</B>\n";

				$stmt="DELETE FROM vicidial_campaign_statuses where campaign_id='$campaign_id' and status='$status';";
				$rslt=mysql_query($stmt, $link);

				$stmtA="DELETE FROM vicidial_campaign_hotkeys where campaign_id='$campaign_id' and status='$status';";
				$rslt=mysql_query($stmtA, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_STATUS', event_type='DELETE', record_id='$campaign_id', event_code='ADMIN DELETE CAMPAIGN STATUS', event_sql=\"$SQL_log\", event_notes='Status: $status';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			if (ereg('modify',$stage))
				{
				echo "<br><B>CUSTOM CAMPAIGN STATUS MODIFIED: $campaign_id - $status</B>\n";

				$stmt="UPDATE vicidial_campaign_statuses SET class='$status_class',status_name='$status_name',selectable='$selectable',human_answered='$human_answered',category='$category',sale='$sale',dnc='$dnc',customer_contact='$customer_contact',not_interested='$not_interested',unworkable='$unworkable',status_type='$status_type' where campaign_id='$campaign_id' and status='$status';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_STATUS', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN STATUS', event_sql=\"$SQL_log\", event_notes='Status: $status';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$SUB=22;
	$ADD=31;	# go to campaign modification form below
	}


######################
# ADD=43 delete campaign hotkey in the system
######################

if ($ADD==43)
	{
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($campaign_id) < 2) or (strlen($status) < 1) or (strlen($hotkey) < 1) )
			{
			echo "<br>CAMPAIGN HOT KEY NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>the campaign id needs to be at least 2 characters in length\n";
			echo "<br>the campaign status needs to be at least 1 characters in length\n";
			echo "<br>the campaign hotkey needs to be at least 1 characters in length\n";
			}
		else
			{
			echo "<br><B>CUSTOM CAMPAIGN HOT KEY DELETED: $campaign_id - $status - $hotkey</B>\n";

			$stmt="DELETE FROM vicidial_campaign_hotkeys where campaign_id='$campaign_id' and status='$status' and hotkey='$hotkey';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_HOTKEY', event_type='DELETE', record_id='$campaign_id', event_code='ADMIN DELETE CAMPAIGN HOTKEY', event_sql=\"$SQL_log\", event_notes='Status: $status|HotKey: $hotkey';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$SUB=23;
	$ADD=31;	# go to campaign modification form below
	}


######################
# ADD=44 submit campaign modifications to the system - Basic View
######################

if ($ADD==44)
	{
	
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ($SSoutbound_autodial_active < 1)
			{
			$adaptive_dl_diff_target =		'0';
			$adaptive_dropped_percentage =	'99';
			$adaptive_intensity =			'0';
			$adaptive_latest_server_time =	'2359';
			$adaptive_maximum_level =		'1.0';
			$agent_extended_alt_dial =		'N';
			$alt_number_dialing =			'N';
			$am_message_exten =				'8320';
			$amd_send_to_vmx =				'N';
			$auto_alt_dial =				'N';
			$auto_dial_level =				'1.0';
			$available_only_ratio_tally =	'Y';
			$campaign_allow_inbound =		'Y';
			$campaign_vdad_exten =			'8368';
			$concurrent_transfers =			'AUTO';
			$dial_method =					'RATIO';
			$dial_status =					'';
			$dial_timeout =					'60';
			$drop_action =					'HANGUP';
			$drop_call_seconds =			'5';
			$drop_inbound_group =			'---NONE---';
			$force_reset_hopper =			'N';
			$hopper_level =					'5';
			$lead_filter_id =				'NONE';
			$lead_order =					'DOWN';
			$list_order_mix =				'DISABLED';
			$no_hopper_leads_logins =		'Y';
			$queue_priority =				'50';
			$safe_harbor_exten =			'8300';
			$voicemail_ext =				'';
			}
		if (ereg('list_activation',$stage))
			{
			$p=0;
			echo "<BR>ACTIVE LISTS CHANGED";
			$list_active_change_ct = count($list_active_change);
			while ($p < $list_active_change_ct)
				{
				$LIST_ACTIVATE .= "'$list_active_change[$p]',";
				$p++;
				}
			
			$stmt = "UPDATE vicidial_lists SET active='Y' where list_id IN($LIST_ACTIVATE'') and campaign_id='$campaign_id';";
			$stmtB = "UPDATE vicidial_lists SET active='N' where list_id NOT IN($LIST_ACTIVATE'') and campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			$rslt=mysql_query($stmtB, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|$stmtB|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGNS', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN ACTIVE LISTS', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			if ($DB > 0) {echo "|$stmt|\n|$stmtB|\n";}
			}
		else
			{
			if ( (strlen($campaign_name) < 6) or (strlen($active) < 1) )
				{
				echo "<br>CAMPAIGN NOT MODIFIED - Please go back and look at the data you entered\n";
				echo "<br>the campaign name needs to be at least 6 characters in length\n";
				}
			else
				{
				echo "<br><B>CAMPAIGN MODIFIED: $campaign_id</B>\n";

				if ($dial_method == 'RATIO')
					{
					if ($auto_dial_level < 1) {$auto_dial_level = "1.0";}
					$adlSQL = "auto_dial_level='$auto_dial_level',";
					}
				else
					{
					if ($dial_method == 'MANUAL') 
						{
						$auto_dial_level='0';
						$adlSQL = "auto_dial_level='0',";
						}
					else
						{
						$adlSQL = "";
						if ($auto_dial_level < 1) 
							{
							$auto_dial_level = "1.0";
							$adlSQL = "auto_dial_level='$auto_dial_level',";
							}
						}
					}
				if ( (!ereg("DISABLED",$list_order_mix)) and ($hopper_level < 100) )
					{$hopper_level='100';}
					
				$stmtA="UPDATE vicidial_campaigns set campaign_name='$campaign_name',active='$active',dial_status_a='$dial_status_a',dial_status_b='$dial_status_b',dial_status_c='$dial_status_c',dial_status_d='$dial_status_d',dial_status_e='$dial_status_e',lead_order='$lead_order',hopper_level='$hopper_level', $adlSQL lead_filter_id='$lead_filter_id',dial_method='$dial_method',adaptive_intensity='$adaptive_intensity',campaign_changedate='$SQLdate',list_order_mix='$list_order_mix' where campaign_id='$campaign_id';";
				
				if($LOGuser_level<=8){
					$stmtA="UPDATE vicidial_campaigns set campaign_name='$campaign_name',active='$active' where campaign_id='$campaign_id';";
				}
				$rslt=mysql_query($stmtA, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmtA|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGNS', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);

				if ($reset_hopper == 'Y')
					{
					echo "<br>RESETTING CAMPAIGN LEAD HOPPER\n";
					echo "<br> - Wait 1 minute before dialing next number\n";
					$stmt="DELETE from vicidial_hopper where campaign_id='$campaign_id' and status IN('READY','QUEUE','DONE');;";
					$rslt=mysql_query($stmt, $link);

					### LOG INSERTION Admin Log Table ###
					$SQL_log = "$stmt|";
					$SQL_log = ereg_replace(';','',$SQL_log);
					$SQL_log = addslashes($SQL_log);
					$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGNS', event_type='RESET', record_id='$campaign_id', event_code='ADMIN RESET CAMPAIGN LEAD HOPPER', event_sql=\"$SQL_log\", event_notes='';";
					if ($DB) {echo "|$stmt|\n";}
					$rslt=mysql_query($stmt, $link);
					}
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=34;	# go to campaign modification form below
	}


######################
# ADD=45 modify campaign lead recycle in the system
######################

if ($ADD==45)
	{
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($campaign_id) < 2) or (strlen($status) < 1) or ($attempt_maximum < 1) or ($attempt_maximum > 10) )//鍙栨秷Attempt Delay鐨勭鏁伴檺鍒讹細($attempt_delay < 120) or ($attempt_delay >= 43200)锛?
			{
			echo "<br>CAMPAIGN LEAD RECYCLE NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>status must be between 1 and 6 characters in length\n";
//			echo "<br>attempt delay must be at least 120 seconds and less than 43200 seconds or 12 hours\n";//鍙栨秷Attempt Delay鐨勭鏁伴檺鍒讹紱
			echo "<br>maximum attempts must be from 1 to 10\n";
			}
		else
			{
			echo "<br><B>CAMPAIGN LEAD MODIFIED: $campaign_id - $status - $attempt_delay</B>\n";

			$stmt="UPDATE vicidial_lead_recycle SET attempt_delay='$attempt_delay',attempt_maximum='$attempt_maximum',active='$active' where campaign_id='$campaign_id' and status='$status';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_RECYCLE', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN LEAD RECYCLE', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$SUB=25;
	$ADD=31;	# go to campaign modification form below
	}


######################
# ADD=47 modify agent pause code in the system
######################

if ($ADD==47)
	{
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($campaign_id) < 2) or (strlen($pause_code) < 1) or (strlen($pause_code) > 6) or (strlen($pause_code_name) < 2) )
			{
			echo "<br>AGENT PAUSE CODE NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>pause_code must be between 1 and 6 characters in length\n";
			echo "<br>pause_code name must be between 2 and 30 characters in length\n";
			}
		else
			{
			echo "<br><B>AGENT PAUSE CODE MODIFIED: $campaign_id - $pause_code - $pause_code_name</B>\n";

			$stmt="UPDATE vicidial_pause_codes SET pause_code_name='$pause_code_name',billable='$billable' where campaign_id='$campaign_id' and pause_code='$pause_code';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_PAUSECODE', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN PAUSE CODE', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$SUB=27;
	$ADD=31;	# go to campaign modification form below
	}


######################
# ADD=48 modify campaign QC settings in the system
######################
if ($ADD==48)
	{
	if ( ($LOGmodify_campaigns==1) and ($SSqc_features_active) )
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if (strlen($campaign_id) < 2)
			{
			echo "<br>QC SETTINGS NOT MODIFIED - Please go back and look at the data you entered\n";
			}
		else
			{
			$p=0;
			$qc_statuses_ct = count($qc_statuses);
			while ($p < $qc_statuses_ct)
				{
				$QC_statuses .= " $qc_statuses[$p]";
				$p++;
				}
			$p=0;
			$qc_lists_ct = count($qc_lists);
			while ($p < $qc_lists_ct)
				{
				$QC_lists .= " $qc_lists[$p]";
				$p++;
				}
			
			if (strlen($QC_statuses)>0) {$QC_statuses .= " -";}
			if (strlen($QC_lists)>0) {$QC_lists .= " -";}

			echo "<br><B>QC SETTINGS MODIFIED: $campaign_id</B>\n";

			$stmt="UPDATE vicidial_campaigns SET qc_enabled='$qc_enabled',qc_statuses='$QC_statuses',qc_lists='$QC_lists',qc_web_form_address='$qc_web_form_address',qc_script='$qc_script',qc_get_record_launch='$qc_get_record_launch',qc_show_recording='$qc_show_recording',qc_shift_id='$qc_shift_id' where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_QC', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN QC SETTINGS', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$SUB=28;
	$ADD=31;	# go to campaign modification form below
	}


######################
# ADD=40A modify campaign survey settings in the system
######################

if ($ADD=='40A')
	{
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if (strlen($campaign_id) < 2)
			{
			echo "<br>SURVEY SETTINGS NOT MODIFIED - Please go back and look at the data you entered\n";
			}
		else
			{
			echo "<br><B>SURVEY SETTINGS MODIFIED: $campaign_id</B>\n";

			$stmt="UPDATE vicidial_campaigns SET survey_first_audio_file='$survey_first_audio_file',survey_dtmf_digits='$survey_dtmf_digits',survey_ni_digit='$survey_ni_digit',survey_opt_in_audio_file='$survey_opt_in_audio_file',survey_ni_audio_file='$survey_ni_audio_file',survey_method='$survey_method',survey_no_response_action='$survey_no_response_action',survey_ni_status='$survey_ni_status',survey_response_digit_map='$survey_response_digit_map',survey_xfer_exten='$survey_xfer_exten',survey_camp_record_dir='$survey_camp_record_dir',voicemail_ext='$voicemail_ext',survey_third_digit='$survey_third_digit',survey_fourth_digit='$survey_fourth_digit',survey_third_audio_file='$survey_third_audio_file',survey_fourth_audio_file='$survey_fourth_audio_file',survey_third_status='$survey_third_status',survey_fourth_status='$survey_fourth_status',survey_third_exten='$survey_third_exten',survey_fourth_exten='$survey_fourth_exten' where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_SURVEY', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN SURVEY', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$SUB='20A';
	$ADD=31;	# go to campaign modification form below
	}


######################
# ADD=49 modify campaign list mix in the system
######################

if ($ADD==49)
	{
	if ($LOGmodify_campaigns==1)
		{
		##### MODIFY a list mix container entry #####
		if ($stage=='MODIFY')
			{
			echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

			$Flist_mix_container = "list_mix_container_$vcl_id";
			$Fmix_method = "mix_method_$vcl_id";
			$Fstatus = "status_$vcl_id";
			$Fvcl_name = "vcl_name_$vcl_id";

			if (isset($_GET[$Flist_mix_container]))				{$list_mix_container=$_GET[$Flist_mix_container];}
				elseif (isset($_POST[$Flist_mix_container]))	{$list_mix_container=$_POST[$Flist_mix_container];}
			if (isset($_GET[$Fmix_method]))						{$mix_method=$_GET[$Fmix_method];}
				elseif (isset($_POST[$Fmix_method]))			{$mix_method=$_POST[$Fmix_method];}
			if (isset($_GET[$Fstatus]))							{$status=$_GET[$Fstatus];}
				elseif (isset($_POST[$Fstatus]))				{$status=$_POST[$Fstatus];}
			if (isset($_GET[$Fvcl_name]))						{$vcl_name=$_GET[$Fvcl_name];}
				elseif (isset($_POST[$Fvcl_name]))				{$vcl_name=$_POST[$Fvcl_name];}
			$list_mix_container = preg_replace("/:$/","",$list_mix_container);

			 if ( (strlen($campaign_id) < 2) or (strlen($vcl_id) < 1) or (strlen($list_mix_container) < 6) or (strlen($vcl_name) < 2) )
				{
				echo "<br>LIST MIX NOT MODIFIED - Please go back and look at the data you entered\n";
				echo "<br>vcl_id must be between 1 and 20 characters in length\n";
				echo "<br>vcl_name name must be between 2 and 30 characters in length\n";
				}
			 else
				{
				$stmt="UPDATE vicidial_campaigns_list_mix SET vcl_name='$vcl_name',mix_method='$mix_method',list_mix_container='$list_mix_container' where campaign_id='$campaign_id' and vcl_id='$vcl_id';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_LISTMIX', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN LIST MIX', event_sql=\"$SQL_log\", event_notes='List Mix: $vcl_id';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);

				echo "<br><B>LIST MIX MODIFIED: $campaign_id - $vcl_id - $vcl_name</B>\n";
				}
			}

		##### ADD a list mix container entry #####
			if ($stage=='ADD')
			{
			echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

			if ( (strlen($campaign_id) < 2) or (strlen($vcl_id) < 1) or (strlen($list_id) < 1) )
				{
				echo "<br>LIST MIX NOT MODIFIED - Please go back and look at the data you entered\n";
				echo "<br>vcl_id must be between 1 and 20 characters in length\n";
				echo "<br>list_id must be at least 2 characters in length\n";
				}
			else
				{
				$stmt="SELECT list_mix_container from vicidial_campaigns_list_mix where campaign_id='$campaign_id' and vcl_id='$vcl_id';";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);
				$OLDlist_mix_container =	$row[0];
				$NEWlist_mix_container = "$OLDlist_mix_container:$list_id|10|0| -|";

				$stmt="UPDATE vicidial_campaigns_list_mix SET list_mix_container='$NEWlist_mix_container' where campaign_id='$campaign_id' and vcl_id='$vcl_id';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_LISTMIX', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN LIST MIX', event_sql=\"$SQL_log\", event_notes='List Mix: $vcl_id';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);

				echo "<br><B>LIST MIX MODIFIED: $campaign_id - $vcl_id - $list_id</B>\n";
				}
			}

		##### REMOVE a list mix container entry #####
			if ($stage=='REMOVE')
			{
			echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

			if ( (strlen($campaign_id) < 2) or (strlen($vcl_id) < 1) or (strlen($list_id) < 1) )
				{
				echo "<br>LIST MIX NOT MODIFIED - Please go back and look at the data you entered\n";
				echo "<br>vcl_id must be between 1 and 20 characters in length\n";
				echo "<br>list_id must be at least 2 characters in length\n";
				}
			else
				{
				$stmt="SELECT list_mix_container from vicidial_campaigns_list_mix where campaign_id='$campaign_id' and vcl_id='$vcl_id';";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);
				$MIXentries = $MT;
				$MIXentries = explode(":", $row[0]);
				$Ms_to_print = (count($MIXentries) - 0);

				if ($Ms_to_print < 2)
					{
					echo "<br><B>LIST MIX NOT MODIFIED: You cannot delete the last list_id entry from a list mix</B>\n";
					}
				else
					{
					$MIXdetailsPCT = explode('|', $MIXentries[$mix_container_item]);
					$MIXpercentPCT = $MIXdetailsPCT[2];

					$q=0;
					while ($Ms_to_print > $q) 
						{
						if ( ($mix_container_item > $q) or ($mix_container_item < $q) )
							{
							if ( ($q==0) and ($mix_container_item > 0) )
								{
								$MIXdetailsONE = explode('|', $MIXentries[$q]);
								$MIXpercentONE = ($MIXdetailsONE[2] + $MIXpercentPCT);
								$NEWlist_mix_container .= "$MIXdetailsONE[0]|$MIXdetailsONE[1]|$MIXpercentONE|$MIXdetailsONE[3]|:";
								}
							else
								{
								if ( ($q==1) and ($mix_container_item < 1) )
									{
									$MIXdetailsONE = explode('|', $MIXentries[$q]);
									$MIXpercentONE = ($MIXdetailsONE[2] + $MIXpercentPCT);
									$NEWlist_mix_container .= "$MIXdetailsONE[0]|$MIXdetailsONE[1]|$MIXpercentONE|$MIXdetailsONE[3]|:";
									}
								else
									{
									$NEWlist_mix_container .= "$MIXentries[$q]:";
									}
								}
							}
						$q++;
						}
					$NEWlist_mix_container = preg_replace("/.$/",'',$NEWlist_mix_container);

					$stmt="UPDATE vicidial_campaigns_list_mix SET list_mix_container='$NEWlist_mix_container' where campaign_id='$campaign_id' and vcl_id='$vcl_id';";
					$rslt=mysql_query($stmt, $link);

					### LOG INSERTION Admin Log Table ###
					$SQL_log = "$stmt|";
					$SQL_log = ereg_replace(';','',$SQL_log);
					$SQL_log = addslashes($SQL_log);
					$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_LISTMIX', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN LIST MIX', event_sql=\"$SQL_log\", event_notes='List Mix: $vcl_id';";
					if ($DB) {echo "|$stmt|\n";}
					$rslt=mysql_query($stmt, $link);

					echo "<br><B>LIST MIX MODIFIED: $campaign_id - $vcl_id - $list_id - $mix_container_item</B>\n";
					}
				}
			}

		##### ADD a NEW list mix #####
			if ($stage=='NEWMIX')
			{
			echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

			if ( (strlen($campaign_id) < 2) or (strlen($vcl_id) < 1) or (strlen($vcl_name) < 2) )
				{
				echo "<br>LIST MIX NOT ADDED - Please go back and look at the data you entered\n";
				echo "<br>vcl_id must be between 1 and 20 characters in length\n";
				echo "<br>vcl_name must be at least 2 characters in length\n";
				}
			else
				{
				$stmt="SELECT count(*) from vicidial_campaigns_list_mix where vcl_id='$vcl_id';";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);
				if ($row[0] > 0)
					{
					echo "<br>LIST MIX NOT ADDED - There is already a list mix with this ID in the system\n";
					}
				else
					{
					$stmt="INSERT INTO vicidial_campaigns_list_mix SET list_mix_container='$list_id|1|100| $status -|',campaign_id='$campaign_id',vcl_id='$vcl_id',vcl_name='$vcl_name',mix_method='$mix_method',status='INACTIVE';";
					$rslt=mysql_query($stmt, $link);

					### LOG INSERTION Admin Log Table ###
					$SQL_log = "$stmt|";
					$SQL_log = ereg_replace(';','',$SQL_log);
					$SQL_log = addslashes($SQL_log);
					$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_LISTMIX', event_type='ADD', record_id='$campaign_id', event_code='ADMIN ADD CAMPAIGN LIST MIX', event_sql=\"$SQL_log\", event_notes='List Mix: $vcl_id';";
					if ($DB) {echo "|$stmt|\n";}
					$rslt=mysql_query($stmt, $link);

					echo "<br><B>LIST MIX ADDED: $campaign_id - $vcl_id - $vcl_name</B>\n";
					}
				}
			}

		##### DELETE an existing list mix #####
			if ($stage=='DELMIX')
			{
			echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

			if ( (strlen($campaign_id) < 2) or (strlen($vcl_id) < 1) )
				{
				echo "<br>LIST MIX NOT DELETED - Please go back and look at the data you entered\n";
				echo "<br>vcl_id must be between 1 and 20 characters in length\n";
				}
			else
				{
				$stmt="DELETE from vicidial_campaigns_list_mix where vcl_id='$vcl_id' and campaign_id='$campaign_id';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_LISTMIX', event_type='DELETE', record_id='$campaign_id', event_code='ADMIN DELETE CAMPAIGN LIST MIX', event_sql=\"$SQL_log\", event_notes='List Mix: $vcl_id';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);

				echo "<br><B>LIST MIX DELETED: $campaign_id - $vcl_id - $vcl_name</B>\n";
				}
			}

		##### Set list mix entry to active #####
			if ($stage=='SETACTIVE')
			{
			echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

			if ( (strlen($campaign_id) < 2) or (strlen($vcl_id) < 1) )
				{
				echo "<br>LIST MIX NOT ACTIVATED - Please go back and look at the data you entered\n";
				echo "<br>vcl_id must be between 1 and 20 characters in length\n";
				}
			else
				{
				$stmt="UPDATE vicidial_campaigns_list_mix SET status='INACTIVE' where campaign_id='$campaign_id';";
				$rslt=mysql_query($stmt, $link);

				$stmt="UPDATE vicidial_campaigns_list_mix SET status='ACTIVE' where vcl_id='$vcl_id' and campaign_id='$campaign_id';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_LISTMIX', event_type='MODIFY', record_id='$campaign_id', event_code='ADMIN MODIFY CAMPAIGN LIST MIX ACTIVE', event_sql=\"$SQL_log\", event_notes='List Mix: $vcl_id';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);

				echo "<br><B>LIST MIX ACTIVATED: $campaign_id - $vcl_id - $vcl_name</B>\n";
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$SUB=29;
	$ADD=31;	# go to campaign modification form below
	}


######################
# ADD=411 submit list modifications to the system
######################

if ($ADD==411)
	{
	if ($LOGmodify_lists==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($list_name) < 2) or (strlen($campaign_id) < 2) )
			{
			echo "<br>LIST NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>list name must be at least 2 characters in length\n";
			}
		else
			{
			if (strlen($reset_time) < 4) {$reset_time='';}

			echo "<br><B>LIST MODIFIED: $list_id</B>\n";

			$stmt="UPDATE vicidial_lists set list_name='$list_name',campaign_id='$campaign_id',active='$active',list_description='$list_description' where list_id='$list_id';";
			if($LOGuser_level>8){
				$stmt="UPDATE vicidial_lists set list_name='$list_name',campaign_id='$campaign_id',active='$active',list_description='$list_description',list_changedate='$SQLdate',reset_time='$reset_time',agent_script_override='$agent_script_override',campaign_cid_override='$campaign_cid_override',am_message_exten_override='$am_message_exten_override',drop_inbound_group_override='$drop_inbound_group_override',xferconf_a_number='$xferconf_a_number',xferconf_b_number='$xferconf_b_number',xferconf_c_number='$xferconf_c_number',xferconf_d_number='$xferconf_d_number',xferconf_e_number='$xferconf_e_number' where list_id='$list_id';";

			}
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='MODIFY', record_id='$list_id', event_code='ADMIN MODIFY LIST', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			if ($reset_list == 'Y')
				{
				echo "<br>RESETTING LIST-CALLED-STATUS\n";
				$stmtB="UPDATE vicidial_list set called_since_last_reset='N' where list_id='$list_id';";
				$rslt=mysql_query($stmtB, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='RESET', record_id='$list_id', event_code='ADMIN RESET LIST', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			if ($campaign_id != "$old_campaign_id")
				{
				echo "<br>REMOVING LIST HOPPER LEADS FROM OLD CAMPAIGN HOPPER ($old_campaign_id)\n";
				$stmtC="DELETE from vicidial_hopper where list_id='$list_id' and campaign_id='$old_campaign_id';";
				$rslt=mysql_query($stmtC, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=311;	# go to list modification form below
	}


######################
# ADD=4111 modify in-group info in the system
######################

if ($ADD==4111)
	{
	if ($LOGmodify_ingroups==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($group_name) < 2) or (strlen($group_color) < 2) )
			{
			echo "<br>GROUP NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>group name and group color must be at least 2 characters in length\n";
			}
		else
			{
			if (isset($_GET["busy_transfer"]))									{$busy_transfer=$_GET["busy_transfer"];}
				elseif (isset($_POST["busy_transfer"]))							{$busy_transfer=$_POST["busy_transfer"];}
			if (isset($_GET["busy_transfer_destination_group_id"]))				{$busy_transfer_destination_group_id=$_GET["busy_transfer_destination_group_id"];}
				elseif (isset($_POST["busy_transfer_destination_group_id"]))		{$busy_transfer_destination_group_id=$_POST["busy_transfer_destination_group_id"];}
			if (isset($_GET["busy_transfer_available_agents"]))								{$busy_transfer_available_agents=$_GET["busy_transfer_available_agents"];}
				elseif (isset($_POST["busy_transfer_available_agents"]))					{$busy_transfer_available_agents=$_POST["busy_transfer_available_agents"];}
				
				
			$p=0;
			$qc_statuses_ct = count($qc_statuses);
			while ($p < $qc_statuses_ct)
				{
				$QC_statuses .= " $qc_statuses[$p]";
				$p++;
				}
			$p=0;
			$qc_lists_ct = count($qc_lists);
			while ($p < $qc_lists_ct)
				{
				$QC_lists .= " $qc_lists[$p]";
				$p++;
				}
			
			if (strlen($QC_statuses)>0) {$QC_statuses .= " -";}
			if (strlen($QC_lists)>0) {$QC_lists .= " -";}


			if ($no_agent_action == "INGROUP")
				{
				if (isset($_GET["IGgroup_id_no_agent_action"]))					{$IGgroup_id=$_GET["IGgroup_id_no_agent_action"];}
					elseif (isset($_POST["IGgroup_id_no_agent_action"]))		{$IGgroup_id=$_POST["IGgroup_id_no_agent_action"];}
				if (isset($_GET["IGhandle_method_no_agent_action"]))			{$IGhandle_method=$_GET["IGhandle_method_no_agent_action"];}
					elseif (isset($_POST["IGhandle_method_no_agent_action"]))	{$IGhandle_method=$_POST["IGhandle_method_no_agent_action"];}
				if (isset($_GET["IGsearch_method_no_agent_action"]))			{$IGsearch_method=$_GET["IGsearch_method_no_agent_action"];}
					elseif (isset($_POST["IGsearch_method_no_agent_action"]))	{$IGsearch_method=$_POST["IGsearch_method_no_agent_action"];}
				if (isset($_GET["IGlist_id_no_agent_action"]))					{$IGlist_id=$_GET["IGlist_id_no_agent_action"];}
					elseif (isset($_POST["IGlist_id_no_agent_action"]))			{$IGlist_id=$_POST["IGlist_id_no_agent_action"];}
				if (isset($_GET["IGcampaign_id_no_agent_action"]))				{$IGcampaign_id=$_GET["IGcampaign_id_no_agent_action"];}
					elseif (isset($_POST["IGcampaign_id_no_agent_action"]))		{$IGcampaign_id=$_POST["IGcampaign_id_no_agent_action"];}
				if (isset($_GET["IGphone_code_no_agent_action"]))				{$IGphone_code=$_GET["IGphone_code_no_agent_action"];}
					elseif (isset($_POST["IGphone_code_no_agent_action"]))		{$IGphone_code=$_POST["IGphone_code_no_agent_action"];}

				$no_agent_action_value = "$IGgroup_id,$IGhandle_method,$IGsearch_method,$IGlist_id,$IGcampaign_id,$IGphone_code";
				}

			if ($no_agent_action == "EXTENSION")
				{
				if (isset($_GET["EXextension_no_agent_action"]))			{$EXextension=$_GET["EXextension_no_agent_action"];}
					elseif (isset($_POST["EXextension_no_agent_action"]))	{$EXextension=$_POST["EXextension_no_agent_action"];}
				if (isset($_GET["EXcontext_no_agent_action"]))				{$EXcontext=$_GET["EXcontext_no_agent_action"];}
					elseif (isset($_POST["EXcontext_no_agent_action"]))		{$EXcontext=$_POST["EXcontext_no_agent_action"];}

				$no_agent_action_value = "$EXextension,$EXcontext";
				}

			$no_agent_action_value = ereg_replace("[^-\/\|\_\#\*\,\.\_0-9a-zA-Z]","",$no_agent_action_value);

			if ($inbound_mode == "ring")
				{
				$next_agent_call = $next_agent_call_ring;
        
				if ($ring_timeout_seconds > 30) {$ring_timeout_seconds = 30;} # max ring timeout value is 30 seconds
				}

			echo "<br><B>GROUP MODIFIED: $group_id</B>\n";
# Modifed by fnatic start
			#	$stmt="UPDATE vicidial_inbound_groups set group_name='$group_name', group_color='$group_color', active='$active', web_form_address='" . mysql_real_escape_string($web_form_address) . "', voicemail_ext='$voicemail_ext', next_agent_call='$next_agent_call', fronter_display='$fronter_display', ingroup_script='$script_id', get_call_launch='$get_call_launch', xferconf_a_dtmf='$xferconf_a_dtmf',xferconf_a_number='$xferconf_a_number', xferconf_b_dtmf='$xferconf_b_dtmf',xferconf_b_number='$xferconf_b_number',drop_action='$drop_action',drop_call_seconds='$drop_call_seconds',drop_exten='$drop_exten',call_time_id='$call_time_id',after_hours_action='$after_hours_action',after_hours_message_filename='$after_hours_message_filename',after_hours_exten='$after_hours_exten',after_hours_voicemail='$after_hours_voicemail',welcome_message_filename='$welcome_message_filename',moh_context='$moh_context',onhold_prompt_filename='$onhold_prompt_filename',prompt_interval='$prompt_interval',agent_alert_exten='$agent_alert_exten',agent_alert_delay='$agent_alert_delay',default_xfer_group='$default_xfer_group',queue_priority='$queue_priority',drop_inbound_group='$drop_inbound_group',ingroup_recording_override='$ingroup_recording_override',ingroup_rec_filename='$ingroup_rec_filename',afterhours_xfer_group='$afterhours_xfer_group',qc_enabled='$qc_enabled',qc_statuses='$QC_statuses',qc_shift_id='$qc_shift_id',qc_get_record_launch='$qc_get_record_launch',qc_show_recording='$qc_show_recording',qc_web_form_address='$qc_web_form_address',qc_script='$qc_script',play_place_in_line='$play_place_in_line',play_estimate_hold_time='$play_estimate_hold_time',hold_time_option='$hold_time_option',hold_time_option_seconds='$hold_time_option_seconds',hold_time_option_exten='$hold_time_option_exten',hold_time_option_voicemail='$hold_time_option_voicemail',hold_time_option_xfer_group='$hold_time_option_xfer_group',hold_time_option_callback_filename='$hold_time_option_callback_filename',hold_time_option_callback_list_id='$hold_time_option_callback_list_id',hold_recall_xfer_group='$hold_recall_xfer_group',no_delay_call_route='$no_delay_call_route',play_welcome_message='$play_welcome_message',answer_sec_pct_rt_stat_one='$answer_sec_pct_rt_stat_one',answer_sec_pct_rt_stat_two='$answer_sec_pct_rt_stat_two',default_group_alias='$default_group_alias',no_agent_no_queue='$no_agent_no_queue',no_agent_action='$no_agent_action',no_agent_action_value='$no_agent_action_value',web_form_address_two='" . mysql_real_escape_string($web_form_address_two) . "',timer_action='$timer_action',timer_action_message='$timer_action_message',timer_action_seconds='$timer_action_seconds',start_call_url='" . mysql_real_escape_string($start_call_url) . "',dispo_call_url='" . mysql_real_escape_string($dispo_call_url) . "',xferconf_c_number='$xferconf_c_number',xferconf_d_number='$xferconf_d_number',xferconf_e_number='$xferconf_e_number' where group_id='$group_id';";
#			$stmt="UPDATE vicidial_inbound_groups set group_name='$group_name', group_color='$group_color', active='$active', web_form_address='" . mysql_real_escape_string($web_form_address) . "', voicemail_ext='$voicemail_ext', next_agent_call='$next_agent_call', fronter_display='$fronter_display', ingroup_script='$script_id', get_call_launch='$get_call_launch', xferconf_a_dtmf='$xferconf_a_dtmf',xferconf_a_number='$xferconf_a_number', xferconf_b_dtmf='$xferconf_b_dtmf',xferconf_b_number='$xferconf_b_number',drop_action='$drop_action',drop_call_seconds='$drop_call_seconds',drop_exten='$drop_exten',call_time_id='$call_time_id',after_hours_action='$after_hours_action',after_hours_message_filename='$after_hours_message_filename',after_hours_exten='$after_hours_exten',after_hours_voicemail='$after_hours_voicemail',welcome_message_filename='$welcome_message_filename',moh_context='$moh_context',onhold_prompt_filename='$onhold_prompt_filename',prompt_interval='$prompt_interval',agent_alert_exten='$agent_alert_exten',agent_alert_delay='$agent_alert_delay',default_xfer_group='$default_xfer_group',queue_priority='$queue_priority',drop_inbound_group='$drop_inbound_group',ingroup_recording_override='$ingroup_recording_override',ingroup_rec_filename='$ingroup_rec_filename',afterhours_xfer_group='$afterhours_xfer_group',qc_enabled='$qc_enabled',qc_statuses='$QC_statuses',qc_shift_id='$qc_shift_id',qc_get_record_launch='$qc_get_record_launch',qc_show_recording='$qc_show_recording',qc_web_form_address='$qc_web_form_address',qc_script='$qc_script',play_place_in_line='$play_place_in_line',play_estimate_hold_time='$play_estimate_hold_time',hold_time_option='$hold_time_option',hold_time_option_seconds='$hold_time_option_seconds',hold_time_option_exten='$hold_time_option_exten',hold_time_option_voicemail='$hold_time_option_voicemail',hold_time_option_xfer_group='$hold_time_option_xfer_group',hold_time_option_callback_filename='$hold_time_option_callback_filename',hold_time_option_callback_list_id='$hold_time_option_callback_list_id',hold_recall_xfer_group='$hold_recall_xfer_group',no_delay_call_route='$no_delay_call_route',play_welcome_message='$play_welcome_message',answer_sec_pct_rt_stat_one='$answer_sec_pct_rt_stat_one',answer_sec_pct_rt_stat_two='$answer_sec_pct_rt_stat_two',default_group_alias='$default_group_alias',no_agent_no_queue='$no_agent_no_queue',no_agent_action='$no_agent_action',no_agent_action_value='$no_agent_action_value',web_form_address_two='" . mysql_real_escape_string($web_form_address_two) . "',timer_action='$timer_action',timer_action_message='$timer_action_message',timer_action_seconds='$timer_action_seconds',start_call_url='" . mysql_real_escape_string($start_call_url) . "',dispo_call_url='" . mysql_real_escape_string($dispo_call_url) . "',xferconf_c_number='$xferconf_c_number',xferconf_d_number='$xferconf_d_number',xferconf_e_number='$xferconf_e_number',inbound_mode='$inbound_mode',ring_timeout_seconds=$ring_timeout_seconds,ring_timeout_action='$ring_timeout_action',ring_timeout_exten='$ring_timeout_exten',ring_timeout_voicemail_ext='$ring_timeout_voicemail_ext',ring_timeout_inbound_group='$ring_timeout_inbound_group' where group_id='$group_id';";
			$stmt="UPDATE vicidial_inbound_groups set group_name='$group_name', group_color='$group_color', active='$active', web_form_address='" . mysql_real_escape_string($web_form_address) . "', voicemail_ext='$voicemail_ext', next_agent_call='$next_agent_call', fronter_display='$fronter_display', ingroup_script='$script_id', get_call_launch='$get_call_launch', xferconf_a_dtmf='$xferconf_a_dtmf',xferconf_a_number='$xferconf_a_number', xferconf_b_dtmf='$xferconf_b_dtmf',xferconf_b_number='$xferconf_b_number',drop_action='$drop_action',drop_call_seconds='$drop_call_seconds',drop_exten='$drop_exten',call_time_id='$call_time_id',after_hours_action='$after_hours_action',after_hours_message_filename='$after_hours_message_filename',after_hours_exten='$after_hours_exten',after_hours_voicemail='$after_hours_voicemail',welcome_message_filename='$welcome_message_filename',moh_context='$moh_context',onhold_prompt_filename='$onhold_prompt_filename',prompt_interval='$prompt_interval',agent_alert_exten='$agent_alert_exten',agent_alert_delay='$agent_alert_delay',default_xfer_group='$default_xfer_group',queue_priority='$queue_priority',drop_inbound_group='$drop_inbound_group',drop_menu_id='$drop_menu_id',ingroup_recording_override='$ingroup_recording_override',ingroup_rec_filename='$ingroup_rec_filename',afterhours_xfer_group='$afterhours_xfer_group',qc_enabled='$qc_enabled',qc_statuses='$QC_statuses',qc_shift_id='$qc_shift_id',qc_get_record_launch='$qc_get_record_launch',qc_show_recording='$qc_show_recording',qc_web_form_address='$qc_web_form_address',qc_script='$qc_script',play_place_in_line='$play_place_in_line',play_language='$play_language',play_estimate_hold_time='$play_estimate_hold_time',hold_time_option='$hold_time_option',hold_time_option_seconds='$hold_time_option_seconds',hold_time_option_exten='$hold_time_option_exten',hold_time_option_voicemail='$hold_time_option_voicemail',hold_time_option_xfer_group='$hold_time_option_xfer_group',hold_time_option_callback_filename='$hold_time_option_callback_filename',hold_time_option_callback_list_id='$hold_time_option_callback_list_id',hold_recall_xfer_group='$hold_recall_xfer_group',no_delay_call_route='$no_delay_call_route',play_welcome_message='$play_welcome_message',answer_sec_pct_rt_stat_zero='$answer_sec_pct_rt_stat_zero',answer_sec_pct_rt_stat_one='$answer_sec_pct_rt_stat_one',answer_sec_pct_rt_stat_two='$answer_sec_pct_rt_stat_two',default_group_alias='$default_group_alias',no_agent_no_queue='$no_agent_no_queue',no_agent_action='$no_agent_action',no_agent_action_value='$no_agent_action_value',web_form_address_two='" . mysql_real_escape_string($web_form_address_two) . "',timer_action='$timer_action',timer_action_message='$timer_action_message',timer_action_seconds='$timer_action_seconds',start_call_url='" . mysql_real_escape_string($start_call_url) . "',dispo_call_url='" . mysql_real_escape_string($dispo_call_url) . "',xferconf_c_number='$xferconf_c_number',xferconf_d_number='$xferconf_d_number',xferconf_e_number='$xferconf_e_number',inbound_mode='$inbound_mode',ring_timeout_seconds=$ring_timeout_seconds,play_agent_info='$play_agent_info',ring_start_launch='$ring_start_launch',ring_form_address='$ring_form_address',ring_form_address_two='$ring_form_address_two',ring_ingroup_script='$ring_ingroup_script',agent_follow_up='$agent_follow_up',busy_transfer='$busy_transfer',busy_transfer_destination_group_id='$busy_transfer_destination_group_id',busy_transfer_available_agents='$busy_transfer_available_agents' where group_id='$group_id';";
		# echo $stmt;
# end
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='INGROUPS', event_type='MODIFY', record_id='$group_id', event_code='ADMIN MODIFY INGROUP', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=3111;	# go to in-group modification form below
	}


######################
# ADD=4311 modify did info in the system
######################

if ($ADD==4311)
	{
	if ($LOGmodify_dids==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($did_id) < 1) or (strlen($did_pattern) < 1) )
			{
			echo "<br>DID NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>did_extension must be at least 1 character in length\n";
			}
		else
			{
			echo "<br><B>DID MODIFIED: $did_pattern</B>\n";

			$stmt="UPDATE vicidial_inbound_dids set did_pattern='$did_pattern',did_description='$did_description',did_active='$did_active',did_route='$did_route',extension='$extension',exten_context='$exten_context',voicemail_ext='$voicemail_ext',phone='$phone',server_ip='$server_ip',user='$user',user_unavailable_action='$user_unavailable_action',user_route_settings_ingroup='$user_route_settings_ingroup',group_id='$group_id',call_handle_method='$call_handle_method',agent_search_method='$agent_search_method',list_id='$list_id',campaign_id='$campaign_id',phone_code='$phone_code',menu_id='$menu_id' where did_id='$did_id';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='DIDS', event_type='MODIFY', record_id='$did_id', event_code='ADMIN MODIFY DID', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=3311;	# go to did modification form below
	}


######################
# ADD=4511 modify IVR info in the system
######################

if ($ADD==4511)
	{
	if ($LOGmodify_dids==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if (strlen($menu_id) < 1)
			{
			echo "<br>IVR NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>menu_id must be at least 1 character in length\n";
			}
		else
			{
			echo "<br><B>IVR MODIFIED: $menu_id</B>\n";

			$stmt="UPDATE vicidial_call_menu set menu_name='$menu_name',menu_prompt='$menu_prompt',menu_timeout='$menu_timeout',menu_timeout_prompt='$menu_timeout_prompt',menu_invalid_prompt='$menu_invalid_prompt',menu_repeat='$menu_repeat',menu_time_check='$menu_time_check',call_time_id='$call_time_id',track_in_vdac='$track_in_vdac',custom_dialplan_entry='$custom_dialplan_entry',tracking_group='$tracking_group' where menu_id='$menu_id';";
			$rslt=mysql_query($stmt, $link);

			$h=0;
			$option_value_list='|';
			while ($h <= 18)
				{
				$option_value=''; $option_description=''; $option_route=''; $option_route_value=''; $option_route_value_context='';

				if (isset($_GET["option_value_$h"]))				{$option_value=$_GET["option_value_$h"];}
					elseif (isset($_POST["option_value_$h"]))		{$option_value=$_POST["option_value_$h"];}
				if (isset($_GET["option_description_$h"]))			{$option_description=$_GET["option_description_$h"];}
					elseif (isset($_POST["option_description_$h"]))	{$option_description=$_POST["option_description_$h"];}
				if (isset($_GET["option_route_$h"]))				{$option_route=$_GET["option_route_$h"];}
					elseif (isset($_POST["option_route_$h"]))		{$option_route=$_POST["option_route_$h"];}
				if (isset($_GET["option_route_value_$h"]))			{$option_route_value=$_GET["option_route_value_$h"];}
					elseif (isset($_POST["option_route_value_$h"]))	{$option_route_value=$_POST["option_route_value_$h"];}
				if (isset($_GET["option_route_value_context_$h"]))	{$option_route_value_context=$_GET["option_route_value_context_$h"];}
					elseif (isset($_POST["option_route_value_context_$h"]))	{$option_route_value_context=$_POST["option_route_value_context_$h"];}

				if ($option_route == "INGROUP")
					{
					if (isset($_GET["IGhandle_method_$h"]))				{$IGhandle_method=$_GET["IGhandle_method_$h"];}
						elseif (isset($_POST["IGhandle_method_$h"]))	{$IGhandle_method=$_POST["IGhandle_method_$h"];}
					if (isset($_GET["IGsearch_method_$h"]))				{$IGsearch_method=$_GET["IGsearch_method_$h"];}
						elseif (isset($_POST["IGsearch_method_$h"]))	{$IGsearch_method=$_POST["IGsearch_method_$h"];}
					if (isset($_GET["IGlist_id_$h"]))					{$IGlist_id=$_GET["IGlist_id_$h"];}
						elseif (isset($_POST["IGlist_id_$h"]))			{$IGlist_id=$_POST["IGlist_id_$h"];}
					if (isset($_GET["IGcampaign_id_$h"]))				{$IGcampaign_id=$_GET["IGcampaign_id_$h"];}
						elseif (isset($_POST["IGcampaign_id_$h"]))		{$IGcampaign_id=$_POST["IGcampaign_id_$h"];}
					if (isset($_GET["IGphone_code_$h"]))				{$IGphone_code=$_GET["IGphone_code_$h"];}
						elseif (isset($_POST["IGphone_code_$h"]))		{$IGphone_code=$_POST["IGphone_code_$h"];}

					$option_route_value_context = "$IGhandle_method,$IGsearch_method,$IGlist_id,$IGcampaign_id,$IGphone_code";
					}

				if ($non_latin < 1)
					{
					$option_value = ereg_replace("[^-\_0-9A-Z]","",$option_value);
					$option_description = ereg_replace("[^- \:\/\_0-9a-zA-Z]","",$option_description);
					$option_route = ereg_replace("[^-_0-9a-zA-Z]","",$option_route);
					$option_route_value = ereg_replace("[^-\/\|\_\#\*\,\.\_0-9a-zA-Z]","",$option_route_value);
					$option_route_value_context = ereg_replace("[^,-_0-9a-zA-Z]","",$option_route_value_context);
					}

				if (strlen($option_route) > 0)
					{
					$stmtA="SELECT count(*) from vicidial_call_menu_options where menu_id='$menu_id' and option_value='$option_value';";
					$rslt=mysql_query($stmtA, $link);
					$row=mysql_fetch_row($rslt);
					$option_exists = $row[0];

					if ($option_exists > 0)
						{
						$stmtA="UPDATE vicidial_call_menu_options SET option_description='$option_description',option_route='$option_route',option_route_value='$option_route_value',option_route_value_context='$option_route_value_context' where menu_id='$menu_id' and option_value='$option_value';";
						$rslt=mysql_query($stmtA, $link);
						$stmtAX .= "$stmtA|";
						}
					else
						{
						$stmtA="INSERT INTO vicidial_call_menu_options SET menu_id='$menu_id',option_value='$option_value',option_description='$option_description',option_route='$option_route',option_route_value='$option_route_value',option_route_value_context='$option_route_value_context';";
						$rslt=mysql_query($stmtA, $link);
						$stmtAX .= "$stmtA|";
						}
					}
				else
					{
					$stmtA="SELECT count(*) from vicidial_call_menu_options where menu_id='$menu_id' and option_value='$option_value';";
					$rslt=mysql_query($stmtA, $link);
					$row=mysql_fetch_row($rslt);
					$option_exists_db = $row[0];

					if ($option_exists_db > 0)
						{
						$stmtA="DELETE FROM vicidial_call_menu_options where menu_id='$menu_id' and option_value='$option_value';";
						$rslt=mysql_query($stmtA, $link);
						$stmtAX .= "$stmtA|";
						}
					}
				$option_value_list .= "$option_value|";
				$h++;
				}
			## delete existing database records that were not in the submit
			$h = 0;
			while ($h <= 18)
				{
				if (!preg_match("/\|$dtmf[$h]\|/i",$option_value_list))
					{
					$stmtA="SELECT count(*) from vicidial_call_menu_options where menu_id='$menu_id' and option_value='$dtmf[$h]';";
					$rslt=mysql_query($stmtA, $link);
					$row=mysql_fetch_row($rslt);
					$option_exists_db = $row[0];

					if ($option_exists_db > 0)
						{
						$stmtA="DELETE FROM vicidial_call_menu_options where menu_id='$menu_id' and option_value='$dtmf[$h]';";
						$rslt=mysql_query($stmtA, $link);
						$stmtAX .= "$stmtA|";
						}
					}
				$h++;
				}

			$stmtA="UPDATE servers set rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y';";
			$rslt=mysql_query($stmtA, $link);
			$stmtAX .= "$stmtA|";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|$stmtAX";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CALLMENUS', event_type='MODIFY', record_id='$menu_id', event_code='ADMIN MODIFY IVR', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=3511;	# go to IVR modification form below
	}


######################
# ADD=41111 modify remote agents info in the system
######################

if ($ADD==41111)
	{
	if ($LOGmodify_remoteagents==1)
		{
		$remoteagentgroup_id = $_REQUEST[remoteagentgroup_id];
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($server_ip) < 2) or (strlen($user_start) < 2)  or (strlen($campaign_id) < 2) or (strlen($conf_exten) < 2) )
			{
			echo "<br>REMOTE AGENTS NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>User ID Start and External Extension must be at least 2 characters in length\n";
			}
		else
			{
			$stmt="UPDATE vicidial_remote_agents set user_start='$user_start', number_of_lines='$number_of_lines', server_ip='$server_ip', conf_exten='$conf_exten', status='$status', campaign_id='$campaign_id',group_id='$remoteagentgroup_id' ,closer_campaigns='$groups_value' where remote_agent_id='$remote_agent_id';";
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>REMOTE AGENTS MODIFIED</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='REMOTEAGENTS', event_type='MODIFY', record_id='$remote_agent_id', event_code='ADMIN MODIFY REMOTE AGENT', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=31111;	# go to remote agents modification form below
	}


######################
# ADD=411111 modify user group info in the system
######################

if ($ADD==411111)
	{

	if ($LOGmodify_usergroups==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($user_group) < 2) or (strlen($group_name) < 2) )
			{
			echo "<br>USER GROUP NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>Group name and description must be at least 2 characters in length\n";
			}
		else
			{
			$p=0;
			$GROUP_shifts=' ';
			$group_shifts_ct = count($group_shifts);
			while ($p <= $group_shifts_ct)
				{
				$group_shifts[$p] = ereg_replace("[^ -_0-9a-zA-Z]","",$group_shifts[$p]);
				$GROUP_shifts .= "$group_shifts[$p] ";
				$p++;
				}
			$p=0;
			$VGROUP_vgroups=' ';
			$vgroup_vgroups_ct = count($agent_status_viewable_groups);
			while ($p <= $vgroup_vgroups_ct)
				{
				$agent_status_viewable_groups[$p] = ereg_replace("[^ -_0-9a-zA-Z]","",$agent_status_viewable_groups[$p]);
				$VGROUP_vgroups .= "$agent_status_viewable_groups[$p] ";
				$p++;
				}
			$stmt="UPDATE vicidial_user_groups set user_group='$user_group', group_name='$group_name',supervisor='$supervisor_select',manager='$manager_select',qa='$qa_select' where user_group='$OLDuser_group';";
			if($LOGuser_level>8){
				$stmt="UPDATE vicidial_user_groups set user_group='$user_group', group_name='$group_name',allowed_campaigns='$campaigns_value',qc_allowed_campaigns='$qc_campaigns_value',qc_allowed_inbound_groups='$qc_groups_value',group_shifts='$GROUP_shifts',forced_timeclock_login='$forced_timeclock_login',shift_enforcement='$shift_enforcement',agent_status_viewable_groups='$VGROUP_vgroups',agent_status_view_time='$agent_status_view_time',supervisor='$supervisor_select',manager='$manager_select',qa='$qa_select' where user_group='$OLDuser_group';";
			}
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>USER GROUP MODIFIED</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='USERGROUPS', event_type='MODIFY', record_id='$user_group', event_code='ADMIN MODIFY USER GROUP', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			###############################################################
			##### START SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			$stmt = "SELECT enable_vtiger_integration,vtiger_server_ip,vtiger_dbname,vtiger_login,vtiger_pass,vtiger_url FROM vicidial_campaigns where campaign_id='$campaign_id';";
//			echo $stmt."<br>";
			$rslt=mysql_query($stmt, $link);
			if ($DB) {echo "$stmt\n";}
			$ss_conf_ct = mysql_num_rows($rslt);
			if ($ss_conf_ct > 0)
				{
				$row=mysql_fetch_row($rslt);
				$enable_vtiger_integration =	$row[0];
				$vtiger_server_ip	=			$row[1];
				$vtiger_dbname =				$row[2];
				$vtiger_login =					$row[3];
				$vtiger_pass =					$row[4];
				$vtiger_url =					$row[5];
				}
			##### END SYSTEM_SETTINGS VTIGER CONNECTION INFO LOOKUP #####
			#############################################################

			if ($enable_vtiger_integration > 0)
				{

				### connect to your vtiger database
				$linkV=mysql_connect("$vtiger_server_ip", "$vtiger_login","$vtiger_pass");
				if (!$linkV) {die("Could not connect: $vtiger_server_ip|$vtiger_dbname|$vtiger_login|$vtiger_pass" . mysql_error());}
				echo 'Connected successfully';
				mysql_select_db("$vtiger_dbname", $linkV);

				######################################
				##### BEGIN Add/Update group info in Vtiger
				$stmt="SELECT count(*) from vtiger_groups where groupname='$user_group';";
				$rslt=mysql_query($stmt, $linkV);
				if ($DB) {echo "$stmt\n";}
				if (!$rslt) {die('Could not execute: ' . mysql_error());}
				$row=mysql_fetch_row($rslt);
				$group_found_count = $row[0];

				### group exists in vtiger, update it
				if ($group_found_count > 0)
					{
					$stmt="SELECT groupid from vtiger_groups where groupname='$user_group';";
					$rslt=mysql_query($stmt, $linkV);
					if ($DB) {echo "$stmt\n";}
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					$row=mysql_fetch_row($rslt);
					$groupid = $row[0];
					mysql_query("set names utf8");
					$stmtA = "UPDATE vtiger_groups SET description='$group_name' where groupid='$groupid';";
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					}

				### user doesn't exist in vtiger, insert it
				else
					{
					#### BEGIN CREATE NEW GROUP RECORD IN VTIGER
					# Get next available id from vtiger_users_seq to use as groupid
					$stmt="SELECT id from vtiger_users_seq;";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					$row=mysql_fetch_row($rslt);
					$groupid = ($row[0] + 1);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					# Increase next available groupid with 1 so next record gets proper id
					$stmt="UPDATE vtiger_users_seq SET id = '$groupid';";
					if ($DB) {echo "$stmt\n";}
					$rslt=mysql_query($stmt, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}
					mysql_query("set names utf8");
					$stmtA = "INSERT INTO vtiger_groups SET groupid='$groupid',groupname='$user_group',description='$group_name';";
					
					if ($DB) {echo "|$stmtA|\n";}
					$rslt=mysql_query($stmtA, $linkV);
					if (!$rslt) {die('Could not execute: ' . mysql_error());}

					#### END CREATE NEW GROUP RECORD IN VTIGER
					}
				##### END Add/Update group info in Vtiger
				######################################
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=311111;	# go to user group modification form below;
###### start Synchronize users with CRM 2011-09-20 add by pie;
	$stmt="SELECT ccms_url from system_settings;";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);
	$ccms_url_link = $row[0];
//	echo $ccms_url_link."<br>";
//	echo $user_group."<br>";
	$url_link = $ccms_url_link."integrate_vtiger_group.php?user_group=".$user_group;
//	echo $url_link."<br>";
	file("$url_link");
###### end Synchronize users with CRM 2011-09-20 add by pie;
	}


######################
# ADD=4111111 modify script in the system
######################

if ($ADD==4111111)
	{
	if ($LOGmodify_scripts==1)
		{
		echo "<!-- $script_text -->\n";
		echo "<!--" . mysql_real_escape_string($script_text) . " -->\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($script_id) < 2) or (strlen($script_name) < 2) or (strlen($script_text) < 2) )
			{
			echo "<br>SCRIPT NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>Script name, description and text must be at least 2 characters in length\n";
			}
		else
			{
			$stmt="UPDATE vicidial_scripts set script_name='$script_name', script_comments='$script_comments', script_text='" . mysql_real_escape_string($script_text) . "', active='$active' where script_id='$script_id';";
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>SCRIPT MODIFIED</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SCRIPTS', event_type='MODIFY', record_id='$script_id', event_code='ADMIN MODIFY SCRIPT', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=3111111;	# go to script modification form below
	}


######################
# ADD=41111111 modify filter in the system
######################

if ($ADD==41111111)
	{
	if ($LOGmodify_filters==1)
		{
		echo "<!-- $lead_filter_sql -->\n";
		echo "<!--" . mysql_real_escape_string($lead_filter_sql) . " -->\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($lead_filter_id) < 2) or (strlen($lead_filter_name) < 2) or (strlen($lead_filter_sql) < 2) )
			{
			echo "<br>FILTER NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>Filter ID, name and SQL must be at least 2 characters in length\n";
			}
		else
			{
			$stmt="UPDATE vicidial_lead_filters set lead_filter_name='$lead_filter_name', lead_filter_comments='$lead_filter_comments', lead_filter_sql='" . mysql_real_escape_string($lead_filter_sql) . "' where lead_filter_id='$lead_filter_id';";
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>FILTER MODIFIED</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='FILTERS', event_type='MODIFY', record_id='$lead_filter_id', event_code='ADMIN MODIFY FILTER', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=31111111;	# go to filter modification form below
	}


######################
# ADD=411111111 modify call time in the system
######################

if ($ADD==411111111)
	{
	if ($LOGmodify_call_times==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($call_time_id) < 2) or (strlen($call_time_name) < 2) )
			{
			echo "<br>CALL TIME NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>Call Time ID and name must be at least 2 characters in length\n";
			}
		else
			{
			$ct_default_start = preg_replace('/\D/', '', $ct_default_start);
			$ct_default_stop = preg_replace('/\D/', '', $ct_default_stop);
			$ct_sunday_start = preg_replace('/\D/', '', $ct_sunday_start);
			$ct_sunday_stop = preg_replace('/\D/', '', $ct_sunday_stop);
			$ct_monday_start = preg_replace('/\D/', '', $ct_monday_start);
			$ct_monday_stop = preg_replace('/\D/', '', $ct_monday_stop);
			$ct_tuesday_start = preg_replace('/\D/', '', $ct_tuesday_start);
			$ct_tuesday_stop = preg_replace('/\D/', '', $ct_tuesday_stop);
			$ct_wednesday_start = preg_replace('/\D/', '', $ct_wednesday_start);
			$ct_wednesday_stop = preg_replace('/\D/', '', $ct_wednesday_stop);
			$ct_thursday_start = preg_replace('/\D/', '', $ct_thursday_start);
			$ct_thursday_stop = preg_replace('/\D/', '', $ct_thursday_stop);
			$ct_friday_start = preg_replace('/\D/', '', $ct_friday_start);
			$ct_friday_stop = preg_replace('/\D/', '', $ct_friday_stop);
			$ct_saturday_start = preg_replace('/\D/', '', $ct_saturday_start);
			$ct_saturday_stop = preg_replace('/\D/', '', $ct_saturday_stop);
			$stmt="UPDATE vicidial_call_times set call_time_name='$call_time_name', call_time_comments='$call_time_comments', ct_default_start='$ct_default_start', ct_default_stop='$ct_default_stop', ct_sunday_start='$ct_sunday_start', ct_sunday_stop='$ct_sunday_stop', ct_monday_start='$ct_monday_start', ct_monday_stop='$ct_monday_stop', ct_tuesday_start='$ct_tuesday_start', ct_tuesday_stop='$ct_tuesday_stop', ct_wednesday_start='$ct_wednesday_start', ct_wednesday_stop='$ct_wednesday_stop', ct_thursday_start='$ct_thursday_start', ct_thursday_stop='$ct_thursday_stop', ct_friday_start='$ct_friday_start', ct_friday_stop='$ct_friday_stop', ct_saturday_start='$ct_saturday_start', ct_saturday_stop='$ct_saturday_stop' where call_time_id='$call_time_id';";
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>CALL TIME MODIFIED</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CALLTIMES', event_type='MODIFY', record_id='$call_time_id', event_code='ADMIN MODIFY CALL TIME', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=311111111;	# go to call time modification form below
	}


######################
# ADD=4111111111 modify state call time in the system
######################

if ($ADD==4111111111)
	{
	if ($LOGmodify_call_times==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($call_time_id) < 2) or (strlen($call_time_name) < 2) or (strlen($state_call_time_state) < 2) )
			{
			echo "<br>STATE CALL TIME NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>State Call Time ID, name and state must be at least 2 characters in length\n";
			}
		else
			{
			$ct_default_start = preg_replace('/\D/', '', $ct_default_start);
			$ct_default_stop = preg_replace('/\D/', '', $ct_default_stop);
			$ct_sunday_start = preg_replace('/\D/', '', $ct_sunday_start);
			$ct_sunday_stop = preg_replace('/\D/', '', $ct_sunday_stop);
			$ct_monday_start = preg_replace('/\D/', '', $ct_monday_start);
			$ct_monday_stop = preg_replace('/\D/', '', $ct_monday_stop);
			$ct_tuesday_start = preg_replace('/\D/', '', $ct_tuesday_start);
			$ct_tuesday_stop = preg_replace('/\D/', '', $ct_tuesday_stop);
			$ct_wednesday_start = preg_replace('/\D/', '', $ct_wednesday_start);
			$ct_wednesday_stop = preg_replace('/\D/', '', $ct_wednesday_stop);
			$ct_thursday_start = preg_replace('/\D/', '', $ct_thursday_start);
			$ct_thursday_stop = preg_replace('/\D/', '', $ct_thursday_stop);
			$ct_friday_start = preg_replace('/\D/', '', $ct_friday_start);
			$ct_friday_stop = preg_replace('/\D/', '', $ct_friday_stop);
			$ct_saturday_start = preg_replace('/\D/', '', $ct_saturday_start);
			$ct_saturday_stop = preg_replace('/\D/', '', $ct_saturday_stop);
			$stmt="UPDATE vicidial_state_call_times set state_call_time_name='$call_time_name', state_call_time_comments='$call_time_comments', sct_default_start='$ct_default_start', sct_default_stop='$ct_default_stop', sct_sunday_start='$ct_sunday_start', sct_sunday_stop='$ct_sunday_stop', sct_monday_start='$ct_monday_start', sct_monday_stop='$ct_monday_stop', sct_tuesday_start='$ct_tuesday_start', sct_tuesday_stop='$ct_tuesday_stop', sct_wednesday_start='$ct_wednesday_start', sct_wednesday_stop='$ct_wednesday_stop', sct_thursday_start='$ct_thursday_start', sct_thursday_stop='$ct_thursday_stop', sct_friday_start='$ct_friday_start', sct_friday_stop='$ct_friday_stop', sct_saturday_start='$ct_saturday_start', sct_saturday_stop='$ct_saturday_stop', state_call_time_state='$state_call_time_state'  where state_call_time_id='$call_time_id';";
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>STATE CALL TIME MODIFIED</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CALLTIMES', event_type='MODIFY', record_id='$call_time_id', event_code='ADMIN MODIFY STATE CALL TIME', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=3111111111;	# go to state call time modification form below
	}


######################
# ADD=431111111 modify shift in the system
######################

if ($ADD==431111111)
	{
	if ($LOGmodify_call_times==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$shift_length_test = eregi_replace(':','',$shift_length);
		if ( (strlen($shift_id) < 2) or (strlen($shift_name) < 2) or (strlen($shift_start_time) < 4) or (strlen($shift_start_time) > 4) or (strlen($shift_length) < 5) or (strlen($shift_length) > 5) or ($shift_start_time > 2359) or ($shift_length_test > 2400) )
			{
			echo "<br>SHIFT DEFINITION NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>Shift ID and name must be at least 2 characters in length\n";
			echo "<br>Shift Start Time must be 4 digits in length and be a valid time\n";
			echo "<br>Shift Length must be 5 characters in length and be 24 hours or less\n";
			}
		else
			{
			$p=0;
			$shift_weekdays_ct = count($shift_weekdays);
			while ($p <= $shift_weekdays_ct)
				{
				$SHIFT_weekdays .= "$shift_weekdays[$p]";
				$p++;
				}
			$shift_start_time = preg_replace('/\D/', '', $shift_start_time);
			$stmt="UPDATE vicidial_shifts set shift_name='$shift_name', shift_start_time='$shift_start_time', shift_length='$shift_length', shift_weekdays='$SHIFT_weekdays' where shift_id='$shift_id';";
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>SHIFT MODIFIED</B>\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SHIFTS', event_type='MODIFY', record_id='$shift_id', event_code='ADMIN MODIFY SHIFT', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=331111111;	# go to shift modification form below
	}


######################
# ADD=41111111111 modify phone record in the system
######################

if ($ADD==41111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT count(*) from phones where extension='$extension' and server_ip='$server_ip';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ( ($row[0] > 0) && ( ($extension != $old_extension) or ($server_ip != $old_server_ip) ) )
			{echo "<br>PHONE NOT MODIFIED - there is already a Phone in the system with this extension/server\n";}
		else
			{
			if ( (strlen($extension) < 1) or (strlen($server_ip) < 7) or (strlen($dialplan_number) < 1) or (strlen($login) < 1)  or (strlen($pass) < 1))
				{echo "<br>PHONE NOT MODIFIED - Please go back and look at the data you entered\n";}
			else
				{
				echo "<br>PHONE MODIFIED: $extension\n";

				$stmt="UPDATE phones set extension='$extension', dialplan_number='$dialplan_number', voicemail_id='$voicemail_id', phone_ip='$phone_ip', computer_ip='$computer_ip', server_ip='$server_ip', login='$login', pass='$pass', status='$status', active='$active', phone_type='$phone_type', fullname='$fullname', company='$company', picture='$picture', protocol='$protocol', local_gmt='$local_gmt', ASTmgrUSERNAME='$ASTmgrUSERNAME', ASTmgrSECRET='$ASTmgrSECRET', login_user='$login_user', login_pass='$login_pass', login_campaign='$login_campaign', park_on_extension='$park_on_extension', conf_on_extension='$conf_on_extension', VICIDIAL_park_on_extension='$VICIDIAL_park_on_extension', VICIDIAL_park_on_filename='$VICIDIAL_park_on_filename', monitor_prefix='$monitor_prefix', recording_exten='$recording_exten', voicemail_exten='$voicemail_exten', voicemail_dump_exten='$voicemail_dump_exten', ext_context='$ext_context', dtmf_send_extension='$dtmf_send_extension', call_out_number_group='$call_out_number_group', client_browser='$client_browser', install_directory='$install_directory', local_web_callerID_URL='" . mysql_real_escape_string($local_web_callerID_URL) . "', VICIDIAL_web_URL='" . mysql_real_escape_string($VICIDIAL_web_URL) . "', AGI_call_logging_enabled='$AGI_call_logging_enabled', user_switching_enabled='$user_switching_enabled', conferencing_enabled='$conferencing_enabled', admin_hangup_enabled='$admin_hangup_enabled', admin_hijack_enabled='$admin_hijack_enabled', admin_monitor_enabled='$admin_monitor_enabled', call_parking_enabled='$call_parking_enabled', updater_check_enabled='$updater_check_enabled', AFLogging_enabled='$AFLogging_enabled', QUEUE_ACTION_enabled='$QUEUE_ACTION_enabled', CallerID_popup_enabled='$CallerID_popup_enabled', voicemail_button_enabled='$voicemail_button_enabled', enable_fast_refresh='$enable_fast_refresh', fast_refresh_rate='$fast_refresh_rate', enable_persistant_mysql='$enable_persistant_mysql', auto_dial_next_number='$auto_dial_next_number', VDstop_rec_after_each_call='$VDstop_rec_after_each_call', DBX_server='$DBX_server', DBX_database='$DBX_database', DBX_user='$DBX_user', DBX_pass='$DBX_pass', DBX_port='$DBX_port', DBY_server='$DBY_server', DBY_database='$DBY_database', DBY_user='$DBY_user', DBY_pass='$DBY_pass', DBY_port='$DBY_port', outbound_cid='$outbound_cid', enable_sipsak_messages='$enable_sipsak_messages', email='$email', template_id='$template_id', conf_override='$conf_override',phone_context='$phone_context',phone_ring_timeout='$phone_ring_timeout',conf_secret='$conf_secret', delete_vm_after_email='$delete_vm_after_email' where extension='$old_extension' and server_ip='$old_server_ip';";
				$rslt=mysql_query($stmt, $link);

				$stmtA="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y' and server_ip='$server_ip';";
				$rslt=mysql_query($stmtA, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='PHONES', event_type='MODIFY', record_id='$extension', event_code='ADMIN MODIFY PHONE', event_sql=\"$SQL_log\", event_notes='Server IP: $server_ip';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=31111111111;	# go to phone modification form below
	}


######################
# ADD=42111111111 modify phone alias record in the system
######################

if ($ADD==42111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT count(*) from phones_alias where alias_id='$alias_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ( (strlen($alias_id) < 1) or (strlen($alias_name) < 2) )
			{echo "<br>PHONE ALIAS NOT MODIFIED - Please go back and look at the data you entered\n";}
		else
			{
			echo "<br>PHONE ALIAS MODIFIED: $alias_id\n";

			$stmt="UPDATE phones_alias set alias_name='$alias_name', logins_list='$logins_list' where alias_id='$alias_id';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='PHONEALIASES', event_type='MODIFY', record_id='$alias_id', event_code='ADMIN MODIFY PHONE ALIAS', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=32111111111;	# go to phone alias modification form below
	}


######################
# ADD=43111111111 modify group alias record in the system
######################

if ($ADD==43111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT count(*) from groups_alias where group_alias_id='$group_alias_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ( (strlen($group_alias_id) < 1) or (strlen($group_alias_name) < 2) )
			{echo "<br>GROUP ALIAS NOT MODIFIED - Please go back and look at the data you entered\n";}
		else
			{
			echo "<br>GROUP ALIAS MODIFIED: $alias_id\n";

			$stmt="UPDATE groups_alias set group_alias_name='$group_alias_name', caller_id_number='$caller_id_number', caller_id_name='$caller_id_name', active='$active' where group_alias_id='$group_alias_id';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='GROUPALIASES', event_type='MODIFY', record_id='$group_alias_id', event_code='ADMIN MODIFY GROUP ALIAS', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=33111111111;	# go to group alias modification form below
	}


######################
# ADD=411111111111 modify server record in the system
######################

if ($ADD==411111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT count(*) from servers where server_id='$server_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ( ($row[0] > 0) && ($server_id != $old_server_id) )
			{echo "<br>SERVER NOT MODIFIED - there is already a server in the system with this server_id\n";}
		else
			{
			$stmt="SELECT count(*) from servers where server_ip='$server_ip';";
			$rslt=mysql_query($stmt, $link);
			$row=mysql_fetch_row($rslt);
			if ( ($row[0] > 0) && ($server_ip != $old_server_ip) )
				{echo "<br>SERVER NOT MODIFIED - there is already a server in the system with this server_ip\n";}
			else
				{
				if ( (strlen($server_id) < 1) or (strlen($server_ip) < 7) )
					{echo "<br>SERVER NOT MODIFIED - Please go back and look at the data you entered\n";}
				else
					{
					$stmt="UPDATE servers set server_id='$server_id',server_description='$server_description',server_ip='$server_ip',active='$active',asterisk_version='$asterisk_version', max_vicidial_trunks='$max_vicidial_trunks', telnet_host='$telnet_host', telnet_port='$telnet_port', ASTmgrUSERNAME='$ASTmgrUSERNAME', ASTmgrSECRET='$ASTmgrSECRET', ASTmgrUSERNAMEupdate='$ASTmgrUSERNAMEupdate', ASTmgrUSERNAMElisten='$ASTmgrUSERNAMElisten', ASTmgrUSERNAMEsend='$ASTmgrUSERNAMEsend', local_gmt='$local_gmt', voicemail_dump_exten='$voicemail_dump_exten', answer_transfer_agent='$answer_transfer_agent', ext_context='$ext_context', sys_perf_log='$sys_perf_log', vd_server_logs='$vd_server_logs', agi_output='$agi_output', vicidial_balance_active='$vicidial_balance_active',balance_trunks_offlimits='$balance_trunks_offlimits',recording_web_link='$recording_web_link',alt_server_ip='$alt_server_ip',active_asterisk_server='$active_asterisk_server',generate_vicidial_conf='$generate_vicidial_conf',rebuild_conf_files='$rebuild_conf_files',outbound_calls_per_second='$outbound_calls_per_second',sounds_update='$sounds_update',vicidial_recording_limit='$vicidial_recording_limit',carrier_logging_active='$carrier_logging_active',vicidial_balance_rank='$vicidial_balance_rank',rebuild_music_on_hold='$rebuild_music_on_hold',active_agent_login_server='$active_agent_login_server',conf_secret='$conf_secret' where server_id='$old_server_id';";
					$rslt=mysql_query($stmt, $link);

					$stmtA="UPDATE servers SET rebuild_conf_files='Y',rebuild_music_on_hold='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y';";
					$rslt=mysql_query($stmtA, $link);

					echo "<br>SERVER MODIFIED: $server_ip\n";

					### LOG INSERTION Admin Log Table ###
					$SQL_log = "$stmt|";
					$SQL_log = ereg_replace(';','',$SQL_log);
					$SQL_log = addslashes($SQL_log);
					$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SERVERS', event_type='MODIFY', record_id='$server_id', event_code='ADMIN MODIFY SERVER', event_sql=\"$SQL_log\", event_notes='';";
					if ($DB) {echo "|$stmt|\n";}
					$rslt=mysql_query($stmt, $link);
					}
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=311111111111;	# go to server modification form below
	}


######################
# ADD=421111111111 modify CCMS server trunks record in the system
######################

if ($ADD==421111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
		$stmt="SELECT max_vicidial_trunks from servers where server_ip='$server_ip';";
		$rslt=mysql_query($stmt, $link);
		$rowx=mysql_fetch_row($rslt);
		$MAXvicidial_trunks = $rowx[0];
		
		$stmt="SELECT sum(dedicated_trunks) from vicidial_server_trunks where server_ip='$server_ip' and campaign_id !='$campaign_id';";
		$rslt=mysql_query($stmt, $link);
		$rowx=mysql_fetch_row($rslt);
		$SUMvicidial_trunks = ($rowx[0] + $dedicated_trunks);
		
		if ($SUMvicidial_trunks > $MAXvicidial_trunks)
			{
			echo "<br>CCMS SERVER TRUNK RECORD NOT ADDED - the number of CCMS trunks is too high: $SUMvicidial_trunks / $MAXvicidial_trunks\n";
			}
		else
			{
			if ( (strlen($campaign_id) < 2) or (strlen($server_ip) < 7) or (strlen($dedicated_trunks) < 1) or (strlen($trunk_restriction) < 1) )
				{
				echo "<br>CCMS SERVER TRUNK RECORD NOT MODIFIED - Please go back and look at the data you entered\n";
				echo "<br>campaign must be between 3 and 8 characters in length\n";
				echo "<br>server_ip delay must be at least 7 characters\n";
				echo "<br>trunks must be a digit from 0 to 9999\n";
				}
			else
				{
				$stmt="UPDATE vicidial_server_trunks SET dedicated_trunks='$dedicated_trunks',trunk_restriction='$trunk_restriction' where campaign_id='$campaign_id' and server_ip='$server_ip';";
				$rslt=mysql_query($stmt, $link);

				echo "<br><B>CCMS SERVER TRUNK RECORD MODIFIED: $campaign_id - $server_ip - $dedicated_trunks - $trunk_restriction</B>\n";

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SERVERTRUNKS', event_type='MODIFY', record_id='$server_ip', event_code='ADMIN MODIFY SERVER TRUNK', event_sql=\"$SQL_log\", event_notes='Campaign: $campaign_id';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=311111111111;	# go to server modification form below
	}


######################
# ADD=431111111111 modify conf template record in the system
###################### '$template_id','$template_name','$template_contents'

if ($ADD==431111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($template_id) < 1) or (strlen($template_name) < 1) )
			{echo "<br>CONF TEMPLATE NOT MODIFIED - Please go back and look at the data you entered\n";}
		else
			{
			$stmt="UPDATE vicidial_conf_templates set template_name='$template_name',template_contents='$template_contents' where template_id='$template_id';";
			$rslt=mysql_query($stmt, $link);

			$stmtA="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y';";
			$rslt=mysql_query($stmtA, $link);

			echo "<br>CONF TEMPLATE MODIFIED: $template_id\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CONFTEMPLATES', event_type='MODIFY', record_id='$template_id', event_code='ADMIN MODIFY CONF TEMPLATE', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=331111111111;	# go to conf template modification form below
	}


######################
# ADD=441111111111 modify carrier record in the system
######################

if ($ADD==441111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($carrier_id) < 1) or (strlen($server_ip) < 7) or (strlen($protocol) < 1) )
			{echo "<br>CARRIER NOT MODIFIED - Please go back and look at the data you entered\n";}
		else
			{
			$stmt="UPDATE vicidial_server_carriers set carrier_name='$carrier_name',registration_string='$registration_string',template_id='$template_id',account_entry='$account_entry',protocol='$protocol',globals_string='$globals_string',dialplan_entry='$dialplan_entry',server_ip='$server_ip',active='$active',carrier_description='$carrier_description' where carrier_id='$carrier_id';";
			$rslt=mysql_query($stmt, $link);

			$stmtA="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y' and server_ip='$server_ip';";
			$rslt=mysql_query($stmtA, $link);

			echo "<br>CARRIER MODIFIED: $carrier_id\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CARRIERS', event_type='MODIFY', record_id='$carrier_id', event_code='ADMIN MODIFY CARRIER', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=341111111111;	# go to carrier modification form below
	}


######################
# ADD=451111111111 modify tts record in the system
######################

if ($ADD==451111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($tts_id) < 2) or (strlen($tts_name) < 5) )
			{echo "<br>TTS ENTRY NOT MODIFIED - Please go back and look at the data you entered\n";}
		else
			{
			$stmt="UPDATE vicidial_tts_prompts set tts_name='$tts_name',active='$active',tts_text=\"$tts_text\" where tts_id='$tts_id';";
			$rslt=mysql_query($stmt, $link);

			echo "<br>TTS ENTRY MODIFIED: $tts_id\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='TTS', event_type='MODIFY', record_id='$tts_id', event_code='ADMIN MODIFY TTS', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=351111111111;	# go to tts entry modification form below
	}


######################
# ADD=461111111111 modify music on hold record in the system
######################

if ($ADD==461111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ($stage == "FILEDELETE")
			{
			if ( (strlen($moh_id) < 2) or (strlen($filename) < 1) or ($moh_id=='sounds') or ($moh_id=='agi-bin') or ($moh_id=='astdb') or ($moh_id=='keys') )
				{echo "<br>MUSIC ON HOLD ENTRY NOT MODIFIED - Please go back and look at the data you entered\n";}
			else
				{
				$stmt="DELETE FROM vicidial_music_on_hold_files where moh_id='$moh_id' and filename='$filename';";
				$rslt=mysql_query($stmt, $link);

				$stmtA="UPDATE servers SET rebuild_conf_files='Y',rebuild_music_on_hold='Y',sounds_update='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y';";
				$rslt=mysql_query($stmtA, $link);

				echo "<br>MUSIC ON HOLD ENTRY MODIFIED: $moh_id - $filename\n";

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|$stmtA|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='MOH', event_type='MODIFY', record_id='$moh_id', event_code='ADMIN MODIFY MOH', event_sql=\"$SQL_log\", event_notes='FILE DELETE';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		else
			{
			if ( (strlen($moh_id) < 2) or (strlen($moh_name) < 5) or ($moh_id=='sounds') or ($moh_id=='agi-bin') or ($moh_id=='astdb') or ($moh_id=='keys') )
				{echo "<br>MUSIC ON HOLD ENTRY NOT MODIFIED - Please go back and look at the data you entered\n";}
			else
				{
				$stmt="UPDATE vicidial_music_on_hold set moh_name='$moh_name',active='$active',random='$random' where moh_id='$moh_id';";
				$rslt=mysql_query($stmt, $link);
				$stmtLIST = $stmt;

				$stmt="SELECT filename,rank from vicidial_music_on_hold_files where moh_id='$moh_id' order by rank;";
				$rsltx=mysql_query($stmt, $link);
				$mohfiles_to_print = mysql_num_rows($rsltx);
				$ranks = ($mohfiles_to_print + 1);
				$o=0;
				while ($mohfiles_to_print > $o)
					{
					$rowx=mysql_fetch_row($rsltx);
					$mohfiles[$o] = $rowx[0];
					$mohranks[$o] = $rowx[1];
					$o++;
					}

				$o=0;
				while ($mohfiles_to_print > $o)
					{
					$new_rank=0;
					$Ffilename = $mohfiles[$o];
					if (isset($_GET[$Ffilename]))			{$new_rank=$_GET[$Ffilename];}
						elseif (isset($_POST[$Ffilename]))	{$new_rank=$_POST[$Ffilename];}

					$stmt="UPDATE vicidial_music_on_hold_files set rank='$new_rank' where moh_id='$moh_id' and filename='$mohfiles[$o]';";
					$rslt=mysql_query($stmt, $link);
					$stmtLIST .= "|$stmt";
					$o++;
					}

				if (strlen($filename) > 0)
					{
					$stmt="INSERT INTO vicidial_music_on_hold_files set filename='$filename',rank='$ranks',moh_id='$moh_id';";
					$rslt=mysql_query($stmt, $link);
					$stmtLIST .= "|$stmt";
					}

				$stmtA="UPDATE servers SET rebuild_conf_files='Y',rebuild_music_on_hold='Y',sounds_update='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y';";
				$rslt=mysql_query($stmtA, $link);

				echo "<br>MUSIC ON HOLD ENTRY MODIFIED: $moh_id\n";

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmtLIST|$stmtA|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='MOH', event_type='MODIFY', record_id='$moh_id', event_code='ADMIN MODIFY MOH', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=361111111111;	# go to music on hold entry modification form below
	}


######################
# ADD=471111111111 modify voicemail record in the system
######################

if ($ADD==471111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($voicemail_id) < 2) or (strlen($fullname) < 2) )
			{echo "<br>VOICEMAIL BOX NOT MODIFIED - Please go back and look at the data you entered\n";}
		else
			{
			$stmt="UPDATE vicidial_voicemail set fullname='$fullname',active='$active',pass='$pass',email='$email',delete_vm_after_email='$delete_vm_after_email' where voicemail_id='$voicemail_id';";
			$rslt=mysql_query($stmt, $link);

			$stmt="SELECT active_voicemail_server from system_settings;";
			$rslt=mysql_query($stmt, $link);
			$row=mysql_fetch_row($rslt);
			$active_voicemail_server = $row[0];

			$stmtA="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y' and server_ip='$active_voicemail_server';";
			$rslt=mysql_query($stmtA, $link);

			echo "<br>VOICEMAIL BOX MODIFIED: $voicemail_id\n";

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='VOICEMAIL', event_type='MODIFY', record_id='$voicemail_id', event_code='ADMIN MODIFY VOICEMAIL', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=371111111111;	# go to voicemail entry modification form below
	}


######################
# ADD=4111111111111 modify conference record in the system
######################

if ($ADD==4111111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT count(*) from conferences where conf_exten='$conf_exten' and server_ip='$server_ip';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ( ($row[0] > 0) && ( ($conf_exten != $old_conf_exten) or ($server_ip != $old_server_ip) ) )
			{echo "<br>CONFERENCE NOT MODIFIED - there is already a Conference in the system with this extension-server\n";}
		else
			{
			if ( (strlen($conf_exten) < 1) or (strlen($server_ip) < 7) )
				{echo "<br>CONFERENCE NOT MODIFIED - Please go back and look at the data you entered\n";}
			else
				{
				echo "<br>CONFERENCE MODIFIED: $conf_exten\n";

				$stmt="UPDATE conferences set conf_exten='$conf_exten',server_ip='$server_ip',extension='$extension' where conf_exten='$old_conf_exten';";
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=3111111111111;	# go to conference modification form below
	}


######################
# ADD=41111111111111 modify CCMS conference record in the system
######################

if ($ADD==41111111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT count(*) from vicidial_conferences where conf_exten='$conf_exten' and server_ip='$server_ip';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ( ($row[0] > 0) && ( ($conf_exten != $old_conf_exten) or ($server_ip != $old_server_ip) ) )
			{echo "<br>CCMS CONFERENCE NOT MODIFIED - there is already a Conference in the system with this extension-server\n";}
		else
			{
			if ( (strlen($conf_exten) < 1) or (strlen($server_ip) < 7) )
				{echo "<br>CCMS CONFERENCE NOT MODIFIED - Please go back and look at the data you entered\n";}
			else
				{
				echo "<br>CCMS CONFERENCE MODIFIED: $conf_exten\n";

				$stmt="UPDATE vicidial_conferences set conf_exten='$conf_exten',server_ip='$server_ip',extension='$extension' where conf_exten='$old_conf_exten';";
				$rslt=mysql_query($stmt, $link);

				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=31111111111111;	# go to CCMS conference modification form below
	}


######################
# ADD=411111111111111 modify CCMS system settings
######################

if ($ADD==411111111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>CCMS SYSTEM SETTINGS MODIFIED\n";

		$stmt="UPDATE system_settings set use_non_latin='$use_non_latin',webroot_writable='$webroot_writable',enable_queuemetrics_logging='$enable_queuemetrics_logging',queuemetrics_server_ip='$queuemetrics_server_ip',queuemetrics_dbname='$queuemetrics_dbname',queuemetrics_login='$queuemetrics_login',queuemetrics_pass='$queuemetrics_pass',queuemetrics_url='$queuemetrics_url',queuemetrics_log_id='$queuemetrics_log_id',queuemetrics_eq_prepend='$queuemetrics_eq_prepend',vicidial_agent_disable='$vicidial_agent_disable',allow_sipsak_messages='$allow_sipsak_messages',admin_home_url='$admin_home_url',enable_agc_xfer_log='$enable_agc_xfer_log',timeclock_end_of_day='$timeclock_end_of_day',vdc_header_date_format='$vdc_header_date_format',vdc_customer_date_format='$vdc_customer_date_format',vdc_header_phone_format='$vdc_header_phone_format',vdc_agent_api_active='$vdc_agent_api_active',enable_vtiger_integration='$enable_vtiger_integration',vtiger_server_ip='$vtiger_server_ip',vtiger_dbname='$vtiger_dbname',vtiger_login='$vtiger_login',vtiger_pass='$vtiger_pass',vtiger_url='$vtiger_url',qc_features_active='$qc_features_active',outbound_autodial_active='$outbound_autodial_active',outbound_calls_per_second='$outbound_calls_per_second',enable_tts_integration='$enable_tts_integration',agentonly_callback_campaign_lock='$agentonly_callback_campaign_lock',sounds_central_control_active='$sounds_central_control_active',sounds_web_server='$sounds_web_server',sounds_web_directory='$sounds_web_directory',active_voicemail_server='$active_voicemail_server',auto_dial_limit='$auto_dial_limit',user_territories_active='$user_territories_active',allow_custom_dialplan='$allow_custom_dialplan',enable_second_webform='$enable_second_webform',ccms_report_url='$ccms_report_url',ccms_url='$ccms_url';";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SYSTEMSETTINGS', event_type='MODIFY', record_id='system_settings', event_code='ADMIN MODIFY SYSTEM SETTINGS', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=311111111111111;	# go to CCMS system settings form below
	}


######################
# ADD=421111111111111 modify/delete system status in the system
######################

if ($ADD==421111111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if (ereg('delete',$stage))
			{
			if ( (strlen($status) < 1) or (preg_match("/^B$|^NA$|^DNC$|^NA$|^DROP$|^INCALL$|^QUEUE$|^NEW$/i",$status)) )
				{
				echo "<br>SYSTEM STATUS NOT DELETED - Please go back and look at the data you entered\n";
				echo "<br>the system status cannot be a reserved status: B,NA,DNC,NA,DROP,INCALL,QUEUE,NEW\n";
				echo "<br>the system status needs to be at least 1 characters in length\n";
				}
			else
				{
				echo "<br><B>SYSTEM STATUS DELETED: $status</B>\n";

				$stmt="DELETE FROM vicidial_statuses where status='$status';";
				$rslt=mysql_query($stmt, $link);

				$stmtA="DELETE FROM vicidial_campaign_hotkeys where status='$status';";
				$rslt=mysql_query($stmtA, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SYSTEMSTATUSES', event_type='DELETE', record_id='$status', event_code='ADMIN DELETE SYSTEM STATUS', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		if (ereg('modify',$stage))
			{
			if ( (strlen($status) < 1) or (strlen($status_name) < 2) )
				{
				echo "<br>SYSTEM STATUS NOT MODIFIED - Please go back and look at the data you entered\n";
				echo "<br>the system status needs to be at least 1 characters in length\n";
				echo "<br>the system status name needs to be at least 1 characters in length\n";
				}
			else
				{
				echo "<br><B>SYSTEM STATUS MODIFIED: $status</B>\n";

				$stmt="UPDATE vicidial_statuses SET class='$status_class',status_name='$status_name',selectable='$selectable',human_answered='$human_answered',category='$category',sale='$sale',dnc='$dnc',customer_contact='$customer_contact',not_interested='$not_interested',unworkable='$unworkable',status_type='$status_type' where status='$status';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SYSTEMSTATUSES', event_type='MODIFY', record_id='$status', event_code='ADMIN MODIFY SYSTEM STATUS', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=321111111111111;	# go to system settings modification form below
	}


######################
# ADD=431111111111111 modify/delete status category in the system
######################

if ($ADD==431111111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($vsc_id) < 2)  or (preg_match("/^UNDEFINED$/i",$vsc_id)) )
			{
			echo "<br>STATUS CATEGORY NOT MODIFIED - Please go back and look at the data you entered\n";
			echo "<br>the status category cannot be a reserved category: UNDEFINED\n";
			echo "<br>the status category needs to be at least 2 characters in length\n";
			}
		else
			{
			if (ereg('delete',$stage))
				{
				echo "<br><B>STATUS CATEGORY DELETED: $vsc_id</B>\n";

				$stmt="DELETE FROM vicidial_status_categories where vsc_id='$vsc_id';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='STATUSCATEGORIES', event_type='DELETE', record_id='$vsc_id', event_code='ADMIN DELETE STATUS CATEGORY', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			if (ereg('modify',$stage))
				{
				echo "<br><B>STATUS CATEGORY MODIFIED: $vsc_id</B>\n";

				$stmt="SELECT count(*) from vicidial_status_categories where tovdad_display='Y' and vsc_id NOT IN('$vsc_id');";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);
				if ( ($row[0] > 3) and (ereg('Y',$tovdad_display)) )
					{
					$tovdad_display = 'N';
					echo "<br><B>ERROR: There are already 4 Status Categories set to TimeOnVDAD Display</B>\n";
					}

				$stmt="UPDATE vicidial_status_categories SET vsc_name='$vsc_name',vsc_description='$vsc_description',tovdad_display='$tovdad_display',sale_category='$sale_category',dead_lead_category='$dead_lead_category' where vsc_id='$vsc_id';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='STATUSCATEGORIES', event_type='MODIFY', record_id='$vsc_id', event_code='ADMIN MODIFY STATUS CATEGORY', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=331111111111111;	# go to system settings modification form below
	}

######################
# ADD=431111111111111222 modify/delete status category in the system
######################

if ($ADD==431111111111111222)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if (strlen($vsc_id) < 0)
			{
			echo "<br>System Call Result Type NOT MODIFIED - Please go back and look at the data you entered\n";
			}
		else
			{
			if (ereg('delete',$stage))
				{
				echo "<br><B>System Call Result Type DELETED: $vsc_id</B>\n";

				$stmt="DELETE FROM vicidial_status_type where type='$vsc_id';";
				$rslt=mysql_query($stmt, $link);

				}
			if (ereg('modify',$stage))
				{
				echo "<br><B>System Call Result Type MODIFIED: $vsc_id</B>\n";

				$stmt="UPDATE vicidial_status_type SET typedescription='$vsc_name',active='$tovdad_display' where type='$vsc_id';";
				$rslt=mysql_query($stmt, $link);

				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=331111111111111222;	# go to system settings modification form below
	}

######################
# ADD=441111111111111 modify/delete qc status code in the system
######################

if ($ADD==441111111111111)
	{
	if ( ($LOGmodify_servers==1) and ($SSqc_features_active > 0) )
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if (ereg('delete',$stage))
			{
			if ( (strlen($code) < 1) or (preg_match("/^B$|^NA$|^DNC$|^NA$|^DROP$|^INCALL$|^QUEUE$|^NEW$/i",$code)) )
				{
				echo "<br>QC STATUS CODE NOT DELETED - Please go back and look at the data you entered\n";
				echo "<br>the qc status code cannot be a reserved status: B,NA,DNC,NA,DROP,INCALL,QUEUE,NEW\n";
				echo "<br>the qc status code needs to be at least 1 characters in length\n";
				}
			else
				{
				echo "<br><B>QC STATUS CODE DELETED: $code</B>\n";

				$stmt="DELETE FROM vicidial_qc_codes where code='$code';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='QCCODES', event_type='DELETE', record_id='$vsc_id', event_code='ADMIN DELETE QC CODES', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		if (ereg('modify',$stage))
			{
			if ( (strlen($code) < 1) or (strlen($code_name) < 2) )
				{
				echo "<br>QC STATUS CODE NOT MODIFIED - Please go back and look at the data you entered\n";
				echo "<br>the qc status code needs to be at least 1 characters in length\n";
				echo "<br>the qc status code name needs to be at least 1 characters in length\n";
				}
			else
				{
				echo "<br><B>QC STATUS CODE MODIFIED: $code</B>\n";

				$stmt="UPDATE vicidial_qc_codes SET code_name='$code_name' where code='$code';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='QCCODES', event_type='MODIFY', record_id='$vsc_id', event_code='ADMIN MODIFY QC CODES', event_sql=\"$SQL_log\", event_notes='';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=341111111111111;	# go to qc status code modification form below
	}




######################################################################################################
######################################################################################################
#######   5 series, delete records confirmation
######################################################################################################
######################################################################################################


######################
# ADD=5 confirmation before deletion of user
######################

if ($ADD==5)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($user) < 2) or ($LOGdelete_users < 1) )
		{
		echo "<br>USER NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>User be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>USER DELETION CONFIRMATION: $user</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=6&user=$user&CoNfIrM=YES\">Click here to delete user $user</a><br><br><br>\n";
		}

	$ADD='3';		# go to user modification below
	}

######################
# ADD=51 confirmation before deletion of campaign
######################

if ($ADD==51)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($campaign_id) < 2) or ($LOGdelete_campaigns < 1) )
		{
		echo "<br>CAMPAIGN NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Campaign_id be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>CAMPAIGN DELETION CONFIRMATION: $campaign_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=61&campaign_id=$campaign_id&CoNfIrM=YES\">Click here to delete campaign $campaign_id</a><br><br><br>\n";
		}

	$ADD='31';		# go to campaign modification below
	}

######################
# ADD=52 confirmation before logging all agents out of campaign of campaign
######################

if ($ADD==52)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if (strlen($campaign_id) < 2)
		{
		echo "<br>AGENTS NOT LOGGED OUT OF CAMPAIGN - Please go back and look at the data you entered\n";
		echo "<br>Campaign_id be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>AGENT LOGOUT CONFIRMATION: $campaign_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=62&campaign_id=$campaign_id&CoNfIrM=YES&DB=$DB\">Click here to log all agents out of $campaign_id</a><br><br><br>\n";
		}

	$ADD='31';		# go to campaign modification below
	}

######################
# ADD=53 confirmation before Emergency VDAC Jam Clear - deletes oldest LIVE vicidial_auto_call record
######################

if ($ADD==53)
	{
	if (eregi('IN',$stage))
		{$group_id=$campaign_id;}
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if (strlen($campaign_id) < 2)
		{
		echo "<br>VDAC NOT CLEARED FOR CAMPAIGN - Please go back and look at the data you entered\n";
		echo "<br>Campaign_id be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>VDAC CLEAR CONFIRMATION: $campaign_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=63&campaign_id=$campaign_id&CoNfIrM=YES&&stage=$stage\">Click here to delete the oldest LIVE record in VDAC for $campaign_id</a><br><br><br>\n";
		}

	# go to campaign modification below
	if (eregi('IN',$stage))
		{$ADD='3111';}
	else
		{$ADD='31';}	
	}

######################
# ADD=511 confirmation before deletion of list
######################

if ($ADD==511)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($list_id) < 2) or ($LOGdelete_lists < 1) )
		{
		echo "<br>LIST NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>List_id be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>LIST DELETION CONFIRMATION: $list_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=611&list_id=$list_id&CoNfIrM=YES\">Click here to delete list and all of its leads $list_id</a><br><br><br>\n";
		}

	$ADD='311';		# go to campaign modification below
	}

######################
# ADD=5111 confirmation before deletion of in-group
######################

if ($ADD==5111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($group_id) < 2) or ($LOGdelete_ingroups < 1) )
		{
		echo "<br>IN-GROUP NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Group_id be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>IN-GROUP DELETION CONFIRMATION: $group_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=6111&group_id=$group_id&CoNfIrM=YES\">Click here to delete in-group $group_id</a><br><br><br>\n";
		}

	$ADD='3111';		# go to in-group modification below
	}

######################
# ADD=5311 confirmation before deletion of did
######################

if ($ADD==5311)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($did_id) < 1) or ($LOGdelete_dids < 1) )
		{
		echo "<br>DID NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>did_id be at least 1 characters in length\n";
		}
	else
		{
		echo "<br><B>DID DELETION CONFIRMATION: $menu_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=6311&did_id=$did_id&CoNfIrM=YES\">Click here to delete DID $did_id</a><br><br><br>\n";
		}

	$ADD='3311';		# go to did modification below
	}

######################
# ADD=5511 confirmation before deletion of IVR
######################

if ($ADD==5511)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($menu_id) < 2) or ($LOGdelete_dids < 1) )
		{
		echo "<br>IVR NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>menu_id be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>IVR DELETION CONFIRMATION: $menu_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=6511&menu_id=$menu_id&CoNfIrM=YES\">Click here to delete IVR $menu_id</a><br><br><br>\n";
		}

	$ADD='3511';		# go to IVR modification below
	}

######################
# ADD=51111 confirmation before deletion of remote agent record
######################

if ($ADD==51111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($remote_agent_id) < 1) or ($LOGdelete_remote_agents < 1) )
		{
		echo "<br>REMOTE AGENT NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Remote_agent_id be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>REMOTE AGENT DELETION CONFIRMATION: $remote_agent_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=61111&remote_agent_id=$remote_agent_id&CoNfIrM=YES\">Click here to delete remote agent $remote_agent_id</a><br><br><br>\n";
		}

	$ADD='31111';		# go to remote agent modification below
	}

######################
# ADD=511111 confirmation before deletion of user group record
######################

if ($ADD==511111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($user_group) < 2) or ($LOGdelete_user_groups < 1) )
		{
		echo "<br>USER GROUP NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>User_group be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>USER GROUP DELETION CONFIRMATION: $user_group</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=611111&user_group=$user_group&CoNfIrM=YES\">Click here to delete user group $user_group</a><br><br><br>\n";
		}

	$ADD='311111';		# go to user group modification below
	}

######################
# ADD=5111111 confirmation before deletion of script record
######################

if ($ADD==5111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($script_id) < 2) or ($LOGdelete_scripts < 1) )
		{
		echo "<br>SCRIPT NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Script_id must be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>SCRIPT DELETION CONFIRMATION: $script_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=6111111&script_id=$script_id&CoNfIrM=YES\">Click here to delete script $script_id</a><br><br><br>\n";
		}

	$ADD='3111111';		# go to script modification below
	}

######################
# ADD=51111111 confirmation before deletion of filter record
######################

if ($ADD==51111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($lead_filter_id) < 2) or ($LOGdelete_filters < 1) )
		{
		echo "<br>FILTER NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Filter ID must be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>FILTER DELETION CONFIRMATION: $lead_filter_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=61111111&lead_filter_id=$lead_filter_id&CoNfIrM=YES\">Click here to delete filter $lead_filter_id</a><br><br><br>\n";
		}

	$ADD='31111111';		# go to filter modification below
	}

######################
# ADD=511111111 confirmation before deletion of call time record
######################

if ($ADD==511111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($call_time_id) < 2) or ($LOGdelete_call_times < 1) )
		{
		echo "<br>CALL TIME NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Call Time ID must be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>CALL TIME DELETION CONFIRMATION: $call_time_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=611111111&call_time_id=$call_time_id&CoNfIrM=YES\">Click here to delete call time $call_time_id</a><br><br><br>\n";
		}

	$ADD='311111111';		# go to call time modification below
	}

######################
# ADD=5111111111 confirmation before deletion of state call time record
######################

if ($ADD==5111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($call_time_id) < 2) or ($LOGdelete_call_times < 1) )
		{
		echo "<br>STATE CALL TIME NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Call Time ID must be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>STATE CALL TIME DELETION CONFIRMATION: $call_time_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=6111111111&call_time_id=$call_time_id&CoNfIrM=YES\">Click here to delete state call time $call_time_id</a><br><br><br>\n";
		}

	$ADD='3111111111';		# go to state call time modification below
	}

######################
# ADD=531111111 confirmation before deletion of shift record
######################

if ($ADD==531111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($shift_id) < 2) or ($LOGdelete_call_times < 1) )
		{
		echo "<br>SHIFT NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Shift ID must be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>SHIFT DELETION CONFIRMATION: $shift_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=631111111&shift_id=$shift_id&CoNfIrM=YES\">Click here to delete shift $shift_id</a><br><br><br>\n";
		}

	$ADD='331111111';		# go to call time modification below
	}

######################
# ADD=51111111111 confirmation before deletion of phone record
######################

if ($ADD==51111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($extension) < 2) or (strlen($server_ip) < 7) or ($LOGast_delete_phones < 1) )
		{
		echo "<br>PHONE NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Extension be at least 2 characters in length\n";
		echo "<br>Server IP be at least 7 characters in length\n";
		}
	else
		{
		echo "<br><B>PHONE DELETION CONFIRMATION: $extension - $server_ip</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=61111111111&extension=$extension&server_ip=$server_ip&CoNfIrM=YES\">Click here to delete phone $extension - $server_ip</a><br><br><br>\n";
		}
	$ADD='31111111111';		# go to phone modification below
	}


######################
# ADD=52111111111 confirmation before deletion of phone alias record
######################

if ($ADD==52111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($alias_id) < 1) or ($LOGast_delete_phones < 1) )
		{
		echo "<br>PHONE ALIAS NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Alias ID must be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>PHONE ALIAS DELETION CONFIRMATION: $alias_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=62111111111&alias_id=$alias_id&CoNfIrM=YES\">Click here to delete phone alias $alias_id</a><br><br><br>\n";
		}
	$ADD='32111111111';		# go to phone alias modification below
	}


######################
# ADD=53111111111 confirmation before deletion of group alias record
######################

if ($ADD==53111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($group_alias_id) < 1) or ($LOGast_delete_phones < 1) )
		{
		echo "<br>GROUP ALIAS NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Group Alias ID must be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>GROUP ALIAS DELETION CONFIRMATION: $group_alias_id</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=63111111111&group_alias_id=$group_alias_id&CoNfIrM=YES\">Click here to delete group alias $group_alias_id</a><br><br><br>\n";
		}
	$ADD='33111111111';		# go to group alias modification below
	}


######################
# ADD=511111111111 confirmation before deletion of server record
######################

if ($ADD==511111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($server_id) < 2) or (strlen($server_ip) < 7) or ($LOGast_delete_phones < 1) )
		{
		echo "<br>SERVER NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Server ID be at least 2 characters in length\n";
		echo "<br>Server IP be at least 7 characters in length\n";
		}
	else
		{
		echo "<br><B>SERVER DELETION CONFIRMATION: $server_id - $server_ip</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=611111111111&server_id=$server_id&server_ip=$server_ip&CoNfIrM=YES\">Click here to delete phone $server_id - $server_ip</a><br><br><br>\n";
		}
	$ADD='311111111111';		# go to server modification below
	}


######################
# ADD=531111111111 confirmation before deletion of conf template record
######################

if ($ADD==531111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if (strlen($template_id) < 2)
		{
		echo "<br>CONF TEMPLATE NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Template ID be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>CONF TEMPLATE DELETION CONFIRMATION: $template_id - $template_name</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=631111111111&template_id=$template_id&server_ip=$server_ip&CoNfIrM=YES\">Click here to delete conf template $template_id - $template_name</a><br><br><br>\n";
		}
	$ADD='331111111111';		# go to conf template modification below
	}


######################
# ADD=541111111111 confirmation before deletion of carrier record
######################

if ($ADD==541111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if (strlen($carrier_id) < 2)
		{
		echo "<br>CARRIER NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Carrier ID be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>CARRIER DELETION CONFIRMATION: $carrier_id - $carrier_name</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=641111111111&carrier_id=$carrier_id&CoNfIrM=YES\">Click here to delete carrier $carrier_id - $carrier_name</a><br><br><br>\n";
		}
	$ADD='341111111111';		# go to carrier modification below
	}


######################
# ADD=551111111111 confirmation before deletion of tts record
######################

if ($ADD==551111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if (strlen($tts_id) < 2)
		{
		echo "<br>TTS ENTRY NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>TTS ID be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>TTS ENTRY DELETION CONFIRMATION: $tts_id - $tts_name</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=651111111111&tts_id=$tts_id&CoNfIrM=YES\">Click here to delete tts entry $tts_id - $tts_name</a><br><br><br>\n";
		}
	$ADD='351111111111';		# go to tts entry modification below
	}


######################
# ADD=561111111111 confirmation before deletion of music on hold record
######################

if ($ADD==561111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if (strlen($moh_id) < 2)
		{
		echo "<br>MUSIC ON HOLD ENTRY NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>MOH ID be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>MUSIC ON HOLD ENTRY DELETION CONFIRMATION: $moh_id - $moh_name</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=661111111111&moh_id=$moh_id&CoNfIrM=YES\">Click here to delete music on hold entry $moh_id - $moh_name</a><br><br><br>\n";
		}
	$ADD='361111111111';		# go to music on hold entry modification below
	}


######################
# ADD=571111111111 confirmation before deletion of voicemail record
######################

if ($ADD==571111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if (strlen($voicemail_id) < 2)
		{
		echo "<br>VOICEMAIL BOX NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Voicemail ID be at least 2 characters in length\n";
		}
	else
		{
		echo "<br><B>VOICEMAIL BOX DELETION CONFIRMATION: $voicemail_id - $fullname</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=671111111111&voicemail_id=$voicemail_id&CoNfIrM=YES\">Click here to delete voicemail box $voicemail_id - $fullname</a><br><br><br>\n";
		}
	$ADD='371111111111';		# go to voicemail entry modification below
	}


######################
# ADD=5111111111111 confirmation before deletion of conference record
######################

if ($ADD==5111111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($conf_exten) < 2) or (strlen($server_ip) < 7) or ($LOGast_delete_phones < 1) )
		{
		echo "<br>CONFERENCE NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Conference must be at least 2 characters in length\n";
		echo "<br>Server IP be at least 7 characters in length\n";
		}
	else
		{
		echo "<br><B>CONFERENCE DELETION CONFIRMATION: $conf_exten - $server_ip</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=6111111111111&conf_exten=$conf_exten&server_ip=$server_ip&CoNfIrM=YES\">Click here to delete phone $conf_exten - $server_ip</a><br><br><br>\n";
		}
	$ADD='3111111111111';		# go to conference modification below
	}


######################
# ADD=51111111111111 confirmation before deletion of CCMS conference record
######################

if ($ADD==51111111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($conf_exten) < 2) or (strlen($server_ip) < 7) or ($LOGast_delete_phones < 1) )
		{
		echo "<br>CCMS CONFERENCE NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Conference must be at least 2 characters in length\n";
		echo "<br>Server IP be at least 7 characters in length\n";
		}
	else
		{
		echo "<br><B>CCMS CONFERENCE DELETION CONFIRMATION: $conf_exten - $server_ip</B>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=61111111111111&conf_exten=$conf_exten&server_ip=$server_ip&CoNfIrM=YES\">Click here to delete phone $conf_exten - $server_ip</a><br><br><br>\n";
		}
	$ADD='31111111111111';		# go to CCMS conference modification below
	}



######################################################################################################
######################################################################################################
#######   6 series, delete records
######################################################################################################
######################################################################################################


######################
# ADD=6 delete user record
######################

if ($ADD==6)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( ( strlen($user) < 2) or ($CoNfIrM != 'YES') or ($LOGdelete_users < 1) )
		{
		echo "<br>USER NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>User be at least 2 characters in length\n";
		}
	else
		{
		$stmtA="DELETE from vicidial_users where user='$user' limit 1;";
		$rslt=mysql_query($stmtA, $link);

		$stmt="DELETE from vicidial_campaign_agents where user='$user';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_inbound_group_agents where user='$user';";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmtA|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='USERS', event_type='DELETE', record_id='$user', event_code='ADMIN DELETE USER', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>USER DELETION COMPLETED: $user</B>\n";
		echo "<br><br>\n";
		}

	$ADD='0';		# go to user list
	}

######################
# ADD=61 delete campaign record
######################

if ($ADD==61)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( ( strlen($campaign_id) < 2) or ($CoNfIrM != 'YES') or ($LOGdelete_campaigns < 1) )
		{
		echo "<br>CAMPAIGN NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Campaign_id be at least 2 characters in length\n";
		}
	else
		{
		$stmtA="DELETE from vicidial_campaigns where campaign_id='$campaign_id' limit 1;";
		$rslt=mysql_query($stmtA, $link);

		$stmt="DELETE from vicidial_campaign_agents where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_live_agents where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_campaign_statuses where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_campaign_hotkeys where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_callbacks where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_campaign_stats where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_lead_recycle where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_campaign_server_stats where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_server_trunks where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_pause_codes where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_campaigns_list_mix where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);
		
		//add by bear
		$stmt="DELETE from ccms_campaigns where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		// 开始与vicidial_system_status表同步
		systemStatus_campaigns_synchronous($link);

		echo "<br>REMOVING LIST HOPPER LEADS FROM OLD CAMPAIGN HOPPER ($campaign_id)\n";
		$stmt="DELETE from vicidial_hopper where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmtA|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGNS', event_type='DELETE', record_id='$campaign_id', event_code='ADMIN DELETE CAMPAIGN', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>CAMPAIGN DELETION COMPLETED: $campaign_id</B>\n";
		echo "<br><br>\n";
		}

	$ADD='10';		# go to campaigns list
	}


######################
# ADD=62 Logout all agents from a campaign
######################

if ($ADD==62)
	{
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if (strlen($campaign_id) < 2)
			{
			echo "<br>AGENTS NOT LOGGED OUT OF CAMPAIGN - Please go back and look at the data you entered\n";
			echo "<br>Campaign_id be at least 2 characters in length\n";
			}
		else
			{
			$now_date_epoch = date('U');
			$inactive_epoch = ($now_date_epoch - 60);
			$stmt = "SELECT user,campaign_id,UNIX_TIMESTAMP(last_update_time) from vicidial_live_agents where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			if ($DB) {echo "<BR>$stmt\n";}
			$vla_ct = mysql_num_rows($rslt);
			$k=0;
			while ($vla_ct > $k)
				{
				$row=mysql_fetch_row($rslt);
				$VLA_user[$k] =			$row[0];
				$VLA_campaign_id[$k] =	$row[1];
				$VLA_update_time[$k] =	$row[2];
				$k++;
				}

			$k=0;
			while ($vla_ct > $k)
				{
				if ($VLA_update_time[$k] > $inactive_epoch)
					{
					$lead_active=0;
					$stmt = "SELECT agent_log_id,user,server_ip,event_time,lead_id,campaign_id,pause_epoch,pause_sec,wait_epoch,wait_sec,talk_epoch,talk_sec,dispo_epoch,dispo_sec,status,user_group,comments,sub_status,dead_epoch,dead_sec from vicidial_agent_log where user='$VLA_user[$k]' order by agent_log_id desc LIMIT 1;";
					$rslt=mysql_query($stmt, $link);
					if ($DB) {echo "<BR>$stmt\n";}
					$val_ct = mysql_num_rows($rslt);
					if ($val_ct > 0)
						{
						$row=mysql_fetch_row($rslt);
						$VAL_agent_log_id =		$row[0];
						$VAL_user =				$row[1];
						$VAL_server_ip =		$row[2];
						$VAL_event_time =		$row[3];
						$VAL_lead_id =			$row[4];
						$VAL_campaign_id =		$row[5];
						$VAL_pause_epoch =		$row[6];
						$VAL_pause_sec =		$row[7];
						$VAL_wait_epoch =		$row[8];
						$VAL_wait_sec =			$row[9];
						$VAL_talk_epoch =		$row[10];
						$VAL_talk_sec =			$row[11];
						$VAL_dispo_epoch =		$row[12];
						$VAL_dispo_sec =		$row[13];
						$VAL_status =			$row[14];
						$VAL_user_group =		$row[15];
						$VAL_comments =			$row[16];
						$VAL_sub_status =		$row[17];
						$VAL_dead_epoch =		$row[18];
						$VAL_dead_sec =			$row[19];

						if ($DB) {echo "\n<BR>VAL VALUES: $VAL_agent_log_id|$VAL_status|$VAL_lead_id\n";}

						if ( ($VAL_wait_epoch < 1) || ( ($VAL_status == 'PAUSE') && ($VAL_dispo_epoch < 1) ) )
							{
							$VAL_pause_sec = ( ($now_date_epoch - $VAL_pause_epoch) + $VAL_pause_sec);
							$stmt = "UPDATE vicidial_agent_log SET wait_epoch='$now_date_epoch', pause_sec='$VAL_pause_sec' where agent_log_id='$VAL_agent_log_id';";
							}
						else
							{
							if ($VAL_talk_epoch < 1)
								{
								$VAL_wait_sec = ( ($now_date_epoch - $VAL_wait_epoch) + $VAL_wait_sec);
								$stmt = "UPDATE vicidial_agent_log SET talk_epoch='$now_date_epoch', wait_sec='$VAL_wait_sec' where agent_log_id='$VAL_agent_log_id';";
								}
							else
								{
								$lead_active++;
								$status_update_SQL='';
								if ( ( (strlen($VAL_status) < 1) or ($VAL_status == 'NULL') ) and ($VAL_lead_id > 0) )
									{
									$status_update_SQL = ", status='PU'";
									$stmt="UPDATE vicidial_list SET status='PU' where lead_id='$VAL_lead_id';";
									if ($DB) {echo "<BR>$stmt\n";}
									$rslt=mysql_query($stmt, $link);
									}
								if ($VAL_dispo_epoch < 1)
									{
									$VAL_talk_sec = ($now_date_epoch - $VAL_talk_epoch);
									$stmt = "UPDATE vicidial_agent_log SET dispo_epoch='$now_date_epoch', talk_sec='$VAL_talk_sec'$status_update_SQL where agent_log_id='$VAL_agent_log_id';";
									}
								else
									{
									if ($VAL_dispo_sec < 1)
										{
										$VAL_dispo_sec = ($now_date_epoch - $VAL_dispo_epoch);
										$stmt = "UPDATE vicidial_agent_log SET dispo_sec='$VAL_dispo_sec' where agent_log_id='$VAL_agent_log_id';";
										}
									}
								}
							}

						if ($DB) {echo "<BR>$stmt\n";}
						$rslt=mysql_query($stmt, $link);
						}
					}

				$stmt="DELETE from vicidial_live_agents where user='$VLA_user[$k]';";
				if ($DB) {echo "<BR>$stmt\n";}
				$rslt=mysql_query($stmt, $link);

				if (strlen($VAL_user_group) < 1)
					{
					$stmt = "SELECT user_group FROM vicidial_users where user='$VLA_user[$k]';";
					$rslt=mysql_query($stmt, $link);
					if ($DB) {echo "<BR>$stmt\n";}
					$val_ct = mysql_num_rows($rslt);
					if ($val_ct > 0)
						{
						$row=mysql_fetch_row($rslt);
						$VAL_user_group =		$row[0];
						}
					}

				$stmt = "INSERT INTO vicidial_user_log (user,event,campaign_id,event_date,event_epoch,user_group) values('$VLA_user[$k]','LOGOUT','$VLA_campaign_id[$k]','$NOW_TIME','$now_date_epoch','$VAL_user_group');";
				if ($DB) {echo "<BR>$stmt\n";}
				$rslt=mysql_query($stmt, $link);


				#############################################
				##### START QUEUEMETRICS LOGGING LOOKUP #####
				$stmt = "SELECT enable_queuemetrics_logging,queuemetrics_server_ip,queuemetrics_dbname,queuemetrics_login,queuemetrics_pass,queuemetrics_log_id FROM system_settings;";
				$rslt=mysql_query($stmt, $link);
				if ($DB) {echo "<BR>$stmt\n";}
				$qm_conf_ct = mysql_num_rows($rslt);
				if ($qm_conf_ct > 0)
					{
					$row=mysql_fetch_row($rslt);
					$enable_queuemetrics_logging =	$row[0];
					$queuemetrics_server_ip	=		$row[1];
					$queuemetrics_dbname =			$row[2];
					$queuemetrics_login	=			$row[3];
					$queuemetrics_pass =			$row[4];
					$queuemetrics_log_id =			$row[5];
					}
				##### END QUEUEMETRICS LOGGING LOOKUP #####
				###########################################
				if ($enable_queuemetrics_logging > 0)
					{
					$linkB=mysql_connect("$queuemetrics_server_ip", "$queuemetrics_login", "$queuemetrics_pass");
					mysql_select_db("$queuemetrics_dbname", $linkB);

					$agents='@agents';
					$agent_logged_in='';
					$time_logged_in='';

					$stmtB = "SELECT agent,time_id FROM queue_log where agent='Agent/$VLA_user[$k]' and verb='AGENTLOGIN' order by time_id desc limit 1;";
					$rsltB=mysql_query($stmtB, $linkB);
					if ($DB) {echo "<BR>$stmtB\n";}
					$qml_ct = mysql_num_rows($rsltB);
					if ($qml_ct > 0)
						{
						$row=mysql_fetch_row($rsltB);
						$agent_logged_in =	$row[0];
						$time_logged_in =	$row[1];
						}

					$time_logged_in = ($now_date_epoch - $time_logged_in);
					if ($time_logged_in > 1000000) {$time_logged_in=1;}

					$stmtB = "INSERT INTO queue_log SET partition='P01',time_id='$now_date_epoch',call_id='NONE',queue='NONE',agent='$agent_logged_in',verb='AGENTLOGOFF',serverid='$queuemetrics_log_id',data1='$VLA_user[$k]$agents',data2='$time_logged_in';";
					if ($DB) {echo "<BR>$stmtB\n";}
					$rsltB=mysql_query($stmtB, $linkB);
					}

				echo "<!-- Agent $VLA_user[$k] has been emergency logged out, make sure they close their web browser<BR> -->\n";

				$k++;
				}

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGNS', event_type='LOGOUT', record_id='$campaign_id', event_code='ADMIN LOGOUT CAMPAIGN AGENTS', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>AGENT LOGOUT COMPLETED: $campaign_id</B>\n";
			echo "<br><br>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD='31';		# go to campaign modification below
	}


######################
# ADD=63 Emergency VDAC Jam Clear
######################

if ($ADD==63)
	{
	if ($LOGmodify_campaigns==1)
		{
		if (eregi('IN',$stage))
			{$group_id=$campaign_id;}
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if (strlen($campaign_id) < 2)
			{
			echo "<br>VDAC NOT CLEARED FOR CAMPAIGN - Please go back and look at the data you entered\n";
			echo "<br>Campaign_id be at least 2 characters in length\n";
			}
		else
			{
			$stmt="DELETE from vicidial_auto_calls where status='LIVE' and campaign_id='$campaign_id' order by call_time limit 1;";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGNS', event_type='RESET', record_id='$campaign_id', event_code='ADMIN RESET CAMPAIGN JAM', event_sql=\"$SQL_log\", event_notes='';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);

			echo "<br><B>LAST VDAC RECORD CLEARED FOR CAMPAIGN: $campaign_id</B>\n";
			echo "<br><br>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	# go to campaign modification below
	if (eregi('IN',$stage))
		{$ADD='3111';}
	else
		{$ADD='31';}
	}


######################
# ADD=65 delete campaign lead recycle in the system
######################

if ($ADD==65)
	{
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($campaign_id) < 2) or (strlen($status) < 1) )
			{
			echo "<br>CAMPAIGN LEAD RECYCLE NOT DELETED - Please go back and look at the data you entered\n";
			echo "<br>status must be between 1 and 6 characters in length\n";
//			echo "<br>attempt delay must be at least 120 seconds\n";//鍙栨秷Attempt Delay鐨勭鏁伴檺鍒讹紱
			echo "<br>maximum attempts must be from 1 to 10\n";
			}
		else
			{
			echo "<br><B>CAMPAIGN LEAD RECYCLE DELETED: $campaign_id - $status - $attempt_delay</B>\n";

			$stmt="DELETE FROM vicidial_lead_recycle where campaign_id='$campaign_id' and status='$status';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_RECYCLE', event_type='DELETE', record_id='$campaign_id', event_code='ADMIN DELETE CAMPAIGN LEAD RECYCLE', event_sql=\"$SQL_log\", event_notes='Status: $status';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$SUB=25;
	$ADD=31;	# go to campaign modification form below
	}


######################
# ADD=66 delete auto alt dial status from the campaign
######################

if ($ADD==66)
	{
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
		$stmt="SELECT count(*) from vicidial_campaigns where campaign_id='$campaign_id' and auto_alt_dial_statuses LIKE \"% $status %\";";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] < 1)
			{echo "<br>AUTO ALT DIAL STATUS NOT DELETED - this auto alt dial status is not in this campaign\n";}
		else
			{
			if ( (strlen($campaign_id) < 2) or (strlen($status) < 1) )
				{
				echo "<br>AUTO ALT DIAL STATUS NOT DELETED - Please go back and look at the data you entered\n";
				echo "<br>status must be between 1 and 6 characters in length\n";
				}
			else
				{
				echo "<br><B>AUTO ALT DIAL STATUS DELETED: $campaign_id - $status</B>\n";

				$stmt="SELECT auto_alt_dial_statuses from vicidial_campaigns where campaign_id='$campaign_id';";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);

				$auto_alt_dial_statuses = eregi_replace(" $status "," ",$row[0]);
				$stmt="UPDATE vicidial_campaigns set auto_alt_dial_statuses='$auto_alt_dial_statuses' where campaign_id='$campaign_id';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_ALTDIALS', event_type='DELETE', record_id='$campaign_id', event_code='ADMIN DELETE CAMPAIGN ALT DIAL', event_sql=\"$SQL_log\", event_notes='Status: $status';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$SUB=26;
	$ADD=31;	# go to campaign modification form below
	}


######################
# ADD=67 delete agent pause code in the system
######################

if ($ADD==67)
	{
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($campaign_id) < 2) or (strlen($pause_code) < 1) )
			{
			echo "<br>CAMPAIGN PAUSE CODE NOT DELETED - Please go back and look at the data you entered\n";
			echo "<br>pause code must be between 1 and 6 characters in length\n";
			}
		else
			{
			echo "<br><B>CAMPAIGN PAUSE CODE DELETED: $campaign_id - $pause_code</B>\n";

			$stmt="DELETE FROM vicidial_pause_codes where campaign_id='$campaign_id' and pause_code='$pause_code';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_PAUSECODES', event_type='DELETE', record_id='$campaign_id', event_code='ADMIN DELETE CAMPAIGN PAUSE CODE', event_sql=\"$SQL_log\", event_notes='Status: $pause_code';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$SUB=27;
	$ADD=31;	# go to campaign modification form below
	}


######################
# ADD=68 remove campaign dial status
######################

if ($ADD==68)
	{
	if ($LOGmodify_campaigns==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
		$stmt="SELECT count(*) from vicidial_campaigns where campaign_id='$campaign_id' and dial_statuses LIKE \"% $status %\";";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if ($row[0] < 1)
			{echo "<br>CAMPAIGN DIAL STATUS NOT REMOVED - this dial status is not selected for this campaign\n";}
		else
			{
			if ( (strlen($campaign_id) < 2) or (strlen($status) < 1) )
				{
				echo "<br>CAMPAIGN DIAL STATUS NOT REMOVED - Please go back and look at the data you entered\n";
				echo "<br>status must be between 1 and 6 characters in length\n";
				}
			else
				{
				echo "<br><B>CAMPAIGN DIAL STATUS REMOVED: $campaign_id - $status</B>\n";

				$stmt="SELECT dial_statuses from vicidial_campaigns where campaign_id='$campaign_id';";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);

				$dial_statuses = eregi_replace(" $status "," ",$row[0]);
				$stmt="UPDATE vicidial_campaigns set dial_statuses='$dial_statuses' where campaign_id='$campaign_id';";
				$rslt=mysql_query($stmt, $link);

				### LOG INSERTION Admin Log Table ###
				$SQL_log = "$stmt|";
				$SQL_log = ereg_replace(';','',$SQL_log);
				$SQL_log = addslashes($SQL_log);
				$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CAMPAIGN_DIALSTATUSES', event_type='DELETE', record_id='$campaign_id', event_code='ADMIN DELETE CAMPAIGN DIAL STATUS', event_sql=\"$SQL_log\", event_notes='Status: $status';";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	#$SUB=28;
	$ADD=31;	# go to campaign modification form below
	}

######################
# ADD=611 delete list record and all leads within it
######################

if ($ADD==611)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( ( strlen($list_id) < 2) or ($CoNfIrM != 'YES') or ($LOGdelete_lists < 1) )
		{
		echo "<br>LIST NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>List_id be at least 2 characters in length\n";
		}
	else
		{
###### start Synchronize leads with CRM 2011-09-20 add by pie;
		$stmt="SELECT ccms_url from system_settings;";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$ccms_url_link = $row[0];
	//	echo $ccms_url_link."<br>";
//		echo $list_id."<br>";
		$url_link = $ccms_url_link."delete_leads_from_ListId.php?list_id=".$list_id;
	//	echo $url_link."<br>";
		file("$url_link");
//		$delete_content =file("$url_link");
//		echo $delete_content[0]."<br>";
###### end Synchronize leads with CRM 2011-09-20 add by pie;

		$stmt="DELETE from vicidial_lists where list_id='$list_id' limit 1;";
		$rslt=mysql_query($stmt, $link);

		echo "<br>REMOVING LIST HOPPER LEADS FROM OLD CAMPAIGN HOPPER ($list_id)\n";
		$stmt="DELETE from vicidial_hopper where list_id='$list_id';";
		$rslt=mysql_query($stmt, $link);

		echo "<br>REMOVING LIST LEADS FROM CCMS_LIST TABLE\n";
		$stmt="DELETE from vicidial_list where list_id='$list_id';";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='LISTS', event_type='DELETE', record_id='$list_id', event_code='ADMIN DELETE LIST', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>LIST DELETION COMPLETED: $list_id</B>\n";
		echo "<br><br>\n";
		}

	$ADD='100';		# go to lists list
	}

######################
# ADD=6111 delete in-group record
######################

if ($ADD==6111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($group_id) < 2) or ($CoNfIrM != 'YES') or ($LOGdelete_ingroups < 1) )
		{
		echo "<br>IN-GROUP NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Group_id be at least 2 characters in length\n";
		}
	else
		{
		$stmtA="DELETE from vicidial_inbound_groups where group_id='$group_id' and group_id NOT IN('AGENTDIRECT') limit 1;";
		$rslt=mysql_query($stmtA, $link);

		$stmt="DELETE from vicidial_inbound_group_agents where group_id='$group_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_live_inbound_agents where group_id='$group_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_campaign_stats where campaign_id='$group_id';";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmtA|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='INGROUPS', event_type='DELETE', record_id='$group_id', event_code='ADMIN DELETE INGROUP', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>IN-GROUP DELETION COMPLETED: $group_id</B>\n";
		echo "<br><br>\n";
		}

	$ADD='1000';		# go to in-group list
	}


######################
# ADD=6311 delete did record
######################

if ($ADD==6311)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($did_id) < 1) or ($CoNfIrM != 'YES') or ($LOGdelete_dids < 1) )
		{
		echo "<br>DID NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>did_id be at least 1 characters in length\n";
		}
	else
		{
		$stmt="DELETE from vicidial_inbound_dids where did_id='$did_id' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='DIDS', event_type='DELETE', record_id='$did_id', event_code='ADMIN DELETE DID', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>DID DELETION COMPLETED: $did_id</B>\n";
		echo "<br><br>\n";
		}

	$ADD='1300';		# go to did list
	}

######################
# ADD=6511 delete IVR record
######################

if ($ADD==6511)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($menu_id) < 1) or ($CoNfIrM != 'YES') or ($LOGdelete_dids < 1) )
		{
		echo "<br>IVR NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>menu_id be at least 1 characters in length\n";
		}
	else
		{
		$stmt="DELETE from vicidial_call_menu where menu_id='$menu_id' limit 1;";
		$rslt=mysql_query($stmt, $link);

		$stmtA="DELETE from vicidial_call_menu_options where menu_id='$menu_id' limit 17;";
		$rslt=mysql_query($stmtA, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|$stmtA";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CALLMENUS', event_type='DELETE', record_id='$menu_id', event_code='ADMIN DELETE IVR', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>IVR DELETION COMPLETED: $menu_id</B>\n";
		echo "<br><br>\n";
		}

	$ADD='1500';		# go to IVR list
	}

######################
# ADD=61111 delete remote agent record
######################

if ($ADD==61111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($remote_agent_id) < 1) or ($CoNfIrM != 'YES') or ($LOGdelete_remote_agents < 1) )
		{
		echo "<br>REMOTE AGENT NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Remote_agent_id be at least 2 characters in length\n";
		}
	else
		{
		$stmt="DELETE from vicidial_remote_agents where remote_agent_id='$remote_agent_id' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='REMOTEAGENTS', event_type='DELETE', record_id='$remote_agent_id', event_code='ADMIN DELETE REMOTE AGENT', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>REMOTE AGENT DELETION COMPLETED: $remote_agent_id</B>\n";
		echo "<br><br>\n";
		}

	$ADD='10000';		# go to remote agents list
	}

######################
# ADD=611111 delete user group record
######################

if ($ADD==611111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($user_group) < 2) or ($CoNfIrM != 'YES') or ($LOGdelete_user_groups < 1) )
		{
		echo "<br>USER GROUP NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>User_group be at least 2 characters in length\n";
		}
	else
		{
		$stmt="DELETE from vicidial_user_groups where user_group='$user_group' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='USERGROUPS', event_type='DELETE', record_id='$user_group', event_code='ADMIN DELETE USER GROUP', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>USER GROUP DELETION COMPLETED: $user_group</B>\n";
		echo "<br><br>\n";
		}

	$ADD='100000';		# go to user group list
	}

######################
# ADD=6111111 delete script record
######################

if ($ADD==6111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($script_id) < 2) or ($CoNfIrM != 'YES') or ($LOGdelete_scripts < 1) )
		{
		echo "<br>SCRIPT NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Script_id be at least 2 characters in length\n";
		}
	else
		{
		$stmt="DELETE from vicidial_scripts where script_id='$script_id' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SCRIPTS', event_type='DELETE', record_id='$script_id', event_code='ADMIN DELETE SCRIPT', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>SCRIPT DELETION COMPLETED: $script_id</B>\n";
		echo "<br><br>\n";
		}

	$ADD='1000000';		# go to script list
	}


######################
# ADD=61111111 delete filter record
######################

if ($ADD==61111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($lead_filter_id) < 2) or ($CoNfIrM != 'YES') or ($LOGdelete_filters < 1) )
		{
		echo "<br>FILTER NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Filter ID must be at least 2 characters in length\n";
		}
	else
		{
		$stmt="DELETE from vicidial_lead_filters where lead_filter_id='$lead_filter_id' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='FILTERS', event_type='DELETE', record_id='$lead_filter_id', event_code='ADMIN DELETE FILTERS', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>FILTER DELETION COMPLETED: $lead_filter_id</B>\n";
		echo "<br><br>\n";
		}

	$ADD='10000000';		# go to filter list
	}


######################
# ADD=611111111 delete call times record
######################

if ($ADD==611111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($call_time_id) < 2) or ($LOGdelete_call_times < 1) )
		{
		echo "<br>CALL TIME NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Call Time ID must be at least 2 characters in length\n";
		}
	else
		{
		$stmt="DELETE from vicidial_call_times where call_time_id='$call_time_id' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CALLTIMES', event_type='DELETE', record_id='$call_time_id', event_code='ADMIN DELETE CALL TIME', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>CALL TIME DELETION COMPLETED: $call_time_id</B>\n";
		echo "<br><br>\n";
		}

	$ADD='100000000';		# go to call times list
	}


######################
# ADD=6111111111 delete state call times record
######################

if ($ADD==6111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($call_time_id) < 2) or ($LOGdelete_call_times < 1) )
		{
		echo "<br>STATE CALL TIME NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Call Time ID must be at least 2 characters in length\n";
		}
	else
		{
		$stmtA="DELETE from vicidial_state_call_times where state_call_time_id='$call_time_id' limit 1;";
		$rslt=mysql_query($stmtA, $link);

		$stmt="SELECT call_time_id,ct_state_call_times from vicidial_call_times where ct_state_call_times LIKE \"%|$call_time_id|%\" order by call_time_id;";
		$rslt=mysql_query($stmt, $link);
		$sct_to_print = mysql_num_rows($rslt);
		$sct_list='';

		$o=0;
		while ($sct_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$sct_ids[$o] = "$rowx[0]";
			$sct_states[$o] = "$rowx[1]";
			$o++;
			}
		$o=0;
		while ($sct_to_print > $o) 
			{
			$sct_states[$o] = eregi_replace("\|$call_time_id\|",'|',$sct_states[$o]);
			$stmt="UPDATE vicidial_call_times set ct_state_call_times='$sct_states[$o]' where call_time_id='$sct_ids[$o]';";
			$rslt=mysql_query($stmt, $link);
			echo "$stmt\n";
			echo "State Rule Removed: $sct_ids[$o]<BR>\n";
			$o++;
			}

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmtA|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CALLTIMES', event_type='DELETE', record_id='$call_time_id', event_code='ADMIN DELETE STATE CALL TIME', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>STATE CALL TIME DELETION COMPLETED: $call_time_id</B>\n";
		echo "<br><br>\n";
		}

	$ADD='1000000000';		# go to call times list
	}


######################
# ADD=631111111 delete shift record
######################

if ($ADD==631111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($shift_id) < 2) or ($LOGdelete_call_times < 1) )
		{
		echo "<br>SHIFT NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Shift ID must be at least 2 characters in length\n";
		}
	else
		{
		$stmt="DELETE from vicidial_shifts where shift_id='$shift_id' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmtA|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SHIFTS', event_type='DELETE', record_id='$shift_id', event_code='ADMIN DELETE SHIFT', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>SHIFT DELETION COMPLETED: $shift_id</B>\n";
		echo "<br><br>\n";
		}

	$ADD='130000000';		# go to shifts list
	}


######################
# ADD=61111111111 delete phone record
######################

if ($ADD==61111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($extension) < 2) or (strlen($server_ip) < 7) or ($CoNfIrM != 'YES') or ($LOGast_delete_phones < 1) )
		{
		echo "<br>PHONE NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Extension be at least 2 characters in length\n";
		echo "<br>Server IP be at least 7 characters in length\n";
		}
	else
		{
		$stmt="DELETE from phones where extension='$extension' and server_ip='$server_ip' limit 1;";
		$rslt=mysql_query($stmt, $link);

		$stmtA="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y' and server_ip='$server_ip';";
		$rslt=mysql_query($stmtA, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='PHONES', event_type='DELETE', record_id='$extension', event_code='ADMIN DELETE PHONE', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>PHONE DELETION COMPLETED: $extension - $server_ip</B>\n";
		echo "<br><br>\n";
		}
	$ADD='10000000000';		# go to phone list
	}


######################
# ADD=62111111111 delete phone alias record
######################

if ($ADD==62111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($alias_id) < 2) or ($CoNfIrM != 'YES') or ($LOGast_delete_phones < 1) )
		{
		echo "<br>PHONE ALIAS NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Alias ID must be at least 2 characters in length\n";
		}
	else
		{
		$stmt="DELETE from phones_alias where alias_id='$alias_id' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmtA|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='PHONEALIASES', event_type='DELETE', record_id='$alias_id', event_code='ADMIN DELETE PHONE ALIAS', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>PHONE ALIAS DELETION COMPLETED: $alias_id</B>\n";
		echo "<br><br>\n";
		}
	$ADD='12000000000';		# go to phone alias list
	}


######################
# ADD=63111111111 delete group alias record
######################

if ($ADD==63111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($group_alias_id) < 2) or ($CoNfIrM != 'YES') or ($LOGast_delete_phones < 1) )
		{
		echo "<br>GROUP ALIAS NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Group Alias ID must be at least 2 characters in length\n";
		}
	else
		{
		$stmt="DELETE from groups_alias where group_alias_id='$group_alias_id' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmtA|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='GROUPALIASES', event_type='DELETE', record_id='$group_alias_id', event_code='ADMIN DELETE GROUP ALIAS', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>GROUP ALIAS DELETION COMPLETED: $group_alias_id</B>\n";
		echo "<br><br>\n";
		}
	$ADD='13000000000';		# go to group alias list
	}


######################
# ADD=611111111111 delete server record
######################

if ($ADD==611111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($server_id) < 2) or (strlen($server_ip) < 7) or ($CoNfIrM != 'YES') or ($LOGast_delete_phones < 1) )
		{
		echo "<br>SERVER NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Server ID be at least 2 characters in length\n";
		echo "<br>Server IP be at least 7 characters in length\n";
		}
	else
		{
		$stmt="DELETE from servers where server_id='$server_id' and server_ip='$server_ip' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmtA|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SERVERS', event_type='DELETE', record_id='$server_id', event_code='ADMIN DELETE SERVER', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>SERVER DELETION COMPLETED: $server_id - $server_ip</B>\n";
		echo "<br><br>\n";
		}
	$ADD='100000000000';		# go to server list
	}


######################
# ADD=621111111111 delete CCMS server trunk record in the system
######################

if ($ADD==621111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		if ( (strlen($campaign_id) < 2) or (strlen($server_ip) < 7) )
			{
			echo "<br>CCMS SERVER TRUNK RECORD NOT DELETED - Please go back and look at the data you entered\n";
			echo "<br>campaign must be between 3 and 8 characters in length\n";
			echo "<br>server_ip delay must be at least 7 characters\n";
			}
		else
			{
			echo "<br><B>CCMS SERVER TRUNK RECORD DELETED: $campaign_id - $server_ip</B>\n";

			$stmt="DELETE FROM vicidial_server_trunks where campaign_id='$campaign_id' and server_ip='$server_ip';";
			$rslt=mysql_query($stmt, $link);

			### LOG INSERTION Admin Log Table ###
			$SQL_log = "$stmt|";
			$SQL_log = ereg_replace(';','',$SQL_log);
			$SQL_log = addslashes($SQL_log);
			$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='SERVERTRUNKS', event_type='DELETE', record_id='$server_ip', event_code='ADMIN DELETE SERVER TRUNK', event_sql=\"$SQL_log\", event_notes='Campaign: $campaign_id';";
			if ($DB) {echo "|$stmt|\n";}
			$rslt=mysql_query($stmt, $link);
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	$ADD=311111111111;	# go to server modification form below
	}


######################
# ADD=631111111111 delete conf template record
######################

if ($ADD==631111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($template_id) < 2) or ($CoNfIrM != 'YES') )
		{
		echo "<br>CONF TEMPLATE NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Template ID be at least 2 characters in length\n";
		}
	else
		{
		$stmt="UPDATE phones SET template_id='' where template_id='$template_id';";
		$rslt=mysql_query($stmt, $link);
		
		$stmt="UPDATE vicidial_server_carriers SET template_id='' where template_id='$template_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y';";
		$rslt=mysql_query($stmt, $link);

		$stmt="DELETE from vicidial_conf_templates where template_id='$template_id';";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CONFTEMPLATES', event_type='DELETE', record_id='$template_id', event_code='ADMIN DELETE CONF TEMPLATE', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>CONF TEMPLATE DELETION COMPLETED: $server_id - $server_ip</B>\n";
		echo "<br><br>\n";
		}
	$ADD='130000000000';		# go to conf template list
	}


######################
# ADD=641111111111 delete carrier record
######################

if ($ADD==641111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($carrier_id) < 2) or ($CoNfIrM != 'YES') )
		{
		echo "<br>CARRIER NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Carrier ID be at least 2 characters in length\n";
		}
	else
		{
		$stmt="SELECT server_ip from vicidial_server_carriers where carrier_id='$carrier_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$CARRIERserver_ip =	$row[0];

		$stmt="DELETE from vicidial_server_carriers where carrier_id='$carrier_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y' and server_ip='$CARRIERserver_ip';";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CARRIERS', event_type='DELETE', record_id='$carrier_id', event_code='ADMIN DELETE CARRIER', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>CARRIER DELETION COMPLETED: $carrier_id</B>\n";
		echo "<br><br>\n";
		}
	$ADD='140000000000';		# go to carrier list
	}


######################
# ADD=651111111111 delete tts record
######################

if ($ADD==651111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($tts_id) < 2) or ($CoNfIrM != 'YES') )
		{
		echo "<br>TTS ENTRY NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>TTS ID be at least 2 characters in length\n";
		}
	else
		{
		$stmt="DELETE from vicidial_tts_prompts where tts_id='$tts_id';";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='TTS', event_type='DELETE', record_id='$tts_id', event_code='ADMIN DELETE TTS', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>TTS DELETION COMPLETED: $tts_id</B>\n";
		echo "<br><br>\n";
		}
	$ADD='150000000000';		# go to tts entry list
	}


######################
# ADD=661111111111 delete music on hold record
######################

if ($ADD==661111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($moh_id) < 2) or ($CoNfIrM != 'YES') )
		{
		echo "<br>MUSIC ON HOLD ENTRY NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>MOH ID be at least 2 characters in length\n";
		}
	else
		{
		$stmt="UPDATE vicidial_music_on_hold SET remove='Y' where moh_id='$moh_id';";
		$rslt=mysql_query($stmt, $link);

		$stmtA="DELETE from vicidial_music_on_hold_files where moh_id='$moh_id';";
		$rslt=mysql_query($stmtA, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|$stmtA|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='MOH', event_type='DELETE', record_id='$moh_id', event_code='ADMIN DELETE MOH', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>MUSIC ON HOLD DELETION COMPLETED: $moh_id</B>\n";
		echo "<br><br>\n";
		}
	$ADD='160000000000';		# go to music on hold entry list
	}


######################
# ADD=671111111111 delete voicemail record
######################

if ($ADD==671111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($voicemail_id) < 2) or ($CoNfIrM != 'YES') )
		{
		echo "<br>VOICEMAIL BOX NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Voicemail ID be at least 2 characters in length\n";
		}
	else
		{
		$stmt="DELETE from vicidial_voicemail where voicemail_id='$voicemail_id';";
		$rslt=mysql_query($stmt, $link);

		$stmt="SELECT active_voicemail_server from system_settings;";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$active_voicemail_server = $row[0];

		$stmtA="UPDATE servers SET rebuild_conf_files='Y' where generate_vicidial_conf='Y' and active_asterisk_server='Y' and server_ip='$active_voicemail_server';";
		$rslt=mysql_query($stmtA, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='VOICEMAIL', event_type='DELETE', record_id='$voicemail_id', event_code='ADMIN DELETE VOICEMAIL', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>VOICEMAIL BOX DELETION COMPLETED: $voicemail_id</B>\n";
		echo "<br><br>\n";
		}
	$ADD='170000000000';		# go to voicemail entry list
	}


######################
# ADD=6111111111111 delete conference record
######################

if ($ADD==6111111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($conf_exten) < 2) or (strlen($server_ip) < 7) or ($CoNfIrM != 'YES') or ($LOGast_delete_phones < 1) )
		{
		echo "<br>CONFERENCE NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Conference be at least 2 characters in length\n";
		echo "<br>Server IP be at least 7 characters in length\n";
		}
	else
		{
		$stmt="DELETE from conferences where conf_exten='$conf_exten' and server_ip='$server_ip' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CONFERENCES', event_type='DELETE', record_id='$conf_exten', event_code='ADMIN DELETE CONFERENCE', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>CONFERENCE DELETION COMPLETED: $conf_exten - $server_ip</B>\n";
		echo "<br><br>\n";
		}
	$ADD='1000000000000';		# go to conference list
	}


######################
# ADD=61111111111111 delete CCMS conference record
######################

if ($ADD==61111111111111)
	{
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ( (strlen($conf_exten) < 2) or (strlen($server_ip) < 7) or ($CoNfIrM != 'YES') or ($LOGast_delete_phones < 1) )
		{
		echo "<br>CCMS CONFERENCE NOT DELETED - Please go back and look at the data you entered\n";
		echo "<br>Conference be at least 2 characters in length\n";
		echo "<br>Server IP be at least 7 characters in length\n";
		}
	else
		{
		$stmt="DELETE from vicidial_conferences where conf_exten='$conf_exten' and server_ip='$server_ip' limit 1;";
		$rslt=mysql_query($stmt, $link);

		### LOG INSERTION Admin Log Table ###
		$SQL_log = "$stmt|";
		$SQL_log = ereg_replace(';','',$SQL_log);
		$SQL_log = addslashes($SQL_log);
		$stmt="INSERT INTO vicidial_admin_log set event_date='$SQLdate', user='$PHP_AUTH_USER', ip_address='$ip', event_section='CONFERENCES', event_type='DELETE', record_id='$conf_exten', event_code='ADMIN DELETE CONFERENCE', event_sql=\"$SQL_log\", event_notes='';";
		if ($DB) {echo "|$stmt|\n";}
		$rslt=mysql_query($stmt, $link);

		echo "<br><B>CCMS CONFERENCE DELETION COMPLETED: $conf_exten - $server_ip</B>\n";
		echo "<br><br>\n";
		}
	$ADD='10000000000000';		# go to CCMS conference list
	}





######################################################################################################
######################################################################################################
#######   3 series, record modification forms
######################################################################################################
######################################################################################################

if ($ADD == 120329){	

	$stmt="SELECT user,pass,full_name from vicidial_users where user='$user';";
	$rslt=mysql_query($stmt, $link);
	$row=mysql_fetch_row($rslt);	
	$user =					$row[0];
	$pass =					$row[1];
	$full_name =			$row[2];	
	echo "<br>Change Password: $user<form action=$PHP_SELF method=POST>\n";
	echo "<TABLE><TR><TD>\n";

	echo "<input type=hidden name=ADD value=20120329>\n";
	
	echo "<input type=hidden name=user value=\"$user\">\n";
	
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	echo "<center><TABLE width=$section_width cellspacing=3>\n";
	echo "<tr bgcolor=#FFFFFF><td align=right>User Number: </td><td align=left><b>$user</b></td></tr>\n";
	echo "<tr bgcolor=#FFFFFF><td align=right>Full Name: </td><td align=left><input type=text name=full_name size=30 maxlength=30 value=\"$full_name\"></td></tr>\n";
	echo "<tr bgcolor=#FFFFFF><td align=right>Password: </td><td align=left><input type=text id=pass name=pass size=20 maxlength=10 value=\"$pass\"></td></tr>\n";
	echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT onclick=\"return checkpass();  \"></td></tr>\n";
	echo "</TABLE></center>";
	echo "</TD></TR></TABLE>";
	echo "</form>";
	echo "<script>
	function isNumberOrLetter(s){//判断是否是数字或字母
		var regu = \"^[0-9a-zA-Z]+$\";
		var re = new RegExp(regu);
		if (re.test(s)) {
			return true;
		}else{
			return false;
		}
	}
	function checkpass(){
		var pass = document.getElementById(\"pass\").value;
		if(pass.length < 2 || pass.length> 10){
			alert('密码长度必须 2到10位之间');
			return false;
		}
		if(isNumberOrLetter(pass)!=true){
			alert('密码只允许输入数字和字母类型');
			return false;	
		}
		return true;
	}
	</script>";
	
}

if($ADD==20120329) {
	$user = $_POST['user'];
	//echo $user;
	$pass = $_POST['pass'];
	//echo $pass;
	$stmt = "UPDATE vicidial_users SET pass='$pass',pwd_status='1' where user='$user'";
	//echo $stmt;
	$rslt=mysql_query($stmt, $link);
	$stmt="SELECT ccms_url from system_settings;";
    $rslt=mysql_query($stmt, $link);
    $row=mysql_fetch_row($rslt);
    $ccms_url_link = $row[0];
    $url_link = $ccms_url_link."integrate_vtiger_user.php?user=".$user;
    file("$url_link");
	sleep(2);
	if( (strlen($PHP_AUTH_USER)>0) or (strlen($PHP_AUTH_PW)>0) )
		{
		Header("WWW-Authenticate: Basic realm=\"CCMS\"");
		Header("HTTP/1.0 401 Unauthorized");
		}
	echo "<meta http-equiv=\"refresh\" content=\"0;URL=admin.php\">";
	echo "Please login again. Thank you\n";
	unset($_SESSION['login']);
	if(strlen($PHP_AUTH_USER)>0){
		$NOW_TIME = date("Y-m-d H:i:s");
		$StarTtimE = date("U");
		$stmt="SELECT user_group from vicidial_users where user='$PHP_AUTH_USER';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$user_group	=$row[0];
		$stmt = "INSERT INTO vicidial_user_log (user,event,campaign_id,event_date,event_epoch,user_group) values('$PHP_AUTH_USER','LOGOUT','Admin','$NOW_TIME','$StarTtimE','$user_group')";
		$rslt=mysql_query($stmt, $link);
	}
	exit;
}

######################
# ADD=3 modify user info in the system
######################

if ($ADD==3)
	{
		
	if ($LOGmodify_users==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT user_id,user,pass,full_name,user_level,user_group,phone_login,phone_pass,delete_users,delete_user_groups,delete_lists,delete_campaigns,delete_ingroups,delete_remote_agents,load_leads,campaign_detail,ast_admin_access,ast_delete_phones,delete_scripts,modify_leads,hotkeys_active,change_agent_campaign,agent_choose_ingroups,closer_campaigns,scheduled_callbacks,agentonly_callbacks,agentcall_manual,vicidial_recording,vicidial_transfers,delete_filters,alter_agent_interface_options,closer_default_blended,delete_call_times,modify_call_times,modify_users,modify_campaigns,modify_lists,modify_scripts,modify_filters,modify_ingroups,modify_usergroups,modify_remoteagents,modify_servers,view_reports,vicidial_recording_override,alter_custdata_override,qc_enabled,qc_user_level,qc_pass,qc_finish,qc_commit,add_timeclock_log,modify_timeclock_log,delete_timeclock_log,alter_custphone_override,vdc_agent_api_access,modify_inbound_dids,delete_inbound_dids,active,alert_enabled,download_lists,agent_shift_enforcement_override,manager_shift_enforcement_override,shift_override_flag,export_reports,delete_from_dnc,email,user_code,territory,allow_alerts,agent_choose_territories,custom_one,custom_two,custom_three,custom_four,custom_five,add_new_users,add_new_campaigns,add_new_lists,add_new_usergroups,add_from_dnc,view_historical_reports,live_monitor,search_historical_call,disabled_campaigns,grab_calls_in_queue,view_agent_status,search_voice_mail,add_remoteagentgroups,modify_remoteagentgroups,delete_remoteagentgroups,modify_distribute_lead,modify_call_lead,modify_rollback_lead,modify_archive_lead,modify_abandon_lead,modify_recover_lead from vicidial_users where user='$user';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$user_id =				$row[0];
		$user =					$row[1];
		$pass =					$row[2];
		$full_name =			$row[3];
		$user_level =			$row[4];
		$user_group =			$row[5];
		$phone_login =			$row[6];
		$phone_pass =			$row[7];
		$delete_users =			$row[8];
		$delete_user_groups =	$row[9];
		$delete_lists =			$row[10];
		$delete_campaigns =		$row[11];
		$delete_ingroups =		$row[12];
		$delete_remote_agents =	$row[13];
		$load_leads =			$row[14];
		$campaign_detail =		$row[15];
		$ast_admin_access =		$row[16];
		$ast_delete_phones =	$row[17];
		$delete_scripts =		$row[18];
		$modify_leads =			$row[19];
		$hotkeys_active =		$row[20];
		$change_agent_campaign =$row[21];
		$agent_choose_ingroups =$row[22];
		$scheduled_callbacks =	$row[24];
		$agentonly_callbacks =	$row[25];
		$agentcall_manual =		$row[26];
		$vicidial_recording =	$row[27];
		$vicidial_transfers =	$row[28];
		$delete_filters =		$row[29];
		$alter_agent_interface_options =$row[30];
		$closer_default_blended =		$row[31];
		$delete_call_times =	$row[32];
		$modify_call_times =	$row[33];
		$modify_users =			$row[34];
		$modify_campaigns =		$row[35];
		$modify_lists =			$row[36];
		$modify_scripts =		$row[37];
		$modify_filters =		$row[38];
		$modify_ingroups =		$row[39];
		$modify_usergroups =	$row[40];
		$modify_remoteagents =	$row[41];
		$modify_servers =		$row[42];
		$view_reports =			$row[43];
		$vicidial_recording_override =	$row[44];
		$alter_custdata_override = $row[45];
		$qc_enabled =			$row[46];
		$qc_user_level =		$row[47];
		$qc_pass =				$row[48];
		$qc_finish =			$row[49];
		$qc_commit =			$row[50];
		$add_timeclock_log =	$row[51];
		$modify_timeclock_log = $row[52];
		$delete_timeclock_log = $row[53];
		$alter_custphone_override = $row[54];
		$vdc_agent_api_access = $row[55];
		$modify_inbound_dids =	$row[56];
		$delete_inbound_dids =	$row[57];
		$active =				$row[58];
		$alert_enabled =		$row[59];
		$download_lists =		$row[60];
		$agent_shift_enforcement_override =	$row[61];
		$manager_shift_enforcement_override =	$row[62];
		$export_reports =		$row[64];
		$delete_from_dnc =		$row[65];
		$email =				$row[66];
		$user_code =			$row[67];
		$territory =			$row[68];
		$allow_alerts =			$row[69];
		$agent_choose_territories = $row[70];
		$user_custom_one =		$row[71];
		$user_custom_two =		$row[72];
		$user_custom_three =	$row[73];
		$user_custom_four =		$row[74];
		$user_custom_five =		$row[75];
		$add_new_users = 		$row[76];
		$add_new_campaigns = 	$row[77];
		$add_new_lists = 		$row[78];
		$add_new_usergroups = 	$row[79];
		$add_from_dnc = 		$row[80];
		$view_historical_reports = $row[81];
		$live_monitor			=$row[82];
		$search_historical_call =$row[83];
		$disabled_campaigns =    $row[84];
		$grab_calls_in_queue = 	 $row[85];
		$view_agent_status =	 $row[86];
		$search_voice_mail = $row[87];
		$add_remoteagentgroups = $row[88];
		$modify_remoteagentgroups = $row[89];
		$delete_remoteagentgroups = $row[90];
		$modify_distribute_lead = $row[91];
		$modify_call_lead = $row[92];
		$modify_rollback_lead = $row[93];
		$modify_archive_lead = $row[94];
		$modify_abandon_lead = $row[95];
		$modify_recover_lead = $row[96];
		if ( ($user_level >= $LOGuser_level) and ($LOGuser_level < 9) and ($user != $LOGuser_name_id) )
			{
			echo "<br>You do not have permissions to modify this user: $user\n";
			}
		else
			{
			echo "<br>MODIFY A USERS RECORD: $user<form action=$PHP_SELF method=POST>\n";
			if ($LOGuser_level > 8)
				{echo "<input type=hidden name=ADD value=4A>\n";}
			else
				{
				if ($LOGalter_agent_interface == "1")
					{echo "<input type=hidden name=ADD value=4B>\n";}
				else
					{echo "<input type=hidden name=ADD value=4>\n";}
				}
			echo "<input type=hidden name=user value=\"$user\">\n";
			echo "<center><TABLE width=$section_width cellspacing=3>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>User Number: </td><td align=left><b>$user</b>$NWB#vicidial_users-user$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>Password: </td><td align=left><input type=text id=pass name=pass size=20 maxlength=10 value=\"$pass\">$NWB#vicidial_users-pass$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>Full Name: </td><td align=left><input type=text name=full_name size=30 maxlength=30 value=\"$full_name\">$NWB#vicidial_users-full_name$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>User Level(Role): </td><td align=left><select size=1 name=user_level id=user_level onchange=\"CHANGE_ADMIN_INTERFACE_OPTIONS();\">";
			$h=1;
			$user_level_arr = array("5"=>"Agent","6"=>"QA","7"=>"Supervisor","8"=>"Manager","9"=>"Admin");
			foreach($user_level_arr as $k=>$v){
				if($k<=$LOGuser_level){
					if($k==$user_level){
						echo "<option value=\"".$k."\" SELECTED>" . $v . "</option>";
					}else{
						echo "<option value=\"".$k."\">" . $v . "</option>";
					}
				}
			}
			echo "</select>$NWB#vicidial_users-user_level$NWE</td></tr>\n";
			if ( ($LOGuser_level > 8) or ($LOGalter_agent_interface == "1") ){
				echo "<tr bgcolor=#FFFFFF><td align=right><A HREF=\"$PHP_SELF?ADD=311111&user_group=$user_group\">User Group</A>: </td><td align=left><select size=1 name=user_group id=user_group onchange=\"changeCampaignByUsergroup('$disabled_campaigns','$user_level','$user');\">\n";
			}else{
				echo "<tr bgcolor=#FFFFFF><td align=right><A HREF=\"$PHP_SELF?ADD=311111&user_group=$user_group\">User Group</A>: </td><td align=left><select size=1 name=user_group id=user_group onchange=\"checkUserLevelOptions('$user_level','$user');\">\n";
			}
			
			/* comment by heibo 2011-4-22 9:38:41 统一成一个函数
			if($LOGuser_level==9){
				$stmt="SELECT user_group,group_name from vicidial_user_groups order by user_group";
			}else{
				$stmt="SELECT user_group,group_name from vicidial_user_groups where supervisor='$LOGuser_name_id' or manager='$LOGuser_name_id' order by user_group";
			}
			*/
			$stmt = getUserGroupsList($LOGuser_level,$LOGuser_name_id,1);
			$rslt=mysql_query($stmt, $link);
			$Ugroups_to_print = mysql_num_rows($rslt);
			$Ugroups_list='';
			$o=0;
			while ($Ugroups_to_print > $o) 
				{
				$rowx=mysql_fetch_row($rslt);
				$Ugroups_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
				$o++;
				}
			echo "$Ugroups_list";
			echo "<option SELECTED>$user_group</option>\n";
			echo "</select>$NWB#vicidial_users-user_group$NWE</td></tr>\n";
			if ($LOGuser_level < 9){
				echo "<input type=hidden name=view_reports id=view_reports value=$view_reports>\n";
				echo "<input type=hidden name=alter_agent_interface_options id=alter_agent_interface_options value=$alter_agent_interface_options>\n";
				echo "<input type=hidden name=modify_users id=modify_users value=$modify_users>\n";
				echo "<input type=hidden name=change_agent_campaign id=change_agent_campaign value=$change_agent_campaign>\n";
				echo "<input type=hidden name=delete_users id=delete_users value=$delete_users>\n";
				echo "<input type=hidden name=modify_usergroups id=modify_usergroups value=$modify_usergroups>\n";
				echo "<input type=hidden name=delete_user_groups id=delete_user_groups value=$delete_user_groups>\n";
				echo "<input type=hidden name=modify_lists id=modify_lists value=$modify_lists>\n";
				echo "<input type=hidden name=delete_lists id=delete_lists value=$delete_lists>\n";
				echo "<input type=hidden name=load_leads id=load_leads value=$load_leads>\n";
				echo "<input type=hidden name=modify_leads id=modify_leads value=$modify_leads>\n";
				echo "<input type=hidden name=download_lists id=download_lists value=$download_lists>\n";
				echo "<input type=hidden name=export_reports id=export_reports value=$export_reports>\n";
				echo "<input type=hidden name=delete_from_dnc id=delete_from_dnc value=$delete_from_dnc>\n";
				echo "<input type=hidden name=modify_campaigns id=modify_campaigns value=$modify_campaigns>\n";
				echo "<input type=hidden name=campaign_detail id=campaign_detail value=$campaign_detail>\n";
				echo "<input type=hidden name=delete_campaigns id=delete_campaigns value=$delete_campaigns>\n";
				echo "<input type=hidden name=modify_ingroups id=modify_ingroups value=$modify_ingroups>\n";
				echo "<input type=hidden name=delete_ingroups id=delete_ingroups value=$delete_ingroups>\n";
				echo "<input type=hidden name=modify_inbound_dids id=modify_inbound_dids value=$modify_inbound_dids>\n";
				echo "<input type=hidden name=delete_inbound_dids id=delete_inbound_dids value=$delete_inbound_dids>\n";
				echo "<input type=hidden name=modify_remoteagents id=modify_remoteagents value=$modify_remoteagents>\n";
				echo "<input type=hidden name=delete_remote_agents id=delete_remote_agents value=$delete_remote_agents>\n";
				echo "<input type=hidden name=modify_scripts id=modify_scripts value=$modify_scripts>\n";
				echo "<input type=hidden name=delete_scripts id=delete_scripts value=$delete_scripts>\n";
				echo "<input type=hidden name=modify_filters id=modify_filters value=$modify_filters>\n";
				echo "<input type=hidden name=delete_filters id=delete_filters value=$delete_filters>\n";
				echo "<input type=hidden name=ast_admin_access id=ast_admin_access value=$ast_admin_access>\n";
				echo "<input type=hidden name=ast_delete_phones id=ast_delete_phones value=$ast_delete_phones>\n";
				echo "<input type=hidden name=modify_call_times id=modify_call_times value=$modify_call_times>\n";
				echo "<input type=hidden name=delete_call_times id=delete_call_times value=$delete_call_times>\n";
				echo "<input type=hidden name=modify_servers id=modify_servers value=$modify_servers>\n";
				echo "<input type=hidden name=vdc_agent_api_access id=vdc_agent_api_access value=$vdc_agent_api_access>\n";
				echo "<input type=hidden name=add_timeclock_log id=add_timeclock_log value=$add_timeclock_log>\n";
				echo "<input type=hidden name=modify_timeclock_log id=modify_timeclock_log value=$modify_timeclock_log>\n";
				echo "<input type=hidden name=delete_timeclock_log id=delete_timeclock_log value=$delete_timeclock_log>\n";
				echo "<input type=hidden name=manager_shift_enforcement_override id=manager_shift_enforcement_override value=$manager_shift_enforcement_override>\n";
				
				echo "<input type=hidden name=add_new_users id=add_new_users value=$add_new_users>\n";
				echo "<input type=hidden name=add_new_campaigns id=add_new_campaigns value=$add_new_campaigns>\n";
				echo "<input type=hidden name=add_new_lists id=add_new_lists value=$add_new_lists>\n";
				echo "<input type=hidden name=add_new_usergroups id=add_new_usergroups value=$add_new_usergroups>\n";
				echo "<input type=hidden name=add_from_dnc id=add_from_dnc value=$add_from_dnc>\n";
				echo "<input type=hidden name=view_historical_reports id=view_historical_reports value=$view_historical_reports>\n";
				echo "<input type=hidden name=live_monitor id=live_monitor value=$live_monitor>\n";
				echo "<input type=hidden name=search_historical_call id=search_historical_call value=$search_historical_call>\n";
				echo "<input type=hidden name=search_voice_mail id=search_voice_mail value=$search_voice_mail>\n";
			}
			echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Phone Login: </td><td align=left><input type=text name=phone_login size=20 maxlength=20 value=\"$phone_login\">$NWB#vicidial_users-phone_login$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Phone Pass: </td><td align=left><input type=text name=phone_pass size=20 maxlength=20 value=\"$phone_pass\">$NWB#vicidial_users-phone_pass$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option>N</option><option SELECTED>$active</option></select>$NWB#vicidial_users-active$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Email: </td><td align=left><input type=text name=email size=40 maxlength=100 value=\"$email\">$NWB#vicidial_users-optional$NWE</td></tr>\n";
			/*modify by fnatic  播报坐席code 
			echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>User Code: </td><td align=left><input type=text name=user_code size=40 maxlength=100 value=\"$user_code\">$NWB#vicidial_users-optional$NWE</td></tr>\n";
			*/
			echo "<tr bgcolor=#FFFFFF ><td align=right>User Code: </td><td align=left><input type=text name=user_code size=40 maxlength=100 value=\"$user_code\">$NWB#vicidial_users-optional$NWE</td></tr>\n";
			/*
			结束
			*/
			echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Main Territory: </td><td align=left><input type=text name=territory size=40 maxlength=100 value=\"$territory\">$NWB#vicidial_users-optional$NWE</td></tr>\n";

			if ($SSuser_territories_active > 0)
				{
				$stmt="SELECT vut.territory,vt.territory_description from vicidial_user_territories vut,vicidial_territories vt where user='$user' and vut.territory=vt.territory;";
				$rslt=mysql_query($stmt, $link);
				$Uterrs_to_print = mysql_num_rows($rslt);
				$Uterrs_list='';
				$o=0;
				while ($Uterrs_to_print > $o) 
					{
					$rowx=mysql_fetch_row($rslt);
					$Uterrs_list .= "$rowx[0] - $rowx[1]<BR>\n";
					$o++;
					}
				echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"user_territories.php\">User Territories</a>: </td><td align=left>$Uterrs_list</tr>\n";
				}

			if ( ($LOGuser_level > 8) or ($LOGalter_agent_interface == "1") )
				{
				echo "<tr bgcolor=#015B91><td colspan=2 align=center><font color=white><B>AGENT INTERFACE OPTIONS:</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>Agent Choose Ingroups: </td><td align=left><select size=1 name=agent_choose_ingroups><option value=0>N</option><option value=1>Y</option><option SELECTED value=$agent_choose_ingroups>";
				if($agent_choose_ingroups==0){echo "N";}elseif($agent_choose_ingroups==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-agent_choose_ingroups$NWE</td></tr>\n";
				if ($SSuser_territories_active > 0)
					{
					echo "<tr bgcolor=#FFFFFF><td align=right>Agent Choose Territories: </td><td align=left><select size=1 name=agent_choose_territories><option value=0>N</option><option value=1>Y</option><option SELECTED value=$agent_choose_territories>";
					if($agent_choose_territories==0){echo "N";}elseif($agent_choose_territories==1){echo "Y";}
					echo "</option></select>$NWB#vicidial_users-agent_choose_territories$NWE</td></tr>\n";
					}
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>Hot Keys Active: </td><td align=left><select size=1 name=hotkeys_active><option value=0>N</option><option value=1>Y</option><option SELECTED value=$hotkeys_active>";
				if($hotkeys_active==0){echo "N";}elseif($hotkeys_active==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-hotkeys_active$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>CCMS Recording: </td><td align=left><select size=1 name=vicidial_recording><option value=0>N</option><option value=1>Y</option><option SELECTED value=$vicidial_recording>";
				if($vicidial_recording==0){echo "N";}elseif($vicidial_recording==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-vicidial_recording$NWE</td></tr>\n";
				//CCMS Transfers
				echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Transfers: </td><td align=left><select size=1 name=vicidial_transfers><option value=0>N</option><option value=1>Y</option><option SELECTED value=$vicidial_transfers>";
				if($vicidial_transfers==0){echo "N";}elseif($vicidial_transfers==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-vicidial_transfers$NWE</td></tr>\n";
				if ($SSoutbound_autodial_active > 0)
					{
					echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>Closer Default Blended: </td><td align=left><select size=1 name=closer_default_blended><option value=0>N</option><option value=1>Y</option><option SELECTED value=$closer_default_blended>";
					if($closer_default_blended==0){echo "N";}elseif($closer_default_blended==1){echo "Y";}
					echo "</option></select>$NWB#vicidial_users-closer_default_blended$NWE</td></tr>\n";
					}
				//Agent Call Manual
				echo "<tr bgcolor=#FFFFFF><td align=right>Agent Call Manual: </td><td align=left><select size=1 name=agentcall_manual><option value=0>N</option><option value=1>Y</option><option SELECTED value=$agentcall_manual>";
				if($agentcall_manual==0){echo "N";}elseif($agentcall_manual==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-agentcall_manual$NWE</td></tr>\n";
				//View Agent Status
				echo "<tr bgcolor=#FFFFFF><td align=right>View Agent Status: </td><td align=left><select size=1 name=view_agent_status><option>N</option><option>Y</option><option SELECTED>$view_agent_status</option></select>$NWB#vicidial_users-view_agent_status$NWE</td></tr>\n";
				//Allow Alerts:
				echo "<tr bgcolor=#FFFFFF><td align=right>Allow Alerts: </td><td align=left><select size=1 name=allow_alerts><option value=0>N</option><option value=1>Y</option><option SELECTED value=$allow_alerts>";
				if($allow_alerts==0){echo "N";}elseif($allow_alerts==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-allow_alerts$NWE</td></tr>\n";
				//Agent Grab Calls in Queue
				echo "<tr bgcolor=#FFFFFF><td align=right>Agent Grab Calls in Queue: </td><td align=left><select size=1 name=grab_calls_in_queue><option>N</option><option>Y</option><option SELECTED>$grab_calls_in_queue</option></select>$NWB#vicidial_campaigns-grab_calls_in_queue$NWE</td></tr>\n";
				//Scheduled Callbacks
				echo "<tr bgcolor=#FFFFFF><td align=right>Scheduled Callbacks: </td><td align=left><select size=1 name=scheduled_callbacks><option value=0>N</option><option value=1>Y</option><option SELECTED value=$scheduled_callbacks>";
				if($scheduled_callbacks==0){echo "N";}elseif($scheduled_callbacks==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-scheduled_callbacks$NWE</td></tr>\n";
				//Agent-Only Callbacks
				echo "<tr bgcolor=#FFFFFF><td align=right>Agent-Only Callbacks: </td><td align=left><select size=1 name=agentonly_callbacks><option value=0>N</option><option value=1>Y</option><option SELECTED value=$agentonly_callbacks>";
				if($agentonly_callbacks==0){echo "N";}elseif($agentonly_callbacks==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-agentonly_callbacks$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>CCMS Recording Override: </td><td align=left><select size=1 name=vicidial_recording_override><option>DISABLED</option><option>NEVER</option><option>ONDEMAND</option><option>ALLCALLS</option><option>ALLFORCE</option><option SELECTED>$vicidial_recording_override</option></select>$NWB#vicidial_users-vicidial_recording_override$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>Agent Alter Customer Data Override: </td><td align=left><select size=1 name=alter_custdata_override><option>NOT_ACTIVE</option><option>ALLOW_ALTER</option><option SELECTED>$alter_custdata_override</option></select>$NWB#vicidial_users-alter_custdata_override$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>Agent Alter Customer Phone Override: </td><td align=left><select size=1 name=alter_custphone_override><option>NOT_ACTIVE</option><option>ALLOW_ALTER</option><option SELECTED>$alter_custphone_override</option></select>$NWB#vicidial_users-alter_custphone_override$NWE</td></tr>\n";

				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>Agent Shift Enforcement Override: </td><td align=left><select size=1 name=agent_shift_enforcement_override><option>DISABLED</option><option>OFF</option><option>START</option><option>ALL</option><option SELECTED>$agent_shift_enforcement_override</option></select>$NWB#vicidial_users-agent_shift_enforcement_override$NWE</td></tr>\n";
				
				/*
				echo "<tr bgcolor=#FFFFFF><td align=right>Alert Enabled: </td><td align=left>";
				if($alert_enabled==0){echo "N";}elseif($alert_enabled==1){echo "Y";}
				echo "$NWB#vicidial_users-alert_enabled$NWE</td></tr>\n";
				*/
				
				
				
				$stmt="SELECT allowed_campaigns from vicidial_user_groups where user_group='$user_group';";
				
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);
				if ( (!eregi("ALL-CAMPAIGNS",$row[0])) )
				{
				$LOGallowed_campaignsSQL = eregi_replace(' -','',$row[0]);
				$LOGallowed_campaignsSQL = eregi_replace(' ',"','",$LOGallowed_campaignsSQL);
				$LOGallowed_campaignsSQL = "and campaign_id IN('$LOGallowed_campaignsSQL')";
				}
				
				$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns where active='Y' $LOGallowed_campaignsSQL order by campaign_id;";
				if ($non_latin > 0) {$rslt=mysql_query("SET NAMES 'UTF8'");}
				$rslt=mysql_query($stmt, $link);
				$camps_to_print = mysql_num_rows($rslt);
				$o=0;
				$campaigns_list_user = "";
				$all_campaigns_hidden = "";
				while ($camps_to_print > $o) 
				{
					$rowx=mysql_fetch_row($rslt);
					$str_check = "";
					if ( (!eregi($rowx[0] . ',',$disabled_campaigns)) ){
						$str_check = " checked";
						//echo $rowx[0] . '--';
					}
					$bg = "#C2C2C2";
					if($o%2!=0){
						$bg = "$ffffff";	
					}
					$campaigns_list_user .= "<tr bgcolor=\"$bg\"><td><input name=\"al_campaign[]\" value=\"$rowx[0]\" type=\"checkbox\" $str_check/>$rowx[0] - $rowx[1]</td></tr>\n";
					$all_campaigns_hidden .= $rowx[0] . ",";
					$o++;
				}
				
				echo "<tr bgcolor=#FFFFFF><td align=center colspan=2>Allowed Campaigns: $NWB#allowed-campaigns$NWE<BR>\n";
				echo "<span id=campaign_span_html>";
				echo "<table border=0><input type=\"hidden\" name=\"all_campaigns_hidden\" value=\"$all_campaigns_hidden\" />\n";
				echo "$campaigns_list_user";
				echo "</table>\n";
				echo "</span>";
				echo "</td></tr>\n";
				
				$RANKgroups_list = getIngroupHtml($user);
				
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=center colspan=2>Campaign Ranks: $NWB#vicidial_users-campaign_ranks$NWE<BR>\n";
				echo "<table border=0 style=\"display:none\">\n";
				echo "$RANKcampaigns_list";
				echo "</table>\n";
				echo "</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=center colspan=2>Inbound Groups: $NWB#vicidial_users-closer_campaigns$NWE<BR>\n";
				echo "<table border=0>\n";
				echo "$RANKgroups_list";
				echo "</table>\n";
				echo "</td></tr>\n";

				//edit start by pie 2010-12-28 ;
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>Custom 1: </td><td align=left><input type=text name=custom_one size=50 maxlength=100 value=\"$user_custom_one\">$NWB#vicidial_users-custom_one$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>Custom 2: </td><td align=left><input type=text name=custom_two size=50 maxlength=100 value=\"$user_custom_two\">$NWB#vicidial_users-custom_two$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>Custom 3: </td><td align=left><input type=text name=custom_three size=50 maxlength=100 value=\"$user_custom_three\">$NWB#vicidial_users-custom_three$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>Custom 4: </td><td align=left><input type=text name=custom_four size=50 maxlength=100 value=\"$user_custom_four\">$NWB#vicidial_users-custom_four$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none\"><td align=right>Custom 5: </td><td align=left><input type=text name=custom_five size=50 maxlength=100 value=\"$user_custom_five\">$NWB#vicidial_users-custom_five$NWE</td></tr>\n";
				//edit end;

				if ($SSqc_features_active > 0)
					{
					echo "<tr bgcolor=#C2C2C2><td align=right>QC Enabled: </td><td align=left><select size=1 name=qc_enabled><option value=0>N</option><option value=1>Y</option><option SELECTED value=$qc_enabled>";
					if($qc_enabled==0){echo "N";}elseif($qc_enabled==1){echo "Y";}
					echo "</option></select>$NWB#vicidial_users-qc_enabled$NWE</td></tr>\n";
					echo "<tr bgcolor=#C2C2C2><td align=right>QC User Level: </td><td align=left><select size=1 name=qc_user_level><option value=1>1 - Modify Nothing</option><option value=2>2 - Modify Nothing Except Status</option><option value=3>3 - Modify All Fields</option><option value=4>4 - Verify First Round of QC</option><option value=5>5 - View QC Statistics</option><option value=6>6 - Ability to Modify FINISHed records</option><option value=7>7 - Manager Level</option><option SELECTED>$qc_user_level</option></select>$NWB#vicidial_users-qc_user_level$NWE</td></tr>\n";
					echo "<tr bgcolor=#C2C2C2><td align=right>QC Pass: </td><td align=left><select size=1 name=qc_pass><option value=0>N</option><option value=1>Y</option><option SELECTED value=$qc_pass>";
					if($qc_pass==0){echo "N";}elseif($qc_pass==1){echo "Y";}
					echo "</option></select>$NWB#vicidial_users-qc_pass$NWE</td></tr>\n";
					echo "<tr bgcolor=#C2C2C2><td align=right>QC Finish: </td><td align=left><select size=1 name=qc_finish><option value=0>N</option><option value=1>Y</option><option SELECTED value=$qc_finish>";
					if($qc_finish==0){echo "N";}elseif($qc_finish==1){echo "Y";}
					echo "</option></select>$NWB#vicidial_users-qc_finish$NWE</td></tr>\n";
					echo "<tr bgcolor=#C2C2C2><td align=right>QC Commit: </td><td align=left><select size=1 name=qc_commit><option value=0>N</option><option value=1>Y</option><option SELECTED value=$qc_commit>";
					if($qc_commit==0){echo "N";}elseif($qc_commit==1){echo "Y";}
					echo "</option></select>$NWB#vicidial_users-qc_commit$NWE</td></tr>\n";
					}
				}
			if ($LOGuser_level > 8)
				{
				echo "<tr bgcolor=#015B91><td colspan=2 align=center><font color=white><B>ADMIN INTERFACE OPTIONS:</td></tr>\n";

				#C2C2C2
				#FFFFFF
				echo "<tr bgcolor=#C2C2C2><td align=right>View Real-Time Reports: </td><td align=left><select size=1 name=view_reports><option value=0>N</option><option value=1>Y</option><option SELECTED value=$view_reports>";
				if($view_reports==0){echo "N";}elseif($view_reports==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-view_reports$NWE</td></tr>\n";
				echo "<tr bgcolor=#C2C2C2><td align=right>View Historical Reports: </td><td align=left><select size=1 name=view_historical_reports><option value=0>N</option><option value=1>Y</option><option SELECTED value=$view_historical_reports>";
				if($view_historical_reports==0){echo "N";}elseif($view_historical_reports==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-view_istorical_reports$NWE</td></tr>\n";
				echo "<tr bgcolor=#C2C2C2><td align=right>Live Monitor: </td><td align=left><select size=1 name=live_monitor><option value=0>N</option><option value=1>Y</option><option SELECTED value=$live_monitor>";
				if($live_monitor==0){echo "N";}elseif($live_monitor==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-live_monitor$NWE</td></tr>\n";
				echo "<tr bgcolor=#C2C2C2><td align=right>Search Call Log: </td><td align=left><select size=1 name=search_historical_call><option value=0>N</option><option value=1>Y</option><option SELECTED value=$search_historical_call>";
				if($search_historical_call==0){echo "N";}elseif($search_historical_call==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-search_call_log$NWE</td></tr>\n";
				echo "<tr bgcolor=#C2C2C2><td align=right>Search Voice mail: </td><td align=left><select size=1 name=search_voice_mail><option value=0>N</option><option value=1>Y</option><option SELECTED value=$search_historical_call>";
				if($search_voice_mail==0){echo "N";}elseif($search_voice_mail==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-search_voice_mail$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Alter Agent Interface Options: </td><td align=left><select size=1 name=alter_agent_interface_options><option value=0>N</option><option value=1>Y</option><option SELECTED value=$alter_agent_interface_options>";
				if($alter_agent_interface_options==0){echo "N";}elseif($alter_agent_interface_options==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-alter_agent_interface_options$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Add New Users: </td><td align=left><select size=1 name=add_new_users><option value=0>N</option><option value=1>Y</option><option SELECTED value=$add_new_users>";
				if($add_new_users==0){echo "N";}elseif($add_new_users==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-add_new_users$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Modify Users: </td><td align=left><select size=1 name=modify_users><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_users>";
				if($modify_users==0){echo "N";}elseif($modify_users==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_sections$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Change Agent Campaign: </td><td align=left><select size=1 name=change_agent_campaign><option value=0>N</option><option value=1>Y</option><option SELECTED value=$change_agent_campaign>";
				if($change_agent_campaign==0){echo "N";}elseif($change_agent_campaign==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-change_agent_campaign$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Delete Users: </td><td align=left><select size=1 name=delete_users><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_users>";
				if($delete_users==0){echo "N";}elseif($delete_users==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-delete_users$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#C2C2C2><td align=right>Add New User Groups: </td><td align=left><select size=1 name=add_new_usergroups><option value=0>N</option><option value=1>Y</option><option SELECTED value=$add_new_usergroups>";
				if($add_new_usergroups==0){echo "N";}elseif($add_new_usergroups==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-add_new_user_groups$NWE</td></tr>\n";
				echo "<tr bgcolor=#C2C2C2><td align=right>Modify User Groups: </td><td align=left><select size=1 name=modify_usergroups><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_usergroups>";
				if($modify_usergroups==0){echo "N";}elseif($modify_usergroups==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_sections$NWE</td></tr>\n";
				echo "<tr bgcolor=#C2C2C2><td align=right>Delete User Groups: </td><td align=left><select size=1 name=delete_user_groups><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_user_groups>";
				if($delete_user_groups==0){echo "N";}elseif($delete_user_groups==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-delete_user_groups$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#FFFFFF><td align=right>Add New Lists: </td><td align=left><select size=1 name=add_new_lists><option value=0>N</option><option value=1>Y</option><option SELECTED value=$add_new_lists>";
				if($add_new_lists==0){echo "N";}elseif($add_new_lists==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-add_new_lists$NWE</td></tr>\n";

				echo "<tr bgcolor=#FFFFFF><td align=right>Modify Lists: </td><td align=left><select size=1 name=modify_lists><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_lists>";
				if($modify_lists==0){echo "N";}elseif($modify_lists==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_sections$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Delete Lists: </td><td align=left><select size=1 name=delete_lists><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_lists>";
				if($delete_lists==0){echo "N";}elseif($delete_lists==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-delete_lists$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Load Leads: </td><td align=left><select size=1 name=load_leads><option value=0>N</option><option value=1>Y</option><option SELECTED value=$load_leads>";
				if($load_leads==0){echo "N";}elseif($load_leads==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-load_leads$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Modify Leads: </td><td align=left><select size=1 name=modify_leads><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_leads>";
				if($modify_leads==0){echo "N";}elseif($modify_leads==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_leads$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Download Lists: </td><td align=left><select size=1 name=download_lists><option value=0>N</option><option value=1>Y</option><option SELECTED value=$download_lists>";
				if($download_lists==0){echo "N";}elseif($download_lists==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_leads$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Export Reports: </td><td align=left><select size=1 name=export_reports><option value=0>N</option><option value=1>Y</option><option SELECTED value=$export_reports>";
				if($export_reports==0){echo "N";}elseif($export_reports==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-export_reports$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Add Number From DNC Lists: </td><td align=left><select size=1 name=add_from_dnc><option value=0>N</option><option value=1>Y</option><option SELECTED value=$add_from_dnc>";
				if($add_from_dnc==0){echo "N";}elseif($add_from_dnc==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-add_from_dnc$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Delete Number From DNC Lists: </td><td align=left><select size=1 name=delete_from_dnc><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_from_dnc>";
				if($delete_from_dnc==0){echo "N";}elseif($delete_from_dnc==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-delete_from_dnc$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#C2C2C2><td align=right>Add New Campaigns: </td><td align=left><select size=1 name=add_new_campaigns><option value=0>N</option><option value=1>Y</option><option SELECTED value=$add_new_campaigns>";
				if($add_new_campaigns==0){echo "N";}elseif($add_new_campaigns==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-add_new_campaigns$NWE</td></tr>\n";
				echo "<tr bgcolor=#C2C2C2><td align=right>Modify Campaigns: </td><td align=left><select size=1 name=modify_campaigns><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_campaigns>";
				if($modify_campaigns==0){echo "N";}elseif($modify_campaigns==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_sections$NWE</td></tr>\n";
				echo "<tr bgcolor=#C2C2C2><td align=right>Campaign Detail: </td><td align=left><select size=1 name=campaign_detail><option value=0>N</option><option value=1>Y</option><option SELECTED value=$campaign_detail>";
				if($campaign_detail==0){echo "N";}elseif($campaign_detail==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-campaign_detail$NWE</td></tr>\n";
				echo "<tr bgcolor=#C2C2C2><td align=right>Delete Campaigns: </td><td align=left><select size=1 name=delete_campaigns><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_campaigns>";
				if($delete_campaigns==0){echo "N";}elseif($delete_campaigns==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-delete_campaigns$NWE</td></tr>\n";

				echo "<tr bgcolor=#FFFFFF><td align=right>Modify In-Groups: </td><td align=left><select size=1 name=modify_ingroups><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_ingroups>";
				if($modify_ingroups==0){echo "N";}elseif($modify_ingroups==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_sections$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Delete In-Groups: </td><td align=left><select size=1 name=delete_ingroups><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_ingroups>";
				if($delete_ingroups==0){echo "N";}elseif($delete_ingroups==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-delete_ingroups$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Modify DIDs: </td><td align=left><select size=1 name=modify_inbound_dids><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_inbound_dids>";
				if($modify_inbound_dids==0){echo "N";}elseif($modify_inbound_dids==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_sections$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Delete DIDs: </td><td align=left><select size=1 name=delete_inbound_dids><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_inbound_dids>";
				if($delete_inbound_dids==0){echo "N";}elseif($delete_inbound_dids==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-delete_ingroups$NWE</td></tr>\n";

				echo "<tr bgcolor=#C2C2C2><td align=right>Modify Remote Agents: </td><td align=left><select size=1 name=modify_remoteagents><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_remoteagents>";
				if($modify_remoteagents==0){echo "N";}elseif($modify_remoteagents==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_sections$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#C2C2C2><td align=right>Delete Remote Agents: </td><td align=left><select size=1 name=delete_remote_agents><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_remote_agents>";
				if($delete_remote_agents==0){echo "N";}elseif($delete_remote_agents==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-delete_remote_agents$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#C2C2C2><td align=right>Add Remote Agent Groups: </td><td align=left><select size=1 name=add_remoteagentgroups><option value=0>N</option><option value=1>Y</option><option SELECTED value=$add_remoteagentgroups>";
				if($add_remoteagentgroups==0){echo "N";}elseif($add_remoteagentgroups==1){echo "Y";}
				echo "</option></select></td></tr>\n";

				
				echo "<tr bgcolor=#C2C2C2><td align=right>Modify Remote Agent Groups: </td><td align=left><select size=1 name=modify_remoteagentgroups><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_remoteagentgroups>";
				if($modify_remoteagentgroups==0){echo "N";}elseif($modify_remoteagentgroups==1){echo "Y";}
				echo "</option></select></td></tr>\n";
				echo "<tr bgcolor=#C2C2C2><td align=right>Delete Remote Agent Groups:</td><td align=left><select size=1 name=delete_remoteagentgroups><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_remoteagentgroups>";
				if($delete_remoteagentgroups==0){echo "N";}elseif($delete_remoteagentgroups==1){echo "Y";}
				echo "</option></select></td></tr>\n";
				
				

				echo "<tr bgcolor=#FFFFFF><td align=right>Modify Scripts: </td><td align=left><select size=1 name=modify_scripts><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_scripts>";
				if($modify_scripts==0){echo "N";}elseif($modify_scripts==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_sections$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Delete Scripts: </td><td align=left><select size=1 name=delete_scripts><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_scripts>";
				if($delete_scripts==0){echo "N";}elseif($delete_scripts==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-delete_scripts$NWE</td></tr>\n";

				if ($SSoutbound_autodial_active > 0)
					{
					echo "<tr bgcolor=#C2C2C2><td align=right>Modify Filters: </td><td align=left><select size=1 name=modify_filters><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_filters>";
					if($modify_filters==0){echo "N";}elseif($modify_filters==1){echo "Y";}
					echo "</option></select>$NWB#vicidial_users-modify_sections$NWE</td></tr>\n";
					echo "<tr bgcolor=#C2C2C2><td align=right>Delete Filters: </td><td align=left><select size=1 name=delete_filters><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_filters>";
					if($delete_filters==0){echo "N";}elseif($delete_filters==1){echo "Y";}
					echo "</option></select>$NWB#vicidial_users-delete_filters$NWE</td></tr>\n";
					}
				echo "<tr bgcolor=#FFFFFF><td align=right>AGC Admin Access: </td><td align=left><select size=1 name=ast_admin_access><option value=0>N</option><option value=1>Y</option><option SELECTED value=$ast_admin_access>";
				if($ast_admin_access==0){echo "N";}elseif($ast_admin_access==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-ast_admin_access$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>AGC Delete Phones: </td><td align=left><select size=1 name=ast_delete_phones><option value=0>N</option><option value=1>Y</option><option SELECTED value=$ast_delete_phones>";if($ast_delete_phones==0){echo "N";}elseif($ast_delete_phones==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-ast_delete_phones$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Modify Call Times: </td><td align=left><select size=1 name=modify_call_times><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_call_times>";
				if($modify_call_times==0){echo "N";}elseif($modify_call_times==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_call_times$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Delete Call Times: </td><td align=left><select size=1 name=delete_call_times><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_call_times>";
				if($delete_call_times==0){echo "N";}elseif($delete_call_times==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-delete_call_times$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Modify Servers: </td><td align=left><select size=1 name=modify_servers><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_servers>";
				if($modify_servers==0){echo "N";}elseif($modify_servers==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_sections$NWE</td></tr>\n";
				echo "<tr bgcolor=#FFFFFF><td align=right>Agent API Access: </td><td align=left><select size=1 name=vdc_agent_api_access><option value=0>N</option><option value=1>Y</option><option SELECTED value=$vdc_agent_api_access>";
				if($vdc_agent_api_access==0){echo "N";}elseif($vdc_agent_api_access==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-vdc_agent_api_access$NWE</td></tr>\n";

				//add by fox for lead workflow;
				//modify_distribute_lead,modify_call_lead,modify_rollback_lead,modify_archive_lead,modify_abandon_lead,modify_recover_lead
				
				echo "<tr bgcolor=#C2C2C2><td align=right>Distribute Lead Access: </td><td align=left><select size=1 name=modify_distribute_lead><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_distribute_lead>";
				if($modify_distribute_lead==0){echo "N";}elseif($modify_distribute_lead==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_distribute_lead$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#C2C2C2><td align=right>Call Lead Access: </td><td align=left><select size=1 name=modify_call_lead><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_call_lead>";
				if($modify_call_lead==0){echo "N";}elseif($modify_call_lead==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_call_lead$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#C2C2C2><td align=right>Rollback Lead Access: </td><td align=left><select size=1 name=modify_rollback_lead><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_rollback_lead>";
				if($modify_rollback_lead==0){echo "N";}elseif($modify_rollback_lead==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_rollback_lead$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#C2C2C2><td align=right>Archive Lead Access: </td><td align=left><select size=1 name=modify_archive_lead><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_archive_lead>";
				if($modify_archive_lead==0){echo "N";}elseif($modify_archive_lead==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_archive_lead$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#C2C2C2><td align=right>Abandon Lead Access: </td><td align=left><select size=1 name=modify_abandon_lead><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_abandon_lead>";
				if($modify_abandon_lead==0){echo "N";}elseif($modify_abandon_lead==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_abandon_lead$NWE</td></tr>\n";
				
				echo "<tr bgcolor=#C2C2C2><td align=right>Recover Lead Access: </td><td align=left><select size=1 name=modify_recover_lead><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_recover_lead>";
				if($modify_recover_lead==0){echo "N";}elseif($modify_recover_lead==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_recover_lead$NWE</td></tr>\n";
				
				//end
				
				echo "<tr bgcolor=#C2C2C2 style=\"display:none;\"><td align=right>Add Timeclock Log Record: </td><td align=left><select size=1 name=add_timeclock_log><option value=0>N</option><option value=1>Y</option><option SELECTED value=$add_timeclock_log>";
				if($add_timeclock_log==0){echo "N";}elseif($add_timeclock_log==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-add_timeclock_log$NWE</td></tr>\n";
				echo "<tr bgcolor=#C2C2C2 style=\"display:none;\"><td align=right>Modify Timeclock Log Record: </td><td align=left><select size=1 name=modify_timeclock_log><option value=0>N</option><option value=1>Y</option><option SELECTED value=$modify_timeclock_log>";
				if($modify_timeclock_log==0){echo "N";}elseif($modify_timeclock_log==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-modify_timeclock_log$NWE</td></tr>\n";
				echo "<tr bgcolor=#C2C2C2 style=\"display:none;\"><td align=right>Delete Timeclock Log Record: </td><td align=left><select size=1 name=delete_timeclock_log><option value=0>N</option><option value=1>Y</option><option SELECTED value=$delete_timeclock_log>";
				if($delete_timeclock_log==0){echo "N";}elseif($delete_timeclock_log==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-delete_timeclock_log$NWE</td></tr>\n";

				echo "<tr bgcolor=#FFFFFF style=\"display:none;\"><td align=right>Manager Shift Enforcement Override: </td><td align=left><select size=1 name=manager_shift_enforcement_override><option value=0>N</option><option value=1>Y</option><option SELECTED value=$manager_shift_enforcement_override>";
				if($manager_shift_enforcement_override==0){echo "N";}elseif($manager_shift_enforcement_override==1){echo "Y";}
				echo "</option></select>$NWB#vicidial_users-manager_shift_enforcement_override$NWE</td></tr>\n";
				}
			echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT onclick=\"return checkpass();  \"></td></tr>\n";
			echo "</TABLE></center>\n";
			echo "<script>
	function isNumberOrLetter(s){//判断是否是数字或字母
		var regu = \"^[0-9a-zA-Z]+$\";
		var re = new RegExp(regu);
		if (re.test(s)) {
			return true;
		}else{
			return false;
		}
	}
	function checkpass(){
		var pass = document.getElementById(\"pass\").value;
		if(pass.length < 2 || pass.length> 10){
			alert('密码长度必须 2到10位之间');
			return false;
		}
		if(isNumberOrLetter(pass)!=true){
			alert('密码只允许输入数字和字母类型');
			return false;	
		}
		return true;
	}
	</script>";
			if ($LOGdelete_users > 0)
				{
				echo "<br><br><a href=\"$PHP_SELF?ADD=5&user=$user\">DELETE THIS USER</a>\n";
				}
//			echo "<br><br><a href=\"./AST_agent_time_sheet.php?agent=$user\">Click here for user time sheet</a>\n";
			echo "<br><br><a href=\"./user_status.php?user=$user\">Click here for user status</a>\n";
//			echo "<br><br><a href=\"./user_stats.php?user=$user\">Click here for user stats</a>\n";
//			echo "<br><br><a href=\"./AST_agent_days_detail.php?user=$user&query_date=$REPORTdate&end_date=$REPORTdate&group[]=--ALL--&shift=ALL\">Click here for user multiple day status detail report</a>\n";
			echo "<br><br><a href=\"$PHP_SELF?ADD=8&user=$user\">Click here for user CallBack Holds</a>\n";
			if ($LOGuser_level >= 9)
				{
				echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=USERS&stage=$user\">Click here to see Admin chages to this record</FONT>\n";
				}
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=31 modify campaign info in the system - Detail view
######################

if ( ($LOGcampaign_detail < 1) and ($ADD==31) ) {$ADD=34;}	# send to Basic if not allowed

if ( ($ADD==31) and ($LOGuser_level < 9) and ( (!eregi("$campaign_id",$LOGallowed_campaigns)) and (!eregi("ALL-CAMPAIGNS",$LOGallowed_campaigns)) ) ) 
	{$ADD=30;}	# send to not allowed screen if not in vicidial_user_groups allowed_campaigns list

if ($ADD==31)
	{
	if ($LOGmodify_campaigns==1)
		{
		if ($stage=='show_dialable')
			{
			$stmt="UPDATE vicidial_campaigns set display_dialable_count='Y' where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			}
		if ($stage=='hide_dialable')
			{
			$stmt="UPDATE vicidial_campaigns set display_dialable_count='N' where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			}

		$stmt="SELECT enable_vtiger_integration,vtiger_url from system_settings;";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$enable_vtiger_integration_LU =		$row[0];
		$vtiger_url_LU =					$row[1];

		$stmt="SELECT campaign_id,campaign_name,active,dial_status_a,dial_status_b,dial_status_c,dial_status_d,dial_status_e,lead_order,park_ext,park_file_name,web_form_address,allow_closers,hopper_level,auto_dial_level,next_agent_call,local_call_time,voicemail_ext,dial_timeout,dial_prefix,campaign_cid,campaign_vdad_exten,campaign_rec_exten,campaign_recording,campaign_rec_filename,campaign_script,get_call_launch,am_message_exten,amd_send_to_vmx,xferconf_a_dtmf,xferconf_a_number,xferconf_b_dtmf,xferconf_b_number,alt_number_dialing,scheduled_callbacks,lead_filter_id,drop_call_seconds,drop_action,safe_harbor_exten,display_dialable_count,wrapup_seconds,wrapup_message,closer_campaigns,use_internal_dnc,allcalls_delay,omit_phone_code,dial_method,available_only_ratio_tally,adaptive_dropped_percentage,adaptive_maximum_level,adaptive_latest_server_time,adaptive_intensity,adaptive_dl_diff_target,concurrent_transfers,auto_alt_dial,auto_alt_dial_statuses,agent_pause_codes_active,campaign_description,campaign_changedate,campaign_stats_refresh,campaign_logindate,dial_statuses,disable_alter_custdata,no_hopper_leads_logins,list_order_mix,campaign_allow_inbound,manual_dial_list_id,default_xfer_group,xfer_groups,queue_priority,drop_inbound_group,qc_enabled,qc_statuses,qc_lists,qc_shift_id,qc_get_record_launch,qc_show_recording,qc_web_form_address,qc_script,survey_first_audio_file,survey_dtmf_digits,survey_ni_digit,survey_opt_in_audio_file,survey_ni_audio_file,survey_method,survey_no_response_action,survey_ni_status,survey_response_digit_map,survey_xfer_exten,survey_camp_record_dir,disable_alter_custphone,display_queue_count,manual_dial_filter,agent_clipboard_copy,agent_extended_alt_dial,use_campaign_dnc,three_way_call_cid,three_way_dial_prefix,web_form_target,vtiger_search_category,vtiger_create_call_record,vtiger_create_lead_record,vtiger_screen_login,cpd_amd_action,agent_allow_group_alias,default_group_alias,vtiger_search_dead,vtiger_status_call,survey_third_digit,survey_third_audio_file,survey_third_status,survey_third_exten,survey_fourth_digit,survey_fourth_audio_file,survey_fourth_status,survey_fourth_exten,drop_lockout_time,quick_transfer_button,prepopulate_transfer_preset,drop_rate_group,view_calls_in_queue,view_calls_in_queue_launch,grab_calls_in_queue,call_requeue_button,pause_after_each_call,no_hopper_dialing,agent_dial_owner_only,agent_display_dialable_leads,web_form_address_two,waitforsilence_options,agent_select_territories,campaign_calldate,crm_popup_login,crm_login_address,timer_action,timer_action_message,timer_action_seconds,start_call_url,dispo_call_url,xferconf_c_number,xferconf_d_number,xferconf_e_number,inbound_mode,enable_vtiger_integration,vtiger_server_ip,vtiger_dbname,vtiger_login,vtiger_pass,vtiger_url,xfer_a_name,xfer_b_name,xfer_c_name,xfer_d_name,xfer_e_name,crm_target from vicidial_campaigns where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$campaign_name = $row[1];
		$dial_status_a = $row[3];
		$dial_status_b = $row[4];
		$dial_status_c = $row[5];
		$dial_status_d = $row[6];
		$dial_status_e = $row[7];
		$lead_order = $row[8];
		$web_form_address = stripslashes($row[11]);
		$allow_closers = $row[12];
		$hopper_level = $row[13];
		$auto_dial_level = $row[14];
		$next_agent_call = $row[15];
		$local_call_time = $row[16];
		$voicemail_ext = $row[17];
		$dial_timeout = $row[18];
		$dial_prefix = $row[19];
		$campaign_cid = $row[20];
		$campaign_vdad_exten = $row[21];
		$campaign_rec_exten = $row[22];
		$campaign_recording = $row[23];
		$campaign_rec_filename = $row[24];
		$script_id = $row[25];
		$get_call_launch = $row[26];
		$am_message_exten = $row[27];
		$amd_send_to_vmx = $row[28];
		$xferconf_a_dtmf = $row[29];
		$xferconf_a_number = $row[30];
		$xferconf_b_dtmf = $row[31];
		$xferconf_b_number = $row[32];
		$alt_number_dialing = $row[33];
		$scheduled_callbacks = $row[34];
		$lead_filter_id = $row[35];
			if ($lead_filter_id=='') {$lead_filter_id='NONE';}
		$drop_call_seconds = $row[36];
		$drop_action = $row[37];
		$safe_harbor_exten = $row[38];
		$display_dialable_count = $row[39];
		$wrapup_seconds = $row[40];
		$wrapup_message = $row[41];
	#	$closer_campaigns = $row[42];
		$use_internal_dnc = $row[43];
		$allcalls_delay = $row[44];
		$omit_phone_code = $row[45];
		$dial_method = $row[46];
		$available_only_ratio_tally = $row[47];
		$adaptive_dropped_percentage = $row[48];
		$adaptive_maximum_level = $row[49];
		$adaptive_latest_server_time = $row[50];
		$adaptive_intensity = $row[51];
		$adaptive_dl_diff_target = $row[52];
		$concurrent_transfers = $row[53];
		$auto_alt_dial = $row[54];
		$auto_alt_dial_statuses = $row[55];
		$agent_pause_codes_active = $row[56];
		$campaign_description = $row[57];
		$campaign_changedate = $row[58];
		$campaign_stats_refresh = $row[59];
		$campaign_logindate = $row[60];
		$dial_statuses = $row[61];
		$disable_alter_custdata = $row[62];
		$no_hopper_leads_logins = $row[63];
		$list_order_mix = $row[64];
		$campaign_allow_inbound = $row[65];
		$manual_dial_list_id = $row[66];
		$default_xfer_group = $row[67];
		$queue_priority = $row[69];
		$drop_inbound_group = $row[70];
		$qc_enabled = $row[71];
		$qc_statuses = $row[72];
		$qc_lists = $row[73];
		$qc_shift_id = $row[74];
		$qc_get_record_launch = $row[75];
		$qc_show_recording = $row[76];
		$qc_web_form_address = stripslashes($row[77]);
		$qc_script = $row[78];
		$survey_first_audio_file = $row[79];
		$survey_dtmf_digits = $row[80];
		$survey_ni_digit = $row[81];
		$survey_opt_in_audio_file = $row[82];
		$survey_ni_audio_file = $row[83];
		$survey_method = $row[84];
		$survey_no_response_action = $row[85];
		$survey_ni_status = $row[86];
		$survey_response_digit_map = $row[87];
		$survey_xfer_exten = $row[88];
		$survey_camp_record_dir = $row[89];
		$disable_alter_custphone = $row[90];
		$display_queue_count = $row[91];
		$manual_dial_filter = $row[92];
		$agent_clipboard_copy = $row[93];
		$agent_extended_alt_dial = $row[94];
		$use_campaign_dnc = $row[95];
		$three_way_call_cid = $row[96];
		$three_way_dial_prefix = $row[97];
		$web_form_target = $row[98];
		$vtiger_search_category = $row[99];
		$vtiger_create_call_record = $row[100];
		$vtiger_create_lead_record = $row[101];
		$vtiger_screen_login = $row[102];
		$cpd_amd_action = $row[103];
		$agent_allow_group_alias = $row[104];
		$default_group_alias = $row[105];
		$vtiger_search_dead = $row[106];
		$vtiger_status_call = $row[107];
		$survey_third_digit = $row[108];
		$survey_third_audio_file = $row[109];
		$survey_third_status = $row[110];
		$survey_third_exten = $row[111];
		$survey_fourth_digit = $row[112];
		$survey_fourth_audio_file = $row[113];
		$survey_fourth_status = $row[114];
		$survey_fourth_exten = $row[115];
		$drop_lockout_time = $row[116];
		$quick_transfer_button = $row[117];
		$prepopulate_transfer_preset = $row[118];
		$drop_rate_group = $row[119];
		$view_calls_in_queue = $row[120];
		$view_calls_in_queue_launch = $row[121];
		$grab_calls_in_queue = $row[122];
		$call_requeue_button = $row[123];
		$pause_after_each_call = $row[124];
		$no_hopper_dialing = $row[125];
		$agent_dial_owner_only = $row[126];
		$agent_display_dialable_leads = $row[127];
		$web_form_address_two = $row[128];
		$waitforsilence_options = $row[129];
		$agent_select_territories = $row[130];
		$campaign_calldate = $row[131];
		$crm_popup_login = $row[132];
		$crm_login_address = $row[133];
		$timer_action = $row[134];
		$timer_action_message = $row[135];
		$timer_action_seconds = $row[136];
		$start_call_url = $row[137];
		$dispo_call_url = $row[138];
		$xferconf_c_number = $row[139];
		$xferconf_d_number = $row[140];
		$xferconf_e_number = $row[141];
		$inbound_mode = $row[142];
		//vtiger campaign setting.
		$enable_vtiger_integration = 	$row[143];
		$vtiger_server_ip = 			$row[144];
		$vtiger_dbname = 				$row[145];
		$vtiger_login = 				$row[146];
		$vtiger_pass = 					$row[147];
		$vtiger_url = 					$row[148];
		
		$xfer_a_name =				$row[149];
		$xfer_b_name =				$row[150];
		$xfer_c_name =				$row[151];
		$xfer_d_name =				$row[152];
		$xfer_e_name =				$row[153];
		// + fnatic
		$crm_target  =				$row[154];
		// End 
	if (ereg("DISABLED",$list_order_mix))
		{$DEFlistDISABLE = '';	$DEFstatusDISABLED=0;}
	else
		{$DEFlistDISABLE = 'disabled';	$DEFstatusDISABLED=1;}

	$stmt="SELECT count(*) from vicidial_campaigns_list_mix where campaign_id='$campaign_id' and status='ACTIVE'";
	$rslt=mysql_query($stmt, $link);
	$rowx=mysql_fetch_row($rslt);
	if ($rowx[0] < 1)
		{
		$mixes_list="<option SELECTED value=\"DISABLED\">DISABLED</option>\n";
		$mixname_list["DISABLED"] = "DISABLED";
		}
	else
		{
		##### get list_mix listings for dynamic pulldown
		$stmt="SELECT vcl_id,vcl_name from vicidial_campaigns_list_mix where campaign_id='$campaign_id' and status='ACTIVE' limit 1";
		$rslt=mysql_query($stmt, $link);
		$mixes_to_print = mysql_num_rows($rslt);
		$mixes_list="<option value=\"DISABLED\">DISABLED</option>\n";

		$o=0;
		while ($mixes_to_print > $o)
			{
			$rowx=mysql_fetch_row($rslt);
			$mixes_list .= "<option value=\"ACTIVE\">ACTIVE ($rowx[0] - $rowx[1])</option>\n";
			$mixname_list["ACTIVE"] = "$rowx[0] - $rowx[1]";
			$o++;
			}
		}

	$dial_statuses = preg_replace("/ -$/","",$dial_statuses);
	$Dstatuses = explode(" ", $dial_statuses);
	$Ds_to_print = (count($Dstatuses) -1);

	$qc_statuses = preg_replace("/^ | -$/","",$qc_statuses);
	$QCstatuses = explode(" ", $qc_statuses);
	$QCs_to_print = (count($QCstatuses) -0);

	$qc_lists = preg_replace("/^ | -$/","",$qc_lists);
	$QClists = explode(" ", $qc_lists);
	$QCL_to_print = (count($QClists) -0);

	##### get status listings for dynamic pulldown
	$stmt="SELECT status,status_name,selectable,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable from vicidial_statuses order by status";
	$rslt=mysql_query($stmt, $link);
	$statuses_to_print = mysql_num_rows($rslt);
	$statuses_list='';
	$dial_statuses_list='';
	$qc_statuses_list='';
	$survey_ni_status_list='';
	$o=0;
	while ($statuses_to_print > $o) 
		{
		$rowx=mysql_fetch_row($rslt);
		$statuses_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
		if ($rowx[0] != 'CBHOLD') 
			{
			$dial_statuses_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			if ($survey_ni_status == $rowx[0])
				{
				$survey_ni_status_list .= "<option value=\"$rowx[0]\" SELECTED>$rowx[0] - $rowx[1]</option>\n";
				}
			else
				{
				$survey_ni_status_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
				}
			}
		$statname_list["$rowx[0]"] = "$rowx[1]";
		$LRstatuses_list .= "<option value=\"$rowx[0]-----$rowx[1]\">$rowx[0] - $rowx[1]</option>\n";
		if (eregi("Y",$rowx[2]))
			{$HKstatuses_list .= "<option value=\"$rowx[0]-----$rowx[1]\">$rowx[0] - $rowx[1]</option>\n";}

		$qc_statuses_list .= "<input type=\"checkbox\" name=\"qc_statuses[]\" value=\"$rowx[0]\"";
		$p=0;
		while ($p < $QCs_to_print)
			{
			if ($rowx[0] == $QCstatuses[$p]) 
				{
				$qc_statuses_list .= " CHECKED";
				}
			$p++;
			}
		$qc_statuses_list .= "> $rowx[0] - $rowx[1]<BR>\n";

		$o++;
		}

	$stmt="SELECT status,status_name,selectable,campaign_id,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable from vicidial_campaign_statuses where campaign_id='$campaign_id' order by status";
	$rslt=mysql_query($stmt, $link);
	$Cstatuses_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($Cstatuses_to_print > $o) 
		{
		$rowx=mysql_fetch_row($rslt);
		$statuses_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
		if ($rowx[0] != 'CBHOLD') {$dial_statuses_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";}
		$statname_list["$rowx[0]"] = "$rowx[1]";
		$LRstatuses_list .= "<option value=\"$rowx[0]-----$rowx[1]\">$rowx[0] - $rowx[1]</option>\n";
		if (eregi("Y",$rowx[2]))
			{$HKstatuses_list .= "<option value=\"$rowx[0]-----$rowx[1]\">$rowx[0] - $rowx[1]</option>\n";}

		$qc_statuses_list .= "<input type=\"checkbox\" name=\"qc_statuses[]\" value=\"$rowx[0]\"";
		$p=0;
		while ($p < $QCs_to_print)
			{
			if ($rowx[0] == $QCstatuses[$p]) 
				{
				$qc_statuses_list .= " CHECKED";
				}
			$p++;
			}
		$qc_statuses_list .= "> $rowx[0] - $rowx[1]<BR>\n";

		$o++;
		}

	##### get in-groups listings for dynamic drop in-group pulldown
	$stmt="SELECT group_id,group_name from vicidial_inbound_groups order by group_id";
#	$stmt="SELECT group_id,group_name from vicidial_inbound_groups where group_id NOT IN('AGENTDIRECT') order by group_id";
	$rslt=mysql_query($stmt, $link);
	$Dgroups_to_print = mysql_num_rows($rslt);
	$Dgroups_menu='';
	$Dgroups_selected=0;
	$o=0;
	while ($Dgroups_to_print > $o) 
		{
		$rowx=mysql_fetch_row($rslt);
		$Dgroups_menu .= "<option ";
		if ($drop_inbound_group == "$rowx[0]") 
			{
			$Dgroups_menu .= "SELECTED ";
			$Dgroups_selected++;
			}
		$Dgroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
		$o++;
		}
	if ($Dgroups_selected < 1) 
		{$Dgroups_menu .= "<option SELECTED value=\"---NONE---\">---NONE---</option>\n";}
	else 
		{$Dgroups_menu .= "<option value=\"---NONE---\">---NONE---</option>\n";}


	##### get in-groups listings for dynamic transfer group pulldown list menu
	$stmt="SELECT group_id,group_name from vicidial_inbound_groups $xfer_groupsSQL order by group_id";
	$rslt=mysql_query($stmt, $link);
	$Xgroups_to_print = mysql_num_rows($rslt);
	$Xgroups_menu='';
	$Xgroups_selected=0;
	$o=0;
	while ($Xgroups_to_print > $o) 
		{
		$rowx=mysql_fetch_row($rslt);
		$Xgroups_menu .= "<option ";
		if ($default_xfer_group == "$rowx[0]") 
			{
			$Xgroups_menu .= "SELECTED ";
			$Xgroups_selected++;
			}
		$Xgroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
		$o++;
		}
	if ($Xgroups_selected < 1) 
		{$Xgroups_menu .= "<option SELECTED value=\"---NONE---\">---NONE---</option>\n";}
	else 
		{$Xgroups_menu .= "<option value=\"---NONE---\">---NONE---</option>\n";}


	if ($SUB<1)		{$camp_detail_color=$subcamp_color;}
		else		{$camp_detail_color=$campaigns_color;}
	if ($SUB==22)	{$camp_statuses_color=$subcamp_color;}
		else		{$camp_statuses_color=$campaigns_color;}
	if ($SUB==23)	{$camp_hotkeys_color=$subcamp_color;}
		else		{$camp_hotkeys_color=$campaigns_color;}
	if ($SUB==25)	{$camp_recycle_color=$subcamp_color;}
		else		{$camp_recycle_color=$campaigns_color;}
	if ($SUB==26)	{$camp_autoalt_color=$subcamp_color;}
		else		{$camp_autoalt_color=$campaigns_color;}
	if ($SUB==27)	{$camp_pause_color=$subcamp_color;}
		else		{$camp_pause_color=$campaigns_color;}
	if ($SUB==28)	{$camp_qc_color=$subcamp_color;}
		else		{$camp_qc_color=$campaigns_color;}
	if ($SUB==29)	{$camp_listmix_color=$subcamp_color;}
		else		{$camp_listmix_color=$campaigns_color;}
	if ($SUB=='20A')	{$camp_survey_color=$subcamp_color;}
		else		{$camp_survey_color=$campaigns_color;}
	echo "<TABLE WIDTH=$page_width CELLPADDING=2 CELLSPACING=0><TR BGCOLOR=\"$campaigns_color\">\n";
	echo "<TD><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\"> <B>$row[0]</B>: </font></TD>";
	echo "<TD><a href=\"$PHP_SELF?ADD=34&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">Basic </font></a></TD>";
	echo "<TD BGCOLOR=\"$camp_detail_color\"> <a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">Detail </font></a> </TD>";
	echo "<TD BGCOLOR=\"$camp_statuses_color\"><a href=\"$PHP_SELF?ADD=31&SUB=22&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">Call Result</font></a></TD>";
	echo "<TD BGCOLOR=\"$camp_hotkeys_color\" style=\"display:none\"><a href=\"$PHP_SELF?ADD=31&SUB=23&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">HotKeys</font></a></TD>";

	if ($SSoutbound_autodial_active > 0)
		{
		echo "<TD BGCOLOR=\"$camp_recycle_color\"><a href=\"$PHP_SELF?ADD=31&SUB=25&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">Lead Recycling</font></a></TD>";
		echo "<TD BGCOLOR=\"$camp_autoalt_color\"><a href=\"$PHP_SELF?ADD=31&SUB=26&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">Auto Alt Dial</font></a></TD>";
		echo "<TD BGCOLOR=\"$camp_listmix_color\"><a href=\"$PHP_SELF?ADD=31&SUB=29&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\"><!--List Mix--></font></a></TD>";
		echo "<TD BGCOLOR=\"$camp_survey_color\"><a href=\"$PHP_SELF?ADD=31&SUB=20A&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">Survey</font></a></TD>";
		}
	echo "<TD BGCOLOR=\"$camp_pause_color\"><a href=\"$PHP_SELF?ADD=31&SUB=27&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">Pause Codes</font></a></TD>";
	if ($SSqc_features_active > 0)
		{
		echo "<TD BGCOLOR=\"$camp_qc_color\"><a href=\"$PHP_SELF?ADD=31&SUB=28&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">QC</font></a></TD>";
		}
	if ($SSoutbound_autodial_active < 1)
		{
		echo "<TD></TD><TD></TD><TD></TD><TD></TD>\n";
		}
	echo "<TD> <a href=\"./AST_timeonVDADallAJAX.php?RR=4&DB=0&group=$row[0]\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\"><span style=\"display:none\">Real-Time</span></font></a></TD>\n";
	echo "</TR></TABLE>\n";

	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	echo "<center>\n";

	if ($SUB < 1)
		{
		echo "<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=41>\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "<TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign ID: </td><td align=left><b>$row[0]</b>$NWB#vicidial_campaigns-campaign_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Name: </td><td align=left><input type=text name=campaign_name size=40 maxlength=40 value=\"$campaign_name\">$NWB#vicidial_campaigns-campaign_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Description: </td><td align=left><input type=text name=campaign_description size=40 maxlength=255 value=\"$campaign_description\">$NWB#vicidial_campaigns-campaign_description$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Change Date: </td><td align=left>$campaign_changedate &nbsp; $NWB#vicidial_campaigns-campaign_changedate$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Login Date: </td><td align=left>$campaign_logindate &nbsp; $NWB#vicidial_campaigns-campaign_logindate$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Call Date: </td><td align=left>$campaign_calldate &nbsp; $NWB#vicidial_campaigns-campaign_calldate$NWE</td></tr>\n";
		echo "<tr bgcolor=#C2C2C2><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option>N</option><option SELECTED>$row[2]</option></select>$NWB#vicidial_campaigns-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Park Extension: </td><td align=left><input type=text name=park_ext size=10 maxlength=10 value=\"$row[9]\"> - Filename: <input type=text name=park_file_name size=10 maxlength=10 value=\"$row[10]\">$NWB#vicidial_campaigns-park_ext$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Web Form: </td><td align=left><input type=text name=web_form_address size=70 maxlength=1055 value=\"$web_form_address\">$NWB#vicidial_campaigns-web_form_address$NWE</td></tr>\n";
		if ($SSenable_second_webform > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Web Form Two: </td><td align=left><input type=text name=web_form_address_two size=70 maxlength=1055 value=\"$web_form_address_two\">$NWB#vicidial_campaigns-web_form_address$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Web Form Target: </td><td align=left><input type=text name=web_form_target size=25 maxlength=255 value=\"$web_form_target\">$NWB#vicidial_campaigns-web_form_target$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Allow Closers: </td><td align=left><select size=1 name=allow_closers><option>Y</option><option>N</option><option SELECTED>$allow_closers</option></select>$NWB#vicidial_campaigns-allow_closers$NWE</td></tr>\n";

		if ($SSoutbound_autodial_active > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Allow Inbound and Blended: </td><td align=left><select size=1 name=campaign_allow_inbound><option>Y</option><option>N</option><option SELECTED>$campaign_allow_inbound</option></select>$NWB#vicidial_campaigns-campaign_allow_inbound$NWE</td></tr>\n";

			$o=0;
			while ($Ds_to_print > $o) 
				{
				$o++;
				$Dstatus = $Dstatuses[$o];

				echo "<tr bgcolor=#C2C2C2><td align=right>Dial Status $o: </td><td align=left> \n";

				if ($DEFstatusDISABLED > 0)
					{
					echo "<font color=grey><DEL><b>$Dstatus</b> - $statname_list[$Dstatus] &nbsp; &nbsp; &nbsp; &nbsp; <font size=2>\n";
					echo "REMOVE</DEL></td></tr>\n";
					}
				else
					{
					echo "<b>$Dstatus</b> - $statname_list[$Dstatus] &nbsp; &nbsp; &nbsp; &nbsp; <font size=2>\n";
					echo "<a href=\"$PHP_SELF?ADD=68&campaign_id=$campaign_id&status=$Dstatuses[$o]\">REMOVE</a></td></tr>\n";
					}
				}

			echo "<tr bgcolor=#C2C2C2><td align=right>Add A Dial Status: </td><td align=left><select size=1 name=dial_status $DEFlistDISABLE>\n";
			echo "<option value=\"\"> - NONE - </option>\n";

			echo "$dial_statuses_list";
			echo "</select> &nbsp; \n";
			echo "<input type=submit name=submit value=ADD> &nbsp; &nbsp; $NWB#vicidial_campaigns-dial_status$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right>List Order: </td><td align=left><select size=1 name=lead_order>
			<option SELECTED>$lead_order</option>
			<option>DOWN</option>
			<option>UP</option>
			<option>DOWN PHONE</option>
			<option>UP PHONE</option>
			<option>DOWN LAST NAME</option>
			<option>UP LAST NAME</option>
			<option>DOWN COUNT</option>
			<option>UP COUNT</option>
			<option>RANDOM</option>
			<option>DOWN LAST CALL TIME</option>
			<option>UP LAST CALL TIME</option>
			<option>DOWN RANK</option>
			<option>UP RANK</option>
			<option>DOWN OWNER</option>
			<option>UP OWNER</option>
			<option>DOWN TIMEZONE</option>
			<option>UP TIMEZONE</option>
			<option>DOWN 2nd NEW</option>
			<option>DOWN 3rd NEW</option>
			<option>DOWN 4th NEW</option>
			<option>DOWN 5th NEW</option>
			<option>DOWN 6th NEW</option>
			<option>UP 2nd NEW</option>
			<option>UP 3rd NEW</option>
			<option>UP 4th NEW</option>
			<option>UP 5th NEW</option>
			<option>UP 6th NEW</option>
			<option>DOWN PHONE 2nd NEW</option>
			<option>DOWN PHONE 3rd NEW</option>
			<option>DOWN PHONE 4th NEW</option>
			<option>DOWN PHONE 5th NEW</option>
			<option>DOWN PHONE 6th NEW</option>
			<option>UP PHONE 2nd NEW</option>
			<option>UP PHONE 3rd NEW</option>
			<option>UP PHONE 4th NEW</option>
			<option>UP PHONE 5th NEW</option>
			<option>UP PHONE 6th NEW</option>
			<option>DOWN LAST NAME 2nd NEW</option>
			<option>DOWN LAST NAME 3rd NEW</option>
			<option>DOWN LAST NAME 4th NEW</option>
			<option>DOWN LAST NAME 5th NEW</option>
			<option>DOWN LAST NAME 6th NEW</option>
			<option>UP LAST NAME 2nd NEW</option>
			<option>UP LAST NAME 3rd NEW</option>
			<option>UP LAST NAME 4th NEW</option>
			<option>UP LAST NAME 5th NEW</option>
			<option>UP LAST NAME 6th NEW</option>
			<option>DOWN COUNT 2nd NEW</option>
			<option>DOWN COUNT 3rd NEW</option>
			<option>DOWN COUNT 4th NEW</option>
			<option>DOWN COUNT 5th NEW</option>
			<option>DOWN COUNT 6th NEW</option>
			<option>UP COUNT 2nd NEW</option>
			<option>UP COUNT 3rd NEW</option>
			<option>UP COUNT 4th NEW</option>
			<option>UP COUNT 5th NEW</option>
			<option>UP COUNT 6th NEW</option>
			<option>RANDOM 2nd NEW</option>
			<option>RANDOM 3rd NEW</option>
			<option>RANDOM 4th NEW</option>
			<option>RANDOM 5th NEW</option>
			<option>RANDOM 6th NEW</option>
			<option>DOWN LAST CALL TIME 2nd NEW</option>
			<option>DOWN LAST CALL TIME 3rd NEW</option>
			<option>DOWN LAST CALL TIME 4th NEW</option>
			<option>DOWN LAST CALL TIME 5th NEW</option>
			<option>DOWN LAST CALL TIME 6th NEW</option>
			<option>UP LAST CALL TIME 2nd NEW</option>
			<option>UP LAST CALL TIME 3rd NEW</option>
			<option>UP LAST CALL TIME 4th NEW</option>
			<option>UP LAST CALL TIME 5th NEW</option>
			<option>UP LAST CALL TIME 6th NEW</option>
			<option>DOWN RANK 2nd NEW</option>
			<option>DOWN RANK 3rd NEW</option>
			<option>DOWN RANK 4th NEW</option>
			<option>DOWN RANK 5th NEW</option>
			<option>DOWN RANK 6th NEW</option>
			<option>UP RANK 2nd NEW</option>
			<option>UP RANK 3rd NEW</option>
			<option>UP RANK 4th NEW</option>
			<option>UP RANK 5th NEW</option>
			<option>UP RANK 6th NEW</option>
			<option>DOWN OWNER 2nd NEW</option>
			<option>DOWN OWNER 3rd NEW</option>
			<option>DOWN OWNER 4th NEW</option>
			<option>DOWN OWNER 5th NEW</option>
			<option>DOWN OWNER 6th NEW</option>
			<option>UP OWNER 2nd NEW</option>
			<option>UP OWNER 3rd NEW</option>
			<option>UP OWNER 4th NEW</option>
			<option>UP OWNER 5th NEW</option>
			<option>UP OWNER 6th NEW</option>
			<option>DOWN TIMEZONE 2nd NEW</option>
			<option>DOWN TIMEZONE 3rd NEW</option>
			<option>DOWN TIMEZONE 4th NEW</option>
			<option>DOWN TIMEZONE 5th NEW</option>
			<option>DOWN TIMEZONE 6th NEW</option>
			<option>UP TIMEZONE 2nd NEW</option>
			<option>UP TIMEZONE 3rd NEW</option>
			<option>UP TIMEZONE 4th NEW</option>
			<option>UP TIMEZONE 5th NEW</option>
			<option>UP TIMEZONE 6th NEW</option>
			</select>$NWB#vicidial_campaigns-lead_order$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=31&SUB=29&campaign_id=$campaign_id&vcl_id=$list_order_mix\">List Mix</a>: </td><td align=left><select size=1 name=list_order_mix>\n";
			echo "$mixes_list";
			if (ereg("DISABLED",$list_order_mix))
				{echo "<option selected value=\"$list_order_mix\">$list_order_mix - $mixname_list[$list_order_mix]</option>\n";}
			else
				{echo "<option selected value=\"ACTIVE\">ACTIVE ($mixname_list[ACTIVE])</option>\n";}
			echo "</select>$NWB#vicidial_campaigns-list_order_mix$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=31111111&lead_filter_id=$lead_filter_id\">Lead Filter</a>: </td><td align=left><select size=1 name=lead_filter_id>\n";
			echo "$filters_list";
			echo "<option selected value=\"$lead_filter_id\">$lead_filter_id - $filtername_list[$lead_filter_id]</option>\n";
			echo "</select>$NWB#vicidial_campaigns-lead_filter_id$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right>Drop Lockout Time: </td><td align=left><input type=text name=drop_lockout_time size=6 maxlength=6 value=\"$drop_lockout_time\"> $NWB#vicidial_campaigns-drop_lockout_time$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Hopper Level: </td><td align=left><select size=1 name=hopper_level><option>1</option><option>5</option><option>10</option><option>20</option><option>50</option><option>100</option><option>200</option><option>500</option><option>700</option><option>1000</option><option>2000</option><option SELECTED>$hopper_level</option></select>$NWB#vicidial_campaigns-hopper_level$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right>Force Reset of Hopper: </td><td align=left><select size=1 name=reset_hopper><option>Y</option><option SELECTED>N</option></select>$NWB#vicidial_campaigns-force_reset_hopper$NWE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Dial Method: </td><td align=left><select size=1 name=dial_method><option >MANUAL</option><option>RATIO</option><option>ADAPT_HARD_LIMIT</option><option>ADAPT_TAPERED</option><option>ADAPT_AVERAGE</option><option>INBOUND_MAN</option><option SELECTED>$dial_method</option></select>$NWB#vicidial_campaigns-dial_method$NWE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Auto Dial Level: </td><td align=left><select size=1 name=auto_dial_level><option selected>$auto_dial_level</option>\n";
			$adl=0;
			while($adl <= $SSauto_dial_limit)
				{
				echo "<option>$adl</option>\n";
				if ($adl < 1)
					{$adl = ($adl + 1);}
				else
					{
					if ($adl < 3)
						{$adl = ($adl + 0.1);}
					else
						{
						if ($adl < 4)
							{$adl = ($adl + 0.25);}
						else
							{
							if ($adl < 5)
								{$adl = ($adl + 0.5);}
							else
								{
								if ($adl < 10)
									{$adl = ($adl + 1);}
								else
									{
									if ($adl < 20)
										{$adl = ($adl + 2);}
									else
										{
										if ($adl < 40)
											{$adl = ($adl + 5);}
										else
											{
											if ($adl < 200)
												{$adl = ($adl + 10);}
											else
												{
												if ($adl < 400)
													{$adl = ($adl + 50);}
												else
													{
													if ($adl < 1000)
														{$adl = ($adl + 100);}
													else
														{$adl = ($adl + 1);}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			echo "<option>$adl</option></select>(0 = off)$NWB#vicidial_campaigns-auto_dial_level$NWE &nbsp; &nbsp; &nbsp; <input type=checkbox name=dial_level_override value=\"1\">ADAPT OVERRIDE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Available Only Tally: </td><td align=left><select size=1 name=available_only_ratio_tally><option >Y</option><option>N</option><option SELECTED>$available_only_ratio_tally</option></select>$NWB#vicidial_campaigns-available_only_ratio_tally$NWE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Drop Percentage Limit: </td><td align=left><select size=1 name=adaptive_dropped_percentage>\n";
			$n=101;
			while ($n>=0.1)
				{
				if ($n <= 3)
					{$n = ($n - 0.1);}
				else
					{$n--;}
				echo "<option>$n</option>\n";
				}
			echo "<option SELECTED>$adaptive_dropped_percentage</option></select>% $NWB#vicidial_campaigns-adaptive_dropped_percentage$NWE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Maximum Adapt Dial Level: </td><td align=left><input type=text name=adaptive_maximum_level size=6 maxlength=6 value=\"$adaptive_maximum_level\"><i>number only</i> $NWB#vicidial_campaigns-adaptive_maximum_level$NWE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Latest Server Time: </td><td align=left><input type=text name=adaptive_latest_server_time size=6 maxlength=4 value=\"$adaptive_latest_server_time\"><i>4 digits only</i> $NWB#vicidial_campaigns-adaptive_latest_server_time$NWE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Adapt Intensity Modifier: </td><td align=left><select size=1 name=adaptive_intensity>\n";
			$n=40;
			while ($n>=-40)
				{
				$dtl = 'Balanced';
				if ($n<0) {$dtl = 'Less Intense';}
				if ($n>0) {$dtl = 'More Intense';}
				if ($n == $adaptive_intensity) 
					{echo "<option SELECTED value=\"$n\">$n - $dtl</option>\n";}
				else
					{echo "<option value=\"$n\">$n - $dtl</option>\n";}
				$n--;
				}
			echo "</select> $NWB#vicidial_campaigns-adaptive_intensity$NWE</td></tr>\n";



			echo "<tr bgcolor=#F5F5F5><td align=right>Dial Level Difference Target: </td><td align=left><select size=1 name=adaptive_dl_diff_target>\n";
			$n=40;
			while ($n>=-40)
				{
				$nabs = abs($n);
				$dtl = 'Balanced';
				if ($n<0) {$dtl = 'Agents Waiting for Calls';}
				if ($n>0) {$dtl = 'Calls Waiting for Agents';}
				if ($n == $adaptive_dl_diff_target) 
					{echo "<option SELECTED value=\"$n\">$n --- $nabs $dtl</option>\n";}
				else
					{echo "<option value=\"$n\">$n --- $nabs $dtl</option>\n";}
				$n--;
				}
			echo "</select> $NWB#vicidial_campaigns-adaptive_dl_diff_target$NWE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Concurrent Transfers: </td><td align=left><select size=1 name=concurrent_transfers><option >AUTO</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9</option><option>10</option><option SELECTED>$concurrent_transfers</option></select>$NWB#vicidial_campaigns-concurrent_transfers$NWE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Queue Priority: </td><td align=left><select size=1 name=queue_priority>\n";
			$n=99;
			while ($n>=-99)
				{
				$dtl = 'Even';
				if ($n<0) {$dtl = 'Lower';}
				if ($n>0) {$dtl = 'Higher';}
				if ($n == $queue_priority) 
					{echo "<option SELECTED value=\"$n\">$n - $dtl</option>\n";}
				else
					{echo "<option value=\"$n\">$n - $dtl</option>\n";}
				$n--;
				}
			echo "</select> $NWB#vicidial_campaigns-queue_priority$NWE</td></tr>\n";



			echo "<tr bgcolor=#F5F5F5><td align=right>Multiple Campaign Drop Rate Group: </td><td align=left><select size=1 name=drop_rate_group>";
			##### get list_mix listings for dynamic pulldown
			$stmt="SELECT group_id from vicidial_drop_rate_groups;";
			$rslt=mysql_query($stmt, $link);
			$DRgroups_to_print = mysql_num_rows($rslt);
			$DRgroups_list="<option value=\"DISABLED\">DISABLED</option>\n";

			$o=0;
			while ($DRgroups_to_print > $o)
				{
				$rowx=mysql_fetch_row($rslt);
				$DRgroups[$o] = "$rowx[0]";
				$o++;
				}

			$o=0;
			while ($DRgroups_to_print > $o)
				{
				$DRcampaigns='';
				$stmt="SELECT campaign_id from vicidial_campaigns where drop_rate_group='$DRgroups[$o]';";
				$rslt=mysql_query($stmt, $link);
				$DRcampaigns_to_print = mysql_num_rows($rslt);
				$p=0;
				while ($DRcampaigns_to_print > $p)
					{
					$rowx=mysql_fetch_row($rslt);
					$DRcampaigns .= "$rowx[0] ";
					$p++;
					}
				if (strlen($DRcampaigns)<2)
					{$DRcampaigns='-EMPTY- ';}
				while(strlen($DRcampaigns) > 45) {$DRcampaigns = substr("$DRcampaigns", 0, -1);}
				if(strlen($DRcampaigns) > 42) {$DRcampaigns = "$DRcampaigns...";}

				$DRgroups_list .= "<option value=\"$DRgroups[$o]\">$DRgroups[$o] ( $DRcampaigns)</option>\n";
				$o++;
				}
			echo "$DRgroups_list<option SELECTED>$drop_rate_group</option></select>$NWB#vicidial_campaigns-drop_rate_group$NWE</td></tr>\n";



			echo "<tr bgcolor=#FFFFFF><td align=right>Auto Alt-Number Dialing: </td><td align=left><select size=1 name=auto_alt_dial><option >NONE</option><option>ALT_ONLY</option><option>ADDR3_ONLY</option><option>ALT_AND_ADDR3</option><option>ALT_AND_EXTENDED</option><option>ALT_AND_ADDR3_AND_EXTENDED</option><option>EXTENDED_ONLY</option><option SELECTED>$auto_alt_dial</option></select>$NWB#vicidial_campaigns-auto_alt_dial$NWE</td></tr>\n";
			}

		echo "<tr bgcolor=#FFFFFF><td align=right>Next Agent Call: </td><td align=left><select size=1 name=next_agent_call><option>random</option><option $auto_display>oldest_call_start</option><option $auto_display>oldest_call_finish</option><option $auto_display>overall_user_level</option><option $auto_display>campaign_rank</option><option $auto_display>fewest_calls</option><option>longest_wait_time</option>";
		if($inbound_mode=='ring')
			{
			echo "<option>roundrobin</option><option>ringall</option>";
			}
		
		echo "<option SELECTED>$next_agent_call</option></select>$NWB#vicidial_campaigns-next_agent_call$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=311111111&call_time_id=$local_call_time\">Local Call Time: </a></td><td align=left><select size=1 name=local_call_time>\n";
		echo "$call_times_list";
		echo "<option selected value=\"$local_call_time\">$local_call_time - $call_timename_list[$local_call_time]</option>\n";
		echo "</select>$NWB#vicidial_campaigns-local_call_time$NWE</td></tr>\n";

		if ($SSoutbound_autodial_active > 0)
			{
			echo "<tr bgcolor=#C2C2C2><td align=right>Dial Timeout: </td><td align=left><input type=text name=dial_timeout size=3 maxlength=3 value=\"$dial_timeout\"> <i>in seconds</i>$NWB#vicidial_campaigns-dial_timeout$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Dial Prefix: </td><td align=left><input type=text name=dial_prefix size=20 maxlength=20 value=\"$dial_prefix\"> <font size=1>for 91NXXNXXXXXX value would be 9, for no dial prefix use X</font>$NWB#vicidial_campaigns-dial_prefix$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Omit Phone Code: </td><td align=left><select size=1 name=omit_phone_code><option>Y</option><option>N</option><option SELECTED>$omit_phone_code</option></select>$NWB#vicidial_campaigns-omit_phone_code$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>Campaign CallerID: </td><td align=left><input type=text name=campaign_cid size=20 maxlength=20 value=\"$campaign_cid\">$NWB#vicidial_campaigns-campaign_cid$NWE\n";
		$stmt="SELECT count(*) from vicidial_lists where campaign_id='$campaign_id' and campaign_cid_override != '' and active='Y';";
		$rslt=mysql_query($stmt, $link);
		$rowx=mysql_fetch_row($rslt);
		if ($rowx[0] > 0) 
			{echo " <font color=red>LIST OVERRIDE ACTIVE</font>";}
		echo "</td></tr>\n";

		if ($SSoutbound_autodial_active > 0)
			{
			echo "<tr bgcolor=#C2C2C2><td align=right>Campaign VDAD exten: </td><td align=left><input type=text name=campaign_vdad_exten size=10 maxlength=20 value=\"$campaign_vdad_exten\">$NWB#vicidial_campaigns-campaign_vdad_exten$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Rec exten: </td><td align=left><input type=text name=campaign_rec_exten size=10 maxlength=10 value=\"$campaign_rec_exten\">$NWB#vicidial_campaigns-campaign_rec_exten$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Recording: </td><td align=left><select size=1 name=campaign_recording><option>NEVER</option><option>ONDEMAND</option><option>ALLCALLS</option><option>ALLFORCE</option><option SELECTED>$campaign_recording</option></select>$NWB#vicidial_campaigns-campaign_recording$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Rec Filename: </td><td align=left><input type=text name=campaign_rec_filename size=50 maxlength=50 value=\"$campaign_rec_filename\">$NWB#vicidial_campaigns-campaign_rec_filename$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Recording Delay: </td><td align=left><input type=text name=allcalls_delay size=3 maxlength=3 value=\"$allcalls_delay\"> <i>in seconds</i>$NWB#vicidial_campaigns-allcalls_delay$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=3111111&script_id=$script_id\">Script</a>: </td><td align=left><select size=1 name=script_id>\n";
		echo "$scripts_list";
		echo "<option selected value=\"$script_id\">$script_id - $scriptname_list[$script_id]</option>\n";
		echo "</select>$NWB#vicidial_campaigns-campaign_script$NWE\n";
		$stmt="SELECT count(*) from vicidial_lists where campaign_id='$campaign_id' and agent_script_override != '' and active='Y';";
		$rslt=mysql_query($stmt, $link);
		$rowx=mysql_fetch_row($rslt);
		if ($rowx[0] > 0) 
			{echo " <font color=red>LIST OVERRIDE ACTIVE</font>";}
		echo "</td></tr>\n";

		$eswHTML='';
		if ($SSenable_second_webform > 0)
			{$eswHTML = '<option>WEBFORMTWO</option>';}
		echo "<tr bgcolor=#FFFFFF><td align=right>Get Call Launch: </td><td align=left><select size=1 name=get_call_launch><option selected>NONE</option><option>SCRIPT</option><option>WEBFORM</option>$eswHTML<option selected>$get_call_launch</option></select>$NWB#vicidial_campaigns-get_call_launch$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>Answering Machine Message: </td><td><input type=text size=50 maxlength=100 name=am_message_exten id=am_message_exten value=\"$am_message_exten\"> <a href=\"javascript:launch_chooser('am_message_exten','date',1200);\">audio chooser</a>  $NWB#vicidial_campaigns-am_message_exten$NWE\n";
		$stmt="SELECT count(*) from vicidial_lists where campaign_id='$campaign_id' and am_message_exten_override != '' and active='Y';";
		$rslt=mysql_query($stmt, $link);
		$rowx=mysql_fetch_row($rslt);
		if ($rowx[0] > 0) 
			{echo " <font color=red>LIST OVERRIDE ACTIVE</font>";}
		echo "</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>WaitForSilence Options: </td><td align=left><input type=text name=waitforsilence_options size=20 maxlength=25 value=\"$waitforsilence_options\">$NWB#vicidial_campaigns-waitforsilence_options$NWE</td></tr>\n";

		if ($SSoutbound_autodial_active > 0)
			{
			echo "<tr bgcolor=#C2C2C2><td align=right>AMD Send to VM exten: </td><td align=left><select size=1 name=amd_send_to_vmx><option>Y</option><option>N</option><option SELECTED>$amd_send_to_vmx</option></select>$NWB#vicidial_campaigns-amd_send_to_vmx$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>CPD AMD Action: </td><td align=left><select size=1 name=cpd_amd_action><option>DISABLED</option><option>DISPO</option><option>MESSAGE</option><option SELECTED>$cpd_amd_action</option></select>$NWB#vicidial_campaigns-cpd_amd_action$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf DTMF 1: </td><td align=left><input type=text name=xferconf_a_dtmf size=20 maxlength=50 value=\"$xferconf_a_dtmf\">$NWB#vicidial_campaigns-xferconf_a_dtmf$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Number 1: </td><td align=left><input type=text name=xferconf_a_number size=20 maxlength=50 value=\"$xferconf_a_number\">$NWB#vicidial_campaigns-xferconf_a_dtmf$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Name 1: </td><td align=left><input type=text name=xfer_a_name size=20 maxlength=50 value=\"$xfer_a_name\">$NWB#vicidial_campaigns-xferconf_a_dtmf_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf DTMF 2: </td><td align=left><input type=text name=xferconf_b_dtmf size=20 maxlength=50 value=\"$xferconf_b_dtmf\">$NWB#vicidial_campaigns-xferconf_a_dtmf$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Number 2: </td><td align=left><input type=text name=xferconf_b_number size=20 maxlength=50 value=\"$xferconf_b_number\">$NWB#vicidial_campaigns-xferconf_a_dtmf$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Name 2: </td><td align=left><input type=text name=xfer_b_name size=20 maxlength=50 value=\"$xfer_b_name\">$NWB#vicidial_campaigns-xferconf_a_dtmf_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Number 3: </td><td align=left><input type=text name=xferconf_c_number size=20 maxlength=50 value=\"$xferconf_c_number\">$NWB#vicidial_campaigns-xferconf_a_dtmf$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Name 3: </td><td align=left><input type=text name=xfer_c_name size=20 maxlength=50 value=\"$xfer_c_name\">$NWB#vicidial_campaigns-xferconf_a_dtmf_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Number 4: </td><td align=left><input type=text name=xferconf_d_number size=20 maxlength=50 value=\"$xferconf_d_number\">$NWB#vicidial_campaigns-xferconf_a_dtmf$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Name 4: </td><td align=left><input type=text name=xfer_d_name size=20 maxlength=50 value=\"$xfer_d_name\">$NWB#vicidial_campaigns-xferconf_a_dtmf_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Number 5: </td><td align=left><input type=text name=xferconf_e_number size=20 maxlength=50 value=\"$xferconf_e_number\">$NWB#vicidial_campaigns-xferconf_a_dtmf$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Name 5: </td><td align=left><input type=text name=xfer_e_name size=20 maxlength=50 value=\"$xfer_e_name\">$NWB#vicidial_campaigns-xferconf_a_dtmf_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Quick Transfer Button: </td><td align=left><select size=1 name=quick_transfer_button><option>N</option><option>IN_GROUP</option><option>PRESET_1</option><option>PRESET_2</option><option>PRESET_3</option><option>PRESET_4</option><option>PRESET_5</option><option SELECTED>$quick_transfer_button</option></select>$NWB#vicidial_campaigns-quick_transfer_button$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>PrePopulate Transfer Preset: </td><td align=left><select size=1 name=prepopulate_transfer_preset><option>N</option><option>PRESET_1</option><option>PRESET_2</option><option>PRESET_3</option><option>PRESET_4</option><option>PRESET_5</option><option SELECTED>$prepopulate_transfer_preset</option></select>$NWB#vicidial_campaigns-prepopulate_transfer_preset$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Timer Action: </td><td align=left><select size=1 name=timer_action><option selected>NONE</option><option>D1_DIAL</option><option>D2_DIAL</option><option>D3_DIAL</option><option>D4_DIAL</option><option>D5_DIAL</option><option>MESSAGE_ONLY</option><option>WEBFORM</option>$eswHTML<option selected>$timer_action</option></select>$NWB#vicidial_campaigns-timer_action$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Timer Action Message: </td><td align=left><input type=text name=timer_action_message size=50 maxlength=255 value=\"$timer_action_message\">$NWB#vicidial_campaigns-timer_action_message$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Timer Action Seconds: </td><td align=left><input type=text name=timer_action_seconds size=10 maxlength=10 value=\"$timer_action_seconds\">$NWB#vicidial_campaigns-timer_action_seconds$NWE</td></tr>\n";

		if ($SSoutbound_autodial_active > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Alt Number Dialing: </td><td align=left><select size=1 name=alt_number_dialing><option>Y</option><option>N</option><option SELECTED>$alt_number_dialing</option></select>$NWB#vicidial_campaigns-alt_number_dialing$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Scheduled Callbacks: </td><td align=left><select size=1 name=scheduled_callbacks><option>Y</option><option>N</option><option SELECTED>$scheduled_callbacks</option></select>$NWB#vicidial_campaigns-scheduled_callbacks$NWE</td></tr>\n";

		if ($SSoutbound_autodial_active > 0)
			{
			echo "<tr bgcolor=#C2C2C2><td align=right>Drop Call Seconds: </td><td align=left><input type=text name=drop_call_seconds size=5 maxlength=2 value=\"$drop_call_seconds\">$NWB#vicidial_campaigns-drop_call_seconds$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Drop Action: </td><td align=left><select size=1 name=drop_action><option>HANGUP</option><option>MESSAGE</option><option>VOICEMAIL</option><option>IN_GROUP</option><option SELECTED>$drop_action</option></select>$NWB#vicidial_campaigns-drop_action$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Safe Harbor Exten: </td><td align=left><input type=text name=safe_harbor_exten size=10 maxlength=20 value=\"$safe_harbor_exten\">$NWB#vicidial_campaigns-safe_harbor_exten$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Voicemail: </td><td align=left><input type=text name=voicemail_ext id=voicemail_ext size=12 maxlength=10 value=\"$voicemail_ext\"> <a href=\"javascript:launch_vm_chooser('voicemail_ext','vm',1600);\">voicemail chooser</a>$NWB#vicidial_campaigns-voicemail_ext$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Drop Transfer Group: </td><td align=left><select size=1 name=drop_inbound_group>";
			echo "$Dgroups_menu";
			echo "</select>$NWB#vicidial_campaigns-drop_inbound_group$NWE\n";
			$stmt="SELECT count(*) from vicidial_lists where campaign_id='$campaign_id' and drop_inbound_group_override != '' and active='Y';";
			$rslt=mysql_query($stmt, $link);
			$rowx=mysql_fetch_row($rslt);
			if ($rowx[0] > 0) 
				{echo " <font color=red>LIST OVERRIDE ACTIVE</font>";}
			echo "</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right>Wrap Up Seconds: </td><td align=left><input type=text name=wrapup_seconds size=5 maxlength=3 value=\"$wrapup_seconds\">$NWB#vicidial_campaigns-wrapup_seconds$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Wrap Up Message: </td><td align=left><input type=text name=wrapup_message size=40 maxlength=255 value=\"$wrapup_message\">$NWB#vicidial_campaigns-wrapup_message$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>Use Internal DNC List: </td><td align=left><select size=1 name=use_internal_dnc><option>Y</option><option>N</option><option>AREACODE</option><option SELECTED>$use_internal_dnc</option></select>$NWB#vicidial_campaigns-use_internal_dnc$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>Use Campaign DNC List: </td><td align=left><select size=1 name=use_campaign_dnc><option>Y</option><option>N</option><option>AREACODE</option><option SELECTED>$use_campaign_dnc</option></select>$NWB#vicidial_campaigns-use_campaign_dnc$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Agent Pause Codes Active: </td><td align=left><select size=1 name=agent_pause_codes_active><option>FORCE</option><option>Y</option><option>N</option><option SELECTED>$agent_pause_codes_active</option></select>$NWB#vicidial_campaigns-agent_pause_codes_active$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Stats Refresh: </td><td align=left><select size=1 name=campaign_stats_refresh><option>Y</option><option>N</option><option SELECTED>$campaign_stats_refresh</option></select>$NWB#vicidial_campaigns-campaign_stats_refresh$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>Disable Alter Customer Data: </td><td align=left><select size=1 name=disable_alter_custdata><option>Y</option><option>N</option><option SELECTED>$disable_alter_custdata</option></select>$NWB#vicidial_campaigns-disable_alter_custdata$NWE</td></tr>\n";
		echo "<tr bgcolor=#C2C2C2><td align=right>Disable Alter Customer Phone: </td><td align=left><select size=1 name=disable_alter_custphone><option>Y</option><option>N</option><option>HIDE</option><option SELECTED>$disable_alter_custphone</option></select>$NWB#vicidial_campaigns-disable_alter_custphone$NWE</td></tr>\n";

		if ($SSoutbound_autodial_active > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Allow No-Hopper-Leads Logins: </td><td align=left><select size=1 name=no_hopper_leads_logins><option>Y</option><option>N</option><option SELECTED>$no_hopper_leads_logins</option></select>$NWB#vicidial_campaigns-no_hopper_leads_logins$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right>No Hopper Dialing: </td><td align=left><select size=1 name=no_hopper_dialing><option>Y</option><option>N</option><option SELECTED>$no_hopper_dialing</option></select>$NWB#vicidial_campaigns-no_hopper_dialing$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right>Owner Only Dialing: </td><td align=left><select size=1 name=agent_dial_owner_only><option>NONE</option><option>USER</option><option>TERRITORY</option><option>USER_GROUP</option><option SELECTED>$agent_dial_owner_only</option></select>$NWB#vicidial_campaigns-agent_dial_owner_only$NWE</td></tr>\n";

			if ($SSuser_territories_active > 0)
				{
				echo "<tr bgcolor=#FFFFFF><td align=right>Agent Select Territories: </td><td align=left><select size=1 name=agent_select_territories><option>Y</option><option>N</option><option SELECTED>$agent_select_territories</option></select>$NWB#vicidial_campaigns-agent_select_territories$NWE</td></tr>\n";
				}
			echo "<tr bgcolor=#C2C2C2><td align=right>Agent Display Dialable Leads: </td><td align=left><select size=1 name=agent_display_dialable_leads><option>Y</option><option>N</option><option SELECTED>$agent_display_dialable_leads</option></select>$NWB#vicidial_campaigns-agent_display_dialable_leads$NWE</td></tr>\n";
			}

		echo "<tr bgcolor=#C2C2C2><td align=right>Agent Display Queue Count: </td><td align=left><select size=1 name=display_queue_count><option>Y</option><option>N</option><option SELECTED>$display_queue_count</option></select>$NWB#vicidial_campaigns-display_queue_count$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>Agent View Calls in Queue: </td><td align=left><select size=1 name=view_calls_in_queue><option>NONE</option><option>ALL</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option SELECTED>$view_calls_in_queue</option></select>$NWB#vicidial_campaigns-view_calls_in_queue$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>View Calls in Queue Launch: </td><td align=left><select size=1 name=view_calls_in_queue_launch><option>AUTO</option><option>MANUAL</option><option SELECTED>$view_calls_in_queue_launch</option></select>$NWB#vicidial_campaigns-view_calls_in_queue_launch$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2 style=\"display:none;\"><td align=right>Agent Grab Calls in Queue: </td><td align=left><select size=1 name=grab_calls_in_queue><option>Y</option><option>N</option><option SELECTED>$grab_calls_in_queue</option></select>$NWB#vicidial_campaigns-grab_calls_in_queue$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Agent Call Re-Queue Button: </td><td align=left><select size=1 name=call_requeue_button><option>Y</option><option>N</option><option SELECTED>$call_requeue_button</option></select>$NWB#vicidial_campaigns-call_requeue_button$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Agent Pause After Each Call: </td><td align=left><select size=1 name=pause_after_each_call><option>Y</option><option>N</option><option SELECTED>$pause_after_each_call</option></select>$NWB#vicidial_campaigns-pause_after_each_call$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>Manual Dial List ID: </td><td align=left><input type=text name=manual_dial_list_id size=15 maxlength=12 value=\"$manual_dial_list_id\">$NWB#vicidial_campaigns-manual_dial_list_id$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>Manual Dial Filter: </td><td align=left><select size=1 name=manual_dial_filter><option>NONE</option><option>DNC_ONLY</option><option>CAMPLISTS_ONLY</option><option>DNC_AND_CAMPLISTS</option><option SELECTED>$manual_dial_filter</option></select>$NWB#vicidial_campaigns-manual_dial_filter$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Agent Screen Clipboard Copy: </td><td align=left><select size=1 name=agent_clipboard_copy><option>NONE</option><option>lead_id</option><option>list_id</option><option>title</option><option>first_name</option><option>middle_initial</option><option>last_name</option><option>phone_code</option><option>phone_number</option><option>address1</option><option>address2</option><option>address3</option><option>city</option><option>state</option><option>province</option><option>postal_code</option><option>country_code</option><option>alt_phone</option><option>comments</option><option>date_of_birth</option><option>email</option><option>gender</option><option>gmt_offset_now</option><option>security_phrase</option><option>vendor_lead_code</option><option SELECTED>$agent_clipboard_copy</option></select>$NWB#vicidial_campaigns-agent_clipboard_copy$NWE</td></tr>\n";

		if ($SSoutbound_autodial_active > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Agent Screen Extended Alt Dial: </td><td align=left><select size=1 name=agent_extended_alt_dial><option>Y</option><option>N</option><option SELECTED>$agent_extended_alt_dial</option></select>$NWB#vicidial_campaigns-agent_extended_alt_dial$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#C2C2C2><td align=right>3-Way Call Outbound CallerID: </td><td align=left><select size=1 name=three_way_call_cid><option>CAMPAIGN</option><option>CUSTOMER</option><option>AGENT_PHONE</option><option>AGENT_CHOOSE</option><option SELECTED>$three_way_call_cid</option></select>$NWB#vicidial_campaigns-three_way_call_cid$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>3-Way Call Dial Prefix: </td><td align=left><input type=text name=three_way_dial_prefix size=15 maxlength=20 value=\"$three_way_dial_prefix\">$NWB#vicidial_campaigns-three_way_dial_prefix$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Group Alias Allowed: </td><td align=left><select size=1 name=agent_allow_group_alias><option>Y</option><option>N</option><option SELECTED>$agent_allow_group_alias</option></select>$NWB#vicidial_campaigns-agent_allow_group_alias$NWE</td></tr>\n";

		if ($agent_allow_group_alias == 'Y')
			{
			##### get groups_alias listings for dynamic default group alias pulldown list menu
			$stmt="SELECT group_alias_id,group_alias_name from groups_alias where active='Y' order by group_alias_id";
			$rslt=mysql_query($stmt, $link);
			$group_alias_to_print = mysql_num_rows($rslt);
			$group_alias_menu='';
			$group_alias_selected=0;
			$o=0;
			while ($group_alias_to_print > $o) 
				{
				$rowx=mysql_fetch_row($rslt);
				$group_alias_menu .= "<option ";
				if ($default_group_alias == "$rowx[0]") 
					{
					$group_alias_menu .= "SELECTED ";
					$group_alias_selected++;
					}
				$group_alias_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
				$o++;
				}

			echo "<tr bgcolor=#FFFFFF><td align=right>Default Group Alias: </td><td align=left><select size=1 name=default_group_alias>";
			echo "<option value=\"\">NONE</option>";
			echo "$group_alias_menu";
			echo "</select>$NWB#vicidial_campaigns-default_group_alias$NWE</td></tr>\n";
			}

		if ($SSenable_vtiger_integration > 0)
			{
			echo "<tr bgcolor=#C2C2C2><td align=right>CRM Search Category: </td><td align=left><select size=1 name=vtiger_search_category><option>LEAD</option><option>ACCOUNT</option><option>VENDOR</option><option>LEAD_ACCOUNT</option><option>LEAD_ACCOUNT_VENDOR</option><option>ACCTID</option><option>ACCTID_ACCOUNT</option><option>ACCTID_ACCOUNT_LEAD_VENDOR</option><option>UNIFIED_CONTACT</option><option SELECTED>$vtiger_search_category</option></select>$NWB#vicidial_campaigns-vtiger_search_category$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>CRM Search Dead Accounts: </td><td align=left><select size=1 name=vtiger_search_dead><option>DISABLED</option><option>ASK</option><option>RESURRECT</option><option SELECTED>$vtiger_search_dead</option></select>$NWB#vicidial_campaigns-vtiger_search_dead$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>CRM Create Call Record: </td><td align=left><select size=1 name=vtiger_create_call_record><option>Y</option><option>N</option><option>DISPO</option><option SELECTED>$vtiger_create_call_record</option></select>$NWB#vicidial_campaigns-vtiger_create_call_record$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>CRM Create Lead Record: </td><td align=left><select size=1 name=vtiger_create_lead_record><option>Y</option><option>N</option><option SELECTED>$vtiger_create_lead_record</option></select>$NWB#vicidial_campaigns-vtiger_create_lead_record$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>CRM Status Call: </td><td align=left><select size=1 name=vtiger_status_call><option>LEAD</option><option>Y</option><option>N</option><option SELECTED>$vtiger_status_call</option></select>$NWB#vicidial_campaigns-vtiger_status_call$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>CRM Screen Login: </td><td align=left><select size=1 name=vtiger_screen_login><option>Y</option><option>N</option><option>NEW_WINDOW</option><option SELECTED>$vtiger_screen_login</option></select>$NWB#vicidial_campaigns-vtiger_screen_login$NWE</td></tr>\n";
			}
		else
			{
			echo "<input type=hidden name=vtiger_search_category value=\"$vtiger_search_category\">\n";
			echo "<input type=hidden name=vtiger_create_call_record value=\"$vtiger_create_call_record\">\n";
			echo "<input type=hidden name=vtiger_create_lead_record value=\"$vtiger_create_lead_record\">\n";
			echo "<input type=hidden name=vtiger_screen_login value=\"$vtiger_screen_login\">\n";
			echo "<input type=hidden name=vtiger_search_dead value=\"$vtiger_search_dead\">\n";
			echo "<input type=hidden name=vtiger_status_call value=\"$vtiger_status_call\">\n";
			}
		
		//vtiger config  +++++++++++++
		echo "<tr bgcolor=#CCFFFF><td align=right>Enable CRM Integration: </td><td align=left><select size=1 name=enable_vtiger_integration><option>1</option><option>0</option><option selected>$enable_vtiger_integration</option></select>$NWB#settings-enable_vtiger_integration$NWE\n";
		echo " &nbsp; <a href=\"./vtiger_user.php?campaign=$campaign_id\" target=\"_blank\">Click here to Synchronize users with CRM</a>\n";
		echo "</td></tr>\n";
		
		echo "<tr bgcolor=#CCFFFF><td align=right>CRM DB Server IP: </td><td align=left><input type=text name=vtiger_server_ip size=18 maxlength=15 value=\"$vtiger_server_ip\">$NWB#settings-vtiger_server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#CCFFFF><td align=right>CRM DB Name: </td><td align=left><input type=text name=vtiger_dbname size=18 maxlength=50 value=\"$vtiger_dbname\">$NWB#settings-vtiger_dbname$NWE</td></tr>\n";
		echo "<tr bgcolor=#CCFFFF><td align=right>CRM DB Login: </td><td align=left><input type=text name=vtiger_login size=18 maxlength=50 value=\"$vtiger_login\">$NWB#settings-vtiger_login$NWE</td></tr>\n";
		echo "<tr bgcolor=#CCFFFF><td align=right>CRM DB Password: </td><td align=left><input type=text name=vtiger_pass size=18 maxlength=50 value=\"$vtiger_pass\">$NWB#settings-vtiger_pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#CCFFFF><td align=right>CRM URL: </td><td align=left><input type=text name=vtiger_url size=50 maxlength=255 value=\"$vtiger_url\">$NWB#settings-vtiger_url$NWE</td></tr>\n";
		
		//vtiger config  +++++++++++++
		
		echo "<tr bgcolor=#FFFFFF><td align=right>CRM Popup Login: </td><td align=left><select size=1 name=crm_popup_login><option>Y</option><option>N</option><option SELECTED>$crm_popup_login</option></select>$NWB#vicidial_campaigns-crm_popup_login$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>CRM Popup Address: </td><td align=left><input type=text name=crm_login_address size=70 maxlength=1000 value=\"$crm_login_address\">$NWB#vicidial_campaigns-crm_login_address$NWE</td></tr>\n";
		
		// + fnatic
		$crm_target_selected="selected=selected";
		$crm_option_str="";
		if($crm_target=='_blank')	{$crm_option_str="<option $crm_target_selected>_blank</option><option>CCMS</option>";}
			elseif($crm_target=='CCMS')		{$crm_option_str="<option>_blank</option><option $crm_target_selected>CCMS</option>";}
			else							{$crm_option_str="<option>_blank</option><option>CCMS</option>";}
		if(strlen($crm_target)>0)	{$crm_option_str.="<option>$crm_target</option>";}
		echo "<tr bgcolor=#FFFFFF><td align=right>CRM Target: </td><td align=left><select size=1 name=crm_target>$crm_option_str</select>$NWB#vicidial_campaigns-crm_target$NWE</td></tr>\n";
		// End

		echo "<tr bgcolor=#FFFFFF><td align=right>Start Call URL: </td><td align=left><input type=text name=start_call_url size=70 maxlength=1000 value=\"$start_call_url\">$NWB#vicidial_campaigns-start_call_url$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Dispo Call URL: </td><td align=left><input type=text name=dispo_call_url size=70 maxlength=1000 value=\"$dispo_call_url\">$NWB#vicidial_campaigns-dispo_call_url$NWE</td></tr>\n";

		if ($campaign_allow_inbound == 'Y')
			{
			echo "<tr bgcolor=#FFFFFF style='display:none;'><td align=right>Inbound Mode: <input type=hidden name=modepara value=$modepara><BR>";
			echo "</td><td align=left>\n";
			
			echo "<select size=1 name=campaign_inbound_mode id=campaign_inbound_mode onchange=\"changeInboundMode('$campaign_id');\"><option ";
			if($modepara =="ring" || $modepara == "auto"){
				$inbound_mode = $modepara;
			}
			if($inbound_mode=="auto"){echo "selected";}
			echo" value=\"auto\">auto</option><option ";
			if($inbound_mode=="ring"){echo "selected";}
			echo " value=\"ring\">ring</option></select>";
			echo "$NWB#vicidial_inbound_groups-inbound_mode$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>Allowed Inbound Groups: <BR>";
			echo " $NWB#vicidial_campaigns-closer_campaigns$NWE</td><td align=left>\n";
			echo "$groups_list";
			echo "</td></tr>\n";
			}

		echo "<tr bgcolor=#FFFFFF><td align=right>Default Transfer Group: </td><td align=left><select size=1 name=default_xfer_group>";
		echo "$Xgroups_menu";
		echo "</select>$NWB#vicidial_campaigns-default_xfer_group$NWE</td></tr>\n";

		if ($allow_closers == 'Y')
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Allowed Transfer Groups: <BR>";
			echo " $NWB#vicidial_campaigns-xfer_groups$NWE</td><td align=left>\n";
			echo "$XFERgroups_list";
			echo "</td></tr>\n";
			}
		echo "<script type=\"text/javascript\" src=\"./new_style/Popup.js\"></script>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=button name=button value=MORE onclick=\"openWindow('./ccms_campaign.php?campaign=$campaign_id');return false;\"><br><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center></FORM>\n";

		echo "<center>\n";

		echo "<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=41>\n";
		echo "<input type=hidden name=DB value=$DB>\n";
		echo "<input type=hidden name=stage value=list_activation>\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";

		if ($SSoutbound_autodial_active > 0)
			{
			echo "<br><b>LISTS WITHIN THIS CAMPAIGN: &nbsp; $NWB#vicidial_campaign_lists$NWE</b>\n";

			echo "<TABLE><TR><TD>\n";
				echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

			$LISTlink='stage=LISTIDDOWN';
			$TALLYlink='stage=TALLYDOWN';
			$ACTIVElink='stage=ACTIVEDOWN';
			$CAMPAIGNlink='stage=CAMPAIGNDOWN';
			$CALLDATElink='stage=CALLDATEDOWN';
			$SQLorder='order by list_id';
			if (eregi("LISTIDUP",$stage))		{$SQLorder='order by list_id asc';				$LISTlink='stage=LISTIDDOWN';}
			if (eregi("LISTIDDOWN",$stage))		{$SQLorder='order by list_id desc';				$LISTlink='stage=LISTIDUP';}
			if (eregi("TALLYUP",$stage))		{$SQLorder='order by tally asc';				$TALLYlink='stage=TALLYDOWN';}
			if (eregi("TALLYDOWN",$stage))		{$SQLorder='order by tally desc';				$TALLYlink='stage=TALLYUP';}
			if (eregi("ACTIVEUP",$stage))		{$SQLorder='order by active asc';				$ACTIVElink='stage=ACTIVEDOWN';}
			if (eregi("ACTIVEDOWN",$stage))		{$SQLorder='order by active desc';				$ACTIVElink='stage=ACTIVEUP';}
			if (eregi("CAMPAIGNUP",$stage))		{$SQLorder='order by campaign_id asc';			$CAMPAIGNlink='stage=CAMPAIGNDOWN';}
			if (eregi("CAMPAIGNDOWN",$stage))	{$SQLorder='order by campaign_id desc';			$CAMPAIGNlink='stage=CAMPAIGNUP';}
			if (eregi("CALLDATEUP",$stage))		{$SQLorder='order by list_lastcalldate asc';	$CALLDATElink='stage=CALLDATEDOWN';}
			if (eregi("CALLDATEDOWN",$stage))	{$SQLorder='order by list_lastcalldate desc';	$CALLDATElink='stage=CALLDATEUP';}
			
			$stmt="SELECT vls.list_id,list_name,list_description,0 as tally,active,list_lastcalldate,campaign_id from vicidial_lists vls where campaign_id='$campaign_id' $SQLorder";
			$rslt=mysql_query($stmt, $link);
			$lists_to_print = mysql_num_rows($rslt);
						
			require("dbconnect_report.php");
			mysql_query("SET NAMES 'UTF8'");
			
			$stmt_bak = "SELECT vls.list_id,count(*) as tally from vicidial_lists vls,vicidial_list vl where vls.list_id=vl.list_id and campaign_id='$campaign_id' group by list_id";
			$rslt_bak = mysql_query($stmt_bak, $link);
			$lists_to_print_bak = mysql_num_rows($rslt_bak);

			$o=0;
			$list_bak = array();
			while ($lists_to_print_bak > $o){			
			  $row=mysql_fetch_row($rslt_bak);
			  $list_bak[$row[0]] = $row[1];
				$o++;
			}
						
      require("dbconnect.php");
      mysql_query("SET NAMES 'UTF8'");
      
			echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
			echo "<TR class=tr_bg_color>";
			echo "<TD><a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id&$LISTlink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>LIST ID</B></a></TD>";
			echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>LIST NAME</B></TD>";
			echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>DESCRIPTION</B></TD>\n";
			echo "<TD><a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id&$TALLYlink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>LEADS COUNT</B></a></TD>\n";
			echo "<TD COLSPAN=2><a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id&$ACTIVElink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>ACTIVE</B></a></TD>";
			echo "<TD><a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id&$CALLDATElink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>LAST CALL DATE</B></a></TD>";
			echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>MODIFY</TD>\n";
			echo "</TR>\n";

			$o=0;
			while ($lists_to_print > $o)
				{
				$row=mysql_fetch_row($rslt);
				
				$row[3] = isset($list_bak[$row[0]])?$list_bak[$row[0]]:0;
				
				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}
				echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=311&list_id=$row[0]\">$row[0]</a></td>";
				echo "<td><font size=1> $row[1]</td>";
				echo "<td><font size=1> $row[2]</td>";
				echo "<td><font size=1> $row[3]</td>";
				echo "<td><font size=1> $row[4]</td>";
				echo "<td>";

				if (ereg('Y',$row[4]))
					{
					$active_lists++;
					$camp_lists .= "'$row[0]',";
					echo "<input type=\"checkbox\" name=\"list_active_change[]\" value=\"$row[0]\" CHECKED>";
					}
				else
					{
					$inactive_lists++;
					echo "<input type=\"checkbox\" name=\"list_active_change[]\" value=\"$row[0]\"";
					}

				echo "</td>";
				echo "<td><font size=1> $row[5]</td>";
				echo "<td><font size=1><a href=\"$PHP_SELF?ADD=311&list_id=$row[0]\">MODIFY</a></td></tr>\n";

				$o++;
				}

			echo "<TR><TD COLSPAN=7 ALIGN=CENTER><input type=submit value=\"SUBMIT ACTIVE LIST CHANGES\"></TD></TR>\n";
			echo "</TABLE></center><BR></FORM>\n";

			echo "<center><b>\n";

			$filterSQL = $filtersql_list[$lead_filter_id];
			$filterSQL = preg_replace("/\\\\/","",$filterSQL);
			$filterSQL = eregi_replace("^and|and$|^or|or$","",$filterSQL);
			if (strlen($filterSQL)>4)
				{$fSQL = "and $filterSQL";}
			else
				{$fSQL = '';}

				$camp_lists = eregi_replace(".$","",$camp_lists);
			echo "This campaign has $active_lists active lists and $inactive_lists inactive lists<br><br>\n";

			if ($display_dialable_count == 'Y')
				{
				### call function to calculate and print dialable leads
				dialable_leads($DB,$link,$local_call_time,$dial_statuses,$camp_lists,$drop_lockout_time,$fSQL);
				echo " - <font size=1><a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id&stage=hide_dialable\">HIDE</a></font><BR><BR>";
				}
			else
				{
				echo "<a href=\"$PHP_SELF?ADD=73&campaign_id=$campaign_id\" target=\"_blank\">Popup Dialable Leads Count</a>";
				echo " - <font size=1><a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id&stage=show_dialable\">SHOW</a></font><BR><BR>";
				}

			$stmt="SELECT count(*) FROM vicidial_hopper where campaign_id='$campaign_id' and status IN('READY')";
			if ($DB) {echo "$stmt\n";}
			$rslt=mysql_query($stmt, $link);
			$rowx=mysql_fetch_row($rslt);
			$hopper_leads = "$rowx[0]";

			echo "This campaign has $hopper_leads leads in the dial hopper<br><br>\n";
			echo "<a href=\"./AST_VICIDIAL_hopperlist.php?group=$campaign_id\">Click here to see what leads are in the hopper right now</a><br><br>\n";
			echo "<a href=\"./AST_VDADstats.php?group=$campaign_id\">Click here to see a VDAD report for this campaign</a><BR><BR>\n";
			}
		echo "<a href=\"$PHP_SELF?ADD=81&campaign_id=$campaign_id\">Click here to see all CallBack Holds in this campaign</a><BR><BR>\n";
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=CAMPAIGNS&stage=$campaign_id\">Click here to see Admin chages to this campaign</a></FONT>\n";
			}
		echo "</b></center>\n";
		}


	##### CAMPAIGN CUSTOM Call Result #####
	if ($SUB==22)
		{

	##### 获取status type ---add by akin
	$stmt="select type,typedescription from vicidial_status_type where active='Y' and isdel='N' order by type asc";
	$rslt=mysql_query($stmt, $link);
	$status_type_list = "";
	$status_type_list_add = "";
	$status_type_result_array = array();
	if($rslt && mysql_num_rows($rslt)){
		while($status_type_row = mysql_fetch_row($rslt)){
			$status_type_list .= "<option value=$status_type_row[0]>$status_type_row[1]</option>";
			$selected_str = "";
			if($status_type_row[1] == 'Answer')	$selected_str = "selected=selected";
			$status_type_list_add .= "<option $selected_str value=$status_type_row[0]>$status_type_row[1]</option>";
			$status_type_result_array[$status_type_row[0]] = $status_type_row[1];
		}
	}

	##### get status category listings for dynamic pulldown
	$stmt="SELECT vsc_id,vsc_name from vicidial_status_categories order by vsc_id desc";
	$rslt=mysql_query($stmt, $link);
	$cats_to_print = mysql_num_rows($rslt);
	$cats_list="";

	$o=0;
	while ($cats_to_print > $o)
		{
		$rowx=mysql_fetch_row($rslt);
		$cats_list .= "<option value=\"$rowx[0]\">$rowx[0] - " . substr($rowx[1],0,20) . "</option>\n";
		$catsname_list["$rowx[0]"] = substr($rowx[1],0,20);
		$o++;
		}


		echo "<center>\n";
		echo "<br><b>CUSTOM Call Result WITHIN THIS CAMPAIGN: &nbsp; $NWB#vicidial_campaign_statuses$NWE</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>STATUS</td><td>DESCRIPTION</td><td>SELECTABLE</td><td>HUMAN ANSWER</td><td>CLASS</td><td>CATEGORY</td><td>TYPE</td><td>MODIFY-DELETE</td></tr>\n";

		$stmt="SELECT status,status_name,selectable,campaign_id,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable,class,status_type from vicidial_campaign_statuses where campaign_id='$campaign_id'";
		$rslt=mysql_query($stmt, $link);
		$statuses_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($statuses_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$AScategory = $rowx[5];
			$status_type = $rowx[12];
			$o++;

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><form action=$PHP_SELF method=POST>\n";
			echo "<input type=hidden name=ADD value=42>\n";
			echo "<input type=hidden name=stage value=modify>\n";
			echo "<input type=hidden name=status value=\"$rowx[0]\">\n";
			echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
			echo "<font size=2><B>$rowx[0]</B></td>\n";
			echo "<td><input type=text name=status_name size=20 maxlength=30 value=\"$rowx[1]\"></td>\n";
			echo "<td><select size=1 name=selectable><option>Y</option><option>N</option><option selected>$rowx[2]</option></select></td>\n";
			echo "<td><select size=1 name=human_answered><option>Y</option><option>N</option><option selected>$rowx[4]</option></select></td>\n";
			echo "<td><select size=1 name=status_class><option>inbound</option><option>outbound</option><option selected>$rowx[11]</option></select></td>\n";
			echo "<td>\n";
			echo "<select size=1 name=category>\n";
			echo "$cats_list";
			echo "<option selected value=\"$AScategory\">$AScategory - $catsname_list[$AScategory]</option>\n";
			echo "</select>\n";
			echo "</td>\n";
			echo "<td>";
			echo "<select size=1 name=status_type>\n";
			echo $status_type_list;
			echo "<option selected value=\"$status_type\">$status_type_result_array[$status_type]</option>\n";
			echo "</select>\n";
			echo "</td>\n";
			echo "<td align=center nowrap><font size=1><input type=submit name=submit value=MODIFY> &nbsp; &nbsp; &nbsp; &nbsp; \n";
			echo " &nbsp; \n";
			echo "<a onClick=\"delete_confirm('$PHP_SELF?ADD=42&campaign_id=$campaign_id&status=$rowx[0]&stage=delete')\" href='#'>DELETE</a>\n";
			echo "</td></tr><tr $bgcolor style=\"display:none\"><td colspan=6 align=center><FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>\n";

			echo "&nbsp; Sale: <select size=1 name=sale><option>Y</option><option>N</option><option selected>$rowx[6]</option></select> &nbsp; \n";
			echo "&nbsp; DNC: <select size=1 name=dnc><option>Y</option><option>N</option><option selected>$rowx[7]</option></select> &nbsp; \n";
			echo "&nbsp; Customer Contact: <select size=1 name=customer_contact><option>Y</option><option>N</option><option selected>$rowx[8]</option></select> &nbsp; \n";
			echo "&nbsp; Not Interested: <select size=1 name=not_interested><option>Y</option><option>N</option><option selected>$rowx[9]</option></select> &nbsp; \n";
			echo "&nbsp; Unworkable: <select size=1 name=unworkable><option>Y</option><option>N</option><option selected>$rowx[10]</option></select> &nbsp; \n";

			echo "</form></td></tr>\n";
			}

		echo "</table>\n";
		echo "<script language='javascript'>
				function check_for_status_type(obj){
					var add_status_type_obj = document.getElementById('add_status_type');
					var select_length = add_status_type_obj.length;

					for(var i=0;i<select_length;i++){
						if(add_status_type_obj.options[i].value==1){	//Answer
								add_status_type_obj.options[i].selected = 'selected';
						}
						else{
							if(obj.value=='inbound'){
								add_status_type_obj.options[i].style.display = 'none';
								add_status_type_obj.options[i].disabled = true;
							}
							else{
								add_status_type_obj.options[i].style.display = '';
								add_status_type_obj.options[i].disabled = false;
							}
						}
					}


				}
				</script>";
		echo "<br>ADD NEW CUSTOM CAMPAIGN STATUS<BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=22>\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "<table>
				<tr>
					<td>Status: <input type=text name=status_id size=20 maxlength=20 value='777_'> &nbsp; </td>
						
					<td>Description: </td>
					<td><input type=text name=status_name size=20 maxlength=30> &nbsp; 
						Selectable: <select size=1 name=selectable><option>Y</option><option>N</option></select></td>
				<td>Class: <select size=1 name=status_class onchange='check_for_status_type(this)'><option value=inbound>inbound</option><option SELECTED value=outbound>outbound</option></select> &nbsp; </td>
				</tr>
				<tr>
					<td>Human Answer: <select size=1 name=human_answered><option>Y</option><option SELECTED>N</option></select> &nbsp; </td>
						
					<td>Category: </td>
					<td><select size=1 name=category>
						<option value='UNDEFINED'>UNDEFINED - Default Category</option>
						<option selected value=''> - </option>
						</select> </td>
					<td>Type: 
						<select size=1 id=add_status_type name=status_type>
						$status_type_list_add
						</select> 
					</td>
				</tr>
			</table> <BR>\n";
		echo "<input type=submit name=submit value=ADD><BR>\n";

		echo "</FORM><br>\n";
		}

	##### CAMPAIGN HOTKEYS #####
	if ($SUB==23)
		{
		echo "<br><b>CUSTOM HOT KEYS WITHIN THIS CAMPAIGN: &nbsp; $NWB#vicidial_campaign_hotkeys$NWE</b><br>\n";
		echo "<TABLE width=400 cellspacing=3>\n";
		echo "<tr><td>HOT KEY</td><td>STATUS</td><td>DESCRIPTION</td><td>DELETE</td></tr>\n";

		$stmt="SELECT status,hotkey,status_name,selectable,campaign_id from vicidial_campaign_hotkeys where campaign_id='$campaign_id' order by hotkey";
		$rslt=mysql_query($stmt, $link);
		$statuses_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($statuses_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$o++;

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=1>$rowx[1]</td><td><font size=1>$rowx[0]</td><td><font size=1>$rowx[2]</td><td><font size=1><a href=\"$PHP_SELF?ADD=43&campaign_id=$campaign_id&status=$rowx[0]&hotkey=$rowx[1]&action=DELETE\">DELETE</a></td></tr>\n";

			}

		echo "</table>\n";

		echo "<br>ADD NEW CUSTOM CAMPAIGN HOT KEY<BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=23>\n";
		echo "<input type=hidden name=selectable value=Y>\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "Hotkey: <select size=1 name=hotkey>\n";
		echo "<option>1</option>\n";
		echo "<option>2</option>\n";
		echo "<option>3</option>\n";
		echo "<option>4</option>\n";
		echo "<option>5</option>\n";
		echo "<option>6</option>\n";
		echo "<option>7</option>\n";
		echo "<option>8</option>\n";
		echo "<option>9</option>\n";
		echo "</select> &nbsp; \n";
		echo "Status: <select size=1 name=HKstatus>\n";
		echo "$HKstatuses_list\n";
		echo "<option value=\"ALTPH2-----Alternate Phone Hot Dial\">ALTPH2 - Alternate Phone Hot Dial</option>\n";
		echo "<option value=\"ADDR3-----Address3 Hot Dial\">ADDR3 - Address3 Hot Dial</option>\n";
		echo "</select> &nbsp; \n";
		echo "<input type=submit name=submit value=ADD><BR>\n";
		echo "</form><BR>\n";
		}

	##### CAMPAIGN LEAD RECYCLING #####
	if ($SUB==25)
		{	
		### display counts on leads that have hit the limit in this campaign
		$stmt="SELECT list_id,active,list_name from vicidial_lists where campaign_id='$campaign_id'";

		$rslt=mysql_query($stmt, $link);
		$lists_to_print = mysql_num_rows($rslt);
		$camp_lists='';
		$o=0;
		while ($lists_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			if (ereg("Y", $rowx[1])) {$camp_lists .= "'$rowx[0]',";}
			$o++;
			}
		$camp_lists = eregi_replace(".$","",$camp_lists);

		$stmt="SELECT recycle_id,campaign_id,status,attempt_delay,attempt_maximum,active from vicidial_lead_recycle where campaign_id='$campaign_id' order by status";
		$rslt=mysql_query($stmt, $link);
		$recycle_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($recycle_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$RECYCLE_status[$o] =	$rowx[2];
			$RECYCLE_delay[$o] =	$rowx[3];
			$RECYCLE_attempt[$o] =	$rowx[4];
			$RECYCLE_active[$o] =	$rowx[5];
			$RECYCLE_count[$o] = "'Y','Y1','Y2','Y3','Y4','Y5','Y6','Y7','Y8','Y9','Y10'";
			$RECYCLE_count_available[$o] = "'Y','Y1','Y2','Y3','Y4','Y5','Y6','Y7','Y8','Y9','Y10'";
			### Modifed by fnatic for nielsen project ### 
			if ($RECYCLE_attempt[$o]==1) 
				{
				$RECYCLE_count[$o] = "'Y1','Y2','Y3','Y4','Y5','Y6','Y7','Y8','Y9','Y10'";
				$RECYCLE_count_available[$o] = "'Y'";
				}
			if ($RECYCLE_attempt[$o]==2) 
				{
				$RECYCLE_count[$o] = "'Y2','Y3','Y4','Y5','Y6','Y7','Y8','Y9','Y10'";
				$RECYCLE_count_available[$o] = "'Y','Y1'";
				}
			if ($RECYCLE_attempt[$o]==3) 
				{
				$RECYCLE_count[$o] = "'Y3','Y4','Y5','Y6','Y7','Y8','Y9','Y10'";
				$RECYCLE_count_available[$o] = "'Y','Y1','Y2'";
				}
			if ($RECYCLE_attempt[$o]==4) 
				{
				$RECYCLE_count[$o] = "'Y4','Y5','Y6','Y7','Y8','Y9','Y10'";
				$RECYCLE_count_available[$o] = "'Y','Y1','Y2','Y3'";
				}
			if ($RECYCLE_attempt[$o]==5) 
				{
				$RECYCLE_count[$o] = "'Y5','Y6','Y7','Y8','Y9','Y10'";
				$RECYCLE_count_available[$o] = "'Y','Y1','Y2','Y3','Y4'";
				}
			if ($RECYCLE_attempt[$o]==6) 
				{
				$RECYCLE_count[$o] = "'Y6','Y7','Y8','Y9','Y10'";
				$RECYCLE_count_available[$o] = "'Y','Y1','Y2','Y3','Y4','Y5'";
				}
			if ($RECYCLE_attempt[$o]==7) 
				{
				$RECYCLE_count[$o] = "'Y7','Y8','Y9','Y10'";
				$RECYCLE_count_available[$o] = "'Y','Y1','Y2','Y3','Y4','Y5','Y6'";
				}
			if ($RECYCLE_attempt[$o]==8) 
				{
				$RECYCLE_count[$o] = "'Y8','Y9','Y10'";
				$RECYCLE_count_available[$o] = "'Y','Y1','Y2','Y3','Y4','Y5','Y6','Y7'";
				}
			if ($RECYCLE_attempt[$o]==9) 
				{
				$RECYCLE_count_available[$o] = "'Y','Y1','Y2','Y3','Y4','Y5','Y6','Y7','Y8'";
				}
			if ($RECYCLE_attempt[$o]>9) 
				{
				$RECYCLE_count[$o] = "'Y10'";
				$RECYCLE_count_available[$o] = "'Y','Y1','Y2','Y3','Y4','Y5','Y6','Y7','Y8','Y9'";
				}
			#End#
			$o++;
			}
		$o=0;

		echo "<br><br><b>LEAD RECYCLING WITHIN THIS CAMPAIGN: &nbsp; $NWB#vicidial_lead_recycle$NWE</b><br>\n";
		echo "<TABLE width=800 cellspacing=3>\n";
		echo "<tr><td>STATUS</td><td>ATTEMPT DELAY</td><td>ATTEMPT MAXIMUM</td><td>LEADS AT LIMIT</td><td>AVAILABLE LEADS TODAY</td><td>ACTIVE</td><td> </td><td>DELETE</td></tr>\n";#Add by fnatic
		
		//add by heibo  bug 1960
		require("dbconnect_report.php");
		mysql_query("SET NAMES 'UTF8'");
		
		while ($recycle_to_print > $o) 
			{
			$recycle_limit=0;
			if (strlen($camp_lists) > 2)
				{
				$stmt="SELECT count(*) from vicidial_list where status='$RECYCLE_status[$o]' and list_id IN($camp_lists) and called_since_last_reset IN($RECYCLE_count[$o]);";
				if ($DB) {echo "|$stmt|\n";}
				$rslt=mysql_query($stmt, $link);
				$counts_to_print = mysql_num_rows($rslt);
				if ($counts_to_print > 0) 
					{
					$rowx=mysql_fetch_row($rslt);
					$recycle_limit = $rowx[0];
					}
				#Add by fantic#
				$stmtN="SELECT count(*) from vicidial_list where status='$RECYCLE_status[$o]' and list_id IN($camp_lists) and  called_since_last_reset IN ($RECYCLE_count_available[$o]) and ( (unix_timestamp(modify_date)+$RECYCLE_delay[$o]) < (unix_timestamp(curdate())+3600*24) );";
        //echo $stmtN;
        		
				if ($DB) {echo "|$stmtN|\n";}
				$rsltN=mysql_query($stmtN, $link);
				$counts_to_printN = mysql_num_rows($rsltN);
				if ($counts_to_printN > 0) 
					{
					$rowN=mysql_fetch_row($rsltN);
					$available_leads = $rowN[0];
					}
				#End#
				}

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=2> &nbsp; $RECYCLE_status[$o]<form action=$PHP_SELF method=POST>\n";
			echo "<input type=hidden name=status value=\"$RECYCLE_status[$o]\">\n";
			echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
			echo "<input type=hidden name=ADD value=45></td>\n";
			echo "<td><font size=1><input type=text size=14 maxlength=9 name=attempt_delay value=\"$RECYCLE_delay[$o]\"></td>\n";
			echo "<td><font size=1><input type=text size=5 maxlength=3 name=attempt_maximum value=\"$RECYCLE_attempt[$o]\"></td>\n";
			echo "<td align=right><font size=2>$recycle_limit &nbsp;  </td>\n";
			echo "<td align=right><font size=2>$available_leads </font>&nbsp;</td>\n";#Add by fantic
			echo "<td><select size=1 name=active><option>Y</option><option>N</option><option SELECTED>$RECYCLE_active[$o]</option></select></td>\n";
			echo "<td><font size=1><input type=submit name=submit value=MODIFY></form></td>\n";
			echo "<td><font size=1><a onClick=\"delete_confirm('$PHP_SELF?ADD=65&campaign_id=$campaign_id&status=$RECYCLE_status[$o]')\" href='#'>DELETE</a></td></tr>\n";
			$o++;
			}

		require("dbconnect.php");
		mysql_query("SET NAMES 'UTF8'");
		
		echo "</table>\n";

		echo "<br>ADD NEW CAMPAIGN LEAD RECYCLE<BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=25>\n";
		echo "<input type=hidden name=active value=\"N\">\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "Status: <select size=1 name=status>\n";
		echo "$LRstatuses_list\n";
		echo "</select> &nbsp; \n";
		echo "Attempt Delay: <input type=text size=14 maxlength=9 name=attempt_delay>\n";
		echo "Attempt Maximum: <input type=text size=5 maxlength=3 name=attempt_maximum>\n";
		echo "<input type=submit name=submit value=ADD><BR>\n";

		echo "</FORM><br>\n";
		echo "<br>\n";
		echo "* Lead counts taken from active lists in the campaign only.\n";
		}

	##### CAMPAIGN AUTO-ALT-NUMBER DIALING #####
	if ($SUB==26)
		{
		echo "<br><br><b>AUTO ALT NUMBER DIALING FOR THIS CAMPAIGN: &nbsp; $NWB#vicidial_auto_alt_dial_statuses$NWE</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>Call Result</td><td>DELETE</td></tr>\n";

		$auto_alt_dial_statuses = preg_replace("/ -$/","",$auto_alt_dial_statuses);
		$AADstatuses = explode(" ", $auto_alt_dial_statuses);
		$AADs_to_print = (count($AADstatuses) -1);

		$o=0;
		while ($AADs_to_print > $o) 
			{
			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}
			$o++;

			echo "<tr $bgcolor><td><font size=1>$AADstatuses[$o]</td>\n";
			echo "<td><font size=1><a onClick=\"delete_confirm('$PHP_SELF?ADD=66&campaign_id=$campaign_id&status=$AADstatuses[$o]')\" href='#'>DELETE</a></td></tr>\n";
			}

		echo "</table>\n";

		echo "<br>ADD NEW AUTO ALT NUMBER DIALING STATUS<BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=26>\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "Status: <select size=1 name=status>\n";
		echo "$LRstatuses_list\n";
		echo "</select> &nbsp; \n";
		echo "<input type=submit name=submit value=ADD><BR>\n";

		echo "</FORM><br>\n";
		}

	##### CAMPAIGN PAUSE CODES #####
	if ($SUB==27)
		{
		echo "<br><br><b>AGENT PAUSE CODES FOR THIS CAMPAIGN: &nbsp; $NWB#vicidial_pause_codes$NWE</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>PAUSE CODES</td><td>BILLABLE</td><td>MODIFY</td><td>DELETE</td></tr>\n";

		$stmt="SELECT pause_code,pause_code_name,billable,campaign_id from vicidial_pause_codes where campaign_id='$campaign_id' order by pause_code";
		$rslt=mysql_query($stmt, $link);
		$pause_codes_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($pause_codes_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$o++;

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><form action=$PHP_SELF method=POST><font size=1>$rowx[0]\n";
			echo "<input type=hidden name=ADD value=47>\n";
			echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
			echo "<input type=hidden name=pause_code value=\"$rowx[0]\"> &nbsp;\n";
			echo "<input type=text size=20 maxlength=30 name=pause_code_name value=\"$rowx[1]\"></td>\n";
			echo "<td><select size=1 name=billable><option>YES</option><option>NO</option><option>HALF</option><option SELECTED>$rowx[2]</option></select></td>\n";
			echo "<td><font size=1><input type=submit name=submit value=MODIFY></form></td>\n";
			echo "<td><font size=1><a onClick=\"delete_confirm('$PHP_SELF?ADD=67&campaign_id=$campaign_id&pause_code=$rowx[0]')\" href='#'>DELETE</a></td></tr>\n";
			}

		echo "</table>\n";

		echo "<br>ADD NEW AGENT PAUSE CODE<BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=27>\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "Pause Code: <input type=text size=8 maxlength=6 name=pause_code>\n";
		echo "Pause Code Name: <input type=text size=20 maxlength=30 name=pause_code_name>\n";
		echo " &nbsp; Billable: <select size=1 name=billable><option>YES</option><option>NO</option><option>HALF</option></select>\n";
		echo "<input type=submit name=submit value=ADD><BR>\n";

		echo "</center></FORM><br>\n";
		}

	##### CAMPAIGN QC SETTINGS #####
	if ( ($SUB==28) and ($SSqc_features_active > 0) )
		{
		$stmt="SELECT list_id,list_name,active from vicidial_lists where campaign_id='$campaign_id'";
		$rslt=mysql_query($stmt, $link);
		$lists_to_print = mysql_num_rows($rslt);
		$qc_lists_list='';

		$p=0;
		while ($lists_to_print > $p) 
			{
			$rowx=mysql_fetch_row($rslt);
			$qc_lists_list .= "<input type=\"checkbox\" name=\"qc_lists[]\" value=\"$rowx[0]\"";
			$r=0;
			while ($r < $QCL_to_print)
				{
				if ($rowx[0] == $QClists[$r]) 
					{
					$qc_lists_list .= " CHECKED";
					}
				$r++;
				}
			$qc_lists_list .= "> $rowx[0] - $rowx[1] - $rowx[2]<BR>\n";

			$p++;
			}

		##### get scripts listings for pulldown
		$stmt="SELECT script_id,script_name from vicidial_scripts order by script_id";
		$rslt=mysql_query($stmt, $link);
		$scripts_to_print = mysql_num_rows($rslt);
		$QCscripts_list="";
		$o=0;
		while ($scripts_to_print > $o)
			{
			$rowx=mysql_fetch_row($rslt);
			$QCscripts_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$scriptname_list["$rowx[0]"] = "$rowx[1]";
			$o++;
			}
		##### get shifts listings for pulldown
		$stmt="SELECT shift_id,shift_name from vicidial_shifts order by shift_id";
		$rslt=mysql_query($stmt, $link);
		$shifts_to_print = mysql_num_rows($rslt);
		$QCshifts_list="";
		$o=0;
		while ($shifts_to_print > $o)
			{
			$rowx=mysql_fetch_row($rslt);
			$QCshifts_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$shiftname_list["$rowx[0]"] = "$rowx[1]";
			$o++;
			}

		echo "<br><br><b>QC SETTINGS FOR THIS CAMPAIGN:</b><br>\n";
		echo "<form action=$PHP_SELF method=POST><center><TABLE width=700 cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right><input type=hidden name=ADD value=48>\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "QC Enabled: </td><td><select size=1 name=qc_enabled><option>Y</option><option>N</option><option SELECTED>$qc_enabled</option></select> $NWB#vicidial_campaigns-qc_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#C2C2C2><td align=right>QC Call Result: <BR> $NWB#vicidial_campaigns-qc_statuses$NWE</td><td>$qc_statuses_list</td></tr>\n";
#		echo "<tr bgcolor=#FFFFFF><td align=right>QC Lists: <BR> $NWB#vicidial_campaigns-qc_lists$NWE</td><td>$qc_lists_list</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>QC WebForm: </td><td align=left><input type=text name=qc_web_form_address size=70 maxlength=255 value=\"$qc_web_form_address\">$NWB#vicidial_campaigns-qc_web_form_address$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=3111111&script_id=$script_id\">QC Script</a>: </td><td align=left><select size=1 name=qc_script>\n";
		echo "$QCscripts_list";
		echo "<option selected value=\"$qc_script\">$qc_script - $scriptname_list[$qc_script]</option>\n";
		echo "</select>$NWB#vicidial_campaigns-qc_script$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=331111111&shift_id=$qc_shift_id\">QC Shift</a>: </td><td align=left><select size=1 name=qc_shift_id>\n";
		echo "$QCshifts_list";
		echo "<option selected value=\"$qc_shift_id\">$qc_shift_id - $shiftname_list[$qc_shift_id]</option>\n";
		echo "</select>$NWB#vicidial_campaigns-qc_shift_id$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>QC Get Record Launch: </td><td><select size=1 name=qc_get_record_launch><option>NONE</option><option>SCRIPT</option><option>WEBFORM</option><option>QCSCRIPT</option><option>QCWEBFORM</option><option SELECTED>$qc_get_record_launch</option></select> $NWB#vicidial_campaigns-qc_get_record_launch$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>QC Show Recording: </td><td><select size=1 name=qc_show_recording><option>Y</option><option>N</option><option SELECTED>$qc_show_recording</option></select> $NWB#vicidial_campaigns-qc_show_recording$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit value=SUBMIT></td></tr>\n";
		echo "</table>\n";
		echo "<BR></center></FORM><br>\n";
		}

	##### CAMPAIGN SURVEY SETTINGS #####
	if ($SUB=='20A')
		{

		echo "<center><br><b>SURVEY SETTINGS FOR THIS CAMPAIGN:</b><br>\n";
		echo "<form action=$PHP_SELF method=POST name=admin_form id=admin_form><center><TABLE width=750 cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right><input type=hidden name=ADD value=40A>\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Survey First Audio File: </td><td><input type=text size=50 maxlength=50 name=survey_first_audio_file id=survey_first_audio_file value=\"$survey_first_audio_file\"> <a href=\"javascript:launch_chooser('survey_first_audio_file','date',30);\">audio chooser</a>  $NWB#vicidial_campaigns-survey_first_audio_file$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey DTMF Digits: </td><td><input type=text size=16 maxlength=16 name=survey_dtmf_digits value=\"$survey_dtmf_digits\"> $NWB#vicidial_campaigns-survey_dtmf_digits$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Not Interested Digit: </td><td><input type=text size=5 maxlength=1 name=survey_ni_digit value=\"$survey_ni_digit\"> $NWB#vicidial_campaigns-survey_ni_digit$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Opt-in Audio File: </td><td><input type=text size=50 maxlength=50 name=survey_opt_in_audio_file id=survey_opt_in_audio_file value=\"$survey_opt_in_audio_file\"> <a href=\"javascript:launch_chooser('survey_opt_in_audio_file','date',30);\">audio chooser</a> $NWB#vicidial_campaigns-survey_opt_in_audio_file$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Not Interested Audio File: </td><td><input type=text size=50 maxlength=50 name=survey_ni_audio_file id=survey_ni_audio_file value=\"$survey_ni_audio_file\"> <a href=\"javascript:launch_chooser('survey_ni_audio_file','date',30);\">audio chooser</a> $NWB#vicidial_campaigns-survey_ni_audio_file$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Method: </td><td><select size=1 name=survey_method><option>AGENT_XFER</option><option>VOICEMAIL</option><option>EXTENSION</option><option>HANGUP</option><option>CAMPREC_60_WAV</option><option SELECTED>$survey_method</option></select> $NWB#vicidial_campaigns-survey_method$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey No-Response Action: </td><td><select size=1 name=survey_no_response_action><option>OPTIN</option><option>OPTOUT</option><option SELECTED>$survey_no_response_action</option></select> $NWB#vicidial_campaigns-survey_no_response_action$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Not Interested Status: </td><td><select name=survey_ni_status>$survey_ni_status_list</select> $NWB#vicidial_campaigns-survey_ni_status$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Third Digit: </td><td><input type=text size=5 maxlength=1 name=survey_third_digit id=survey_third_digit value=\"$survey_third_digit\"> $NWB#vicidial_campaigns-survey_third_digit$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Third Audio File: </td><td><input type=text size=50 maxlength=50 name=survey_third_audio_file id=survey_third_audio_file value=\"$survey_third_audio_file\"> <a href=\"javascript:launch_chooser('survey_third_audio_file','date',30);\">audio chooser</a> $NWB#vicidial_campaigns-survey_third_audio_file$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Third Status: </td><td><input type=text size=10 maxlength=6 name=survey_third_status value=\"$survey_third_status\"> $NWB#vicidial_campaigns-survey_third_status$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Third Extension: </td><td><input type=text size=20 maxlength=20 name=survey_third_exten value=\"$survey_third_exten\"> $NWB#vicidial_campaigns-survey_third_exten$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Fourth Digit: </td><td><input type=text size=5 maxlength=1 name=survey_fourth_digit value=\"$survey_fourth_digit\"> $NWB#vicidial_campaigns-survey_fourth_digit$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Fourth Audio File: </td><td><input type=text size=50 maxlength=50 name=survey_fourth_audio_file id=survey_fourth_audio_file value=\"$survey_fourth_audio_file\"> <a href=\"javascript:launch_chooser('survey_fourth_audio_file','date',30);\">audio chooser</a> $NWB#vicidial_campaigns-survey_fourth_audio_file$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Fourth Status: </td><td><input type=text size=10 maxlength=6 name=survey_fourth_status value=\"$survey_fourth_status\"> $NWB#vicidial_campaigns-survey_fourth_status$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Fourth Extension: </td><td><input type=text size=20 maxlength=20 name=survey_fourth_exten value=\"$survey_fourth_exten\"> $NWB#vicidial_campaigns-survey_fourth_exten$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Response Digit Map: </td><td><input type=text size=70 maxlength=100 name=survey_response_digit_map value=\"$survey_response_digit_map\"> $NWB#vicidial_campaigns-survey_response_digit_map$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Survey Xfer Extension: </td><td><input type=text size=12 maxlength=20 name=survey_xfer_exten value=\"$survey_xfer_exten\"> $NWB#vicidial_campaigns-survey_xfer_exten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Survey Campaign Recording Directory: </td><td><input type=text size=70 maxlength=255 name=survey_camp_record_dir value=\"$survey_camp_record_dir\"> $NWB#vicidial_campaigns-survey_camp_record_dir$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Voicemail: </td><td><input type=text size=12 maxlength=10 name=voicemail_ext id=voicemail_ext value=\"$voicemail_ext\"> <a href=\"javascript:launch_vm_chooser('voicemail_ext','vm',300);\">voicemail chooser</a> $NWB#vicidial_campaigns-voicemail_ext$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit value=SUBMIT></td></tr>\n";
		echo "</table>\n";
		echo "<BR></center></FORM><br>\n";
		}


	if ($SUB < 1)
		{
		echo "<BR><BR>\n";
		echo "<a href=\"$PHP_SELF?ADD=52&campaign_id=$campaign_id&DB=$DB\">LOG ALL AGENTS OUT OF THIS CAMPAIGN</a><BR><BR>\n";
		echo "<a href=\"$PHP_SELF?ADD=53&campaign_id=$campaign_id&DB=$DB\">EMERGENCY VDAC CLEAR FOR THIS CAMPAIGN</a><BR><BR>\n";

		if ($LOGdelete_campaigns > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=51&campaign_id=$campaign_id\">DELETE THIS CAMPAIGN</a>\n";
			}
		}
	}
	else
	{
	echo "You do not have permission to view this page\n";
	exit;
	}
}


######################
# ADD=34 modify campaign info in the system - Basic View
######################
/*
if ( ($ADD==34) and ( (!eregi("$campaign_id",$LOGallowed_campaigns)) and (!eregi("ALL-CAMPAIGNS",$LOGallowed_campaigns)) ) ) 
	{$ADD=30;}	# send to not allowed screen if not in vicidial_user_groups allowed_campaigns list
*/
if ($ADD==34)
	{
	
	if ($LOGmodify_campaigns==1)
		{
		if ($stage=='show_dialable')
			{
			$stmt="UPDATE vicidial_campaigns set display_dialable_count='Y' where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			}
		if ($stage=='hide_dialable')
			{
			$stmt="UPDATE vicidial_campaigns set display_dialable_count='N' where campaign_id='$campaign_id';";
			$rslt=mysql_query($stmt, $link);
			}

		$stmt="SELECT campaign_id,campaign_name,active,dial_status_a,dial_status_b,dial_status_c,dial_status_d,dial_status_e,lead_order,park_ext,park_file_name,web_form_address,allow_closers,hopper_level,auto_dial_level,next_agent_call,local_call_time,voicemail_ext,dial_timeout,dial_prefix,campaign_cid,campaign_vdad_exten,campaign_rec_exten,campaign_recording,campaign_rec_filename,campaign_script,get_call_launch,am_message_exten,amd_send_to_vmx,xferconf_a_dtmf,xferconf_a_number,xferconf_b_dtmf,xferconf_b_number,alt_number_dialing,scheduled_callbacks,lead_filter_id,drop_call_seconds,drop_action,safe_harbor_exten,display_dialable_count,wrapup_seconds,wrapup_message,closer_campaigns,use_internal_dnc,allcalls_delay,omit_phone_code,dial_method,available_only_ratio_tally,adaptive_dropped_percentage,adaptive_maximum_level,adaptive_latest_server_time,adaptive_intensity,adaptive_dl_diff_target,concurrent_transfers,auto_alt_dial,auto_alt_dial_statuses,agent_pause_codes_active,campaign_description,campaign_changedate,campaign_stats_refresh,campaign_logindate,dial_statuses,disable_alter_custdata,no_hopper_leads_logins,list_order_mix,campaign_allow_inbound,manual_dial_list_id,default_xfer_group,xfer_groups,queue_priority,drop_inbound_group,qc_enabled,qc_statuses,qc_lists,qc_shift_id,qc_get_record_launch,qc_show_recording,qc_web_form_address,qc_script,survey_first_audio_file,survey_dtmf_digits,survey_ni_digit,survey_opt_in_audio_file,survey_ni_audio_file,survey_method,survey_no_response_action,survey_ni_status,survey_response_digit_map,survey_xfer_exten,survey_camp_record_dir,disable_alter_custphone,display_queue_count,manual_dial_filter,agent_clipboard_copy,agent_extended_alt_dial,use_campaign_dnc,three_way_call_cid,three_way_dial_prefix,web_form_target,vtiger_search_category,vtiger_create_call_record,vtiger_create_lead_record,vtiger_screen_login,cpd_amd_action,agent_allow_group_alias,default_group_alias,vtiger_search_dead,vtiger_status_call,survey_third_digit,survey_third_audio_file,survey_third_status,survey_third_exten,survey_fourth_digit,survey_fourth_audio_file,survey_fourth_status,survey_fourth_exten,drop_lockout_time,quick_transfer_button,prepopulate_transfer_preset,drop_rate_group,view_calls_in_queue,view_calls_in_queue_launch,grab_calls_in_queue,call_requeue_button,pause_after_each_call,no_hopper_dialing,agent_dial_owner_only,agent_display_dialable_leads,web_form_address_two,waitforsilence_options from vicidial_campaigns where campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$dial_status_a = $row[3];
		$dial_status_b = $row[4];
		$dial_status_c = $row[5];
		$dial_status_d = $row[6];
		$dial_status_e = $row[7];
		$lead_order = $row[8];
		$hopper_level = $row[13];
		$auto_dial_level = $row[14];
		$next_agent_call = $row[15];
		$local_call_time = $row[16];
		$voicemail_ext = $row[17];
		$dial_timeout = $row[18];
		$dial_prefix = $row[19];
		$campaign_cid = $row[20];
		$campaign_vdad_exten = $row[21];
		$script_id = $row[25];
		$get_call_launch = $row[26];
		$lead_filter_id = $row[35];
			if ($lead_filter_id=='') {$lead_filter_id='NONE';}
		$display_dialable_count = $row[39];
		$dial_method = $row[46];
		$adaptive_intensity = $row[51];
		$campaign_description = $row[57];
		$campaign_changedate = $row[58];
		$campaign_stats_refresh = $row[59];
		$campaign_logindate = $row[60];
		$dial_statuses = $row[61];
		$list_order_mix = $row[64];
		$default_xfer_group = $row[67];
		$campaign_allow_inbound = $row[65];
		$default_xfer_group = $row[67];
		$drop_lockout_time = $row[116];

	if (ereg("DISABLED",$list_order_mix))
		{$DEFlistDISABLE = '';	$DEFstatusDISABLED=0;}
	else
		{$DEFlistDISABLE = 'disabled';	$DEFstatusDISABLED=1;}

		$stmt="SELECT status,status_name,selectable,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable from vicidial_statuses order by status";
		$rslt=mysql_query($stmt, $link);
		$statuses_to_print = mysql_num_rows($rslt);
		$statuses_list='';
		$dial_statuses_list='';
		$o=0;
		while ($statuses_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$statuses_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			if ($rowx[0] != 'CBHOLD') {$dial_statuses_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";}
			$statname_list["$rowx[0]"] = "$rowx[1]";
			$LRstatuses_list .= "<option value=\"$rowx[0]-----$rowx[1]\">$rowx[0] - $rowx[1]</option>\n";
			if (eregi("Y",$rowx[2]))
				{$HKstatuses_list .= "<option value=\"$rowx[0]-----$rowx[1]\">$rowx[0] - $rowx[1]</option>\n";}
			$o++;
			}

		$stmt="SELECT status,status_name,selectable,campaign_id,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable from vicidial_campaign_statuses where campaign_id='$campaign_id' order by status";
		$rslt=mysql_query($stmt, $link);
		$Cstatuses_to_print = mysql_num_rows($rslt);

		$o=0;
		while ($Cstatuses_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$statuses_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			if ($rowx[0] != 'CBHOLD') {$dial_statuses_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";}
			$statname_list["$rowx[0]"] = "$rowx[1]";
			$LRstatuses_list .= "<option value=\"$rowx[0]-----$rowx[1]\">$rowx[0] - $rowx[1]</option>\n";
			if (eregi("Y",$rowx[2]))
				{$HKstatuses_list .= "<option value=\"$rowx[0]-----$rowx[1]\">$rowx[0] - $rowx[1]</option>\n";}
			$o++;
			}

		$dial_statuses = preg_replace("/ -$/","",$dial_statuses);
		$Dstatuses = explode(" ", $dial_statuses);
		$Ds_to_print = (count($Dstatuses) -1);

	$stmt="SELECT count(*) from vicidial_campaigns_list_mix where campaign_id='$campaign_id' and status='ACTIVE'";
	$rslt=mysql_query($stmt, $link);
	$rowx=mysql_fetch_row($rslt);
	if ($rowx[0] < 1)
		{
		$mixes_list="<option SELECTED value=\"DISABLED\">DISABLED</option>\n";
		$mixname_list["DISABLED"] = "DISABLED";
		}
	else
		{
		##### get list_mix listings for dynamic pulldown
		$stmt="SELECT vcl_id,vcl_name from vicidial_campaigns_list_mix where campaign_id='$campaign_id' and status='ACTIVE' limit 1";
		$rslt=mysql_query($stmt, $link);
		$mixes_to_print = mysql_num_rows($rslt);
		$mixes_list="<option value=\"DISABLED\">DISABLED</option>\n";

		$o=0;
		while ($mixes_to_print > $o)
			{
			$rowx=mysql_fetch_row($rslt);
			$mixes_list .= "<option value=\"ACTIVE\">ACTIVE ($rowx[0] - $rowx[1])</option>\n";
			$mixname_list["ACTIVE"] = "$rowx[0] - $rowx[1]";
			$o++;
			}
		}

	if ($SUB<1)		{$camp_detail_color=$subcamp_color;}
		else		{$camp_detail_color=$campaigns_color;}
	if ($SUB==22)	{$camp_statuses_color=$subcamp_color;}
		else		{$camp_statuses_color=$campaigns_color;}
	if ($SUB==23)	{$camp_hotkeys_color=$subcamp_color;}
		else		{$camp_hotkeys_color=$campaigns_color;}
	if ($SUB==25)	{$camp_recycle_color=$subcamp_color;}
		else		{$camp_recycle_color=$campaigns_color;}
	if ($SUB==26)	{$camp_autoalt_color=$subcamp_color;}
		else		{$camp_autoalt_color=$campaigns_color;}
	if ($SUB==27)	{$camp_pause_color=$subcamp_color;}
		else		{$camp_pause_color=$campaigns_color;}
	if ($SUB==29)	{$camp_listmix_color=$subcamp_color;}
		else		{$camp_listmix_color=$campaigns_color;}
	echo "<TABLE WIDTH=$page_width CELLPADDING=2 CELLSPACING=0><TR class=tr_bg_color>\n";
	echo "<TD><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\"> <B>$row[0]</B>: </font></TD>";
	echo "<TD><a href=\"$PHP_SELF?ADD=34&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">Basic View </font></a></TD>";
	echo "<TD> <a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">Detail View</font></a> </TD>";
	if ($SSoutbound_autodial_active > 0)
		{
		echo "<TD> <a href=\"$PHP_SELF?ADD=34&SUB=29&campaign_id=$campaign_id\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">List Mix</font></a> </TD>";
		}
	//echo "<TD> <a href=\"./AST_timeonVDADall.php?RR=4&DB=0&group=$row[0]\"><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\">Real-Time Screen</font></a></TD>\n";
	//echo "<TD></TD>\n";
	echo "<TD WIDTH=300><font size=2 color=$subcamp_font face=\"ARIAL,HELVETICA\"> &nbsp; </font></TD>\n";
	if ($SSoutbound_autodial_active < 1)
		{
		echo "<TD></TD>";
		}
	echo "</TR></TABLE>\n";

	if ($SUB < 1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
		echo "<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=44>\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign ID: </td><td align=left><b>$row[0]</b>$NWB#vicidial_campaigns-campaign_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Name: </td><td align=left><input type=text name=campaign_name size=40 maxlength=40 value=\"$row[1]\">$NWB#vicidial_campaigns-campaign_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Description: </td><td align=left>$row[57]$NWB#vicidial_campaigns-campaign_description$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Change Date: </td><td align=left>$campaign_changedate &nbsp; $NWB#vicidial_campaigns-campaign_changedate$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign Login Date: </td><td align=left>$campaign_logindate &nbsp; $NWB#vicidial_campaigns-campaign_logindate$NWE</td></tr>\n";

		echo "<tr bgcolor=#C2C2C2><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option>N</option><option SELECTED>$row[2]</option></select>$NWB#vicidial_campaigns-active$NWE</td></tr>\n";
		if($LOGuser_level>8){
			echo "<tr bgcolor=#FFFFFF><td align=right>Park Extension: </td><td align=left>$row[9] - $row[10]$NWB#vicidial_campaigns-park_ext$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>Web Form: </td><td align=left>$row[11]$NWB#vicidial_campaigns-web_form_address$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>Allow Closers: </td><td align=left>$row[12] $NWB#vicidial_campaigns-allow_closers$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>Default Transfer Group: </td><td align=left>$default_xfer_group $NWB#vicidial_campaigns-default_xfer_group$NWE</td></tr>\n";
		}
		if ($SSoutbound_autodial_active > 0)
			{
			if($LOGuser_level>8){
			echo "<tr bgcolor=#FFFFFF><td align=right>Allow Inbound and Blended: </td><td align=left>$campaign_allow_inbound $NWB#vicidial_campaigns-campaign_allow_inbound$NWE</td></tr>\n";
			}
			$o=0;
			while ($Ds_to_print > $o) 
				{
				$o++;
				$Dstatus = $Dstatuses[$o];

				echo "<tr bgcolor=#C2C2C2><td align=right>Dial Status $o: </td><td align=left> \n";
				if ($DEFstatusDISABLED > 0)
					{
					echo "<font color=grey><DEL><b>$Dstatus</b> - $statname_list[$Dstatus] &nbsp; &nbsp; &nbsp; &nbsp; <font size=2>\n";
					echo "REMOVE</DEL></td></tr>\n";
					}
				else
					{
					echo "<b>$Dstatus</b> - $statname_list[$Dstatus] &nbsp; &nbsp; &nbsp; &nbsp; <font size=2>\n";
					echo "<a href=\"$PHP_SELF?ADD=68&campaign_id=$campaign_id&status=$Dstatuses[$o]\">REMOVE</a></td></tr>\n";
					}
				}

			echo "<tr bgcolor=#C2C2C2><td align=right>Add A Dial Status: </td><td align=left><select size=1 name=dial_status $DEFlistDISABLE>\n";
			echo "<option value=\"\"> - NONE - </option>\n";

			echo "$dial_statuses_list";
			echo "</select> &nbsp; \n";
			echo "<input type=submit name=submit value=ADD> &nbsp; &nbsp; $NWB#vicidial_campaigns-dial_status$NWE</td></tr>\n";
			if($LOGuser_level>8){
			echo "<tr bgcolor=#FFFFFF><td align=right>List Order: </td><td align=left><select size=1 name=lead_order>
			<option SELECTED>$lead_order</option>
			<option>DOWN</option>
			<option>UP</option>
			<option>DOWN PHONE</option>
			<option>UP PHONE</option>
			<option>DOWN LAST NAME</option>
			<option>UP LAST NAME</option>
			<option>DOWN COUNT</option>
			<option>UP COUNT</option>
			<option>RANDOM</option>
			<option>DOWN LAST CALL TIME</option>
			<option>UP LAST CALL TIME</option>
			<option>DOWN RANK</option>
			<option>UP RANK</option>
			<option>DOWN OWNER</option>
			<option>UP OWNER</option>
			<option>DOWN TIMEZONE</option>
			<option>UP TIMEZONE</option>
			<option>DOWN 2nd NEW</option>
			<option>DOWN 3rd NEW</option>
			<option>DOWN 4th NEW</option>
			<option>DOWN 5th NEW</option>
			<option>DOWN 6th NEW</option>
			<option>UP 2nd NEW</option>
			<option>UP 3rd NEW</option>
			<option>UP 4th NEW</option>
			<option>UP 5th NEW</option>
			<option>UP 6th NEW</option>
			<option>DOWN PHONE 2nd NEW</option>
			<option>DOWN PHONE 3rd NEW</option>
			<option>DOWN PHONE 4th NEW</option>
			<option>DOWN PHONE 5th NEW</option>
			<option>DOWN PHONE 6th NEW</option>
			<option>UP PHONE 2nd NEW</option>
			<option>UP PHONE 3rd NEW</option>
			<option>UP PHONE 4th NEW</option>
			<option>UP PHONE 5th NEW</option>
			<option>UP PHONE 6th NEW</option>
			<option>DOWN LAST NAME 2nd NEW</option>
			<option>DOWN LAST NAME 3rd NEW</option>
			<option>DOWN LAST NAME 4th NEW</option>
			<option>DOWN LAST NAME 5th NEW</option>
			<option>DOWN LAST NAME 6th NEW</option>
			<option>UP LAST NAME 2nd NEW</option>
			<option>UP LAST NAME 3rd NEW</option>
			<option>UP LAST NAME 4th NEW</option>
			<option>UP LAST NAME 5th NEW</option>
			<option>UP LAST NAME 6th NEW</option>
			<option>DOWN COUNT 2nd NEW</option>
			<option>DOWN COUNT 3rd NEW</option>
			<option>DOWN COUNT 4th NEW</option>
			<option>DOWN COUNT 5th NEW</option>
			<option>DOWN COUNT 6th NEW</option>
			<option>UP COUNT 2nd NEW</option>
			<option>UP COUNT 3rd NEW</option>
			<option>UP COUNT 4th NEW</option>
			<option>UP COUNT 5th NEW</option>
			<option>UP COUNT 6th NEW</option>
			<option>RANDOM 2nd NEW</option>
			<option>RANDOM 3rd NEW</option>
			<option>RANDOM 4th NEW</option>
			<option>RANDOM 5th NEW</option>
			<option>RANDOM 6th NEW</option>
			<option>DOWN LAST CALL TIME 2nd NEW</option>
			<option>DOWN LAST CALL TIME 3rd NEW</option>
			<option>DOWN LAST CALL TIME 4th NEW</option>
			<option>DOWN LAST CALL TIME 5th NEW</option>
			<option>DOWN LAST CALL TIME 6th NEW</option>
			<option>UP LAST CALL TIME 2nd NEW</option>
			<option>UP LAST CALL TIME 3rd NEW</option>
			<option>UP LAST CALL TIME 4th NEW</option>
			<option>UP LAST CALL TIME 5th NEW</option>
			<option>UP LAST CALL TIME 6th NEW</option>
			<option>DOWN RANK 2nd NEW</option>
			<option>DOWN RANK 3rd NEW</option>
			<option>DOWN RANK 4th NEW</option>
			<option>DOWN RANK 5th NEW</option>
			<option>DOWN RANK 6th NEW</option>
			<option>UP RANK 2nd NEW</option>
			<option>UP RANK 3rd NEW</option>
			<option>UP RANK 4th NEW</option>
			<option>UP RANK 5th NEW</option>
			<option>UP RANK 6th NEW</option>
			<option>DOWN OWNER 2nd NEW</option>
			<option>DOWN OWNER 3rd NEW</option>
			<option>DOWN OWNER 4th NEW</option>
			<option>DOWN OWNER 5th NEW</option>
			<option>DOWN OWNER 6th NEW</option>
			<option>UP OWNER 2nd NEW</option>
			<option>UP OWNER 3rd NEW</option>
			<option>UP OWNER 4th NEW</option>
			<option>UP OWNER 5th NEW</option>
			<option>UP OWNER 6th NEW</option>
			<option>DOWN TIMEZONE 2nd NEW</option>
			<option>DOWN TIMEZONE 3rd NEW</option>
			<option>DOWN TIMEZONE 4th NEW</option>
			<option>DOWN TIMEZONE 5th NEW</option>
			<option>DOWN TIMEZONE 6th NEW</option>
			<option>UP TIMEZONE 2nd NEW</option>
			<option>UP TIMEZONE 3rd NEW</option>
			<option>UP TIMEZONE 4th NEW</option>
			<option>UP TIMEZONE 5th NEW</option>
			<option>UP TIMEZONE 6th NEW</option>
			</select>$NWB#vicidial_campaigns-lead_order$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=31&SUB=29&campaign_id=$campaign_id&vcl_id=$list_order_mix\">List Mix</a>: </td><td align=left><select size=1 name=list_order_mix>\n";
			echo "$mixes_list";
			if (ereg("DISABLED",$list_order_mix))
				{echo "<option selected value=\"$list_order_mix\">$list_order_mix - $mixname_list[$list_order_mix]</option>\n";}
			else
				{echo "<option selected value=\"ACTIVE\">ACTIVE ($mixname_list[ACTIVE])</option>\n";}
			echo "</select>$NWB#vicidial_campaigns-list_order_mix$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=31111111&lead_filter_id=$lead_filter_id\">Lead Filter</a>: </td><td align=left><select size=1 name=lead_filter_id>\n";
			echo "$filters_list";
			echo "<option selected value=\"$lead_filter_id\">$lead_filter_id - $filtername_list[$lead_filter_id]</option>\n";
			echo "</select>$NWB#vicidial_campaigns-lead_filter_id$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Hopper Level: </td><td align=left><select size=1 name=hopper_level><option>1</option><option>5</option><option>10</option><option>20</option><option>50</option><option>100</option><option>200</option><option>500</option><option>700</option><option>1000</option><option>2000</option><option SELECTED>$hopper_level</option></select>$NWB#vicidial_campaigns-hopper_level$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right>Force Reset of Hopper: </td><td align=left><select size=1 name=reset_hopper><option>Y</option><option SELECTED>N</option></select>$NWB#vicidial_campaigns-force_reset_hopper$NWE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Dial Method: </td><td align=left><select size=1 name=dial_method><option >MANUAL</option><option>RATIO</option><option>ADAPT_HARD_LIMIT</option><option>ADAPT_TAPERED</option><option>ADAPT_AVERAGE</option><option>INBOUND_MAN</option><option SELECTED>$dial_method</option></select>$NWB#vicidial_campaigns-dial_method$NWE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Auto Dial Level: </td><td align=left><select size=1 name=auto_dial_level><option selected>$auto_dial_level</option>\n";
			$adl=0;
			while($adl <= $SSauto_dial_limit)
				{
				echo "<option>$adl</option>\n";
				if ($adl < 1)
					{$adl = ($adl + 1);}
				else
					{
					if ($adl < 3)
						{$adl = ($adl + 0.1);}
					else
						{
						if ($adl < 4)
							{$adl = ($adl + 0.25);}
						else
							{
							if ($adl < 5)
								{$adl = ($adl + 0.5);}
							else
								{
								if ($adl < 10)
									{$adl = ($adl + 1);}
								else
									{
									if ($adl < 20)
										{$adl = ($adl + 2);}
									else
										{
										if ($adl < 40)
											{$adl = ($adl + 5);}
										else
											{
											if ($adl < 200)
												{$adl = ($adl + 10);}
											else
												{
												if ($adl < 400)
													{$adl = ($adl + 50);}
												else
													{
													if ($adl < 1000)
														{$adl = ($adl + 100);}
													else
													{$adl = ($adl + 1);}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			echo "<option>$adl</option></select>(0 = off)$NWB#vicidial_campaigns-auto_dial_level$NWE</td></tr>\n";

			echo "<tr bgcolor=#F5F5F5><td align=right>Adapt Intensity Modifier: </td><td align=left><select size=1 name=adaptive_intensity>\n";
			$n=40;
			while ($n>=-40)
				{
				$dtl = 'Balanced';
				if ($n<0) {$dtl = 'Less Intense';}
				if ($n>0) {$dtl = 'More Intense';}
				if ($n == $adaptive_intensity) 
					{echo "<option SELECTED value=\"$n\">$n - $dtl</option>\n";}
				else
					{echo "<option value=\"$n\">$n - $dtl</option>\n";}
				$n--;
				}
			echo "</select> $NWB#vicidial_campaigns-adaptive_intensity$NWE</td></tr>\n";
			}
		}
		if($LOGuser_level>8){
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=3111111&script_id=$script_id\">Script</a>: </td><td align=left>$script_id $NWB#vicidial_campaigns-campaign_script$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Get Call Launch: </td><td align=left>$get_call_launch $NWB#vicidial_campaigns-get_call_launch$NWE</td></tr>\n";
		}
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center></FORM>\n";

		echo "<center>\n";
	if($LOGuser_level>8){
	if ($SSoutbound_autodial_active > 0)
		{
		
		echo "<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=44>\n";
		echo "<input type=hidden name=DB value=$DB>\n";
		echo "<input type=hidden name=stage value=list_activation>\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "<br><b>LISTS WITHIN THIS CAMPAIGN: &nbsp; $NWB#vicidial_campaign_lists$NWE</b>\n";

		echo "<TABLE><TR><TD>\n";
			echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$LISTlink='stage=LISTIDDOWN';
		$TALLYlink='stage=TALLYDOWN';
		$ACTIVElink='stage=ACTIVEDOWN';
		$CAMPAIGNlink='stage=CAMPAIGNDOWN';
		$CALLDATElink='stage=CALLDATEDOWN';
		$SQLorder='order by list_id';
		if (eregi("LISTIDUP",$stage))		{$SQLorder='order by list_id asc';				$LISTlink='stage=LISTIDDOWN';}
		if (eregi("LISTIDDOWN",$stage))		{$SQLorder='order by list_id desc';				$LISTlink='stage=LISTIDUP';}
		if (eregi("TALLYUP",$stage))		{$SQLorder='order by tally asc';				$TALLYlink='stage=TALLYDOWN';}
		if (eregi("TALLYDOWN",$stage))		{$SQLorder='order by tally desc';				$TALLYlink='stage=TALLYUP';}
		if (eregi("ACTIVEUP",$stage))		{$SQLorder='order by active asc';				$ACTIVElink='stage=ACTIVEDOWN';}
		if (eregi("ACTIVEDOWN",$stage))		{$SQLorder='order by active desc';				$ACTIVElink='stage=ACTIVEUP';}
		if (eregi("CAMPAIGNUP",$stage))		{$SQLorder='order by campaign_id asc';			$CAMPAIGNlink='stage=CAMPAIGNDOWN';}
		if (eregi("CAMPAIGNDOWN",$stage))	{$SQLorder='order by campaign_id desc';			$CAMPAIGNlink='stage=CAMPAIGNUP';}
		if (eregi("CALLDATEUP",$stage))		{$SQLorder='order by list_lastcalldate asc';	$CALLDATElink='stage=CALLDATEDOWN';}
		if (eregi("CALLDATEDOWN",$stage))	{$SQLorder='order by list_lastcalldate desc';	$CALLDATElink='stage=CALLDATEUP';}

			$stmt="SELECT vls.list_id,list_name,list_description,0 as tally,active,list_lastcalldate,campaign_id from vicidial_lists vls where campaign_id='$campaign_id' group by list_id $SQLorder";
			$rslt=mysql_query($stmt, $link);
			$lists_to_print = mysql_num_rows($rslt);
			
			require("dbconnect_report.php");
			mysql_query("SET NAMES 'UTF8'");
			
			$stmt_bak = "SELECT vls.list_id,count(*) as tally from vicidial_lists vls,vicidial_list vl where vls.list_id=vl.list_id and campaign_id='$campaign_id' group by list_id";
			$rslt_bak = mysql_query($stmt_bak, $link);
			$lists_to_print_bak = mysql_num_rows($rslt_bak);

			$o=0;
			$list_bak = array();
			while ($lists_to_print_bak > $o){			
			  $row=mysql_fetch_row($rslt_bak);
			  $list_bak[$row[0]] = $row[1];
				$o++;
			}
						
      require("dbconnect.php");
      mysql_query("SET NAMES 'UTF8'");
      
			echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
			echo "<TR class=tr_bg_color>";
			echo "<TD><a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id&$LISTlink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>LIST ID</B></a></TD>";
			echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>LIST NAME</B></TD>";
			echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>DESCRIPTION</B></TD>\n";
			echo "<TD><a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id&$TALLYlink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>LEADS COUNT</B></a></TD>\n";
			echo "<TD COLSPAN=2><a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id&$ACTIVElink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>ACTIVE</B></a></TD>";
			echo "<TD><a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id&$CALLDATElink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>LAST CALL DATE</B></a></TD>";
			echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>MODIFY</TD>\n";
			echo "</TR>\n";

			$o=0;
			while ($lists_to_print > $o)
				{
				$row=mysql_fetch_row($rslt);
				
				$row[3] = isset($list_bak[$row[0]])?$list_bak[$row[0]]:0;
				
				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}
				echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=311&list_id=$row[0]\">$row[0]</a></td>";
				echo "<td><font size=1> $row[1]</td>";
				echo "<td><font size=1> $row[2]</td>";
				echo "<td><font size=1> $row[3]</td>";
				echo "<td><font size=1> $row[4]</td>";
				echo "<td>";

				if (ereg('Y',$row[4]))
					{
					$active_lists++;
					$camp_lists .= "'$row[0]',";
					echo "<input type=\"checkbox\" name=\"list_active_change[]\" value=\"$row[0]\" CHECKED>";
					}
				else
					{
					$inactive_lists++;
					echo "<input type=\"checkbox\" name=\"list_active_change[]\" value=\"$row[0]\"";
					}

				echo "</td>";
				echo "<td><font size=1> $row[5]</td>";
				echo "<td><font size=1><a href=\"$PHP_SELF?ADD=311&list_id=$row[0]\">MODIFY</a></td></tr>\n";

				$o++;
				}

			echo "<TR><TD COLSPAN=7 ALIGN=CENTER><input type=submit value=\"SUBMIT ACTIVE LIST CHANGES\"></TD></TR>\n";
			echo "</TABLE></center><BR></FORM>\n";
			echo "<center><b>\n";

			$filterSQL = $filtersql_list[$lead_filter_id];
			$filterSQL = preg_replace("/\\\\/","",$filterSQL);
			$filterSQL = eregi_replace("^and|and$|^or|or$","",$filterSQL);
			if (strlen($filterSQL)>4)
				{$fSQL = "and $filterSQL";}
			else
				{$fSQL = '';}

				$camp_lists = eregi_replace(".$","",$camp_lists);
			echo "This campaign has $active_lists active lists and $inactive_lists inactive lists<br><br>\n";


			if ($display_dialable_count == 'Y')
				{
				### call function to calculate and print dialable leads
				dialable_leads($DB,$link,$local_call_time,$dial_statuses,$camp_lists,$drop_lockout_time,$fSQL);
				echo " - <font size=1><a href=\"$PHP_SELF?ADD=34&campaign_id=$campaign_id&stage=hide_dialable\">HIDE</a></font><BR><BR>";
				}
			else
				{
				echo "<a href=\"$PHP_SELF?ADD=73&campaign_id=$campaign_id\" target=\"_blank\">Popup Dialable Leads Count</a>";
				echo " - <font size=1><a href=\"$PHP_SELF?ADD=31&campaign_id=$campaign_id&stage=show_dialable\">SHOW</a></font><BR><BR>";
				}



				$stmt="SELECT count(*) FROM vicidial_hopper where campaign_id='$campaign_id' and status IN('READY')";
				if ($DB) {echo "$stmt\n";}
				$rslt=mysql_query($stmt, $link);
				$rowx=mysql_fetch_row($rslt);
				$hopper_leads = "$rowx[0]";

			echo "This campaign has $hopper_leads leads in the dial hopper<br><br>\n";
			echo "<a href=\"./AST_VICIDIAL_hopperlist.php?group=$campaign_id\">Click here to see what leads are in the hopper right now</a><br><br>\n";
			echo "<a href=\"./AST_VDADstats.php?group=$campaign_id\">Click here to see a VDAD report for this campaign</a><BR><BR>\n";
		}
		echo "<a href=\"$PHP_SELF?ADD=81&campaign_id=$campaign_id\">Click here to see all CallBack Holds in this campaign</a><BR><BR>\n";
		echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=CAMPAIGNS&stage=$campaign_id\">Click here to see Admin chages to this campaign</a></FONT>\n";
			

		echo "</b></center>\n";

		echo "<br>\n";

		### list of agent rank or skill-level for this campaign
		echo "<center>\n";
		echo "<br><b>AGENT RANKS FOR THIS CAMPAIGN:</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>USER</td><td> &nbsp; &nbsp; RANK</td><td> &nbsp; &nbsp; CALLS TODAY</td></tr>\n";

			$stmt="SELECT vu.user,vca.campaign_rank,vca.calls_today,full_name from vicidial_campaign_agents vca, vicidial_users vu where campaign_id='$campaign_id' and active='Y' and vu.user=vca.user;";
			$rsltx=mysql_query($stmt, $link);
			$users_to_print = mysql_num_rows($rsltx);

			$o=0;
			while ($users_to_print > $o) {
				$rowx=mysql_fetch_row($rsltx);
				$o++;

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=3&user=$rowx[0]\">$rowx[0]</a> - $rowx[3]</td><td><font size=1>$rowx[1]</td><td><font size=1>$rowx[2]</td></tr>\n";
			}

		echo "</table></center><br>\n";


		echo "<a href=\"$PHP_SELF?ADD=52&campaign_id=$campaign_id&DB=$DB\">LOG ALL AGENTS OUT OF THIS CAMPAIGN</a><BR><BR>\n";


		if ($LOGdelete_campaigns > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=51&campaign_id=$campaign_id\">DELETE THIS CAMPAIGN</a>\n";
			}
		}
	}
	}
	else
	{
	echo "You do not have permission to view this page\n";
	exit;
	}
}


######################
# ADD=31 or 34 and SUB=29 for list mixes
######################
if ( ( ($ADD==34) or ($ADD==31) ) and ( (!eregi("$campaign_id",$LOGallowed_campaigns)) and (!eregi("ALL-CAMPAIGNS",$LOGallowed_campaigns)) ) ) 
	{$ADD=30;}	# send to not allowed screen if not in vicidial_user_groups allowed_campaigns list

if ( ($ADD==34) or ($ADD==31) )
{
	if ($LOGmodify_campaigns==1)
	{
	##### CAMPAIGN LIST MIX SETTINGS #####
	if ($SUB==29)
		{
		##### get list_id listings for dynamic pulldown
		$stmt="SELECT list_id,list_name from vicidial_lists where campaign_id='$campaign_id' order by list_id";
		$rslt=mysql_query($stmt, $link);
		$mixlists_to_print = mysql_num_rows($rslt);
		$mixlists_list="";

		$o=0;
		while ($mixlists_to_print > $o)
			{
			$rowx=mysql_fetch_row($rslt);
			$mixlists_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$mixlistsname_list["$rowx[0]"] = "$rowx[1]";
			$o++;
			}


		echo "<br><br><b>LIST MIXES FOR THIS CAMPAIGN: &nbsp; $NWB#vicidial_campaigns-list_order_mix$NWE</b><br>\n";

		echo "<br><b>WARNING, we only recommend List Mix for advanced users, Please read the CCMS Manager Manual</b><br>\n";

		$stmt="SELECT dial_statuses from vicidial_campaigns where campaign_id='$campaign_id'";
		$rslt=mysql_query($stmt, $link);
		$statuses = mysql_num_rows($rslt);
		if ($statuses > 0) 
			{
			$rowy=mysql_fetch_row($rslt);
			$LMdial_statuses=$rowy[0];
			}

		$stmt="SELECT vcl_id,vcl_name,campaign_id,list_mix_container,mix_method,status from vicidial_campaigns_list_mix where campaign_id='$campaign_id' order by status, vcl_id";
		$rslt=mysql_query($stmt, $link);
		$listmixes = mysql_num_rows($rslt);
		$o=0;
		while ($listmixes > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$vcl_id=$rowx[0];
			$o++;

			if ($o < 2)
				{$tablecolor='bgcolor="#99FF99"';   $bgcolor='bgcolor="#CCFFCC"';}
			else
				{
				if (eregi("1$|3$|5$|7$|9$", $o))
					{$tablecolor='bgcolor="#FFFFFF"';   $bgcolor='bgcolor="#C2C2C2"';} 
				else
					{$tablecolor='bgcolor="#C2C2C2"';   $bgcolor='bgcolor="#FFFFFF"';}
				}
			echo "<a name=\"LINK_$vcl_id\"><BR>\n";
			echo "<span id=\"LISTMIX$US$vcl_id$US$o\">";
			echo "<TABLE width=740 cellspacing=3 $tablecolor>\n";
			echo "<tr><td colspan=6>\n";
			echo "<form action=\"$PHP_SELF#LINK_$vcl_id\" method=POST name=$vcl_id id=$vcl_id>\n";
			echo "<input type=hidden name=ADD value=49>\n";
			echo "<input type=hidden name=SUB value=29>\n";
			echo "<input type=hidden name=stage value=\"MODIFY\">\n";
			echo "<input type=hidden name=vcl_id value=\"$vcl_id\">\n";
			echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
			echo "<input type=hidden name=list_mix_container$US$vcl_id id=list_mix_container$US$vcl_id value=\"\">\n";
			echo "<B>$vcl_id:</B>\n";
			echo "<input type=text size=40 maxlength=50 name=vcl_name$US$vcl_id id=vcl_name$US$vcl_id value=\"$rowx[1]\">\n";
			echo " &nbsp; &nbsp; <a href=\"$PHP_SELF?ADD=49&SUB=29&stage=DELMIX&campaign_id=$campaign_id&vcl_id=$vcl_id\">DELETE LIST MIX</a></td></tr>\n";
			echo "<tr><td colspan=3>Status: \n";
			if ($rowx[5]=='INACTIVE')
				{
				echo "<B>$rowx[5]</B>\n";
				echo "<a href=\"$PHP_SELF?ADD=49&SUB=29&stage=SETACTIVE&campaign_id=$campaign_id&vcl_id=$vcl_id\"><font size=1>SET TO ACTIVE</font></a></td>\n";
				}
			else
				{echo "<B>$rowx[5]</B></td>\n";}
			echo "<td colspan=3>Method:\n";
			echo "<select size=1 name=mix_method$US$vcl_id id=method$US$vcl_id><option value=\"EVEN_MIX\">EVEN_MIX</option><option value=\"IN_ORDER\">IN_ORDER</option><option value=\"RANDOM\">RANDOM</option><option SELECTED value=\"$rowx[4]\">$rowx[4]</option></select></td></tr>\n";
			echo "<tr><td>LIST ID</td><td>PRIORITY</td><td>% MIX</td><td>Call Result</td><td></td></tr>\n";

# list_id|order|percent|statuses|:list_id|order|percent|statuses|:...
# 101|1|40| A B NA -|:102|2|25| NEW -|:103|3|30| DROP CALLBK -|:101|4|5| DROP -|
# INSERT INTO vicidial_campaigns_list_mix values('TESTMIX','TESTCAMP List Mix','TESTCAMP','101|1|40| A B NA -|:102|2|25| NEW -|:103|3|30| DROP CALLBK -|:101|4|5| DROP -|','IN_ORDER','ACTIVE');
# INSERT INTO vicidial_campaigns_list_mix values('TESTMIX2','TESTCAMP List Mix2','TESTCAMP','101|1|20| A B -|:102|2|45| NEW -|:103|3|30| DROP CALLBK -|:101|4|5| DROP -|','IN_ORDER','ACTIVE');
# INSERT INTO vicidial_campaigns_list_mix values('TESTMIX3','TESTCAMP List Mix3','TESTCAMP','101|1|30| A NA -|:102|2|35| NEW -|:103|3|30| DROP CALLBK -|:101|4|5| DROP -|','IN_ORDER','ACTIVE');

			$MIXentries = $MT;
			$MIXentries = explode(":", $rowx[3]);
			$Ms_to_print = (count($MIXentries) - 0);
			$q=0;
			while ($Ms_to_print > $q) 
				{
				$MIXdetails = explode('|', $MIXentries[$q]);
				$MIXdetailsLIST = $MIXdetails[0];

				$dial_statuses = preg_replace("/ -$/","",$dial_statuses);
				$Dstatuses = explode(" ", $dial_statuses);
				$Ds_to_print = (count($Dstatuses) - 0);
				$Dsql = '';
				$r=0;
				while ($Ds_to_print > $r) 
					{
					$r++;
					$Dsql .= "'$Dstatuses[$r]',";
					}
				$Dsql = preg_replace("/,$/","",$Dsql);

				echo "<tr $bgcolor><td NOWRAP><font size=3>\n";
				echo "<input type=hidden name=list_id$US$q$US$vcl_id id=list_id$US$q$US$vcl_id value=$MIXdetailsLIST>\n";
				echo "<a href=\"$PHP_SELF?ADD=311&list_id=$MIXdetailsLIST\">List</a>: $MIXdetailsLIST &nbsp; <font size=1><a href=\"$PHP_SELF?ADD=49&SUB=29&stage=REMOVE&campaign_id=$campaign_id&vcl_id=$vcl_id&mix_container_item=$q&list_id=$MIXdetailsLIST#LINK_$vcl_id\">REMOVE</a></font></td>\n";

				echo "<td><select size=1 name=priority$US$q$US$vcl_id id=priority$US$q$US$vcl_id>\n";
				$n=40;
				while ($n>=1)
					{
					echo "<option value=\"$n\">$n</option>\n";
					$n = ($n-1);
					}
				echo "<option SELECTED value=\"$MIXdetails[1]\">$MIXdetails[1]</option></select></td>\n";

				echo "<td><select size=1 name=\"percentage$US$q$US$vcl_id\" id=\"percentage$US$q$US$vcl_id\" onChange=\"mod_mix_percent('$vcl_id','$Ms_to_print')\">\n";
				$n=100;
				while ($n>=0)
					{
					echo "<option value=\"$n\">$n</option>\n";
					$n = ($n-1);
					}
				echo "<option SELECTED value=\"$MIXdetails[2]\">$MIXdetails[2]</option></select></td>\n";

				
				echo "<td><input type=hidden name=status$US$q$US$vcl_id id=status$US$q$US$vcl_id value=\"$MIXdetails[3]\"><input type=text size=20 maxlength=255 name=ROstatus$US$q$US$vcl_id id=ROstatus$US$q$US$vcl_id value=\"$MIXdetails[3]\" READONLY></td>\n";
				echo "<td NOWRAP>\n";



				echo "<select size=1 name=dial_status$US$q$US$vcl_id id=dial_status$US$q$US$vcl_id>\n";
				echo "<option value=\"\"> - Select A Status - </option>\n";

				echo "$dial_statuses_list";
				echo "</select> <font size=2><B>\n";
				echo "<a href=\"#\" onclick=\"mod_mix_status('ADD','$vcl_id','$q');return false;\">ADD</a> &nbsp; \n";
				echo "<a href=\"#\" onclick=\"mod_mix_status('REMOVE','$vcl_id','$q');return false;\">REMOVE</a>\n";
				echo "</font></B></td></tr>\n";


				echo "</td></tr>\n";


				$q++;

				}



			
			echo "<tr $bgcolor><td colspan=3 align=right><font size=2>\n";
			echo "Difference %: <input type=text size=4 name=PCT_DIFF_$vcl_id id=PCT_DIFF_$vcl_id value=0 readonly>\n";
			echo "</td>\n";

			echo "<td colspan=2><input type=button name=submit_$vcl_id id=submit_$vcl_id value=\"SUBMIT\" onClick=\"submit_mix('$vcl_id','$Ms_to_print')\"> &nbsp; \n";
			echo "<span id=ERROR_$vcl_id></span>\n";
			echo "</form></td></tr>\n";


			echo "<tr $bgcolor><td colspan=3 align=center VALIGN=BOTTOM><font size=2>\n";
			echo "<form action=\"$PHP_SELF#LINK_$vcl_id\" method=POST name=ADD_$vcl_id id=ADD_$vcl_id>\n";
			echo "<input type=hidden name=ADD value=49>\n";
			echo "<input type=hidden name=SUB value=29>\n";
			echo "<input type=hidden name=stage value=\"ADD\">\n";
			echo "<input type=hidden name=vcl_id value=\"$vcl_id\">\n";
			echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
			echo "List: <select size=1 name=list_id>\n";
			echo "$mixlists_list";
			echo "<option selected value=\"\">ADD ANOTHER ENTRY</option>\n";
			echo "</select>\n";
			
			if ($q > 39) {$AE_disabled = 'DISABLED';}
			else {$AE_disabled = '';}
			echo "<input type=submit name=submit value=\"ADD ENTRY\" $AE_disabled>\n";
			echo "</form></td>\n";

			$X='X';
			echo "<td NOWRAP VALIGN=BOTTOM>\n";
			echo "<form action=\"$PHP_SELF#LINK_$vcl_id\" method=POST name=DEFAULT_$vcl_id id=DEFAULT_$vcl_id>\n";
			echo "<input type=hidden name=status$US$X$US$vcl_id id=status$US$X$US$vcl_id value=\"\"><input type=text size=20 maxlength=255 name=ROstatus$US$X$US$vcl_id id=ROstatus$US$X$US$vcl_id value=\"$LMdial_statuses\" READONLY>\n";
			echo "<BR><font size=2><B>CHANGE: \n";
			echo "<a href=\"#\" onclick=\"mod_mix_status('ALL','$vcl_id','$q');return false;\">ALL</a> &nbsp; \n";
			echo "<a href=\"#\" onclick=\"mod_mix_status('EMPTY','$vcl_id','$q');return false;\">EMPTY</a>\n";
			echo "</td><td NOWRAP VALIGN=MIDDLE>\n";
			echo "<select size=1 name=dial_status$US$X$US$vcl_id id=dial_status$US$X$US$vcl_id>\n";
			echo "<option value=\"\"> - Select A Status - </option>\n";
			echo "$dial_statuses_list";
			echo "</select> <font size=2><B>\n";
			echo "<a href=\"#\" onclick=\"mod_mix_status('ADD','$vcl_id','X');return false;\">ADD</a> &nbsp; \n";
			echo "<a href=\"#\" onclick=\"mod_mix_status('REMOVE','$vcl_id','X');return false;\">REMOVE</a>\n";
			echo "</form></td></tr>\n";
			echo "</table></span>\n";
			}


		echo "<br><br><B>ADD NEW LIST MIX</B><BR><form action=$PHP_SELF method=POST>\n";
		echo "<table border=0>\n";
		echo "<tr $bgcolor><td><form action=\"$PHP_SELF#LINK_$vcl_id\" method=POST>\n";
		echo "<input type=hidden name=ADD value=49>\n";
		echo "<input type=hidden name=SUB value=29>\n";
		echo "<input type=hidden name=stage value=\"NEWMIX\">\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "Mix ID: <input type=text size=20 maxlength=20 name=vcl_id value=\"\"></td>\n";
		echo "<td>Mix Name: <input type=text size=30 maxlength=50 name=vcl_name value=\"\"></td>\n";
		echo "<td>Mix Method: ";
		echo "<select size=1 name=mix_method><option value=\"EVEN_MIX\">EVEN_MIX</option><option value=\"IN_ORDER\">IN_ORDER</option><option value=\"RANDOM\">RANDOM</option></select></td></tr>\n";
		echo "<tr $bgcolor><td>List: <select size=1 name=list_id>\n";
		echo "$mixlists_list";
		echo "</select></td>\n";
		echo "<td>Dial Status: <select size=1 name=status>\n";
		echo "$dial_statuses_list";
		echo "</select></td>\n";
		echo "<td> &nbsp; <input type=submit name=submit value=SUBMIT></form></td>\n";
		echo "</tr>\n";
		echo "</table>\n";

		echo "<br>\n";

		}
	}
	echo "</TD></TR></TABLE></center>\n";
}


######################
# ADD=30 campaign not allowed
######################

if ($ADD==30)
{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
echo "You do not have permission to view campaign $campaign_id\n";
}


######################
# ADD=32 display all campaign statuses
######################
if ($ADD==32)
{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "<br>CUSTOM CAMPAIGN Call Result LISTINGS:\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr>\n";
echo "<td><B>CAMPAIGN</B></td>\n";
echo "<td><B>NAME</B></td>\n";
echo "<td><B>Call Result</B></td>\n";
echo "<td><B>MODIFY</B></td>\n";
echo "</tr>\n";

	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id);
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);
	
	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$campaigns_name_list[$o] = $row[1];
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=22&campaign_id=$campaigns_id_list[$o]\">$campaigns_id_list[$o]</a></td>";
		echo "<td><font size=1> $campaigns_name_list[$o] </td>";
		echo "<td><font size=1> ";

		$stmt="SELECT status from vicidial_campaign_statuses where campaign_id='$campaigns_id_list[$o]' order by status";
		$rslt=mysql_query($stmt, $link);
		$campstatus_to_print = mysql_num_rows($rslt);
		$p=0;
		while ( ($campstatus_to_print > $p) and ($p < 10) )
			{
			$row=mysql_fetch_row($rslt);
			echo "$row[0] ";
			$p++;
			}
		if ($p<1) 
			{echo "<font color=grey><DEL>NONE</DEL></font>";}
		echo "</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=22&campaign_id=$campaigns_id_list[$o]\">MODIFY Call Result</a></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
}


######################
# ADD=33 display all campaign hotkeys
######################
if ($ADD==33)
{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "<br>CAMPAIGN HOTKEYS LISTINGS:\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr>\n";
echo "<td><B>CAMPAIGN</B></td>\n";
echo "<td><B>NAME</B></td>\n";
echo "<td><B>HOTKEYS</B></td>\n";
echo "<td><B>MODIFY</B></td>\n";
echo "</tr>\n";

	$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$campaigns_name_list[$o] = $row[1];
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=23&campaign_id=$campaigns_id_list[$o]\">$campaigns_id_list[$o]</a></td>";
		echo "<td><font size=1> $campaigns_name_list[$o] </td>";
		echo "<td><font size=1> ";

		$stmt="SELECT status from vicidial_campaign_hotkeys where campaign_id='$campaigns_id_list[$o]' order by status";
		$rslt=mysql_query($stmt, $link);
		$campstatus_to_print = mysql_num_rows($rslt);
		$p=0;
		while ( ($campstatus_to_print > $p) and ($p < 10) )
			{
			$row=mysql_fetch_row($rslt);
			echo "$row[0] ";
			$p++;
			}
		if ($p<1) 
			{echo "<font color=grey><DEL>NONE</DEL></font>";}
		echo "</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=23&campaign_id=$campaigns_id_list[$o]\">MODIFY HOTKEYS</a></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
}


######################
# ADD=35 display all campaign lead recycle entries
######################
if ($ADD==35)
{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "<br>CAMPAIGN LEAD RECYCLE LISTINGS:\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr>\n";
echo "<td><B>CAMPAIGN</B></td>\n";
echo "<td><B>NAME</B></td>\n";
echo "<td><B>LEAD RECYCLES</B></td>\n";
echo "<td><B>MODIFY</B></td>\n";
echo "</tr>\n";

	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id);
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$campaigns_name_list[$o] = $row[1];
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=25&campaign_id=$campaigns_id_list[$o]\">$campaigns_id_list[$o]</a></td>";
		echo "<td><font size=1> $campaigns_name_list[$o] </td>";
		echo "<td><font size=1> ";

		$stmt="SELECT status from vicidial_lead_recycle where campaign_id='$campaigns_id_list[$o]' order by status";
		$rslt=mysql_query($stmt, $link);
		$campstatus_to_print = mysql_num_rows($rslt);
		$p=0;
		while ( ($campstatus_to_print > $p) and ($p < 10) )
			{
			$row=mysql_fetch_row($rslt);
			echo "$row[0] ";
			$p++;
			}
		if ($p<1) 
			{echo "<font color=grey><DEL>NONE</DEL></font>";}
		echo "</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=25&campaign_id=$campaigns_id_list[$o]\">MODIFY LEAD RECYCLES</a></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
}


######################
# ADD=36 display all campaign auto-alt dial entries
######################
if ($ADD==36)
{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "<br>CAMPAIGN LEAD AUTO-ALT DIAL LISTINGS:\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr>\n";
echo "<td><B>CAMPAIGN</B></td>\n";
echo "<td><B>NAME</B></td>\n";
echo "<td><B>AUTO-ALT DIAL</B></td>\n";
echo "<td><B>MODIFY</B></td>\n";
echo "</tr>\n";

	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id);
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$campaigns_name_list[$o] = $row[1];
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=26&campaign_id=$campaigns_id_list[$o]\">$campaigns_id_list[$o]</a></td>";
		echo "<td><font size=1> $campaigns_name_list[$o] </td>";
		echo "<td><font size=1> ";

		$stmt="SELECT auto_alt_dial_statuses from vicidial_campaigns where campaign_id='$campaigns_id_list[$o]';";
		$rslt=mysql_query($stmt, $link);
		$campstatus_to_print = mysql_num_rows($rslt);
		$p=0;
		while ( ($campstatus_to_print > $p) and ($p < 10) )
			{
			$row=mysql_fetch_row($rslt);
			echo "$row[0] ";
			$p++;
			}
		if (strlen($row[0])<3) 
			{echo "<font color=grey><DEL>NONE</DEL></font>";}
		echo "</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=26&campaign_id=$campaigns_id_list[$o]\">MODIFY AUTO-ALT DIAL</a></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
}


######################
# ADD=37 display all campaign agent pause codes
######################
if ($ADD==37)
{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "<br>CAMPAIGN AGENT PAUSE CODE LISTINGS:\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr>\n";
echo "<td><B>CAMPAIGN</B></td>\n";
echo "<td><B>NAME</B></td>\n";
echo "<td><B>PAUSE CODES</B></td>\n";
echo "<td><B>MODIFY</B></td>\n";
echo "</tr>\n";

	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id);
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$campaigns_name_list[$o] = $row[1];
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=27&campaign_id=$campaigns_id_list[$o]\">$campaigns_id_list[$o]</a></td>";
		echo "<td><font size=1> $campaigns_name_list[$o] </td>";
		echo "<td><font size=1> ";

		$stmt="SELECT pause_code from vicidial_pause_codes where campaign_id='$campaigns_id_list[$o]' order by pause_code;";
		$rslt=mysql_query($stmt, $link);
		$campstatus_to_print = mysql_num_rows($rslt);
		$p=0;
		while ( ($campstatus_to_print > $p) and ($p < 10) )
			{
			$row=mysql_fetch_row($rslt);
			echo "$row[0] ";
			$p++;
			}
		if ($p<1) 
			{echo "<font color=grey><DEL>NONE</DEL></font>";}
		echo "</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=27&campaign_id=$campaigns_id_list[$o]\">MODIFY PAUSE CODES</a></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
}



######################
# ADD=371 display Trans Switch
######################
if ($ADD==371)
{

	if($SUB==3711){
		if($sql_on_table=='vicidial_system_status'){
			$state_head = 'state';
		}
		else{
			$state_head = 'pause_code';
		}
		$stmt = "update `$sql_on_table` set `trans_switch`='$trans_switch' where campaign_id='$campaign_id' and `$state_head`='$system_status_state'";
		if ($DB) {echo "|$stmt|\n";}
		$delete_result=mysql_query($stmt, $link);
		$SUB = 3710;

	}
	
	##### 显示编辑页面 #####
	if ($SUB==3710)
		{
		echo "<br><br><b>TRANS SWITCH FOR THIS CAMPAIGN: </b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>STATE</td><td>Description</td><td>Trans Switch</td><td>MODIFY</td></tr>\n";

		$stmt="SELECT * from vicidial_system_status where campaign_id='$campaign_id'";
		$system_status_rslt=mysql_query($stmt, $link);
		$pause_codes_to_print = mysql_num_rows($system_status_rslt);

		$array_to_print = array();
		if($pause_codes_to_print){
			$stmt = "SELECT * from vicidial_pause_codes where campaign_id='$campaign_id'";
			$pause_codes_rslt=mysql_query($stmt, $link);		
			$pause_codes_to_print += mysql_num_rows($pause_codes_rslt);
			
			while($row = mysql_fetch_row($system_status_rslt)){
				$array_to_print[] = array('state'=>$row[0],'description'=>$row[1],'trans_switch'=>$row[2],'class'=>'system_status');
			}

			if(mysql_num_rows($pause_codes_rslt)){
				while($row = mysql_fetch_row($pause_codes_rslt)){
					$array_to_print[] = array('state'=>$row[0],'description'=>$row[1],'trans_switch'=>$row[4],'class'=>'pause_codes');
				}
			}

		}
		
		$PAUSED_trans_switch = "N";
		$o=0;
		if($pause_codes_to_print){
			foreach($array_to_print as $rowx){

				$onchange_str = "";
				if($rowx['state'] == 'PAUSED'||$rowx['state'] == 'QUEUE'){
					//$onchange_str = "onchange='trans_switch_select_onchange(this.value)'";
					continue;
					$PAUSED_trans_switch = $rowx['trans_switch'];
				}

				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}
				
				echo "<tr $bgcolor><form action=$PHP_SELF method=POST>\n";
				echo "<input type=hidden name=ADD value=371>\n";
				echo "<input type=hidden name=SUB value=3711></td>\n";
				echo "<input type=hidden name=system_status_state value=\"".$rowx['state']."\"></td>\n";
				echo "<input type=hidden name=sql_on_table value=\"vicidial_".$rowx['class']."\"></td>\n";
				echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
				echo "<td><font size=1>".$rowx['state']."</td>\n";
				echo "<td><font size=1>".$rowx['description']."</td>\n";
				echo "<td><select size=1 name=trans_switch $onchange_str class=".$rowx['class']."><option value=Y>Y</option><option value=N>N</option><option SELECTED value=".$rowx['trans_switch'].">".$rowx['trans_switch']."</option></select></td>\n";
				echo "<td><font size=1><input type=submit name=submit value=MODIFY></form></td>\n";
				echo "</tr>\n";
				$o++;
			}
		}

		echo "</table>\n";
		/*
		echo "<script>
				function trans_switch_select_onchange(trans_switch_value){
					var disabled_value = 'disabled';
					if(trans_switch_value == 'Y'){
						disabled_value = '';
					}

					var els = document.getElementsByTagName('select');
					for(var i=0;i<els.length;i++){
						if(els[i].className=='pause_codes'){
							els[i].disabled = disabled_value;

							var els_2 = els[i].parentNode.parentNode.parentNode.getElementsByTagName('input');
							for(var o=0;o<els_2.length;o++){
								if(els_2[o].name=='submit'){
									els_2[o].disabled = disabled_value;
								}
							}
						}
					}
				}
				trans_switch_select_onchange('".$PAUSED_trans_switch."');
			</script>";
		*/

/*
		echo "<br>ADD NEW TRANS SWITCH<BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=371>\n";
		echo "<input type=hidden name=SUB value=3712></td>\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "STATE: <input type=text size=8 maxlength=6 name=pause_code>\n";
		echo "Description: <input type=text size=20 maxlength=30 name=pause_code_name>\n";
		echo " &nbsp; Trans Switch: <select size=1 name=trans_switch><option>Y</option><option>N</option></select>\n";
		echo "<input type=submit name=submit value=ADD><BR>\n";

		echo "</center></FORM><br>\n";
*/
		echo "</center><br>\n";
		}
	else
		{
		##### 显示列表页面 #####
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>CAMPAIGN TRANS SWITCH LISTINGS:\n";
		echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
		echo "<tr>\n";
		echo "<td><B>CAMPAIGN</B></td>\n";
		echo "<td><B>NAME</B></td>\n";
		echo "<td><B>MODIFY</B></td>\n";
		echo "</tr>\n";

			//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
			$stmt = "select a.campaign_id,b.campaign_name from vicidial_system_status a left join vicidial_campaigns b on a.campaign_id=b.campaign_id group by campaign_id";
			$rslt=mysql_query($stmt, $link);
			$campaigns_to_print = mysql_num_rows($rslt);

			$o=0;
			while ($campaigns_to_print > $o) 
				{
				$row=mysql_fetch_row($rslt);
				$campaigns_id_list[$o] = $row[0];
				$campaigns_name_list[$o] = $row[1];
				$o++;
				}

			$o=0;
			while ($campaigns_to_print > $o) 
				{
				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}
				echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=371&SUB=3710&campaign_id=$campaigns_id_list[$o]\">$campaigns_id_list[$o]</a></td>";
				echo "<td><font size=1> $campaigns_name_list[$o] </td>";
				echo "<td><font size=1><a href=\"$PHP_SELF?ADD=371&SUB=3710&campaign_id=$campaigns_id_list[$o]\">MODIFY TRANS SWITCH</a></td></tr>\n";
				$o++;
				}

		echo "</TABLE></center>\n";
		}
}



if ($ADD==38)
{
	$abandon_rate = (isset($_POST['abandon_rate']))?$_POST['abandon_rate']:$_GET['abandon_rate'];
	$dial_level = (isset($_POST['dial_level']))?$_POST['dial_level']:$_GET['dial_level'];
	$active = (isset($_POST['active']))?$_POST['active']:$_GET['active'];
	//if(!$abandon_rate && $abandon_rate!==0 && isset($SUB)) $SUB=25;
	
	if($SUB==45){
		$stmt = "update vicidial_dial_level set dial_level=$dial_level,`active`='$active' where campaign_id='$campaign_id' and abandon_rate=$abandon_rate";
		if ($DB) {echo "|$stmt|\n";}
		$delete_result=mysql_query($stmt, $link);
		$SUB = 25;

	}
	if($SUB==46){
		$stmt="delete from vicidial_dial_level where campaign_id='$campaign_id' and abandon_rate=$abandon_rate";
		if ($DB) {echo "|$stmt|\n";}
		$delete_result=mysql_query($stmt, $link);
		$SUB = 25;
	}
	if($SUB==47){
		$stmt="insert into vicidial_dial_level (`campaign_id`,abandon_rate,dial_level,active) values ('$campaign_id',$abandon_rate,$dial_level,'$active')";
		if ($DB) {echo "|$stmt|\n";}
		$delete_result=mysql_query($stmt, $link);
		$SUB = 25;
	}


	if ($SUB==25)
		{	

		$stmt="SELECT * from vicidial_dial_level where campaign_id='$campaign_id'";
		if ($DB) {echo "|$stmt|\n";}
		$dial_level_result=mysql_query($stmt, $link);
		$counts_to_print = mysql_num_rows($dial_level_result);


		echo "<br><br><b>DAIL LEVEL WITHIN THIS CAMPAIGN:</b><br>\n";
		echo "<TABLE width=800 cellspacing=3>\n";
		echo "<tr><td>ABANDON RATE</td><td>DIAL LEVEL</td><td>ACTIVE</td><td>MODIFY</td><td>DELETE</td></tr>\n";
		
		//add by heibo  bug 1960
		require("dbconnect_report.php");
		mysql_query("SET NAMES 'UTF8'");

		if($counts_to_print){
			$o=0;
			while($dial_level_row=mysql_fetch_array($dial_level_result)){

				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}
				
				echo "<tr $bgcolor><td><font size=2> &nbsp; ".$dial_level_row['abandon_rate']."%<form action=$PHP_SELF method=POST>\n";
				echo "<input type=hidden name=abandon_rate value=\"".$dial_level_row['abandon_rate']."\">\n";
				echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
				echo "<input type=hidden name=ADD value=38></td>\n";
				echo "<input type=hidden name=SUB value=45></td>\n";
				echo "<td><select size=1 name=dial_level>";
				
				$adl=0;
				$SSauto_dial_limit = 5.1;
				while($adl <= $SSauto_dial_limit)
					{
					$selected_str = "";
					if(strval($dial_level_row["dial_level"])==strval($adl)) $selected_str = " selected=selected ";
					echo "<option $selected_str>$adl</option>\n";
					if ($adl < 1)
						{$adl = ($adl + 1);}
					else
						{
						if ($adl < 3)
							{$adl = ($adl + 0.1);}
						else
							{
							if ($adl < 4)
								{$adl = ($adl + 0.25);}
							else
								{
								if ($adl < 5)
									{$adl = ($adl + 0.5);}
								else
									{
									if ($adl < 10)
										{$adl = ($adl + 1);}
									else
										{
										if ($adl < 20)
											{$adl = ($adl + 2);}
										else
											{
											if ($adl < 40)
												{$adl = ($adl + 5);}
											else
												{
												if ($adl < 200)
													{$adl = ($adl + 10);}
												else
													{
													if ($adl < 400)
														{$adl = ($adl + 50);}
													else
														{
														if ($adl < 1000)
															{$adl = ($adl + 100);}
														else
														{$adl = ($adl + 1);}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				echo "</select></td>\n";

				echo "<td><select size=1 name=active><option>Y</option><option>N</option><option SELECTED>".$dial_level_row["active"]."</option></select></td>\n";
				echo "<td><font size=1><input type=submit name=submit value=MODIFY></form></td>\n";
				echo "<td><font size=1><a onClick=\"delete_confirm('$PHP_SELF?ADD=38&SUB=46&campaign_id=$campaign_id&abandon_rate=".$dial_level_row["abandon_rate"]."')\" href='#'>DELETE</a></td></tr>\n";
				$o++;
			}
		}
		

		require("dbconnect.php");
		mysql_query("SET NAMES 'UTF8'");
		
		echo "</table>\n";

		echo "<br>ADD NEW DIAL LEVEL<BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=38>\n";
		echo "<input type=hidden name=SUB value=47>\n";
		echo "<input type=hidden name=active value=\"Y\">\n";
		echo "<input type=hidden name=campaign_id value=\"$campaign_id\">\n";
		echo "Abandon Rate: <select size=1 name=abandon_rate>\n";
		for($i=100;$i>=0;$i--)
			{
			echo "<option value=$i>$i%</option>";
			}
		echo "</select> &nbsp; \n";
		echo "Dial Level: <select size=1 name=dial_level>\n";
		$adl=0;
		$SSauto_dial_limit = 5.1;
		while($adl <= $SSauto_dial_limit)
			{
			echo "<option >$adl</option>\n";
			if ($adl < 1)
				{$adl = ($adl + 1);}
			else
				{
				if ($adl < 3)
					{$adl = ($adl + 0.1);}
				else
					{
					if ($adl < 4)
						{$adl = ($adl + 0.25);}
					else
						{
						if ($adl < 5)
							{$adl = ($adl + 0.5);}
						else
							{
							if ($adl < 10)
								{$adl = ($adl + 1);}
							else
								{
								if ($adl < 20)
									{$adl = ($adl + 2);}
								else
									{
									if ($adl < 40)
										{$adl = ($adl + 5);}
									else
										{
										if ($adl < 200)
											{$adl = ($adl + 10);}
										else
											{
											if ($adl < 400)
												{$adl = ($adl + 50);}
											else
												{
												if ($adl < 1000)
													{$adl = ($adl + 100);}
												else
												{$adl = ($adl + 1);}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		echo "</select> &nbsp; \n";
		echo "<input type=submit name=submit value=ADD><BR>\n";
		echo "</FORM><br>\n";
		echo "<br>\n";
		}
	else{
		echo "<TABLE><TR><TD>\n";
			echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>CAMPAIGN DIAL LEVEL LISTINGS:\n";
		echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
		echo "<tr>\n";
		echo "<td><B>CAMPAIGN</B></td>\n";
		echo "<td><B>NAME</B></td>\n";
		echo "<td><B>MODIFY</B></td>\n";
		echo "</tr>\n";

			//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
			$stmt = "select campaign_id,campaign_name from vicidial_campaigns where dial_method='RATIO'";
			$rslt=mysql_query($stmt, $link);
			$campaigns_to_print = mysql_num_rows($rslt);

			$o=0;
			while ($campaigns_to_print > $o) 
				{
				$row=mysql_fetch_row($rslt);
				$campaigns_id_list[$o] = $row[0];
				$campaigns_name_list[$o] = $row[1];
				$o++;
				}

			$o=0;
			while ($campaigns_to_print > $o) 
				{
				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}
				echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=38&SUB=25&campaign_id=$campaigns_id_list[$o]\">$campaigns_id_list[$o]</a></td>";
				echo "<td><font size=1> $campaigns_name_list[$o] </td>";
				echo "<td><font size=1><a href=\"$PHP_SELF?ADD=38&SUB=25&campaign_id=$campaigns_id_list[$o]\">MODIFY PAUSE CODES</a></td>";
				echo "</tr>\n";
				$o++;
				}

		echo "</TABLE></center>\n";
	}

}


if ($ADD==377)
{
	if ($LOGload_leads==1)
		{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr class=tr_bg_color>\n";
echo "<td><font size=\"1\" color=\"white\"><B>CAMPAIGN</B></font></td>\n";
echo "<td><font size=\"1\" color=\"white\"><B>LOAD NEW LEADS</B></font></td>\n";
echo "</tr>\n";

	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id);
	//echo $stmt;exit;
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$vtiger_url[$o] = "<span style=\"font-size:12px;\">LOAD NEW LEADS</span>";
		if(!empty($row[7])){
			$vtiger_url[$o] = "<a href=\"$ADMIN?ccms_admin_modules=list_leads&vtiger_url=$row[7]\">LOAD NEW LEADS</a>";
		}
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1>$campaigns_id_list[$o]</font></td>";
		echo "<td><font size=1>$vtiger_url[$o]</font></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
}
if ($ADD==377111)
{
	if ($LOGload_leads==1)
		{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr class=tr_bg_color>\n";
echo "<td><font size=\"1\" color=\"white\"><B>CAMPAIGN</B></font></td>\n";
echo "<td><font size=\"1\" color=\"white\"><B>LOAD NEW LEADS</B></font></td>\n";
echo "</tr>\n";

	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id);
	//echo $stmt;exit;
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$vtiger_url[$o] = "<span style=\"font-size:12px;\">Import Leads From CSV</span>";
		if(!empty($row[7])){
			$vtiger_url[$o] = "<a href=\"$ADMIN?ccms_admin_modules=list_leads&vtiger_type=1&vtiger_url=$row[7]\">Import Leads From CSV</a>";
		}
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1>$campaigns_id_list[$o]</font></td>";
		echo "<td><font size=1>$vtiger_url[$o]</font></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
}
if ($ADD==99999999999999)
{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr class=tr_bg_color>\n";
echo "<td><font size=\"1\" color=\"white\"><B>CAMPAIGN</B></font></td>\n";
echo "<td><font size=\"1\" color=\"white\"><B>Queue Board</B></font></td>\n";
echo "</tr>\n";

	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id);
	//echo $stmt;exit;
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$vtiger_url[$o] = "<a href=\"project/sh_ef/queue_board.php?campaign=$row[0]\" target=\"_blank\">Queue Board</a>";
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1>$campaigns_id_list[$o]</font></td>";
		echo "<td><font size=1>$vtiger_url[$o]</font></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
}
if ($ADD==377222)
{
	if ($LOGload_leads==1)
		{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr class=tr_bg_color>\n";
echo "<td><font size=\"1\" color=\"white\"><B>CAMPAIGN</B></font></td>\n";
echo "<td><font size=\"1\" color=\"white\"><B>LOAD NEW LEADS</B></font></td>\n";
echo "</tr>\n";

	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id);
	//echo $stmt;exit;
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$vtiger_url[$o] = "<span style=\"font-size:12px;\">Import Leads From LDMS</span>";
		if(!empty($row[7])){
			$vtiger_url[$o] = "<a href=\"$ADMIN?ccms_admin_modules=list_leads&vtiger_type=2&vtiger_url=$row[7]\">Import Leads From LDMS</a>";
		}
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1>$campaigns_id_list[$o]</font></td>";
		echo "<td><font size=1>$vtiger_url[$o]</font></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
}
if ($ADD==377333)
{
	if ($LOGload_leads==1)
		{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr class=tr_bg_color>\n";
echo "<td><font size=\"1\" color=\"white\"><B>CAMPAIGN</B></font></td>\n";
echo "<td><font size=\"1\" color=\"white\"><B>LOAD NEW LEADS</B></font></td>\n";
echo "</tr>\n";

	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id);
	//echo $stmt;exit;
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$vtiger_url[$o] = "<span style=\"font-size:12px;\">Assign Leads</span>";
		if(!empty($row[7])){
			$vtiger_url[$o] = "<a href=\"$ADMIN?ccms_admin_modules=list_leads&vtiger_type=3&vtiger_url=$row[7]&campaign_id=$row[0]\">Assign Leads</a>";
		}
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1>$campaigns_id_list[$o]</font></td>";
		echo "<td><font size=1>$vtiger_url[$o]</font></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
}
if ($ADD==3777)
{
	if ($LOGast_admin_access==1)
		{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr class=tr_bg_color>\n";
echo "<td><font size=\"1\" color=\"white\"><B>CAMPAIGN</B></font></td>\n";
echo "<td><font size=\"1\" color=\"white\"><B>MODULES</B></font></td>\n";
echo "</tr>\n";

	//$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id);
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$vtiger_url[$o] = "<span style=\"font-size:12px;\">MODULES</span>";
		if(!empty($row[7]) && $row[8]==1){
			$vtiger_url[$o] = "<a href=\"?ccms_admin_modules=vtigercrm&campaign_id=$row[0]\">MODULES</a>";
		}
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1>$campaigns_id_list[$o]</font></td>";
		echo "<td><font size=1>$vtiger_url[$o]</font></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
}
######################
# ADD=39 display all campaign list mixes
######################
if ($ADD==39)
{
echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

echo "<br>CAMPAIGN LIST MIX LISTINGS:\n";
echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
echo "<tr>\n";
echo "<td><B>CAMPAIGN</B></td>\n";
echo "<td><B>NAME</B></td>\n";
echo "<td><B>LIST MIX</B></td>\n";
echo "<td><B>MODIFY</B></td>\n";
echo "</tr>\n";

	$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
	$rslt=mysql_query($stmt, $link);
	$campaigns_to_print = mysql_num_rows($rslt);

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$campaigns_id_list[$o] = $row[0];
		$campaigns_name_list[$o] = $row[1];
		$o++;
		}

	$o=0;
	while ($campaigns_to_print > $o) 
		{
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=29&campaign_id=$campaigns_id_list[$o]\">$campaigns_id_list[$o]</a></td>";
		echo "<td><font size=1> $campaigns_name_list[$o] </td>";
		echo "<td><font size=1> ";

		$stmt="SELECT vcl_id from vicidial_campaigns_list_mix where campaign_id='$campaigns_id_list[$o]' order by status,vcl_id;";
		$rslt=mysql_query($stmt, $link);
		$campstatus_to_print = mysql_num_rows($rslt);
		$p=0;
		while ( ($campstatus_to_print > $p) and ($p < 10) )
			{
			$row=mysql_fetch_row($rslt);
			echo "$row[0] ";
			$p++;
			}
		if ($p<1) 
			{echo "<font color=grey><DEL>NONE</DEL></font>";}
		echo "</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=31&SUB=29&campaign_id=$campaigns_id_list[$o]\">MODIFY LIST MIX</a></td></tr>\n";
		$o++;
		}

echo "</TABLE></center>\n";
}





######################
# ADD=311 modify list info in the system
######################

if ($ADD==311)
	{
	
	if ($LOGmodify_lists==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT list_id,list_name,campaign_id,active,list_description,list_changedate,list_lastcalldate,reset_time,agent_script_override,campaign_cid_override,am_message_exten_override,drop_inbound_group_override,xferconf_a_number,xferconf_b_number,xferconf_c_number,xferconf_d_number,xferconf_e_number from vicidial_lists where list_id='$list_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$list_name =				$row[1];
		$campaign_id =				$row[2];
		$active =					$row[3];
		$list_description =			$row[4];
		$list_changedate =			$row[5];
		$list_lastcalldate =		$row[6];
		$reset_time =				$row[7];
		$agent_script_override =	$row[8];
		$campaign_cid_override =	$row[9];
		$am_message_exten_override =	$row[10];
		$drop_inbound_group_override =	$row[11];
		$xferconf_a_number =		$row[12];
		$xferconf_b_number =		$row[13];
		$xferconf_c_number =		$row[14];
		$xferconf_d_number =		$row[15];
		$xferconf_e_number =		$row[16];
		# grab names of global Call Result and Call Result in the selected campaign
		$stmt="SELECT status,status_name,selectable,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable from vicidial_statuses order by status";
		$rslt=mysql_query($stmt, $link);
		$statuses_to_print = mysql_num_rows($rslt);

		$o=0;
		while ($statuses_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$statuses_list["$rowx[0]"] = "$rowx[1]";
			$o++;
			}

		$stmt="SELECT status,status_name,selectable,campaign_id,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable from vicidial_campaign_statuses where campaign_id='$campaign_id' order by status";
		$rslt=mysql_query($stmt, $link);
		$Cstatuses_to_print = mysql_num_rows($rslt);

		$o=0;
		while ($Cstatuses_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$statuses_list["$rowx[0]"] = "$rowx[1]";
			$o++;
			}
		# end grab status names

		##### get scripts listings for pulldown
		$Lscripts_list = "<option value=\"\">NONE - INACTIVE</option>\n";
		$stmt="SELECT script_id,script_name from vicidial_scripts order by script_id";
		$rslt=mysql_query($stmt, $link);
		$scripts_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($scripts_to_print > $o)
			{
			$rowx=mysql_fetch_row($rslt);
			$Lscripts_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$scriptname_list["$rowx[0]"] = "$rowx[1]";
			$o++;
			}

		##### get in-groups listings for dynamic drop in-group pulldown
		$stmt="SELECT group_id,group_name from vicidial_inbound_groups order by group_id";
		$rslt=mysql_query($stmt, $link);
		$Dgroups_to_print = mysql_num_rows($rslt);
		$Dgroups_menu='';
		$Dgroups_selected=0;
		$o=0;
		while ($Dgroups_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$Dgroups_menu .= "<option ";
			if ($drop_inbound_group_override == "$rowx[0]") 
				{
				$Dgroups_menu .= "SELECTED ";
				$Dgroups_selected++;
				}
			$Dgroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		if ($Dgroups_selected < 1) 
			{$Dgroups_menu .= "<option SELECTED value=\"\">---NONE---</option>\n";}
		else 
			{$Dgroups_menu .= "<option value=\"\">---NONE---</option>\n";}


		echo "<br>MODIFY A LISTS RECORD: $list_id<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=411>\n";
		echo "<input type=hidden name=list_id value=\"$list_id\">\n";
		echo "<input type=hidden name=old_campaign_id value=\"$campaign_id\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>List ID: </td><td align=left><b>$list_id</b>$NWB#vicidial_lists-list_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>List Name: </td><td align=left><input type=text name=list_name size=20 maxlength=20 value=\"$list_name\">$NWB#vicidial_lists-list_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>List Description: </td><td align=left><input type=text name=list_description size=30 maxlength=255 value=\"$list_description\">$NWB#vicidial_lists-list_description$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=34&campaign_id=$campaign_id\">Campaign</a>: </td><td align=left><select size=1 name=campaign_id>\n";

		$stmt=getCampaignSql($LOGuser_level,$LOGuser_name_id);
		$rslt=mysql_query($stmt, $link);
		$campaigns_to_print = mysql_num_rows($rslt);
		$campaigns_list='';
		$o=0;
		while ($campaigns_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$campaigns_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "$campaigns_list";
		echo "<option SELECTED>$campaign_id</option>\n";
		echo "</select>$NWB#vicidial_lists-campaign_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option>N</option><option SELECTED>$active</option></select>$NWB#vicidial_lists-active$NWE</td></tr>\n";
		if($LOGuser_level>8){
			echo "<tr bgcolor=#FFFFFF><td align=right>Reset Lead-Called-Status for this list: </td><td align=left><select size=1 name=reset_list><option>Y</option><option SELECTED>N</option></select>$NWB#vicidial_lists-reset_list$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>Reset Times: </td><td align=left><input type=text name=reset_time size=30 maxlength=100 value=\"$reset_time\">$NWB#vicidial_lists-reset_time$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>List Change Date: </td><td align=left>$list_changedate &nbsp; $NWB#vicidial_lists-list_changedate$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>List Last Call Date: </td><td align=left>$list_lastcalldate &nbsp; $NWB#vicidial_lists-list_lastcalldate$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right><a href=\"$PHP_SELF?ADD=3111111&script_id=$agent_script_override\">Agent Script Override</a>: </td><td align=left><select size=1 name=agent_script_override>\n";
			echo "$Lscripts_list";
			echo "<option selected value=\"$agent_script_override\">$agent_script_override - $scriptname_list[$agent_script_override]</option>\n";
			echo "</select>$NWB#vicidial_lists-agent_script_override$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Campaign CID Override: </td><td align=left><input type=text name=campaign_cid_override size=20 maxlength=20 value=\"$campaign_cid_override\">$NWB#vicidial_lists-campaign_cid_override$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Answering Machine Message Override: </td><td align=left><input type=text name=am_message_exten_override id=am_message_exten_override size=50 maxlength=100 value=\"$am_message_exten_override\"> <a href=\"javascript:launch_chooser('am_message_exten_override','date',300);\">audio chooser</a> $NWB#vicidial_lists-am_message_exten_override$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Drop Inbound Group Override: </td><td align=left><select size=1 name=drop_inbound_group_override>";
			echo "$Dgroups_menu";
			echo "</select>$NWB#vicidial_lists-drop_inbound_group_override$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Transfer-Conf Number 1 Override: </td><td align=left><input type=text name=xferconf_a_number size=20 maxlength=50 value=\"$xferconf_a_number\">$NWB#vicidial_lists-xferconf_a_dtmf$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Transfer-Conf Number 2 Override: </td><td align=left><input type=text name=xferconf_b_number size=20 maxlength=50 value=\"$xferconf_b_number\">$NWB#vicidial_lists-xferconf_a_dtmf$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Transfer-Conf Number 3 Override: </td><td align=left><input type=text name=xferconf_c_number size=20 maxlength=50 value=\"$xferconf_c_number\">$NWB#vicidial_lists-xferconf_a_dtmf$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Transfer-Conf Number 4 Override: </td><td align=left><input type=text name=xferconf_d_number size=20 maxlength=50 value=\"$xferconf_d_number\">$NWB#vicidial_lists-xferconf_a_dtmf$NWE</td></tr>\n";

			echo "<tr bgcolor=#C2C2C2><td align=right>Transfer-Conf Number 5 Override: </td><td align=left><input type=text name=xferconf_e_number size=20 maxlength=50 value=\"$xferconf_e_number\">$NWB#vicidial_lists-xferconf_a_dtmf$NWE</td></tr>\n";
		}

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";

		echo "<center>\n";
		if($LOGuser_level>=8){
		echo "<br><b>Call Result WITHIN THIS LIST:</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>STATUS</td><td>STATUS NAME</td><td>CALLED</td><td>NOT CALLED</td></tr>\n";

		$leads_in_list = 0;
		$leads_in_list_N = 0;
		$leads_in_list_Y = 0;
		$stmt="SELECT status,called_since_last_reset,count(*) from vicidial_list where list_id='$list_id' group by status,called_since_last_reset order by status,called_since_last_reset";
		if ($DB) {echo "$stmt\n";}
		$rslt=mysql_query($stmt, $link);
		$statuses_to_print = mysql_num_rows($rslt);

		$o=0;
		$lead_list['count'] = 0;
		$lead_list['Y_count'] = 0;
		$lead_list['N_count'] = 0;
		while ($statuses_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			
			$lead_list['count'] = ($lead_list['count'] + $rowx[2]);
			if ($rowx[1] == 'N') 
				{
				$since_reset = 'N';
				$since_resetX = 'Y';
				}
			else 
				{
				$since_reset = 'Y';
				$since_resetX = 'N';
				} 
			$lead_list[$since_reset][$rowx[0]] = ($lead_list[$since_reset][$rowx[0]] + $rowx[2]);
			$lead_list[$since_reset.'_count'] = ($lead_list[$since_reset.'_count'] + $rowx[2]);
			#If opposite side is not set, it may not in the future so give it a value of zero
			if (!isset($lead_list[$since_resetX][$rowx[0]])) 
				{
				$lead_list[$since_resetX][$rowx[0]]=0;
				}
			$o++;
			}
	 
		$o=0;
		if ($lead_list['count'] > 0)
			{
			while (list($dispo,) = each($lead_list[$since_reset]))
				{
				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}

				if ($dispo == 'CBHOLD')
					{
					$CLB="<a href=\"$PHP_SELF?ADD=811&list_id=$list_id\">";
					$CLE="</a>";
					}
				else
					{
					$CLB='';
					$CLE='';
					}

				echo "<tr $bgcolor><td><font size=1>$CLB$dispo$CLE</td><td><font size=1>$statuses_list[$dispo]</td><td><font size=1>".$lead_list['Y'][$dispo]."</td><td><font size=1>".$lead_list['N'][$dispo]." </td></tr>\n";
				$o++;
				}
			}

		echo "<tr><td colspan=2><font size=1>SUBTOTALS</td><td><font size=1>$lead_list[Y_count]</td><td><font size=1>$lead_list[N_count]</td></tr>\n";
		echo "<tr bgcolor=\"#C2C2C2\"><td><font size=1>TOTAL</td><td colspan=3 align=center><font size=1>$lead_list[count]</td></tr>\n";

		echo "</table></center><br>\n";
		unset($lead_list);


		echo "<center>\n";
		echo "<br><b>TIME ZONES WITHIN THIS LIST:</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>GMT OFFSET NOW (local time)</td><td>CALLED</td><td>NOT CALLED</td></tr>\n";

		$stmt="SELECT gmt_offset_now,called_since_last_reset,count(*) from vicidial_list where list_id='$list_id' group by gmt_offset_now,called_since_last_reset order by gmt_offset_now,called_since_last_reset";
		$rslt=mysql_query($stmt, $link);
		$statuses_to_print = mysql_num_rows($rslt);

		$o=0;
		$plus='+';
		$lead_list['count'] = 0;
		$lead_list['Y_count'] = 0;
		$lead_list['N_count'] = 0;
		while ($statuses_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			
			$lead_list['count'] = ($lead_list['count'] + $rowx[2]);
			if ($rowx[1] == 'N') 
				{
				$since_reset = 'N';
				$since_resetX = 'Y';
				}
			else 
				{
				$since_reset = 'Y';
				$since_resetX = 'N';
				} 
			$lead_list[$since_reset][$rowx[0]] = ($lead_list[$since_reset][$rowx[0]] + $rowx[2]);
			$lead_list[$since_reset.'_count'] = ($lead_list[$since_reset.'_count'] + $rowx[2]);
			#If opposite side is not set, it may not in the future so give it a value of zero
			if (!isset($lead_list[$since_resetX][$rowx[0]])) 
				{
				$lead_list[$since_resetX][$rowx[0]]=0;
				}
			$o++;
			}

		if ($lead_list['count'] > 0)
			{
			while (list($tzone,) = each($lead_list[$since_reset]))
				{
				$LOCALzone=3600 * $tzone;
				$LOCALdate=gmdate("D M Y H:i", time() + $LOCALzone);

				if ($tzone >= 0) {$DISPtzone = "$plus$tzone";}
				else {$DISPtzone = "$tzone";}
				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}

					echo "<tr $bgcolor><td><font size=1>".$DISPtzone." &nbsp; &nbsp; ($LOCALdate)</td><td><font size=1>".$lead_list['Y'][$tzone]."</td><td><font size=1>".$lead_list['N'][$tzone]."</td></tr>\n";
				}
			}

		echo "<tr><td><font size=1>SUBTOTALS</td><td><font size=1>$lead_list[Y_count]</td><td><font size=1>$lead_list[N_count]</td></tr>\n";
		echo "<tr bgcolor=\"#C2C2C2\"><td><font size=1>TOTAL</td><td colspan=2 align=center><font size=1>$lead_list[count]</td></tr>\n";

		echo "</table></center><br>\n";
		unset($lead_list);


		echo "<center>\n";
		echo "<br><b>OWNERS WITHIN THIS LIST:</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>OWNER</td><td>CALLED</td><td>NOT CALLED</td></tr>\n";

		$leads_in_list = 0;
		$leads_in_list_N = 0;
		$leads_in_list_Y = 0;
		$stmt="SELECT owner,called_since_last_reset,count(*) from vicidial_list where list_id='$list_id' group by owner,called_since_last_reset order by owner,called_since_last_reset";
		if ($DB) {echo "$stmt\n";}
		$rslt=mysql_query($stmt, $link);
		$owners_to_print = mysql_num_rows($rslt);

		$o=0;
		$lead_list['count'] = 0;
		$lead_list['Y_count'] = 0;
		$lead_list['N_count'] = 0;
		while ($owners_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			
			$lead_list['count'] = ($lead_list['count'] + $rowx[2]);
			if ($rowx[1] == 'N') 
				{
				$since_reset = 'N';
				$since_resetX = 'Y';
				}
			else 
				{
				$since_reset = 'Y';
				$since_resetX = 'N';
				} 
			$lead_list[$since_reset][$rowx[0]] = ($lead_list[$since_reset][$rowx[0]] + $rowx[2]);
			$lead_list[$since_reset.'_count'] = ($lead_list[$since_reset.'_count'] + $rowx[2]);
			#If opposite side is not set, it may not in the future so give it a value of zero
			if (!isset($lead_list[$since_resetX][$rowx[0]])) 
				{
				$lead_list[$since_resetX][$rowx[0]]=0;
				}
			$o++;
			}
	 
		$o=0;
		if ($lead_list['count'] > 0)
			{
			while (list($owner,) = each($lead_list[$since_reset]))
				{
				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}

				$CLB='';
				$CLE='';

				echo "<tr $bgcolor><td><font size=1>$CLB$owner$CLE</td><td><font size=1>".$lead_list['Y'][$owner]."</td><td><font size=1>".$lead_list['N'][$owner]." </td></tr>\n";
				$o++;
				}
			}

		echo "<tr><td><font size=1>SUBTOTALS</td><td><font size=1>$lead_list[Y_count]</td><td><font size=1>$lead_list[N_count]</td></tr>\n";
		echo "<tr bgcolor=\"#C2C2C2\"><td><font size=1>TOTAL</td><td colspan=3 align=center><font size=1>$lead_list[count]</td></tr>\n";

		echo "</table></center><br>\n";
		unset($lead_list);


		echo "<center>\n";
		echo "<br><b>RANKS WITHIN THIS LIST:</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>RANK</td><td>CALLED</td><td>NOT CALLED</td></tr>\n";

		$leads_in_list = 0;
		$leads_in_list_N = 0;
		$leads_in_list_Y = 0;
		$stmt="SELECT rank,called_since_last_reset,count(*) from vicidial_list where list_id='$list_id' group by rank,called_since_last_reset order by rank,called_since_last_reset";
		if ($DB) {echo "$stmt\n";}
		$rslt=mysql_query($stmt, $link);
		$ranks_to_print = mysql_num_rows($rslt);

		$o=0;
		$lead_list['count'] = 0;
		$lead_list['Y_count'] = 0;
		$lead_list['N_count'] = 0;
		while ($ranks_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			
			$lead_list['count'] = ($lead_list['count'] + $rowx[2]);
			if ($rowx[1] == 'N') 
				{
				$since_reset = 'N';
				$since_resetX = 'Y';
				}
			else 
				{
				$since_reset = 'Y';
				$since_resetX = 'N';
				} 
			$lead_list[$since_reset][$rowx[0]] = ($lead_list[$since_reset][$rowx[0]] + $rowx[2]);
			$lead_list[$since_reset.'_count'] = ($lead_list[$since_reset.'_count'] + $rowx[2]);
			#If opposite side is not set, it may not in the future so give it a value of zero
			if (!isset($lead_list[$since_resetX][$rowx[0]])) 
				{
				$lead_list[$since_resetX][$rowx[0]]=0;
				}
			$o++;
			}
	 
		$o=0;
		if ($lead_list['count'] > 0)
			{
			while (list($rank,) = each($lead_list[$since_reset]))
				{
				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}

				$CLB='';
				$CLE='';

				echo "<tr $bgcolor><td><font size=1>$CLB$rank$CLE</td><td><font size=1>".$lead_list['Y'][$rank]."</td><td><font size=1>".$lead_list['N'][$rank]." </td></tr>\n";
				$o++;
				}
			}

		echo "<tr><td><font size=1>SUBTOTALS</td><td><font size=1>$lead_list[Y_count]</td><td><font size=1>$lead_list[N_count]</td></tr>\n";
		echo "<tr bgcolor=\"#C2C2C2\"><td><font size=1>TOTAL</td><td colspan=3 align=center><font size=1>$lead_list[count]</td></tr>\n";

		echo "</table></center><br>\n";
		unset($lead_list);


		$leads_in_list = 0;
		$leads_in_list_N = 0;
		$leads_in_list_Y = 0;
		$stmt="SELECT status, if(called_count >= 100, 100, called_count), count(*) from vicidial_list where list_id='$list_id' group by status, if(called_count >= 100, 100, called_count) order by status,called_count";
		$rslt=mysql_query($stmt, $link);
		$status_called_to_print = mysql_num_rows($rslt);

		$o=0;
		$sts=0;
		$first_row=1;
		$all_called_first=1000;
		$all_called_last=0;
		while ($status_called_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$leads_in_list = ($leads_in_list + $rowx[2]);
			$count_statuses[$o]			= $rowx[0];
			$count_called[$o]			= $rowx[1];
			$count_count[$o]			= $rowx[2];
			$all_called_count[$rowx[1]] = ($all_called_count[$rowx[1]] + $rowx[2]);

			if ( (strlen($status[$sts]) < 1) or ($status[$sts] != "$rowx[0]") )
				{
				if ($first_row) {$first_row=0;}
				else {$sts++;}
				$status[$sts] = "$rowx[0]";
				$status_called_first[$sts] = "$rowx[1]";
				if ($status_called_first[$sts] < $all_called_first) {$all_called_first = $status_called_first[$sts];}
				}
			$leads_in_sts[$sts] = ($leads_in_sts[$sts] + $rowx[2]);
			$status_called_last[$sts] = "$rowx[1]";
			if ($status_called_last[$sts] > $all_called_last) {$all_called_last = $status_called_last[$sts];}

			$o++;
			}


		echo "<center>\n";
		echo "<br><b>CALLED COUNTS WITHIN THIS LIST:</b><br>\n";
		echo "<div style=\"width:700px;overflow:auto;\"><TABLE width=500 cellspacing=1>\n";
		echo "<tr><td align=left><font size=1>STATUS</td><td align=center><font size=1>STATUS NAME</td>";
		$first = $all_called_first;
		while ($first <= $all_called_last)
			{
			if (eregi("1$|3$|5$|7$|9$", $first)) {$AB='bgcolor="#AFEEEE"';} 
			else{$AB='bgcolor="#E0FFFF"';}
			if ($first >= 100) {$Fplus='+';}
			else {$Fplus='';}
			echo "<td align=center $AB><font size=1>$first$Fplus</td>";
			$first++;
			}
		echo "<td align=center><font size=1>SUBTOTAL</td></tr>\n";

		$sts=0;
		$statuses_called_to_print = count($status);
		while ($statuses_called_to_print > $sts) 
			{
			$Pstatus = $status[$sts];
			if (eregi("1$|3$|5$|7$|9$", $sts))
				{$bgcolor='bgcolor="#FFFFFF"';   $AB='bgcolor="#C2C2C2"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';   $AB='bgcolor="#FFFFFF"';}
		#	echo "$status[$sts]|$status_called_first[$sts]|$status_called_last[$sts]|$leads_in_sts[$sts]|\n";
		#	echo "$status[$sts]|";
			echo "<tr $bgcolor><td><font size=1>$Pstatus</td><td><font size=1>$statuses_list[$Pstatus]</td>";

			$first = $all_called_first;
			while ($first <= $all_called_last)
				{
				if (eregi("1$|3$|5$|7$|9$", $sts))
					{
					if (eregi("1$|3$|5$|7$|9$", $first)) {$AB='bgcolor="#C2C2C2"';} 
					else{$AB='bgcolor="#FFFFFF"';}
					}
				else
					{
					if (eregi("0$|2$|4$|6$|8$", $first)) {$AB='bgcolor="#C2C2C2"';} 
					else{$AB='bgcolor="#FFFFFF"';}
					}

				$called_printed=0;
				$o=0;
				while ($status_called_to_print > $o) 
					{
					if ( ($count_statuses[$o] == "$Pstatus") and ($count_called[$o] == "$first") )
						{
						$called_printed++;
						echo "<td $AB><font size=1> $count_count[$o]</td>";
						}

					$o++;
					}
				if (!$called_printed) 
					{echo "<td $AB><font size=1> &nbsp;</td>";}
				$first++;
				}
			echo "<td><font size=1>$leads_in_sts[$sts]</td></tr>\n\n";

			$sts++;
			}

		echo "<tr><td align=center colspan=2><b><font size=1>TOTAL</td>";
		$first = $all_called_first;
		while ($first <= $all_called_last)
			{
			if (eregi("1$|3$|5$|7$|9$", $first)) {$AB='bgcolor="#AFEEEE"';} 
			else{$AB='bgcolor="#E0FFFF"';}
			echo "<td align=center $AB><b><font size=1>$all_called_count[$first]</td>";
			$first++;
			}
		echo "<td align=center><b><font size=1>$leads_in_list</td></tr>\n";

		echo "</table></div></center><br>\n";





		echo "<center><b>\n";

		echo "<br><br><a href=\"$PHP_SELF?ADD=811&list_id=$list_id\">Click here to see all CallBack Holds in this list</a><BR><BR>\n";
		echo "<br><br><a href=\"./list_download.php?list_id=$list_id\">Click here to download this list</a><BR><BR>\n";
		}
		if($LOGuser_level>8){
		if ($LOGdelete_lists > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=511&list_id=$list_id\">DELETE THIS LIST</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=LISTS&stage=$list_id\">Click here to see Admin chages to this list</FONT>\n";
			}
		}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}



######################
# ADD=3111 modify in-group info in the system
######################

if ($ADD==3111)
	{
	if ($LOGmodify_ingroups==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
#Modfied by fnatic start#
#		$stmt="SELECT group_id,group_name,group_color,active,web_form_address,voicemail_ext,next_agent_call,fronter_display,ingroup_script,get_call_launch,xferconf_a_dtmf,xferconf_a_number,xferconf_b_dtmf,xferconf_b_number,drop_call_seconds,drop_action,drop_exten,call_time_id,after_hours_action,after_hours_message_filename,after_hours_exten,after_hours_voicemail,welcome_message_filename,moh_context,onhold_prompt_filename,prompt_interval,agent_alert_exten,agent_alert_delay,default_xfer_group,queue_priority,drop_inbound_group,ingroup_recording_override,ingroup_rec_filename,afterhours_xfer_group,qc_enabled,qc_statuses,qc_shift_id,qc_get_record_launch,qc_show_recording,qc_web_form_address,qc_script,play_place_in_line,play_estimate_hold_time,hold_time_option,hold_time_option_seconds,hold_time_option_exten,hold_time_option_voicemail,hold_time_option_xfer_group,hold_time_option_callback_filename,hold_time_option_callback_list_id,hold_recall_xfer_group,no_delay_call_route,play_welcome_message,answer_sec_pct_rt_stat_one,answer_sec_pct_rt_stat_two,default_group_alias,no_agent_no_queue,no_agent_action,no_agent_action_value,web_form_address_two,timer_action,timer_action_message,timer_action_seconds,start_call_url,dispo_call_url,xferconf_c_number,xferconf_d_number,xferconf_e_number from vicidial_inbound_groups where group_id='$group_id';";
#$stmt="SELECT group_id,group_name,group_color,active,web_form_address,voicemail_ext,next_agent_call,fronter_display,ingroup_script,get_call_launch,xferconf_a_dtmf,xferconf_a_number,xferconf_b_dtmf,xferconf_b_number,drop_call_seconds,drop_action,drop_exten,call_time_id,after_hours_action,after_hours_message_filename,after_hours_exten,after_hours_voicemail,welcome_message_filename,moh_context,onhold_prompt_filename,prompt_interval,agent_alert_exten,agent_alert_delay,default_xfer_group,queue_priority,drop_inbound_group,ingroup_recording_override,ingroup_rec_filename,afterhours_xfer_group,qc_enabled,qc_statuses,qc_shift_id,qc_get_record_launch,qc_show_recording,qc_web_form_address,qc_script,play_place_in_line,play_estimate_hold_time,hold_time_option,hold_time_option_seconds,hold_time_option_exten,hold_time_option_voicemail,hold_time_option_xfer_group,hold_time_option_callback_filename,hold_time_option_callback_list_id,hold_recall_xfer_group,no_delay_call_route,play_welcome_message,answer_sec_pct_rt_stat_one,answer_sec_pct_rt_stat_two,default_group_alias,no_agent_no_queue,no_agent_action,no_agent_action_value,web_form_address_two,timer_action,timer_action_message,timer_action_seconds,start_call_url,dispo_call_url,xferconf_c_number,xferconf_d_number,xferconf_e_number,inbound_mode,ring_timeout_seconds,ring_timeout_action,ring_timeout_exten,ring_timeout_voicemail_ext,ring_timeout_inbound_group from vicidial_inbound_groups where group_id='$group_id';";
$stmt="SELECT group_id,group_name,group_color,active,web_form_address,voicemail_ext,next_agent_call,fronter_display,ingroup_script,get_call_launch,xferconf_a_dtmf,xferconf_a_number,xferconf_b_dtmf,xferconf_b_number,drop_call_seconds,drop_action,drop_exten,call_time_id,after_hours_action,after_hours_message_filename,after_hours_exten,after_hours_voicemail,welcome_message_filename,moh_context,onhold_prompt_filename,prompt_interval,agent_alert_exten,agent_alert_delay,default_xfer_group,queue_priority,drop_inbound_group,ingroup_recording_override,ingroup_rec_filename,afterhours_xfer_group,qc_enabled,qc_statuses,qc_shift_id,qc_get_record_launch,qc_show_recording,qc_web_form_address,qc_script,play_place_in_line,play_estimate_hold_time,hold_time_option,hold_time_option_seconds,hold_time_option_exten,hold_time_option_voicemail,hold_time_option_xfer_group,hold_time_option_callback_filename,hold_time_option_callback_list_id,hold_recall_xfer_group,no_delay_call_route,play_welcome_message,answer_sec_pct_rt_stat_one,answer_sec_pct_rt_stat_two,default_group_alias,no_agent_no_queue,no_agent_action,no_agent_action_value,web_form_address_two,timer_action,timer_action_message,timer_action_seconds,start_call_url,dispo_call_url,xferconf_c_number,xferconf_d_number,xferconf_e_number,inbound_mode,ring_timeout_seconds,play_agent_info,drop_menu_id,play_language,ring_start_launch,ring_form_address,ring_form_address_two,ring_ingroup_script,agent_follow_up,answer_sec_pct_rt_stat_zero,busy_transfer,busy_transfer_destination_group_id,busy_transfer_available_agents from vicidial_inbound_groups where group_id='$group_id';";
#End#
		//echo $stmt;exit;
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$group_name =				$row[1];
		$group_color =				$row[2];
		$active =					$row[3];
		$web_form_address =			stripslashes($row[4]);
		$voicemail_ext =			$row[5];
		$next_agent_call =			$row[6];
		$fronter_display =			$row[7];
		$script_id =				$row[8];
		$get_call_launch =			$row[9];
		$xferconf_a_dtmf =			$row[10];
		$xferconf_a_number =		$row[11];
		$xferconf_b_dtmf =			$row[12];
		$xferconf_b_number =		$row[13];
		$drop_call_seconds =		$row[14];
		$drop_action =				$row[15];
		$drop_exten =				$row[16];
		$call_time_id =				$row[17];
		$after_hours_action =		$row[18];
		$after_hours_message_filename =	$row[19];
		$after_hours_exten =		$row[20];
		$after_hours_voicemail =	$row[21];
		$welcome_message_filename =	$row[22];
		$moh_context =				$row[23];
		$onhold_prompt_filename =	$row[24];
		$prompt_interval =			$row[25];
		$agent_alert_exten =		$row[26];
		$agent_alert_delay =		$row[27];
		$default_xfer_group =		$row[28];
		$queue_priority =			$row[29];
		$drop_inbound_group =		$row[30];
		$ingroup_recording_override = $row[31];
		$ingroup_rec_filename =		$row[32];
		$afterhours_xfer_group =	$row[33];
		$qc_enabled =				$row[34];
		$qc_statuses =				$row[35];
		$qc_shift_id =				$row[36];
		$qc_get_record_launch =		$row[37];
		$qc_show_recording =		$row[38];
		$qc_web_form_address =		stripslashes($row[39]);
		$qc_script =				$row[40];
		$play_place_in_line = 		$row[41];
		$play_estimate_hold_time = 	$row[42];
		$hold_time_option = 		$row[43];
		$hold_time_option_seconds = $row[44];
		$hold_time_option_exten = 	$row[45];
		$hold_time_option_voicemail = 	$row[46];
		$hold_time_option_xfer_group = 	$row[47];
		$hold_time_option_callback_filename =	$row[48];
		$hold_time_option_callback_list_id = 	$row[49];
		$hold_recall_xfer_group = 	$row[50];
		$no_delay_call_route = 		$row[51];
		$play_welcome_message = 	$row[52];
		$answer_sec_pct_rt_stat_one =	$row[53];
		$answer_sec_pct_rt_stat_two =	$row[54];
		$default_group_alias =		$row[55];
		$no_agent_no_queue =		$row[56];
		$no_agent_action =			$row[57];
		$no_agent_action_value =	$row[58];
		$web_form_address_two =		stripslashes($row[59]);
		$timer_action =				$row[60];
		$timer_action_message =		$row[61];
		$timer_action_seconds =		$row[62];
		$start_call_url =			$row[63];
		$dispo_call_url =			$row[64];
		$xferconf_c_number =		$row[65];
		$xferconf_d_number =		$row[66];
		$xferconf_e_number =		$row[67];
		#Add by fnatic start#
		$inbound_mode =				$row[68];
		$ring_timeout_seconds =		$row[69];
		$play_agent_info =          $row[70];
		$drop_menu_id =				$row[71];
		$play_language = 			$row[72];
		#$ring_timeout_action =		$row[70];
		#$ring_timeout_exten =		$row[71];
		#$ring_timeout_voicemail_ext	=	$row[72];
		#$ring_timeout_inbound_group = $row[73];
		#End#
		
		$ring_start_launch = 		$row[73];
		$ring_form_address = 		$row[74];
		$ring_form_address_two = 	$row[75];
		$ring_ingroup_script =		$row[76];
		$agent_follow_up_val = 		$row[77];
		$answer_sec_pct_rt_stat_zero = 		$row[78];
		$busy_transfer = 			$row[79];
		$busy_transfer_destination_group_id = $row[80];
		$busy_transfer_available_agents = 	$row[81];
		##### get ivr listings for dynamic pulldown
		$stmt="SELECT menu_id,menu_name from vicidial_call_menu order by menu_id";
		$rslt=mysql_query($stmt, $link);
		$Divrs_to_print = mysql_num_rows($rslt);
		$Divrs_menu='';
		$Divrs_selected=0;
		$o=0;
		while ($Divrs_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$Divrs_menu .= "<option ";
			if ($drop_menu_id == "$rowx[0]") 
				{
				$Divrs_menu .= "SELECTED ";
				$Divrs_selected++;
				}
			$Divrs_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		if ($Divrs_selected < 1) 
			{$Divrs_menu .= "<option SELECTED value=\"---NONE---\">---NONE---</option>\n";}
		else 
			{$Divrs_menu .= "<option value=\"---NONE---\">---NONE---</option>\n";}
			
		##### get in-groups listings for dynamic pulldown
		$stmt="SELECT group_id,group_name from vicidial_inbound_groups where group_id NOT IN('AGENTDIRECT') order by group_id";
		$rslt=mysql_query($stmt, $link);
		$Xgroups_to_print = mysql_num_rows($rslt);
		$Xgroups_menu='';
		$Xgroups_selected=0;
		$Dgroups_menu='';
		$Dgroups_selected=0;
		$Agroups_menu='';
		$Agroups_selected=0;
		$Hgroups_menu='';
		$Hgroups_selected=0;
		$Tgroups_menu='';
		$Tgroups_selected=0;
		$Rgroups_menu='';# Add by fnatic
		$Rgroups_selected=0;# Add by fnatic
		$Bgroups_menu="";#Busy Transfer Group的option值 Add by akin
		$o=0;
		while ($Xgroups_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$Xgroups_menu .= "<option ";
			$Dgroups_menu .= "<option ";
			$Agroups_menu .= "<option ";
			$Tgroups_menu .= "<option ";
			$Hgroups_menu .= "<option ";
			$Rgroups_menu .= "<option "; # Add by fnatic
			$Bgroups_menu .= "<option "; # Add by akin
			if ($default_xfer_group == "$rowx[0]") 
				{
				$Xgroups_menu .= "SELECTED ";
				$Xgroups_selected++;
				}
			if ($drop_inbound_group == "$rowx[0]") 
				{
				$Dgroups_menu .= "SELECTED ";
				$Dgroups_selected++;
				}
			if ($afterhours_xfer_group == "$rowx[0]") 
				{
				$Agroups_menu .= "SELECTED ";
				$Agroups_selected++;
				}
			if ($hold_time_option_xfer_group == "$rowx[0]") 
				{
				$Tgroups_menu .= "SELECTED ";
				$Tgroups_selected++;
				}
			if ($hold_recall_xfer_group == "$rowx[0]") 
				{
				$Hgroups_menu .= "SELECTED ";
				$Hgroups_selected++;
				}
				
			#Add by akin#
			if ($busy_transfer_destination_group_id == "$rowx[0]") 
				{
				$Bgroups_menu .= "SELECTED ";
				}
			$Bgroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			#End#
			
			#Add by fnatic#
			if ($ring_timeout_inbound_group == "$rowx[0]")
				{
				$Rgroups_menu .= "SELECTED ";
				$Rgroups_selected++;
				}
			$Rgroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			#End#
			$Xgroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$Dgroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			if ($group_id!=$rowx[0])
				{
				$Agroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
				$Tgroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
				$Hgroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
				}
			$o++;
			}
		if ($Xgroups_selected < 1) 
			{$Xgroups_menu .= "<option SELECTED value=\"---NONE---\">---NONE---</option>\n";}
		else 
			{$Xgroups_menu .= "<option value=\"---NONE---\">---NONE---</option>\n";}
		if ($Dgroups_selected < 1) 
			{$Dgroups_menu .= "<option SELECTED value=\"---NONE---\">---NONE---</option>\n";}
		else 
			{$Dgroups_menu .= "<option value=\"---NONE---\">---NONE---</option>\n";}
		if ($Agroups_selected < 1) 
			{$Agroups_menu .= "<option SELECTED value=\"---NONE---\">---NONE---</option>\n";}
		else 
			{$Agroups_menu .= "<option value=\"---NONE---\">---NONE---</option>\n";}
		if ($Tgroups_selected < 1) 
			{$Tgroups_menu .= "<option SELECTED value=\"---NONE---\">---NONE---</option>\n";}
		else 
			{$Tgroups_menu .= "<option value=\"---NONE---\">---NONE---</option>\n";}
		if ($Hgroups_selected < 1) 
			{$Hgroups_menu .= "<option SELECTED value=\"---NONE---\">---NONE---</option>\n";}
		else 
			{$Hgroups_menu .= "<option value=\"---NONE---\">---NONE---</option>\n";}
		#Add by fnatic#
		#if ($Rgroups_selected <1)
			#{$Rgroups_menu .= "<option SELECTED value=\"---NONE---\">---NONE---</option>\n";}
		#else 
			#{$Rgroups_menu .= "<option value=\"---NONE---\">---NONE---</option>\n";}
		#End#


		echo "<br>MODIFY A GROUPS RECORD: $row[0]<form action=$PHP_SELF method=POST name=admin_form id=admin_form>\n";
		echo "<input type=hidden name=ADD value=4111>\n";
		echo "<input type=hidden name=group_id value=\"$row[0]\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Group ID: </td><td align=left><b>$row[0]</b>$NWB#vicidial_inbound_groups-group_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Group Name: </td><td align=left><input type=text name=group_name size=30 maxlength=30 value=\"$row[1]\">$NWB#vicidial_inbound_groups-group_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Group Color: </td><td align=left bgcolor=\"$row[2]\" id=\"group_color_td\"><input type=text name=group_color size=7 maxlength=7 value=\"$row[2]\">$NWB#vicidial_inbound_groups-group_color$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option>N</option><option SELECTED>$active</option></select>$NWB#vicidial_inbound_groups-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Web Form: </td><td align=left><input type=text name=web_form_address size=70 maxlength=1055 value=\"$web_form_address\">$NWB#vicidial_inbound_groups-web_form_address$NWE</td></tr>\n";
		if ($SSenable_second_webform > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Web Form Two: </td><td align=left><input type=text name=web_form_address_two size=70 maxlength=1055 value=\"$web_form_address_two\">$NWB#vicidial_inbound_groups-web_form_address$NWE</td></tr>\n";
			}
		# inbound mode element + fnatic
		echo "<tr bgcolor=#BCFF9B><td align=right>Inbound Mode: </td><td align=left><select size=1 id=inbound_mode name=inbound_mode onchange=\"changeRingMode();\">";
		echo "<option>auto</option><option>ring</option><option SELECTED>$inbound_mode</option>";
		echo "</select>$NWB#vicidial_inbound_groups-inbound_mode$NWE</td></tr>\n";

			if($inbound_mode=='ring')
			{
				$ring_display = "";
				$auto_display = " style=\"display:none;\"";
			}else{
				$ring_display = " style=\"display:none;\"";
				$auto_display = "";
			}
			echo "<tr id=\"ring_tr1\" bgcolor=#BCFF9B $ring_display><td align=right>Ring timeout Seconds: </td><td align=left><input type=text name=ring_timeout_seconds size=5 maxlength=2 value=\"$ring_timeout_seconds\">$NWB#vicidial_inbound_groups-ring_timeout_seconds$NWE</td></tr>\n";
			#echo "<tr id=\"ring_tr2\" bgcolor=#BCFF9B $ring_display><td align=right>Ring timeout Action: </td><td align=left><select size=1 name=ring_timeout_action><option>HANGUP</option><option>MESSAGE</option><option>VOICEMAIL</option><option>IN_GROUP</option><option SELECTED>$ring_timeout_action</option></select></td></tr>\n";
			#echo "<tr id=\"ring_tr3\" bgcolor=#BCFF9B $ring_display><td align=right>Ring timeout Exten: </td><td align=left><input type=text name=ring_timeout_exten size=10 maxlength=20 value=\"$ring_timeout_exten\"></td></tr>\n";
			#echo "<tr id=\"ring_tr4\" bgcolor=#BCFF9B $ring_display><td align=right>Ring timeout Voicemail: </td><td align=left><input type=text name=ring_timeout_voicemail_ext id=voicemail_ext size=12 maxlength=10 value=\"$ring_timeout_voicemail_ext\"> <a href=\"javascript:launch_vm_chooser('ring_timeout_voicemail_ext','vm',400);\">voicemail chooser</a></td></tr>\n";
			#echo "<tr id=\"ring_tr5\" bgcolor=#BCFF9B $ring_display><td align=right>Ring timeout Transfer Group: </td><td align=left><select size=1 name=ring_timeout_inbound_group>";
			#echo "$Rgroups_menu";
			#echo "</select></td></tr>\n";
			#backup begin 2011-3-24 15:52:47 
			#echo "<tr id=\"ring_tr6\" bgcolor=#FFFFFF $ring_display><td align=right>Next Agent Call: </td><td align=left><select size=1 name=next_agent_call><option $auto_display>oldest_call_start</option><option $auto_display>oldest_call_finish</option><option $auto_display>overall_user_level</option><option $auto_display>inbound_group_rank</option><option $auto_display>campaign_rank</option><option $auto_display>fewest_calls</option><option $auto_display>fewest_calls_campaign</option>";
			#backup end
			
			echo "<tr id=\"ring_tr6\" bgcolor=#FFFFFF $ring_display><td align=right>Next Agent Call: </td><td align=left><select size=1 name=next_agent_call_ring><option>roundrobin</option><option>ringall</option><option>random</option><option>longest_wait_time</option><option>inbound_group_rank</option><option>fewest_calls</option>";
			//echo "<option>longest_wait_time</option><option>random</option><option>roundrobin</option><option>ringall</option>";
			if ($next_agent_call == "roundrobin" || $next_agent_call == "ringall" || $next_agent_call == "longest_wait_time" || $next_agent_call == "random"  || $next_agent_call == "inbound_group_rank" || $next_agent_call == "fewest_calls"){
			echo "<option SELECTED>$next_agent_call</option>";
			}
			echo "</select>$NWB#vicidial_inbound_groups-next_agent_call$NWE</td></tr>\n";
	
			
			echo "<tr  id=\"auto_tr1\" bgcolor=#FFFFFF $auto_display><td align=right>Next Agent Call: </td><td align=left><select size=1 name=next_agent_call><option >random</option><option >longest_wait_time</option><option>oldest_call_start</option><option>oldest_call_finish</option><option>overall_user_level</option><option>inbound_group_rank</option><option>campaign_rank</option><option>fewest_calls</option><option>fewest_calls_campaign</option>";
			if ($next_agent_call == "random" || $next_agent_call == "longest_wait_time" || $next_agent_call == "oldest_call_start" || $next_agent_call == "oldest_call_finish" || $next_agent_call == "overall_user_level" || $next_agent_call == "inbound_group_rank" || $next_agent_call == "campaign_rank" || $next_agent_call == "fewest_calls"|| $next_agent_call == "fewest_calls_campaign"|| $next_agent_call == "oldest_call_finish" ){
			   echo "<option SELECTED>$next_agent_call</option>";
			}   
			echo "</select>$NWB#vicidial_inbound_groups-next_agent_call$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Agent Follow Up: </td><td align=left><select size=1 name=agent_follow_up><option>Y</option><option>N</option><option SELECTED>$agent_follow_up_val</option></select>$NWB#vicidial_agent_follow_up$NWE</td></tr>\n";

		echo "<tr bgcolor=#F5F5F5><td align=right>Queue Priority: </td><td align=left><select size=1 name=queue_priority>\n";
		$n=99;
		while ($n>=-99)
			{
			$dtl = 'Even';
			if ($n<0) {$dtl = 'Lower';}
			if ($n>0) {$dtl = 'Higher';}
			if ($n == $queue_priority) 
				{echo "<option SELECTED value=\"$n\">$n - $dtl</option>\n";}
			else
				{echo "<option value=\"$n\">$n - $dtl</option>\n";}
			$n--;
			}
		echo "</select> $NWB#vicidial_inbound_groups-queue_priority$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Fronter Display: </td><td align=left><select size=1 name=fronter_display><option>Y</option><option>N</option><option SELECTED>$fronter_display</option></select>$NWB#vicidial_inbound_groups-fronter_display$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=3111111&script_id=$script_id\">Script</a>: </td><td align=left><select size=1 name=script_id>\n";
		echo "$scripts_list";
		echo "<option selected value=\"$script_id\">$script_id - $scriptname_list[$script_id]</option>\n";
		echo "</select>$NWB#vicidial_inbound_groups-ingroup_script$NWE</td></tr>\n";
		$eswHTML='';
		if ($SSenable_second_webform > 0)
			{$eswHTML = '<option>WEBFORMTWO</option>';}
			
		echo "<tr bgcolor=#FFFFFF><td align=right>Get Call Launch: </td><td align=left><select size=1 name=get_call_launch><option selected>NONE</option><option>SCRIPT</option><option>WEBFORM</option>$eswHTML<option selected>$get_call_launch</option></select>$NWB#vicidial_inbound_groups-get_call_launch$NWE</td></tr>\n";
		
		echo "<tr bgcolor=#FFFFFF><td align=right>Ring Start Launch: </td><td align=left><select size=1 name=ring_start_launch><option selected>NONE</option><option>SCRIPT</option><option>WEBFORM</option>$eswHTML<option selected>$ring_start_launch</option></select>$NWB#vicidial_inbound_groups-get_call_launch$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Ring Web Form: </td><td align=left><input type=text name=ring_form_address size=70 maxlength=1055 value=\"$ring_form_address\">$NWB#vicidial_inbound_groups-web_form_address$NWE</td></tr>\n";
		if ($SSenable_second_webform > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Ring Web Form Two: </td><td align=left><input type=text name=ring_form_address_two size=70 maxlength=1055 value=\"$ring_form_address_two\">$NWB#vicidial_inbound_groups-web_form_address$NWE</td></tr>\n";
			}
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=3111111&script_id=$ring_ingroup_script\">Ring Script</a>: </td><td align=left><select size=1 name=ring_ingroup_script>\n";
		echo "$scripts_list";
		echo "<option selected value=\"$ring_ingroup_script\">$ring_ingroup_script - $scriptname_list[$ring_ingroup_script]</option>\n";
		echo "</select>$NWB#vicidial_inbound_groups-ingroup_script$NWE</td></tr>\n";
		
		
		
		
		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf DTMF 1: </td><td align=left><input type=text name=xferconf_a_dtmf size=20 maxlength=50 value=\"$xferconf_a_dtmf\">$NWB#vicidial_inbound_groups-xferconf_a_dtmf$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Number 1: </td><td align=left><input type=text name=xferconf_a_number size=20 maxlength=50 value=\"$xferconf_a_number\">$NWB#vicidial_inbound_groups-xferconf_a_dtmf$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf DTMF 2: </td><td align=left><input type=text name=xferconf_b_dtmf size=20 maxlength=50 value=\"$xferconf_b_dtmf\">$NWB#vicidial_inbound_groups-xferconf_a_dtmf$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Number 2: </td><td align=left><input type=text name=xferconf_b_number size=20 maxlength=50 value=\"$xferconf_b_number\">$NWB#vicidial_inbound_groups-xferconf_a_dtmf$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Number 3: </td><td align=left><input type=text name=xferconf_c_number size=20 maxlength=50 value=\"$xferconf_c_number\">$NWB#vicidial_inbound_groups-xferconf_a_dtmf$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Number 4: </td><td align=left><input type=text name=xferconf_d_number size=20 maxlength=50 value=\"$xferconf_d_number\">$NWB#vicidial_inbound_groups-xferconf_a_dtmf$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Transfer-Conf Number 5: </td><td align=left><input type=text name=xferconf_e_number size=20 maxlength=50 value=\"$xferconf_e_number\">$NWB#vicidial_inbound_groups-xferconf_a_dtmf$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Timer Action: </td><td align=left><select size=1 name=timer_action><option selected>NONE</option><option>D1_DIAL</option><option>D2_DIAL</option><option>D3_DIAL</option><option>D4_DIAL</option><option>D5_DIAL</option><option>MESSAGE_ONLY</option><option>WEBFORM</option>$eswHTML<option selected>$timer_action</option></select>$NWB#vicidial_inbound_groups-timer_action$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Timer Action Message: </td><td align=left><input type=text name=timer_action_message size=50 maxlength=255 value=\"$timer_action_message\">$NWB#vicidial_inbound_groups-timer_action_message$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Timer Action Seconds: </td><td align=left><input type=text name=timer_action_seconds size=10 maxlength=10 value=\"$timer_action_seconds\">$NWB#vicidial_inbound_groups-timer_action_seconds$NWE</td></tr>\n";
		
		$busy_transfer_yes_selected = "";
		$busy_transfer_no_selected = "";
		if($busy_transfer) $busy_transfer_yes_selected = "selected=selected";
		else $busy_transfer_no_selected = "selected=selected";
		
		echo "<tr bgcolor=#66CCFF><td align=right>Busy Transfer: </td><td align=left><select size=1 name=busy_transfer>";
		echo "<option $busy_transfer_no_selected value=0>OFF</option><option $busy_transfer_yes_selected value=1>ON</option>";
		echo "</select></td></tr>\n";
		
		echo "<tr bgcolor=#66CCFF><td align=right>BUSY Transfer Group: </td><td align=left><select size=1 name=busy_transfer_destination_group_id>";
		echo "$Bgroups_menu";
		echo "</select></td></tr>\n";
		
		echo "<tr bgcolor=#66CCFF><td align=right>Busy Transfer When Available Agents ≥: </td><td align=left><input type=text size=1 name=busy_transfer_available_agents value='$busy_transfer_available_agents'/></td></tr>\n";

		echo "<tr bgcolor=#99FFCC><td align=right>Drop Call Seconds: </td><td align=left><input type=text name=drop_call_seconds size=5 maxlength=4 value=\"$drop_call_seconds\">$NWB#vicidial_inbound_groups-drop_call_seconds$NWE</td></tr>\n";

		echo "<tr bgcolor=#99FFCC><td align=right>Drop Action: </td><td align=left><select size=1 name=drop_action><option>HANGUP</option><option>MESSAGE</option><option>VOICEMAIL</option><option>IN_GROUP</option><option>CALLMENU</option><option SELECTED>$drop_action</option></select>$NWB#vicidial_inbound_groups-drop_action$NWE</td></tr>\n";

		echo "<tr bgcolor=#99FFCC><td align=right>Drop Exten: </td><td align=left><input type=text name=drop_exten size=10 maxlength=20 value=\"$drop_exten\">$NWB#vicidial_inbound_groups-drop_exten$NWE</td></tr>\n";

		echo "<tr bgcolor=#99FFCC><td align=right>Voicemail: </td><td align=left><input type=text name=voicemail_ext id=voicemail_ext size=12 maxlength=10 value=\"$voicemail_ext\"> <a href=\"javascript:launch_vm_chooser('voicemail_ext','vm',400);\">voicemail chooser</a>$NWB#vicidial_inbound_groups-voicemail_ext$NWE</td></tr>\n";

		echo "<tr bgcolor=#99FFCC><td align=right>Drop Transfer Group: </td><td align=left><select size=1 name=drop_inbound_group>";
		echo "$Dgroups_menu";
		echo "</select>$NWB#vicidial_inbound_groups-drop_inbound_group$NWE</td></tr>\n";

		echo "<tr bgcolor=#99FFCC><td align=right>IVR: </td><td align=left><select size=1 name=drop_menu_id>";
		echo "$Divrs_menu";
		echo "</select>$NWB#vicidial_inbound_groups-ivrs$NWE</td></tr>\n";
		
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=311111111&call_time_id=$call_time_id\">Call Time: </a></td><td align=left><select size=1 name=call_time_id>\n";
		echo "$call_times_list";
		echo "<option selected value=\"$call_time_id\">$call_time_id - $call_timename_list[$call_time_id]</option>\n";
		echo "</select>$NWB#vicidial_inbound_groups-call_time_id$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>After Hours Action: </td><td align=left><select size=1 name=after_hours_action><option>HANGUP</option><option>MESSAGE</option><option>EXTENSION</option><option>VOICEMAIL</option><option>IN_GROUP</option><option SELECTED>$after_hours_action</option></select>$NWB#vicidial_inbound_groups-after_hours_action$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>After Hours Message Filename: </td><td align=left><input type=text name=after_hours_message_filename id=after_hours_message_filename size=50 maxlength=255 value=\"$after_hours_message_filename\"> <a href=\"javascript:launch_chooser('after_hours_message_filename','date',400);\">audio chooser</a> $NWB#vicidial_inbound_groups-after_hours_message_filename$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>After Hours Extension: </td><td align=left><input type=text name=after_hours_exten size=10 maxlength=20 value=\"$after_hours_exten\">$NWB#vicidial_inbound_groups-after_hours_exten$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>After Hours Voicemail: </td><td align=left><input type=text name=after_hours_voicemail id=after_hours_voicemail size=12 maxlength=10 value=\"$after_hours_voicemail\"> <a href=\"javascript:launch_vm_chooser('after_hours_voicemail','vm',600);\">voicemail chooser</a>$NWB#vicidial_inbound_groups-after_hours_voicemail$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>After Hours Transfer Group: </td><td align=left><select size=1 name=afterhours_xfer_group>";
		echo "$Agroups_menu";
		echo "</select>$NWB#vicidial_inbound_groups-afterhours_xfer_group$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>No Agents No Queueing: </td><td align=left><select size=1 name=no_agent_no_queue><option>Y</option><option>N</option><option>NO_PAUSED</option><option SELECTED>$no_agent_no_queue</option></select>$NWB#vicidial_inbound_groups-no_agent_no_queue$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>No Agent No Queue Action: </td><td align=left><select size=1 name=no_agent_action id=no_agent_action onChange=\"dynamic_call_action('no_agent_action','$no_agent_action','$no_agent_action_value','600');\"><option>CALLMENU</option><option>INGROUP</option><option>DID</option><option>MESSAGE</option><option>EXTENSION</option><option>VOICEMAIL</option><option SELECTED>$no_agent_action</option></select>$NWB#vicidial_inbound_groups-no_agent_no_queue$NWE\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2>";
		echo "<span id=\"no_agent_action_value_span\" name=\"no_agent_action_value_span\">\n";

		if ($no_agent_action=='CALLMENU')
			{
			echo "<span name=no_agent_action_value_link id=no_agent_action_value_link>";
			echo "<a href=\"$PHP_SELF?ADD=3511&menu_id=$no_agent_action_value\">IVR:</a>";
			echo "</span>";
			echo " <select size=1 name=no_agent_action_value id=no_agent_action_value onChange=\"dynamic_call_action_link('no_agent_action','CALLMENU');\">$call_menu_list<option SELECTED>$no_agent_action_value</option></select>\n";
			}
		if ($no_agent_action=='INGROUP')
			{
			if (strlen($no_agent_action_value) < 10)
				{$no_agent_action_value = 'SALESLINE,CID,LB,998,TESTCAMP,1';}
			$IGno_agent_action_value = explode(",",$no_agent_action_value);
			$IGgroup_id =		$IGno_agent_action_value[0];
			$IGhandle_method =	$IGno_agent_action_value[1];
			$IGsearch_method =	$IGno_agent_action_value[2];
			$IGlist_id =		$IGno_agent_action_value[3];
			$IGcampaign_id =	$IGno_agent_action_value[4];
			$IGphone_code =		$IGno_agent_action_value[5];
			echo "<span name=no_agent_action_value_link id=no_agent_action_value_link>";
			echo "<a href=\"$PHP_SELF?ADD=3111&group_id=$IGgroup_id\">In-Group:</a>";
			echo "</span>";
			echo " <select size=1 name=IGgroup_id_no_agent_action id=IGgroup_id_no_agent_action onChange=\"dynamic_call_action_link('IGgroup_id_no_agent_action','INGROUP');\">";
			echo "$ingroup_list<option SELECTED>$IGgroup_id</option></select>";
			echo " &nbsp; Handle Method: <select size=1 name=IGhandle_method_$j id=IGhandle_method_$j>";
			echo "$IGhandle_method_list<option SELECTED>$IGhandle_method</option></select>\n";
			echo "<BR>Search Method: <select size=1 name=IGsearch_method_$j id=IGsearch_method_$j>";
			echo "$IGsearch_method_list<option SELECTED>$IGsearch_method</option></select>\n";
			echo " &nbsp; List ID: <input type=text size=5 maxlength=14 name=IGlist_id_$j id=IGlist_id_$j value=\"$IGlist_id\">";
			echo "<BR>Campaign ID: <select size=1 name=IGcampaign_id_$j id=IGcampaign_id_$j>";
			echo "$IGcampaign_id_list<option SELECTED>$IGcampaign_id</option></select>\n";
			echo " &nbsp; Phone Code: <input type=text size=5 maxlength=14 name=IGphone_code_$j id=IGphone_code_$j value=\"$IGphone_code\">";
			}
		if ($no_agent_action=='DID')
			{
			$stmt="SELECT did_id from vicidial_inbound_dids where did_pattern='$no_agent_action_value';";
			$rslt=mysql_query($stmt, $link);
			$row=mysql_fetch_row($rslt);
			$did_id =			$row[0];

			echo "<span name=no_agent_action_value_link id=no_agent_action_value_link>";
			echo "<a href=\"$PHP_SELF?ADD=3311&did_id=$did_id\">DID:</a>";
			echo "</span>";
			echo " <select size=1 name=no_agent_action_value id=no_agent_action_value onChange=\"dynamic_call_action_link('no_agent_action','DID');\">$did_list<option SELECTED>$no_agent_action_value</option></select>\n";
			}
		if ($no_agent_action=='MESSAGE')
			{
			if (strlen($no_agent_action_value) < 3)
				{$no_agent_action_value = 'nbdy-avail-to-take-call|vm-goodbye';}
			echo "Audio File: <input type=text name=no_agent_action_value id=no_agent_action_value size=50 maxlength=255 value=\"$no_agent_action_value\"> <a href=\"javascript:launch_chooser('no_agent_action_value','date',600);\">audio chooser</a>\n";
			}
		if ($no_agent_action=='EXTENSION')
			{
			if (strlen($no_agent_action_value) < 3)
				{$no_agent_action_value = '8304,default';}
			$EXno_agent_action_value = explode(",",$no_agent_action_value);
			$EXextension =	$EXno_agent_action_value[0];
			$EXcontext =	$EXno_agent_action_value[1];
			echo "Extension: <input type=text name=EXextension_no_agent_action id=EXextension_no_agent_action size=20 maxlength=255 value=\"$EXextension\"> &nbsp; Context: <input type=text name=EXcontext_no_agent_action id=EXcontext_no_agent_action size=20 maxlength=255 value=\"$EXcontext\">\n";
			}
		if ($no_agent_action=='VOICEMAIL')
			{
			echo "Voicemail Box: <input type=text name=no_agent_action_value id=no_agent_action_value size=12 maxlength=10 value=\"$no_agent_action_value\"> <a href=\"javascript:launch_vm_chooser('no_agent_action_value','vm',700);\">voicemail chooser</a>\n";
			}

		echo "</span>
		<BR> &nbsp; </td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Welcome Message Filename: </td><td align=left><input type=text name=welcome_message_filename id=welcome_message_filename size=50 maxlength=255 value=\"$welcome_message_filename\"> <a href=\"javascript:launch_chooser('welcome_message_filename','date',500);\">audio chooser</a> $NWB#vicidial_inbound_groups-welcome_message_filename$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Play Welcome Message: </td><td align=left><select size=1 name=play_welcome_message><option>ALWAYS</option><option>NEVER</option><option>IF_WAIT_ONLY</option><option>YES_UNLESS_NODELAY</option><option SELECTED>$play_welcome_message</option></select>$NWB#vicidial_inbound_groups-play_welcome_message$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Music On Hold Context: </td><td align=left><input type=text name=moh_context id=moh_context size=50 maxlength=50 value=\"$moh_context\"> <a href=\"javascript:launch_moh_chooser('moh_context','moh',500);\">moh chooser</a> $NWB#vicidial_inbound_groups-moh_context$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>On Hold Prompt Filename: </td><td align=left><input type=text name=onhold_prompt_filename id=onhold_prompt_filename size=50 maxlength=255 value=\"$onhold_prompt_filename\"> <a href=\"javascript:launch_chooser('onhold_prompt_filename','date',600);\">audio chooser</a> $NWB#vicidial_inbound_groups-onhold_prompt_filename$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>On Hold Prompt Interval: </td><td align=left><input type=text name=prompt_interval size=5 maxlength=5 value=\"$prompt_interval\">$NWB#vicidial_inbound_groups-prompt_interval$NWE</td></tr>\n";
		
		echo "<tr bgcolor=#FFFFFF><td align=right>Play Language: </td><td align=left><select size=1 name=play_language><option>Mandarin</option><option>Cantonese</option><option>English</option><option SELECTED>$play_language</option></select>$NWB#vicidial_inbound_groups-play_language$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Play Place in Line: </td><td align=left><select size=1 name=play_place_in_line><option>Y</option><option>N</option><option SELECTED>$play_place_in_line</option></select>$NWB#vicidial_inbound_groups-play_place_in_line$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Play Estimated Hold Time: </td><td align=left><select size=1 name=play_estimate_hold_time><option>Y</option><option>N</option><option SELECTED>$play_estimate_hold_time</option></select>$NWB#vicidial_inbound_groups-play_estimate_hold_time$NWE</td></tr>\n";

		/*
		进线前播报坐席信息 + fnatic
		*/
		echo "<tr bgcolor=#FFFFFF><td align=right>Play Agent Info: </td><td align=left><select size=1 name=play_agent_info><option>---NONE---</option><option>USER_CODE</option><option SELECTED>$play_agent_info</option></select></td></tr>\n";		
		/*
		结束
		*/
		echo "<tr bgcolor=#CCFFFF><td align=right>Hold Time Option: </td><td align=left><select size=1 name=hold_time_option><option>NONE</option><option>EXTENSION</option><option>VOICEMAIL</option><option>IN_GROUP</option><option>CALLERID_CALLBACK</option><option>DROP_ACTION</option><option>PRESS_VMAIL</option><option SELECTED>$hold_time_option</option></select>$NWB#vicidial_inbound_groups-hold_time_option$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>Hold Time Option Seconds: </td><td align=left><input type=text name=hold_time_option_seconds size=5 maxlength=5 value=\"$hold_time_option_seconds\">$NWB#vicidial_inbound_groups-hold_time_option_seconds$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>Hold Time Option Extension: </td><td align=left><input type=text name=hold_time_option_exten size=20 maxlength=20 value=\"$hold_time_option_exten\">$NWB#vicidial_inbound_groups-hold_time_option_exten$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>Hold Time Option Voicemail: </td><td align=left><input type=text name=hold_time_option_voicemail id=hold_time_option_voicemail size=12 maxlength=10 value=\"$hold_time_option_voicemail\"> <a href=\"javascript:launch_vm_chooser('hold_time_option_voicemail','vm',900);\">voicemail chooser</a> $NWB#vicidial_inbound_groups-hold_time_option_voicemail$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>Hold Time Option Transfer In-Group: </td><td align=left><select size=1 name=hold_time_option_xfer_group>";
		echo "$Tgroups_menu";
		echo "</select>$NWB#vicidial_inbound_groups-hold_time_option_xfer_group$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>Hold Time Option Callback Filename: </td><td align=left><input type=text name=hold_time_option_callback_filename id=hold_time_option_callback_filename size=50 maxlength=255 value=\"$hold_time_option_callback_filename\"> <a href=\"javascript:launch_chooser('hold_time_option_callback_filename','date',900);\">audio chooser</a> $NWB#vicidial_inbound_groups-hold_time_option_callback_filename$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>Hold Time Option Callback List ID: </td><td align=left><input type=text name=hold_time_option_callback_list_id size=14 maxlength=14 value=\"$hold_time_option_callback_list_id\">$NWB#vicidial_inbound_groups-hold_time_option_callback_list_id$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Agent Alert Filename: </td><td align=left><input type=text name=agent_alert_exten id=agent_alert_exten size=40 maxlength=100 value=\"$agent_alert_exten\"> <a href=\"javascript:launch_chooser('agent_alert_exten','date',1000);\">audio chooser</a> $NWB#vicidial_inbound_groups-agent_alert_exten$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Agent Alert Delay: </td><td align=left><input type=text name=agent_alert_delay size=6 maxlength=6 value=\"$agent_alert_delay\">$NWB#vicidial_inbound_groups-agent_alert_delay$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Default Transfer Group: </td><td align=left><select size=1 name=default_xfer_group>";
		echo "$Xgroups_menu";
		echo "</select>$NWB#vicidial_inbound_groups-default_xfer_group$NWE</td></tr>\n";

		##### get groups_alias listings for dynamic default group alias pulldown list menu
		$stmt="SELECT group_alias_id,group_alias_name from groups_alias where active='Y' order by group_alias_id";
		$rslt=mysql_query($stmt, $link);
		$group_alias_to_print = mysql_num_rows($rslt);
		$group_alias_menu='';
		$group_alias_selected=0;
		$o=0;
		while ($group_alias_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$group_alias_menu .= "<option ";
			if ($default_group_alias == "$rowx[0]") 
				{
				$group_alias_menu .= "SELECTED ";
				$group_alias_selected++;
				}
			$group_alias_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}

		echo "<tr bgcolor=#FFFFFF><td align=right>Default Group Alias: </td><td align=left><select size=1 name=default_group_alias>";
		echo "<option value=\"\">NONE</option>";
		echo "$group_alias_menu";
		echo "</select>$NWB#vicidial_inbound_groups-default_group_alias$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Hold Recall Transfer In-Group: </td><td align=left><select size=1 name=hold_recall_xfer_group>";
		echo "$Hgroups_menu";
		echo "</select>$NWB#vicidial_inbound_groups-hold_recall_xfer_group$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>No Delay Call Route: </td><td align=left><select size=1 name=no_delay_call_route><option>Y</option><option>N</option><option SELECTED>$no_delay_call_route</option></select>$NWB#vicidial_inbound_groups-no_delay_call_route$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>In-Group Recording Override: </td><td align=left><select size=1 name=ingroup_recording_override><option>DISABLED</option><option>NEVER</option><option>ONDEMAND</option><option>ALLCALLS</option><option>ALLFORCE</option><option SELECTED>$ingroup_recording_override</option></select>$NWB#vicidial_inbound_groups-ingroup_recording_override$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>In-Group Recording Filename: </td><td align=left><input type=text name=ingroup_rec_filename size=50 maxlength=50 value=\"$ingroup_rec_filename\">$NWB#vicidial_inbound_groups-ingroup_rec_filename$NWE</td></tr>\n";
		
		echo "<tr bgcolor=#FFFFFF><td align=right>Stats Percent of Calls Answered Within X seconds 0: </td><td align=left><input type=text name=answer_sec_pct_rt_stat_zero size=5 maxlength=5 value=\"$answer_sec_pct_rt_stat_zero\">$NWB#vicidial_inbound_groups-answer_sec_pct_rt_stat_one$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Stats Percent of Calls Answered Within X seconds 1: </td><td align=left><input type=text name=answer_sec_pct_rt_stat_one size=5 maxlength=5 value=\"$answer_sec_pct_rt_stat_one\">$NWB#vicidial_inbound_groups-answer_sec_pct_rt_stat_one$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Stats Percent of Calls Answered Within X seconds 2: </td><td align=left><input type=text name=answer_sec_pct_rt_stat_two size=5 maxlength=5 value=\"$answer_sec_pct_rt_stat_two\">$NWB#vicidial_inbound_groups-answer_sec_pct_rt_stat_one$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Start Call URL: </td><td align=left><input type=text name=start_call_url size=70 maxlength=1000 value=\"$start_call_url\">$NWB#vicidial_inbound_groups-start_call_url$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Dispo Call URL: </td><td align=left><input type=text name=dispo_call_url size=70 maxlength=1000 value=\"$dispo_call_url\">$NWB#vicidial_inbound_groups-dispo_call_url$NWE</td></tr>\n";


		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";

		if ($SSqc_features_active > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=center colspan=2> &nbsp; </td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=center colspan=2> Inbound Group QC Settings: </td></tr>\n";

			##### get status listings for dynamic pulldown
			$qc_statuses = preg_replace("/^ | -$/","",$qc_statuses);
			$QCstatuses = explode(" ", $qc_statuses);
			$QCs_to_print = (count($QCstatuses) -0);
			$stmt="SELECT status,status_name,selectable,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable from vicidial_statuses where status NOT IN('QUEUE','INCALL') order by status";
			$rslt=mysql_query($stmt, $link);
			$statuses_to_print = mysql_num_rows($rslt);
			$qc_statuses_list='';

			$o=0;
			while ($statuses_to_print > $o) 
				{
				$rowx=mysql_fetch_row($rslt);
				$qc_statuses_list .= "<input type=\"checkbox\" name=\"qc_statuses[]\" value=\"$rowx[0]\"";
				$p=0;
				while ($p < $QCs_to_print)
					{
					if ($rowx[0] == $QCstatuses[$p]) 
						{
						$qc_statuses_list .= " CHECKED";
						}
					$p++;
					}
				$qc_statuses_list .= "> $rowx[0] - $rowx[1]<BR>\n";

				$o++;
				}

			$stmt="SELECT distinct(status),status_name from vicidial_campaign_statuses order by status";
			$rslt=mysql_query($stmt, $link);
			$Cstatuses_to_print = mysql_num_rows($rslt);

			$o=0;
			while ($Cstatuses_to_print > $o) 
				{
				$rowx=mysql_fetch_row($rslt);
				if (!ereg("\"$rowx[0]\"",$qc_statuses_list))
					{
					$qc_statuses_list .= "<input type=\"checkbox\" name=\"qc_statuses[]\" value=\"$rowx[0]\"";
					$p=0;
					while ($p < $QCs_to_print)
						{
						if ($rowx[0] == $QCstatuses[$p]) 
							{
							$qc_statuses_list .= " CHECKED";
							}
						$p++;
						}
					$qc_statuses_list .= "> $rowx[0] - $rowx[1]<BR>\n";
					}
				$o++;
				}

			##### get scripts listings for pulldown
			$stmt="SELECT script_id,script_name from vicidial_scripts order by script_id";
			$rslt=mysql_query($stmt, $link);
			$scripts_to_print = mysql_num_rows($rslt);
			$QCscripts_list="";
			$o=0;
			while ($scripts_to_print > $o)
				{
				$rowx=mysql_fetch_row($rslt);
				$QCscripts_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
				$scriptname_list["$rowx[0]"] = "$rowx[1]";
				$o++;
				}
			##### get shifts listings for pulldown
			$stmt="SELECT shift_id,shift_name from vicidial_shifts order by shift_id";
			$rslt=mysql_query($stmt, $link);
			$shifts_to_print = mysql_num_rows($rslt);
			$QCshifts_list="";
			$o=0;
			while ($shifts_to_print > $o)
				{
				$rowx=mysql_fetch_row($rslt);
				$QCshifts_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
				$shiftname_list["$rowx[0]"] = "$rowx[1]";
				$o++;
				}

			echo "<tr bgcolor=#C2C2C2><td align=right>QC Enabled: </td><td><select size=1 name=qc_enabled><option>Y</option><option>N</option><option SELECTED>$qc_enabled</option></select> $NWB#vicidial_inbound_groups-qc_enabled$NWE</td></tr>\n";
			echo "<tr bgcolor=#C2C2C2><td align=right>QC Call Result: <BR> $NWB#vicidial_inbound_groups-qc_statuses$NWE</td><td>$qc_statuses_list</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>QC WebForm: </td><td align=left><input type=text name=qc_web_form_address size=70 maxlength=255 value=\"$qc_web_form_address\">$NWB#vicidial_inbound_groups-qc_web_form_address$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=3111111&script_id=$script_id\">QC Script</a>: </td><td align=left><select size=1 name=qc_script>\n";
			echo "$QCscripts_list";
			echo "<option selected value=\"$qc_script\">$qc_script - $scriptname_list[$qc_script]</option>\n";
			echo "</select>$NWB#vicidial_inbound_groups-qc_script$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=331111111&shift_id=$qc_shift_id\">QC Shift</a>: </td><td align=left><select size=1 name=qc_shift_id>\n";
			echo "$QCshifts_list";
			echo "<option selected value=\"$qc_shift_id\">$qc_shift_id - $shiftname_list[$qc_shift_id]</option>\n";
			echo "</select>$NWB#vicidial_inbound_groups-qc_shift_id$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right>QC Get Record Launch: </td><td><select size=1 name=qc_get_record_launch><option>NONE</option><option>SCRIPT</option><option>WEBFORM</option><option>QCSCRIPT</option><option>QCWEBFORM</option><option SELECTED>$qc_get_record_launch</option></select> $NWB#vicidial_inbound_groups-qc_get_record_launch$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>QC Show Recording: </td><td><select size=1 name=qc_show_recording><option>Y</option><option>N</option><option SELECTED>$qc_show_recording</option></select> $NWB#vicidial_inbound_groups-qc_show_recording$NWE</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit value=SUBMIT></td></tr>\n";
			}

		echo "</table>\n";
		echo "<BR></center></FORM><br>\n";


		### list of agent rank or skill-level for this inbound group
		echo "<center>\n";
		echo "<br><b>AGENT RANKS FOR THIS INBOUND GROUP:</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>USER</td><td> &nbsp; &nbsp; RANK</td><td> &nbsp; &nbsp; CALLS TODAY</td></tr>\n";

		$stmt="SELECT vu.user,viga.group_rank,calls_today,full_name from vicidial_inbound_group_agents viga, vicidial_users vu where group_id='$group_id' and active='Y' and vu.user=viga.user;";
		$rsltx=mysql_query($stmt, $link);
		$users_to_print = mysql_num_rows($rsltx);

		$o=0;
		while ($users_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rsltx);
			$o++;

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=3&user=$rowx[0]\">$rowx[0]</a> - $rowx[3]</td><td><font size=1>$rowx[1]</td><td><font size=1>$rowx[2]</td></tr>\n";
			}

		echo "</table></center><br>\n";

		echo "</table></center><br>\n";

		echo "<a href=\"./AST_CLOSERstats.php?group[]=$group_id\">Click here to see a report for this inbound group</a><BR><BR>\n";

		echo "<center><b>\n";

		echo "<B>DIDS USING THIS IN-GROUP:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT did_id,did_pattern,did_description from vicidial_inbound_dids where group_id='$group_id' and did_route='IN_GROUP';";
		$rslt=mysql_query($stmt, $link);
		$dids_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($dids_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=3311&did_id=$row[0]\">$row[1] </a></TD><TD> $row[2]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE><BR>\n";
		echo "<B>IVRS USING THIS IN-GROUP:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT distinct vm.menu_id,menu_name from vicidial_call_menu vm,vicidial_call_menu_options vmo where vm.menu_id=vmo.menu_id and option_route='INGROUP' and option_route_value='$group_id';";
		$rslt=mysql_query($stmt, $link);
		$cms_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($cms_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=3511&menu_id=$row[0]\">$row[0] </a></TD><TD> $row[1]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE><BR>\n";
		echo "<B>CAMPAIGNS ALLOWING THIS IN-GROUP:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns where closer_campaigns LIKE \"% $group_id %\";";
		$rslt=mysql_query($stmt, $link);
		$campin_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($campin_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=31&campaign_id=$row[0]\">$row[0] </a></TD><TD> $row[1]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE>\n";

		if ($LOGdelete_ingroups > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=53&campaign_id=$group_id&stage=IN\">EMERGENCY VDAC CLEAR FOR THIS IN-GROUP</a><BR><BR>\n";
			echo "<br><br><a href=\"$PHP_SELF?ADD=5111&group_id=$group_id\">DELETE THIS IN-GROUP</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=INGROUPS&stage=$group_id\">Click here to see Admin chages to this In-Group</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}



######################
# ADD=3311 modify did info in the system
######################

if ($ADD==3311)
	{
	if ($LOGmodify_dids==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$didSQL = "did_id='$did_id'";
		if ( (strlen($did_id)<1) and (strlen($did_pattern)>0) )
			{$didSQL = "did_pattern='$did_pattern'";}
		$stmt="SELECT did_id,did_pattern,did_description,did_active,did_route,extension,exten_context,voicemail_ext,phone,server_ip,user,user_unavailable_action,user_route_settings_ingroup,group_id,call_handle_method,agent_search_method,list_id,campaign_id,phone_code,menu_id from vicidial_inbound_dids where $didSQL;";
		if ($DB) {echo "$stmt\n";}
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$did_id = 				$row[0];
		$did_pattern = 			$row[1];
		$did_description = 		$row[2];
		$did_active = 			$row[3];
		$did_route = 			$row[4];
		$extension = 			$row[5];
		$exten_context = 		$row[6];
		$voicemail_ext = 		$row[7];
		$phone = 				$row[8];
		$server_ip = 			$row[9];
		$user = 				$row[10];
		$user_unavailable_action = 	$row[11];
		$user_route_settings_ingroup = 	$row[12];
		$group_id = 			$row[13];
		$call_handle_method = 	$row[14];
		$agent_search_method =	$row[15];
		$list_id = 				$row[16];
		$campaign_id = 			$row[17];
		$phone_code = 			$row[18];
		$menu_id =				$row[19];


		$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
		$rslt=mysql_query($stmt, $link);
		$campaigns_to_print = mysql_num_rows($rslt);
		$campaigns_list='';
		$o=0;
		while ($campaigns_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$campaigns_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}

		##### get in-groups listings for dynamic pulldown
		$stmt="SELECT group_id,group_name from vicidial_inbound_groups order by group_id";
		$rslt=mysql_query($stmt, $link);
		$Xgroups_to_print = mysql_num_rows($rslt);
		$Xgroups_menu='';
		$Xgroups_selected=0;
		$o=0;
		while ($Xgroups_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$Xgroups_menu .= "<option ";
			if ($user_route_settings_ingroup == "$rowx[0]") 
				{
				$Xgroups_menu .= "SELECTED ";
				$Xgroups_selected++;
				}
			$Xgroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		if ($Xgroups_selected < 1) 
			{$Xgroups_menu .= "<option SELECTED value=\"---NONE---\">---NONE---</option>\n";}
		else 
			{$Xgroups_menu .= "<option value=\"---NONE---\">---NONE---</option>\n";}


		##### get in-groups listings for dynamic pulldown
		$stmt="SELECT group_id,group_name from vicidial_inbound_groups where group_id NOT IN('AGENTDIRECT') order by group_id";
		$rslt=mysql_query($stmt, $link);
		$Dgroups_to_print = mysql_num_rows($rslt);
		$Dgroups_menu='';
		$Dgroups_selected=0;
		$o=0;
		while ($Dgroups_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$Dgroups_menu .= "<option ";
			if ($group_id == "$rowx[0]") 
				{
				$Dgroups_menu .= "SELECTED ";
				$Dgroups_selected++;
				}
			$Dgroups_menu .= "value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		if ($Dgroups_selected < 1) 
			{$Dgroups_menu .= "<option SELECTED value=\"---NONE---\">---NONE---</option>\n";}
		else 
			{$Dgroups_menu .= "<option value=\"---NONE---\">---NONE---</option>\n";}
			

			
		

		echo "<br>MODIFY A DID RECORD: $row[0]<form onSubmit=\"return contentFilter('DID Extension,did_pattern,2')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=4311>\n";
		echo "<input type=hidden name=did_id value=\"$did_id\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DID Extension: </td><td align=left><input type=text name=did_pattern size=30 maxlength=50 value=\"$did_pattern\">$NWB#vicidial_inbound_dids-did_pattern$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DID Description: </td><td align=left><input type=text name=did_description size=40 maxlength=50 value=\"$did_description\">$NWB#vicidial_inbound_dids-did_description$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=did_active><option>Y</option><option>N</option><option SELECTED>$did_active</option></select>$NWB#vicidial_inbound_dids-did_active$NWE</td></tr>\n";
		echo "<tr bgcolor=#99FFCC><td align=right>DID Route: </td><td align=left><select size=1 name=did_route><option>AGENT</option><option>EXTEN</option><option>VOICEMAIL</option><option>PHONE</option><option>IN_GROUP</option><option>CALLMENU</option><option>Intelligent_Route</option><option SELECTED>$did_route</option></select>$NWB#vicidial_inbound_dids-did_route$NWE</td></tr>\n";//change by fox
		echo "<tr bgcolor=#FFFFFF><td align=right>Extension: </td><td align=left><input type=text name=extension size=40 maxlength=50 value=\"$extension\">$NWB#vicidial_inbound_dids-extension$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Extension Context: </td><td align=left><input type=text name=exten_context size=40 maxlength=50 value=\"$exten_context\">$NWB#vicidial_inbound_dids-exten_context$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Voicemail Box: </td><td align=left><input type=text name=voicemail_ext id=voicemail_ext size=12 maxlength=10 value=\"$voicemail_ext\"> <a href=\"javascript:launch_vm_chooser('voicemail_ext','vm',100);\">voicemail chooser</a>$NWB#vicidial_inbound_dids-voicemail_ext$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phone Extension: </td><td align=left><input type=text name=phone size=20 maxlength=100 value=\"$phone\">$NWB#vicidial_inbound_dids-phone$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server IP: </td><td align=left><select size=1 name=server_ip>\n";
		echo "$servers_list";
		echo "<option SELECTED>$server_ip</option>\n";
		echo "</select>$NWB#vicidial_inbound_dids-server_ip$NWE</td></tr>\n";
		//change by fox
		if($did_route == 'CALLMENU'){
			$ivr_menu_id = $menu_id;
		}else $ivr_menu_id = '';		
		$stmt="select menu_id,menu_name,menu_prompt from vicidial_call_menu;";
		$rslt=mysql_query($stmt, $link);
		$menus_to_print = mysql_num_rows($rslt);
		$menu_list='';
		$i=0;
		while ($i < $menus_to_print)
			{
			$row=mysql_fetch_row($rslt);
			$menu_list .= "<option value=\"$row[0]\">$row[0] - $row[1] - $row[2]</option>";
			$i++;
			}
		
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=3511&menu_id=$ivr_menu_id\">IVR:</a> </td><td align=left><select size=1 name=ivr_menu_id>$menu_list<option SELECTED>$ivr_menu_id</option></select>$NWB#vicidial_inbound_dids-menu_id$NWE</td></tr>\n";
		
		
		if($did_route == 'Intelligent_Route'){
			$ir_menu_id = $menu_id;
		}else $ir_menu_id = '';
		$stmt="SELECT intelligent_route_id,intelligent_route_name FROM ccms_intelligent_route";
		$rslt=mysql_query($stmt, $link);
		$menus_to_print = mysql_num_rows($rslt);
		$menu_list='';
		$i=0;
		while ($i < $menus_to_print)
			{
			$row=mysql_fetch_row($rslt);
			$menu_list .= "<option value=\"$row[1]\">$row[0] - $row[1]</option>";
			$i++;
			}

		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=1500099&action=modify&route_name=$ir_menu_id\">Intelligent Route:</a> </td><td align=left><select size=1 name=ir_menu_id>$menu_list<option SELECTED>$ir_menu_id</option></select>$NWB#vicidial_inbound_dids-menu_id$NWE</td></tr>\n";
		//end
		echo "<tr bgcolor=#FFFFFF><td align=right>User Agent: </td><td align=left><input type=text name=user size=20 maxlength=20 value=\"$user\">$NWB#vicidial_inbound_dids-user$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>User Unavailable Action: </td><td align=left><select size=1 name=user_unavailable_action><option>EXTEN</option><option>VOICEMAIL</option><option>PHONE</option><option>IN_GROUP</option><option SELECTED>$user_unavailable_action</option></select>$NWB#vicidial_inbound_dids-user_unavailable_action$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>User Route Settings In-Group: </td><td align=left><select size=1 name=user_route_settings_ingroup>";
		echo "$Xgroups_menu";
		echo "</select>$NWB#vicidial_inbound_dids-user_route_settings_ingroup$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=3111&group_id=$group_id\">In-Group ID</a>: </td><td align=left><select size=1 name=group_id>";
		echo "$Dgroups_menu";
		echo "</select>$NWB#vicidial_inbound_dids-group_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>In-Group Call Handle Method: </td><td align=left><select size=1 name=call_handle_method><option>CID</option><option>CIDLOOKUP</option><option>CIDLOOKUPRL</option><option>CIDLOOKUPRC</option><option>ANI</option><option>ANILOOKUP</option><option>ANILOOKUPRL</option><option>VIDPROMPT</option><option>VIDPROMPTLOOKUP</option><option>VIDPROMPTLOOKUPRL</option><option>VIDPROMPTLOOKUPRC</option><option>CLOSER</option><option>3DIGITID</option><option>4DIGITID</option><option>5DIGITID</option><option>10DIGITID</option><option SELECTED>$call_handle_method</option></select>$NWB#vicidial_inbound_dids-call_handle_method$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>In-Group Agent Search Method: </td><td align=left><select size=1 name=agent_search_method><option value=\"LB\">LB - Load Balanced</option><option value=\"LO\">LO - Load Balanced Overflow</option><option value=\"SO\">SO - Server Only</option><option SELECTED>$agent_search_method</option></select>$NWB#vicidial_inbound_dids-agent_search_method$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>In-Group List ID: </td><td align=left><input type=text name=list_id size=14 maxlength=14 value=\"$list_id\">$NWB#vicidial_inbound_dids-list_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>In-Group Campaign ID: </td><td align=left><select size=1 name=campaign_id>\n";
		echo "$campaigns_list";
		echo "<option SELECTED>$campaign_id</option>\n";
		echo "</select>$NWB#vicidial_inbound_dids-campaign_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>In-Group Phone Code: </td><td align=left><input type=text name=phone_code size=14 maxlength=14 value=\"$phone_code\">$NWB#vicidial_inbound_dids-phone_code$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</table>\n";
		echo "<BR></center></FORM><br>\n";

		echo "<br><a href=\"./AST_DIDstats.php?group[0]=$did_id\">Click here to see a traffic report for this DID</FONT><br>\n";

		if ($LOGdelete_dids > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=5311&did_id=$did_id\">DELETE THIS DID</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=DIDS&stage=$did_id\">Click here to see Admin chages to this DID</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}



######################
# ADD=3511 modify IVR info in the system
######################

if ($ADD==3511)
	{
	if ($LOGmodify_dids==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT menu_name,menu_prompt,menu_timeout,menu_timeout_prompt,menu_invalid_prompt,menu_repeat,menu_time_check,call_time_id,track_in_vdac,custom_dialplan_entry,tracking_group from vicidial_call_menu where menu_id='$menu_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$menu_name =			$row[0];
		$menu_prompt =			$row[1];
		$menu_timeout =			$row[2];
		$menu_timeout_prompt =	$row[3];
		$menu_invalid_prompt =	$row[4];
		$menu_repeat =			$row[5];
		$menu_time_check =		$row[6];
		$call_time_id =			$row[7];
		$track_in_vdac =		$row[8];
		$custom_dialplan_entry= $row[9];
		$tracking_group =		$row[10];


		echo "<br>MODIFY A IVR RECORD: $menu_id<form action=$PHP_SELF method=POST name=admin_form id=admin_form>\n";
		echo "<input type=hidden name=ADD value=4511>\n";
		echo "<input type=hidden name=menu_id value=\"$menu_id\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu ID: </td><td align=left>$menu_id $NWB#vicidial_call_menu-menu_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Name: </td><td align=left><input type=text name=menu_name size=40 maxlength=50 value=\"$menu_name\">$NWB#vicidial_call_menu-menu_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Prompt: </td><td align=left><input type=text name=menu_prompt id=menu_prompt size=60 maxlength=255 value=\"$menu_prompt\"> <a href=\"javascript:launch_chooser('menu_prompt','date',30);\">audio chooser</a> $NWB#vicidial_call_menu-menu_prompt$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Timeout: </td><td align=left><input type=text name=menu_timeout size=10 maxlength=5 value=\"$menu_timeout\">$NWB#vicidial_call_menu-menu_timeout$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Timeout Prompt: </td><td align=left><input type=text name=menu_timeout_prompt id=menu_timeout_prompt size=60 maxlength=255 value=\"$menu_timeout_prompt\"> <a href=\"javascript:launch_chooser('menu_timeout_prompt','date',30);\">audio chooser</a> $NWB#vicidial_call_menu-menu_timeout_prompt$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Invalid Prompt: </td><td align=left><input type=text name=menu_invalid_prompt id=menu_invalid_prompt size=60 maxlength=255 value=\"$menu_invalid_prompt\"> <a href=\"javascript:launch_chooser('menu_invalid_prompt','date',30);\">audio chooser</a> $NWB#vicidial_call_menu-menu_invalid_prompt$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Repeat: </td><td align=left><input type=text name=menu_repeat size=4 maxlength=3 value=\"$menu_repeat\">$NWB#vicidial_call_menu-menu_repeat$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Time Check: </td><td align=left><select size=1 name=menu_time_check>\n";
		if ($menu_time_check > 0)
			{
			echo "<option value=\"0\">0 - No Time Check</option><option selected value=\"1\">1 - Time Check</option>\n";
			}
		else
			{
			echo "<option selected value=\"0\">0 - No Time Check</option><option value=\"1\">1 - Time Check</option>\n";
			}
		echo "	</select>$NWB#vicidial_call_menu-menu_time_check$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=311111111&call_time_id=$call_time_id\">Call Time: </a></td><td align=left><select size=1 name=call_time_id>\n";
		echo "$call_times_list";
		echo "<option selected value=\"$call_time_id\">$call_time_id - $call_timename_list[$call_time_id]</option>\n";
		echo "</select>$NWB#vicidial_call_menu-call_time_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Track Calls in Real-Time Report: </td><td align=left><select size=1 name=track_in_vdac>";
		if ($track_in_vdac > 0)
			{
			echo "<option value=\"0\">0 - No Realtime Tracking</option><option selected value=\"1\">1 - Realtime Tracking</option>\n";
			}
		else
			{
			echo "<option selected value=\"0\">0 - No Realtime Tracking</option><option value=\"1\">1 - Realtime Tracking</option>\n";
			}
		echo "</select>$NWB#vicidial_call_menu-track_in_vdac$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Tracking Group: </td><td align=left><select size=1 name=tracking_group>\n";
		echo "<option value=\"CALLMENU\">CALLMENU - Default</option>\n";
		echo "$ingroup_list";
		echo "<option selected value=\"$tracking_group\">$tracking_group</option>\n";
		echo "</select>$NWB#vicidial_call_menu-tracking_group$NWE</td></tr>\n";

		echo "<tr><td align=center colspan=2> <input type=submit name=SUBMIT value=SUBMIT> </td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=CENTER colspan=2> IVR Options: </td></tr>\n";

		$j=0;
		$stmtA="SELECT option_value,option_description,option_route,option_route_value,option_route_value_context from vicidial_call_menu_options where menu_id='$menu_id' order by option_value;";
		$rslt=mysql_query($stmtA, $link);
		$menus_to_print = mysql_num_rows($rslt);

		while ($menus_to_print > $j)
			{
			$row=mysql_fetch_row($rslt);
			$Aoption_value[$j] =				$row[0];
			$Aoption_description[$j] =			$row[1];
			$Aoption_route[$j] =				$row[2];
			$Aoption_route_value[$j] =			$row[3];
			$Aoption_route_value_context[$j] =	$row[4];
			$j++;
			}

		$j=0;
		while ($menus_to_print > $j)
			{
			$choose_height = (($j * 40) + 400);
			$option_value =					$Aoption_value[$j];
			$option_description =			$Aoption_description[$j];
			$option_route =					$Aoption_route[$j];
			$option_route_value =			$Aoption_route_value[$j];
			$option_route_value_context =	$Aoption_route_value_context[$j];

			$dtmf_list = "<select size=1 name=option_value_$j>";
			$h=0;
			while ($h <= 18)
				{
				$dtmf_list .= "<option";
				if ( (preg_match("/$dtmf[$h]/",$option_value) and (strlen($option_value) == strlen($dtmf[$h])) ) )
					{$dtmf_list .= " selected";}
				$dtmf_list .= " value=\"$dtmf[$h]\"> $dtmf_key[$h]</option>";
				$h++;
				}
			$dtmf_list .= "</select>";

			if (eregi("1$|3$|5$|7$|9$", $j))
				{$bgcolor='bgcolor="#CCFFFF"';} 
			else
				{$bgcolor='bgcolor="#99FFCC"';}

			echo "<tr $bgcolor><td align=CENTER colspan=2> 
			Option: $dtmf_list &nbsp; 
			Description: <input type=text name=option_description_$j size=30 maxlength=255 value=\"$option_description\"> 
			Route: <select size=1 name=option_route_$j id=option_route_$j onChange=\"call_menu_option('$j','$option_route','$option_route_value','$option_route_value_context','$choose_height');\">
				<option>CALLMENU</option>
				<option>INGROUP</option>
				<option>DID</option>
				<option>HANGUP</option>
				<option>EXTENSION</option>
				<option>PHONE</option>
				<option>VOICEMAIL</option>
				<option>AGI</option>
				<option>INTELLIGENT ROUTE</option>
				<option value=\"\">* REMOVE *</option>
				<option selected value=\"$option_route\">$option_route</option>
			</select>		$NWB#vicidial_call_menu-option_value$NWE <BR>

			<span id=\"option_value_value_context_$j\" name=\"option_value_value_context_$j\">\n";

			if ($option_route=='CALLMENU')
				{
				echo "<span name=option_route_link_$j id=option_route_link_$j>";
				echo "<a href=\"$PHP_SELF?ADD=3511&menu_id=$option_route_value\">IVR:</a>";
				echo "</span>";
				echo " <select size=1 name=option_route_value_$j id=option_route_value_$j onChange=\"call_menu_link('$j','CALLMENU');\">$call_menu_list<option SELECTED>$option_route_value</option></select>\n";
				}
			if ($option_route=='INTELLIGENT ROUTE')
			{
			echo "<span name=option_route_link_$j id=option_route_link_$j>";
			echo "<a href=\"$PHP_SELF?ADD=1500099&action=modify&route_name=$option_route_value\">INTELLIGENT ROUTE:</a>";
			echo "</span>";
			echo " <select size=1 name=option_route_value_$j id=option_route_value_$j onChange=\"call_menu_link('$j','INTELLIGENT');\">$intelligent_menu_list<option SELECTED>$option_route_value</option></select>\n";
			}
			if ($option_route=='INGROUP')
				{
				if (strlen($option_route_value_context) < 10)
					{$option_route_value_context = 'CID,LB,998,TESTCAMP,1';}
				$IGoption_route_value_context = explode(",",$option_route_value_context);
				$IGhandle_method =	$IGoption_route_value_context[0];
				$IGsearch_method =	$IGoption_route_value_context[1];
				$IGlist_id =		$IGoption_route_value_context[2];
				$IGcampaign_id =	$IGoption_route_value_context[3];
				$IGphone_code =		$IGoption_route_value_context[4];
				echo "<span name=option_route_link_$j id=option_route_link_$j>";
				echo "<a href=\"$PHP_SELF?ADD=3111&group_id=$option_route_value\">In-Group:</a>";
				echo "</span>";
				echo " <input type=hidden name=option_route_value_context_$j id=option_route_value_context_$j value=\"$option_route_value_context\">";
				echo " <select size=1 name=option_route_value_$j id=option_route_value_$j onChange=\"call_menu_link('$j','INGROUP');\">";
				echo "$ingroup_list<option SELECTED>$option_route_value</option></select>";
				echo " &nbsp; Handle Method: <select size=1 name=IGhandle_method_$j id=IGhandle_method_$j>";
				echo "$IGhandle_method_list<option SELECTED>$IGhandle_method</option></select>\n";
				echo "<BR>Search Method: <select size=1 name=IGsearch_method_$j id=IGsearch_method_$j>";
				echo "$IGsearch_method_list<option SELECTED>$IGsearch_method</option></select>\n";
				echo " &nbsp; List ID: <input type=text size=5 maxlength=14 name=IGlist_id_$j id=IGlist_id_$j value=\"$IGlist_id\">";
				echo "<BR>Campaign ID: <select size=1 name=IGcampaign_id_$j id=IGcampaign_id_$j>";
				echo "$IGcampaign_id_list<option SELECTED>$IGcampaign_id</option></select>\n";
				echo " &nbsp; Phone Code: <input type=text size=5 maxlength=14 name=IGphone_code_$j id=IGphone_code_$j value=\"$IGphone_code\">";
				}
			if ($option_route=='DID')
				{
				$stmt="SELECT did_id from vicidial_inbound_dids where did_pattern='$option_route_value';";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);
				$did_id =			$row[0];

				echo "<span name=option_route_link_$j id=option_route_link_$j>";
				echo "<a href=\"$PHP_SELF?ADD=3311&did_id=$did_id\">DID:</a>";
				echo "</span>";
				echo " <select size=1 name=option_route_value_$j id=option_route_value_$j onChange=\"call_menu_link('$j','DID');\">$did_list<option SELECTED>$option_route_value</option></select>\n";
				}
			if ($option_route=='HANGUP')
				{
				echo "Audio File: <input type=text name=option_route_value_$j id=option_route_value_$j size=50 maxlength=255 value=\"$option_route_value\"> <a href=\"javascript:launch_chooser('option_route_value_$j','date',$choose_height);\">audio chooser</a>\n";
				}
			if ($option_route=='EXTENSION')
				{
				echo "Extension: <input type=text name=option_route_value_$j id=option_route_value_$j size=20 maxlength=255 value=\"$option_route_value\"> &nbsp; Context: <input type=text name=option_route_value_context_$j id=option_route_value_context_$j size=20 maxlength=255 value=\"$option_route_value_context\">\n";
				}
			if ($option_route=='PHONE')
				{
				echo "Phone: <select size=1 name=option_route_value_$j id=option_route_value_$j>$phone_list<option SELECTED>$option_route_value</option></select>\n";
				}
			if ($option_route=='VOICEMAIL')
				{
				echo "Voicemail Box: <input type=text name=option_route_value_$j id=option_route_value_$j size=12 maxlength=10 value=\"$option_route_value\"> <a href=\"javascript:launch_vm_chooser('option_route_value_$j','vm',700);\">voicemail chooser</a>\n";
				}
			if ($option_route=='AGI')
				{
				echo "AGI: <input type=text name=option_route_value_$j id=option_route_value_$j size=80 maxlength=255 value=\"$option_route_value\">\n";
				}

			echo "</span>
			<BR> &nbsp; </td></tr>\n";
			$j++;
			}

		while ($j <= 18)
			{
			$choose_height = (($j * 40) + 400);
			$dtmf_list = "<select size=1 name=option_value_$j><option value=\"\"></option>";
			$h=0;
			while ($h <= 18)
				{
				$dtmf_list .= "<option value=\"$dtmf[$h]\"> $dtmf_key[$h]</option>";
				$h++;
				}
			$dtmf_list .= "</select>";

			if (eregi("1$|3$|5$|7$|9$", $j))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td align=CENTER colspan=2> 
			Option: $dtmf_list &nbsp; 
			Description: <input type=text name=option_description_$j size=30 maxlength=255 value=\"\">  
			Route: <select size=1 name=option_route_$j id=option_route_$j onChange=\"call_menu_option('$j','','','','$choose_height');\">
				<option>CALLMENU</option>
				<option>INGROUP</option>
				<option>DID</option>
				<option>HANGUP</option>
				<option>EXTENSION</option>
				<option>PHONE</option>
				<option>VOICEMAIL</option>
				<option>AGI</option>
				<option>INTELLIGENT ROUTE</option>
				<option SELECTED value=\"\"> </option>
			</select> 
			$NWB#vicidial_call_menu-option_value$NWE <BR>

			<span id=\"option_value_value_context_$j\" name=\"option_value_value_context_$j\">\n";
			echo "</span>
			<BR> &nbsp; </td></tr>\n";
			$j++;
			}

		if ($SSallow_custom_dialplan > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Custom Dialplan Entry: <BR> $NWB#vicidial_call_menu-custom_dialplan_entry$NWE</td><td align=left><TEXTAREA NAME=custom_dialplan_entry ROWS=5 COLS=70>$custom_dialplan_entry</TEXTAREA></td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Custom Dialplan Entry: </td><td align=left>Disabled <input type=hidden name=custom_dialplan_entry value=\"\">$NWB#vicidial_call_menu-custom_dialplan_entry$NWE</td></tr>\n";
			}

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</table>\n";
		echo "<BR></center></FORM><br>\n";

		echo "<B>DIDS USING THIS IVR:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT did_id,did_pattern,did_description from vicidial_inbound_dids where menu_id='$menu_id' and did_route='CALLMENU';";
		$rslt=mysql_query($stmt, $link);
		$dids_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($dids_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=3311&did_id=$row[0]\">$row[1] </a></TD><TD> $row[2]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE><BR>\n";

		echo "<B>IVRS USING THIS IVR:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT distinct vm.menu_id,menu_name from vicidial_call_menu vm,vicidial_call_menu_options vmo where vm.menu_id=vmo.menu_id and option_route='CALLMENU' and option_route_value='$menu_id';";
		$rslt=mysql_query($stmt, $link);
		$cms_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($cms_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=3511&menu_id=$row[0]\">$row[0] </a></TD><TD> $row[1]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE>\n";


		if ($LOGdelete_dids > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=5511&menu_id=$menu_id\">DELETE THIS IVR</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=CALLMENUS&stage=$menu_id\">Click here to see Admin chages to this IVR</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}

if ($ADD==35113511)
	{
	if ($LOGmodify_dids==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT menu_name,menu_prompt,menu_timeout,menu_timeout_prompt,menu_invalid_prompt,menu_repeat,menu_time_check,call_time_id,track_in_vdac,custom_dialplan_entry,tracking_group from vicidial_call_menu where menu_id='$menu_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$menu_name =			$row[0];
		$menu_prompt =			$row[1];
		$menu_timeout =			$row[2];
		$menu_timeout_prompt =	$row[3];
		$menu_invalid_prompt =	$row[4];
		$menu_repeat =			$row[5];
		$menu_time_check =		$row[6];
		$call_time_id =			$row[7];
		$track_in_vdac =		$row[8];
		$custom_dialplan_entry= $row[9];
		$tracking_group =		$row[10];


		echo "<br>MODIFY A Intelligent Route RECORD: $menu_id<form action=$PHP_SELF method=POST name=admin_form id=admin_form>\n";
		echo "<input type=hidden name=ADD value=4511>\n";
		echo "<input type=hidden name=menu_id value=\"$menu_id\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu ID: </td><td align=left>$menu_id $NWB#vicidial_call_menu-menu_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Name: </td><td align=left><input type=text name=menu_name size=40 maxlength=50 value=\"$menu_name\">$NWB#vicidial_call_menu-menu_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Prompt: </td><td align=left><input type=text name=menu_prompt id=menu_prompt size=60 maxlength=255 value=\"$menu_prompt\"> <a href=\"javascript:launch_chooser('menu_prompt','date',30);\">audio chooser</a> $NWB#vicidial_call_menu-menu_prompt$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Timeout: </td><td align=left><input type=text name=menu_timeout size=10 maxlength=5 value=\"$menu_timeout\">$NWB#vicidial_call_menu-menu_timeout$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Timeout Prompt: </td><td align=left><input type=text name=menu_timeout_prompt id=menu_timeout_prompt size=60 maxlength=255 value=\"$menu_timeout_prompt\"> <a href=\"javascript:launch_chooser('menu_timeout_prompt','date',30);\">audio chooser</a> $NWB#vicidial_call_menu-menu_timeout_prompt$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Invalid Prompt: </td><td align=left><input type=text name=menu_invalid_prompt id=menu_invalid_prompt size=60 maxlength=255 value=\"$menu_invalid_prompt\"> <a href=\"javascript:launch_chooser('menu_invalid_prompt','date',30);\">audio chooser</a> $NWB#vicidial_call_menu-menu_invalid_prompt$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Repeat: </td><td align=left><input type=text name=menu_repeat size=4 maxlength=3 value=\"$menu_repeat\">$NWB#vicidial_call_menu-menu_repeat$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Menu Time Check: </td><td align=left><select size=1 name=menu_time_check>\n";
		if ($menu_time_check > 0)
			{
			echo "<option value=\"0\">0 - No Time Check</option><option selected value=\"1\">1 - Time Check</option>\n";
			}
		else
			{
			echo "<option selected value=\"0\">0 - No Time Check</option><option value=\"1\">1 - Time Check</option>\n";
			}
		echo "	</select>$NWB#vicidial_call_menu-menu_time_check$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=311111111&call_time_id=$call_time_id\">Call Time: </a></td><td align=left><select size=1 name=call_time_id>\n";
		echo "$call_times_list";
		echo "<option selected value=\"$call_time_id\">$call_time_id - $call_timename_list[$call_time_id]</option>\n";
		echo "</select>$NWB#vicidial_call_menu-call_time_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Track Calls in Real-Time Report: </td><td align=left><select size=1 name=track_in_vdac>";
		if ($track_in_vdac > 0)
			{
			echo "<option value=\"0\">0 - No Realtime Tracking</option><option selected value=\"1\">1 - Realtime Tracking</option>\n";
			}
		else
			{
			echo "<option selected value=\"0\">0 - No Realtime Tracking</option><option value=\"1\">1 - Realtime Tracking</option>\n";
			}
		echo "</select>$NWB#vicidial_call_menu-track_in_vdac$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Tracking Group: </td><td align=left><select size=1 name=tracking_group>\n";
		echo "<option value=\"CALLMENU\">CALLMENU - Default</option>\n";
		echo "$ingroup_list";
		echo "<option selected value=\"$tracking_group\">$tracking_group</option>\n";
		echo "</select>$NWB#vicidial_call_menu-tracking_group$NWE</td></tr>\n";

		echo "<tr><td align=center colspan=2> <input type=submit name=SUBMIT value=SUBMIT> </td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=CENTER colspan=2> IVR Options: </td></tr>\n";

		$j=0;
		$stmtA="SELECT option_value,option_description,option_route,option_route_value,option_route_value_context from vicidial_call_menu_options where menu_id='$menu_id' order by option_value;";
		$rslt=mysql_query($stmtA, $link);
		$menus_to_print = mysql_num_rows($rslt);

		while ($menus_to_print > $j)
			{
			$row=mysql_fetch_row($rslt);
			$Aoption_value[$j] =				$row[0];
			$Aoption_description[$j] =			$row[1];
			$Aoption_route[$j] =				$row[2];
			$Aoption_route_value[$j] =			$row[3];
			$Aoption_route_value_context[$j] =	$row[4];
			$j++;
			}

		$j=0;
		while ($menus_to_print > $j)
			{
			$choose_height = (($j * 40) + 400);
			$option_value =					$Aoption_value[$j];
			$option_description =			$Aoption_description[$j];
			$option_route =					$Aoption_route[$j];
			$option_route_value =			$Aoption_route_value[$j];
			$option_route_value_context =	$Aoption_route_value_context[$j];

			$dtmf_list = "<select size=1 name=option_value_$j>";
			$h=0;
			while ($h <= 18)
				{
				$dtmf_list .= "<option";
				if ( (preg_match("/$dtmf[$h]/",$option_value) and (strlen($option_value) == strlen($dtmf[$h])) ) )
					{$dtmf_list .= " selected";}
				$dtmf_list .= " value=\"$dtmf[$h]\"> $dtmf_key[$h]</option>";
				$h++;
				}
			$dtmf_list .= "</select>";

			if (eregi("1$|3$|5$|7$|9$", $j))
				{$bgcolor='bgcolor="#CCFFFF"';} 
			else
				{$bgcolor='bgcolor="#99FFCC"';}

			echo "<tr $bgcolor><td align=CENTER colspan=2> 
			Option: $dtmf_list &nbsp; 
			Description: <input type=text name=option_description_$j size=40 maxlength=255 value=\"$option_description\"> 
			Route: <select size=1 name=option_route_$j id=option_route_$j onChange=\"call_menu_option('$j','$option_route','$option_route_value','$option_route_value_context','$choose_height');\">
				<option>CALLMENU</option>
				<option>INGROUP</option>
				<option>DID</option>
				<option>HANGUP</option>
				<option>EXTENSION</option>
				<option>PHONE</option>
				<option>VOICEMAIL</option>
				<option>AGI</option>
				<option value=\"\">* REMOVE *</option>
				<option selected value=\"$option_route\">$option_route</option>
			</select>		$NWB#vicidial_call_menu-option_value$NWE <BR>

			<span id=\"option_value_value_context_$j\" name=\"option_value_value_context_$j\">\n";

			if ($option_route=='CALLMENU')
				{
				echo "<span name=option_route_link_$j id=option_route_link_$j>";
				echo "<a href=\"$PHP_SELF?ADD=3511&menu_id=$option_route_value\">IVR:</a>";
				echo "</span>";
				echo " <select size=1 name=option_route_value_$j id=option_route_value_$j onChange=\"call_menu_link('$j','CALLMENU');\">$call_menu_list<option SELECTED>$option_route_value</option></select>\n";
				}
			if ($option_route=='INGROUP')
				{
				if (strlen($option_route_value_context) < 10)
					{$option_route_value_context = 'CID,LB,998,TESTCAMP,1';}
				$IGoption_route_value_context = explode(",",$option_route_value_context);
				$IGhandle_method =	$IGoption_route_value_context[0];
				$IGsearch_method =	$IGoption_route_value_context[1];
				$IGlist_id =		$IGoption_route_value_context[2];
				$IGcampaign_id =	$IGoption_route_value_context[3];
				$IGphone_code =		$IGoption_route_value_context[4];
				echo "<span name=option_route_link_$j id=option_route_link_$j>";
				echo "<a href=\"$PHP_SELF?ADD=3111&group_id=$option_route_value\">In-Group:</a>";
				echo "</span>";
				echo " <input type=hidden name=option_route_value_context_$j id=option_route_value_context_$j value=\"$option_route_value_context\">";
				echo " <select size=1 name=option_route_value_$j id=option_route_value_$j onChange=\"call_menu_link('$j','INGROUP');\">";
				echo "$ingroup_list<option SELECTED>$option_route_value</option></select>";
				echo " &nbsp; Handle Method: <select size=1 name=IGhandle_method_$j id=IGhandle_method_$j>";
				echo "$IGhandle_method_list<option SELECTED>$IGhandle_method</option></select>\n";
				echo "<BR>Search Method: <select size=1 name=IGsearch_method_$j id=IGsearch_method_$j>";
				echo "$IGsearch_method_list<option SELECTED>$IGsearch_method</option></select>\n";
				echo " &nbsp; List ID: <input type=text size=5 maxlength=14 name=IGlist_id_$j id=IGlist_id_$j value=\"$IGlist_id\">";
				echo "<BR>Campaign ID: <select size=1 name=IGcampaign_id_$j id=IGcampaign_id_$j>";
				echo "$IGcampaign_id_list<option SELECTED>$IGcampaign_id</option></select>\n";
				echo " &nbsp; Phone Code: <input type=text size=5 maxlength=14 name=IGphone_code_$j id=IGphone_code_$j value=\"$IGphone_code\">";
				}
			if ($option_route=='DID')
				{
				$stmt="SELECT did_id from vicidial_inbound_dids where did_pattern='$option_route_value';";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);
				$did_id =			$row[0];

				echo "<span name=option_route_link_$j id=option_route_link_$j>";
				echo "<a href=\"$PHP_SELF?ADD=3311&did_id=$did_id\">DID:</a>";
				echo "</span>";
				echo " <select size=1 name=option_route_value_$j id=option_route_value_$j onChange=\"call_menu_link('$j','DID');\">$did_list<option SELECTED>$option_route_value</option></select>\n";
				}
			if ($option_route=='HANGUP')
				{
				echo "Audio File: <input type=text name=option_route_value_$j id=option_route_value_$j size=50 maxlength=255 value=\"$option_route_value\"> <a href=\"javascript:launch_chooser('option_route_value_$j','date',$choose_height);\">audio chooser</a>\n";
				}
			if ($option_route=='EXTENSION')
				{
				echo "Extension: <input type=text name=option_route_value_$j id=option_route_value_$j size=20 maxlength=255 value=\"$option_route_value\"> &nbsp; Context: <input type=text name=option_route_value_context_$j id=option_route_value_context_$j size=20 maxlength=255 value=\"$option_route_value_context\">\n";
				}
			if ($option_route=='PHONE')
				{
				echo "Phone: <select size=1 name=option_route_value_$j id=option_route_value_$j>$phone_list<option SELECTED>$option_route_value</option></select>\n";
				}
			if ($option_route=='VOICEMAIL')
				{
				echo "Voicemail Box: <input type=text name=option_route_value_$j id=option_route_value_$j size=12 maxlength=10 value=\"$option_route_value\"> <a href=\"javascript:launch_vm_chooser('option_route_value_$j','vm',700);\">voicemail chooser</a>\n";
				}
			if ($option_route=='AGI')
				{
				echo "AGI: <input type=text name=option_route_value_$j id=option_route_value_$j size=80 maxlength=255 value=\"$option_route_value\">\n";
				}

			echo "</span>
			<BR> &nbsp; </td></tr>\n";
			$j++;
			}

		while ($j <= 18)
			{
			$choose_height = (($j * 40) + 400);
			$dtmf_list = "<select size=1 name=option_value_$j><option value=\"\"></option>";
			$h=0;
			while ($h <= 18)
				{
				$dtmf_list .= "<option value=\"$dtmf[$h]\"> $dtmf_key[$h]</option>";
				$h++;
				}
			$dtmf_list .= "</select>";

			if (eregi("1$|3$|5$|7$|9$", $j))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td align=CENTER colspan=2> 
			Option: $dtmf_list &nbsp; 
			Description: <input type=text name=option_description_$j size=40 maxlength=255 value=\"\">  
			Route: <select size=1 name=option_route_$j id=option_route_$j onChange=\"call_menu_option('$j','','','','$choose_height');\">
				<option>CALLMENU</option>
				<option>INGROUP</option>
				<option>DID</option>
				<option>HANGUP</option>
				<option>EXTENSION</option>
				<option>PHONE</option>
				<option>VOICEMAIL</option>
				<option>AGI</option>
				<option SELECTED value=\"\"> </option>
			</select> 
			$NWB#vicidial_call_menu-option_value$NWE <BR>

			<span id=\"option_value_value_context_$j\" name=\"option_value_value_context_$j\">\n";
			echo "</span>
			<BR> &nbsp; </td></tr>\n";
			$j++;
			}

		if ($SSallow_custom_dialplan > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Custom Dialplan Entry: <BR> $NWB#vicidial_call_menu-custom_dialplan_entry$NWE</td><td align=left><TEXTAREA NAME=custom_dialplan_entry ROWS=5 COLS=70>$custom_dialplan_entry</TEXTAREA></td></tr>\n";
			}
		else
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>Custom Dialplan Entry: </td><td align=left>Disabled <input type=hidden name=custom_dialplan_entry value=\"\">$NWB#vicidial_call_menu-custom_dialplan_entry$NWE</td></tr>\n";
			}

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</table>\n";
		echo "<BR></center></FORM><br>\n";

		echo "<B>DIDS USING THIS IVR:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT did_id,did_pattern,did_description from vicidial_inbound_dids where menu_id='$menu_id' and did_route='CALLMENU';";
		$rslt=mysql_query($stmt, $link);
		$dids_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($dids_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=3311&did_id=$row[0]\">$row[1] </a></TD><TD> $row[2]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE><BR>\n";

		echo "<B>IVRS USING THIS IVR:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT distinct vm.menu_id,menu_name from vicidial_call_menu vm,vicidial_call_menu_options vmo where vm.menu_id=vmo.menu_id and option_route='CALLMENU' and option_route_value='$menu_id';";
		$rslt=mysql_query($stmt, $link);
		$cms_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($cms_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=3511&menu_id=$row[0]\">$row[0] </a></TD><TD> $row[1]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE>\n";


		if ($LOGdelete_dids > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=5511&menu_id=$menu_id\">DELETE THIS IVR</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=CALLMENUS&stage=$menu_id\">Click here to see Admin chages to this IVR</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}

######################
# ADD=31111 modify remote agents info in the system
######################

if ($ADD==31111)
	{
	if ($LOGmodify_remoteagents==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT a.remote_agent_id,a.user_start,a.number_of_lines,a.server_ip,a.conf_exten,a.status,a.campaign_id,a.closer_campaigns,a.group_id,b.group_name from vicidial_remote_agents a left join vicidial_remote_agent_groups b on a.group_id=b.group_id where a.remote_agent_id='$remote_agent_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$remote_agent_id =	$row[0];
		$user_start =		$row[1];
		$number_of_lines =	$row[2];
		$server_ip =		$row[3];
		$conf_exten =		$row[4];
		$status =			$row[5];
		$campaign_id =		$row[6];
		$remoteagentgroup_id =		$row[8];
		$remoteagentgroup_name =		$row[9];
		
		$stmt="SELECT group_id,group_name from vicidial_remote_agent_groups order by group_id";
		$rslt=mysql_query($stmt, $link);
		$remoteagentgroup_to_print = mysql_num_rows($rslt);
		$remoteagentgroup_list='';
		$o=0;
		while ($remoteagentgroup_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$remoteagentgroup_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}


		echo "<br>MODIFY A REMOTE AGENTS ENTRY: $row[0]<form onSubmit=\"return contentFilter('User ID Start,user_start,2&&&Number of Lines,number_of_lines,2&&&External Extension,conf_exten,2')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=41111>\n";
		echo "<input type=hidden name=remote_agent_id value=\"$row[0]\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=3&user=$user_start\">User ID Start</a>: </td><td align=left><input type=text name=user_start size=6 maxlength=6 value=\"$user_start\"> (numbers only, incremented)$NWB#vicidial_remote_agents-user_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Number of Lines: </td><td align=left><input type=text name=number_of_lines size=3 maxlength=3 value=\"$number_of_lines\"> (numbers only)$NWB#vicidial_remote_agents-number_of_lines$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server IP: </td><td align=left><select size=1 name=server_ip>\n";
		echo "$servers_list";
		echo "<option SELECTED>$row[3]</option>\n";
		echo "</select>$NWB#vicidial_remote_agents-server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>External Extension: </td><td align=left><input type=text name=conf_exten size=20 maxlength=20 value=\"$conf_exten\"> (dial plan number dialed to reach agents)$NWB#vicidial_remote_agents-conf_exten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Status: </td><td align=left><select size=1 name=status><option SELECTED>ACTIVE</option><option>INACTIVE</option><option SELECTED>$status</option></select>$NWB#vicidial_remote_agents-status$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Campaign: </td><td align=left><select size=1 name=campaign_id>\n";
		echo "$campaigns_list";
		echo "<option SELECTED>$campaign_id</option>\n";
		echo "</select>$NWB#vicidial_remote_agents-campaign_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Remote Agent Group: </td><td align=left><select size=1 name=remoteagentgroup_id>\n";
		echo "$remoteagentgroup_list";
		echo "<option value='$remoteagentgroup_id' SELECTED>$remoteagentgroup_id - $remoteagentgroup_name</option>\n";
		echo "</select></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Inbound Groups: </td><td align=left>\n";
		echo "$groups_list";
		echo "$NWB#vicidial_remote_agents-closer_campaigns$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		echo "NOTE: It can take up to 30 seconds for changes submitted on this screen to go live\n";


		if ($LOGdelete_remote_agents > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=51111&remote_agent_id=$remote_agent_id\">DELETE THIS REMOTE AGENT</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=REMOTEAGENTS&stage=$remote_agent_id\">Click here to see Admin chages to this remote agent</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=311111 modify user group info in the system
######################



if ($ADD==311111)
	{
	if ($LOGmodify_usergroups==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT user_group,group_name,allowed_campaigns,qc_allowed_campaigns,qc_allowed_inbound_groups,group_shifts,forced_timeclock_login,shift_enforcement,agent_status_viewable_groups,agent_status_view_time,manager,supervisor from vicidial_user_groups where user_group='$user_group';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$user_group =				$row[0];
		$group_name =				$row[1];
		$GROUP_shifts =				$row[5];
		$forced_timeclock_login =	$row[6];
		$shift_enforcement =		$row[7];
		$VGROUP_vgroups =			$row[8];
		$agent_status_view_time =	$row[9];
		$manager_id = 				$row[10];
		$supervisor_id = 			$row[11];
		
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>MODIFY A USERS GROUP ENTRY<form onSubmit=\"return contentFilter('Group,user_group,1')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=411111>\n";
		echo "<input type=hidden name=OLDuser_group value=\"$user_group\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Group: </td><td align=left><input type=text name=user_group size=15 maxlength=20 value=\"$user_group\"> (no spaces or punctuation)$NWB#vicidial_user_groups-user_group$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Description: </td><td align=left><input type=text name=group_name size=40 maxlength=40 value=\"$group_name\"> (description of group)$NWB#vicidial_user_groups-group_name$NWE</td></tr>\n";
		//echo "<tr bgcolor=#FFFFFF><td align=right>Supervisor: </td><td align=left><select size=10 name=supervisor_select[] multiple style='width:120px'>" . getUserSupervisorHtml($user_group) . "</select></td></tr>\n";
		//echo "<tr bgcolor=#FFFFFF><td align=right>Manager: </td><td align=left ><select size=10 name=manager_select[] multiple style='width:120px' >" . getUserManagerHtml($user_group) . "</select></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right></td><td align=left ></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Manager: </td><td align=left >" . getUserManagerHtml($user_group,8) . "</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right></td><td align=left ></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right></td><td align=left ></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Supervisor: </td><td align=left  >" . getUserManagerHtml($user_group,7) . "</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right></td><td align=left ></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right></td><td align=left ></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>QA: </td><td align=left  >" . getUserManagerHtml($user_group,6) . "</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right></td><td align=left ></td></tr>\n";
		
		if($LOGuser_level>8){
			echo "<tr bgcolor=#FFFFFF><td align=right>Force Timeclock Login: </td><td align=left><select size=1 name=forced_timeclock_login><option SELECTED>N</option><option>Y</option><option>ADMIN_EXEMPT</option><option SELECTED>$forced_timeclock_login</option></select>$NWB#vicidial_user_groups-forced_timeclock_login$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right>Shift Enforcement: </td><td align=left><select size=1 name=shift_enforcement><option SELECTED>OFF</option><option>START</option><option>ALL</option><option>ADMIN_EXEMPT</option><option SELECTED>$shift_enforcement</option></select>$NWB#vicidial_user_groups-shift_enforcement$NWE</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right>Allowed Campaigns: <BR>$NWB#vicidial_user_groups-allowed_campaigns$NWE</td><td align=left>\n";
			echo "$campaigns_list <BR>&nbsp;";
			echo "</td></tr>\n";


			echo "<tr bgcolor=#FFFFFF><td align=right>Group Shifts: <BR>$NWB#vicidial_user_groups-group_shifts$NWE</td><td align=left>\n";
			$stmt="SELECT shift_id,shift_name from vicidial_shifts order by shift_id";
			$rslt=mysql_query($stmt, $link);
			$shifts_to_print = mysql_num_rows($rslt);
			$o=0;
			while ($shifts_to_print > $o)
				{
				$rowx=mysql_fetch_row($rslt);
				$shift_id_value = $rowx[0];
				$shift_name_value = $rowx[1];
				echo "<input type=\"checkbox\" name=\"group_shifts[]\" value=\"$shift_id_value\"";
				$p=0;
				while ($p<1000)
					{
					if (ereg(" $shift_id_value ", $GROUP_shifts))
						{
						echo " CHECKED";
						}
					$p++;
					}
				echo "> <a href=\"$PHP_SELF?ADD=331111111&shift_id=$shift_id_value\">$shift_id_value</a> - $shift_name_value<BR>\n";
				$o++;
				}
			echo " <BR>&nbsp;</td></tr>\n";


			echo "<tr bgcolor=#FFFFFF><td align=right>Agent Status Viewable Groups: <BR>$NWB#vicidial_user_groups-agent_status_viewable_groups$NWE</td><td align=left>\n";
			echo "<input type=\"checkbox\" name=\"agent_status_viewable_groups[]\" value=\"--ALL-GROUPS--\"";
			if (ereg(" --ALL-GROUPS-- ", $VGROUP_vgroups))
				{echo " CHECKED";}
			echo "><B>ALL-GROUPS</B> - All user groups in the system<BR>\n";
			echo "<input type=\"checkbox\" name=\"agent_status_viewable_groups[]\" value=\"--CAMPAIGN-AGENTS--\"";
			if (ereg(" --CAMPAIGN-AGENTS-- ", $VGROUP_vgroups))
				{echo " CHECKED";}
			echo "><B>CAMPAIGN-AGENTS</B> - All users logged into the same campaign as the agent<BR>\n";

			$stmt="SELECT user_group,group_name from vicidial_user_groups order by user_group";
			$rslt=mysql_query($stmt, $link);
			$view_groups_to_print = mysql_num_rows($rslt);
			$o=0;
			while ($view_groups_to_print > $o)
				{
				$rowx=mysql_fetch_row($rslt);
				$vgroups_id_value = $rowx[0];
				$vgroups_name_value = $rowx[1];
				echo "<input type=\"checkbox\" name=\"agent_status_viewable_groups[]\" value=\"$vgroups_id_value\"";
				$p=0;
				while ($p<1000)
					{
					if (ereg(" $vgroups_id_value ", $VGROUP_vgroups))
						{
						echo " CHECKED";
						}
					$p++;
					}
				echo "> <a href=\"$PHP_SELF?ADD=311111&user_group=$vgroups_id_value\">$vgroups_id_value</a> - $vgroups_name_value<BR>\n";
				$o++;
				}
			echo " <BR>&nbsp;</td></tr>\n";

			echo "<tr bgcolor=#FFFFFF><td align=right>Agent Status View Time: </td><td align=left><select size=1 name=agent_status_view_time><option SELECTED>Y</option><option>N</option><option SELECTED>$agent_status_view_time</option></select>$NWB#vicidial_user_groups-agent_status_view_time$NWE</td></tr>\n";
		}
		if ($SSqc_features_active > 0)
			{
			echo "<tr bgcolor=#FFFFFF><td align=right>QC Allowed Campaigns: <BR>$NWB#vicidial_user_groups-qc_allowed_campaigns$NWE</td><td align=left>\n";
			echo "$qc_campaigns_list";
			echo " <BR>&nbsp;</td></tr>\n";
			echo "<tr bgcolor=#FFFFFF><td align=right>QC Allowed Inbound Groups: <BR>$NWB#vicidial_user_groups-qc_allowed_inbound_groups$NWE</td><td align=left>\n";
			echo "$qc_groups_list";
			echo " <BR>&nbsp;</td></tr>\n";
			}

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";


		### list of users in this user group

		$active_confs = 0;
		$stmt="SELECT user,full_name,user_level,active from vicidial_users where user_group='$user_group'";
		$rsltx=mysql_query($stmt, $link);
		$users_to_print = mysql_num_rows($rsltx);

		echo "<center>\n";
		if($LOGuser_level>8){
		echo "<br><b>USERS WITHIN THIS USER GROUP: $users_to_print</b><br>\n";
		echo "<TABLE width=400 cellspacing=3>\n";
		echo "<tr><td>USER</td><td>FULL NAME</td><td>LEVEL</td><td>ACTIVE</td></tr>\n";

		$o=0;
		while ($users_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rsltx);
			$o++;

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor>\n";
			echo "<td><font size=1><a href=\"$PHP_SELF?ADD=3&user=$rowx[0]\">$rowx[0]</a></td>\n";
			echo "<td><font size=1>$rowx[1]</td>\n";
			echo "<td><font size=1>$rowx[2]</td>\n";
			echo "<td><font size=1>$rowx[3]</td>\n";
			echo "</tr>\n";
			}

		echo "</table></center><br>\n";


		echo "<br><br><a href=\"$PHP_SELF?ADD=8111&user_group=$user_group\">Click here to see all CallBack Holds in this user group</a><BR><BR>\n";
		echo "<br><br><a href=\"./timeclock_status.php?user_group=$user_group\">Click here to see the Timeclock Status for this user group</a><BR><BR>\n";

		if ($LOGdelete_user_groups > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=511111&user_group=$user_group\">DELETE THIS USER GROUP</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=USERGROUPS&stage=$user_group\">Click here to see Admin chages to this user group</FONT>\n";
			}
		}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=3111111 modify script info in the system
######################

if ($ADD==3111111)
	{
	if ($LOGmodify_scripts==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT script_id,script_name,script_comments,script_text,active from vicidial_scripts where script_id='$script_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$script_name =		$row[1];
		$script_comments =	$row[2];
		$script_text =		stripslashes($row[3]);
		$active =			$row[4];
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>MODIFY A SCRIPT<form name=scriptForm action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=4111111>\n";
		echo "<input type=hidden name=DB value=\"$DB\">\n";
		echo "<input type=hidden name=script_id value=\"$script_id\">\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Script ID: </td><td align=left><B>$script_id</B>$NWB#vicidial_scripts-script_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Script Name: </td><td align=left><input type=text name=script_name size=40 maxlength=50 value=\"$script_name\"> (title of the script)$NWB#vicidial_scripts-script_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Script Comments: </td><td align=left><input type=text name=script_comments size=50 maxlength=255 value=\"$script_comments\"> $NWB#vicidial_scripts-script_comments$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option SELECTED>Y</option><option>N</option><option selected>$active</option></select>$NWB#vicidial_scripts-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Script Text: <BR><BR><B><a href=\"javascript:openNewWindow('$PHP_SELF?ADD=7111111&script_id=$script_id')\">Preview Script</a></B> </td><td align=left>";
		# BEGIN Insert Field
		echo "<select id=\"selectedField\" name=\"selectedField\">";
		echo "<option>vendor_lead_code</option>";
		echo "<option>source_id</option>";
		echo "<option>list_id</option>";
		echo "<option>gmt_offset_now</option>";
		echo "<option>called_since_last_reset</option>";
		echo "<option>phone_code</option>";
		echo "<option>phone_number</option>";
		echo "<option>title</option>";
		echo "<option>first_name</option>";
		echo "<option>middle_initial</option>";
		echo "<option>last_name</option>";
		echo "<option>address1</option>";
		echo "<option>address2</option>";
		echo "<option>address3</option>";
		echo "<option>city</option>";
		echo "<option>state</option>";
		echo "<option>province</option>";
		echo "<option>postal_code</option>";
		echo "<option>country_code</option>";
		echo "<option>gender</option>";
		echo "<option>date_of_birth</option>";
		echo "<option>alt_phone</option>";
		echo "<option>email</option>";
		echo "<option>security_phrase</option>";
		echo "<option>comments</option>";
		echo "<option>lead_id</option>";
		echo "<option>campaign</option>";
		echo "<option>phone_login</option>";
		echo "<option>group</option>";
		echo "<option>channel_group</option>";
		echo "<option>SQLdate</option>";
		echo "<option>epoch</option>";
		echo "<option>uniqueid</option>";
		echo "<option>customer_zap_channel</option>";
		echo "<option>server_ip</option>";
		echo "<option>SIPexten</option>";
		echo "<option>session_id</option>";
		echo "<option>dialed_number</option>";
		echo "<option>dialed_label</option>";
		echo "<option>rank</option>";
		echo "<option>owner</option>";
		echo "<option>camp_script</option>";
		echo "<option>in_script</option>";
		echo "<option>script_width</option>";
		echo "<option>script_height</option>";
		echo "<option>recording_filename</option>";
		echo "<option>recording_id</option>";
		echo "<option>user_custom_one</option>";
		echo "<option>user_custom_two</option>";
		echo "<option>user_custom_three</option>";
		echo "<option>user_custom_four</option>";
		echo "<option>user_custom_five</option>";
		echo "<option>preset_number_a</option>";
		echo "<option>preset_number_b</option>";
		echo "<option>preset_number_c</option>";
		echo "<option>preset_number_d</option>";
		echo "<option>preset_number_e</option>";
		echo "<option>preset_number_f</option>";
		echo "<option>preset_dtmf_a</option>";
		echo "<option>preset_dtmf_b</option>";
		echo "</select>";
		echo "<input type=\"button\" name=\"insertField\" value=\"Insert\" onClick=\"scriptInsertField();\"><BR>";
		# END Insert Field
		echo "<TEXTAREA NAME=script_text ROWS=20 COLS=50>$script_text</TEXTAREA> $NWB#vicidial_scripts-script_text$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";



		echo "</TABLE><BR><BR>\n";
		echo "<B> CAMPAIGNS USING THIS SCRIPT:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns where campaign_script='$script_id';";
		$rslt=mysql_query($stmt, $link);
		$camps_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($camps_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=31&campaign_id=$row[0]\">$row[0] </a></TD><TD> $row[1]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE><BR><BR>\n";
		echo "<B> IN-GROUPS USING THIS SCRIPT:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT group_id,group_name from vicidial_inbound_groups where ingroup_script='$script_id';";
		$rslt=mysql_query($stmt, $link);
		$camps_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($camps_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=3111&group_id=$row[0]\">$row[0] </a></TD><TD> $row[1]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE><BR><BR>\n";
		echo "<B> LIST OVERRIDES USING THIS SCRIPT:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT list_id,list_name from vicidial_lists where agent_script_override='$script_id';";
		$rslt=mysql_query($stmt, $link);
		$camps_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($camps_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=311&list_id=$row[0]\">$row[0] </a></TD><TD> $row[1]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE>\n";


		if ($LOGdelete_scripts > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=5111111&script_id=$script_id\">DELETE THIS SCRIPT</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=SCRIPTS&stage=$script_id\">Click here to see Admin chages to this script</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=31111111 modify filter info in the system
######################

if ($ADD==31111111)
	{
	if ($LOGmodify_filters==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT lead_filter_id,lead_filter_name,lead_filter_comments,lead_filter_sql from vicidial_lead_filters where lead_filter_id='$lead_filter_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$lead_filter_name =		$row[1];
		$lead_filter_comments =	$row[2];
		$lead_filter_sql =		stripslashes($row[3]);
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>MODIFY A FILTER<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=41111111>\n";
		echo "<input type=hidden name=DB value=\"$DB\">\n";
		echo "<input type=hidden name=lead_filter_id value=\"$lead_filter_id\">\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Filter ID: </td><td align=left><B>$lead_filter_id</B>$NWB#vicidial_lead_filters-lead_filter_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Filter Name: </td><td align=left><input type=text name=lead_filter_name size=40 maxlength=50 value=\"$lead_filter_name\"> (short description of the filter)$NWB#vicidial_lead_filters-lead_filter_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Filter Comments: </td><td align=left><input type=text name=lead_filter_comments size=50 maxlength=255 value=\"$lead_filter_comments\"> $NWB#vicidial_lead_filters-lead_filter_comments$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Filter SQL:</td><td align=left><TEXTAREA NAME=lead_filter_sql ROWS=20 COLS=50>$lead_filter_sql</TEXTAREA> $NWB#vicidial_lead_filters-lead_filter_sql$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center></form>\n";

		##### get campaigns listing for dynamic pulldown
		$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns order by campaign_id";
		$rslt=mysql_query($stmt, $link);
		$campaigns_to_print = mysql_num_rows($rslt);
		$campaigns_list='';

		$o=0;
		while ($campaigns_to_print > $o)
			{
			$rowx=mysql_fetch_row($rslt);
			$campaigns_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}

		echo "<BR><BR>";
		echo "<br>TEST ON CAMPAIGN: <form action=$PHP_SELF method=POST target=\"_blank\">\n";
		echo "<input type=hidden name=lead_filter_id value=\"$lead_filter_id\">\n";
		echo "<input type=hidden name=ADD value=\"73\">\n";
		echo "<select size=1 name=campaign_id>\n";
		echo "$campaigns_list";
		echo "</select>\n";
		echo "<input type=submit name=SUBMIT value=SUBMIT>\n";


		if ($LOGdelete_filters > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=51111111&lead_filter_id=$lead_filter_id\">DELETE THIS FILTER</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=FILTERS&stage=$lead_filter_id\">Click here to see Admin chages to this filter</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=321111111 modify call time definition info in the system
######################

if ($ADD==321111111)
	{
	if ($LOGmodify_call_times==1)
		{
		if ( ($stage=="ADD") and (strlen($state_rule)>0) )
			{
			$stmt="SELECT ct_state_call_times from vicidial_call_times where call_time_id='$call_time_id';";
			$rslt=mysql_query($stmt, $link);
			$row=mysql_fetch_row($rslt);
			$ct_state_call_times = $row[0];

			if (eregi("\|$",$ct_state_call_times))
				{$ct_state_call_times = "$ct_state_call_times$state_rule\|";}
			else
				{$ct_state_call_times = "$ct_state_call_times\|$state_rule\|";}
			$stmt="UPDATE vicidial_call_times set ct_state_call_times='$ct_state_call_times' where call_time_id='$call_time_id';";
			$rslt=mysql_query($stmt, $link);
			echo "State Rule Added: $state_rule<BR>\n";
			}
		if ( ($stage=="REMOVE") and (strlen($state_rule)>0) )
			{
			$stmt="SELECT ct_state_call_times from vicidial_call_times where call_time_id='$call_time_id';";
			$rslt=mysql_query($stmt, $link);
			$row=mysql_fetch_row($rslt);
			$ct_state_call_times = $row[0];

			$ct_state_call_times = eregi_replace("\|$state_rule\|",'|',$ct_state_call_times);
			$stmt="UPDATE vicidial_call_times set ct_state_call_times='$ct_state_call_times' where call_time_id='$call_time_id';";
			$rslt=mysql_query($stmt, $link);
			echo "State Rule Removed: $state_rule<BR>\n";
			}

		$ADD=311111111;
		}
	else
		{
		echo "You are not authorized to view this page. Please go back.";
		}
	}


######################
# ADD=311111111 modify call time definition info in the system
######################

if ($ADD==311111111)
	{
	if ($LOGmodify_call_times==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT call_time_id,call_time_name,call_time_comments,ct_default_start,ct_default_stop,ct_sunday_start,ct_sunday_stop,ct_monday_start,ct_monday_stop,ct_tuesday_start,ct_tuesday_stop,ct_wednesday_start,ct_wednesday_stop,ct_thursday_start,ct_thursday_stop,ct_friday_start,ct_friday_stop,ct_saturday_start,ct_saturday_stop,ct_state_call_times from vicidial_call_times where call_time_id='$call_time_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$call_time_name =		$row[1];
		$call_time_comments =	$row[2];
		$ct_default_start =		$row[3];
		$ct_default_stop =		$row[4];
		$ct_sunday_start =		$row[5];
		$ct_sunday_stop =		$row[6];
		$ct_monday_start =		$row[7];
		$ct_monday_stop =		$row[8];
		$ct_tuesday_start =		$row[9];
		$ct_tuesday_stop =		$row[10];
		$ct_wednesday_start =	$row[11];
		$ct_wednesday_stop =	$row[12];
		$ct_thursday_start =	$row[13];
		$ct_thursday_stop =		$row[14];
		$ct_friday_start =		$row[15];
		$ct_friday_stop =		$row[16];
		$ct_saturday_start =	$row[17];
		$ct_saturday_stop =		$row[18];
		$ct_state_call_times =	$row[19];

		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>MODIFY A CALL TIME<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=411111111>\n";
		echo "<input type=hidden name=DB value=\"$DB\">\n";
		echo "<input type=hidden name=call_time_id value=\"$call_time_id\">\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Call Time ID: </td><td align=left colspan=3><B>$call_time_id</B>$NWB#vicidial_call_times-call_time_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Call Time Name: </td><td align=left colspan=3><input type=text name=call_time_name size=40 maxlength=50 value=\"$call_time_name\"> (short description of the call time)$NWB#vicidial_call_times-call_time_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Call Time Comments: </td><td align=left colspan=3><input type=text name=call_time_comments size=50 maxlength=255 value=\"$call_time_comments\"> $NWB#vicidial_call_times-call_time_comments$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Default Start:</td><td align=left><input type=text name=ct_default_start size=5 maxlength=4 value=\"$ct_default_start\"> </td><td align=right>Default Stop:</td><td align=left><input type=text name=ct_default_stop size=5 maxlength=4 value=\"$ct_default_stop\"> $NWB#vicidial_call_times-ct_default_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Sunday Start:</td><td align=left><input type=text name=ct_sunday_start size=5 maxlength=4 value=\"$ct_sunday_start\"> </td><td align=right>Sunday Stop:</td><td align=left><input type=text name=ct_sunday_stop size=5 maxlength=4 value=\"$ct_sunday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Monday Start:</td><td align=left><input type=text name=ct_monday_start size=5 maxlength=4 value=\"$ct_monday_start\"> </td><td align=right>Monday Stop:</td><td align=left><input type=text name=ct_monday_stop size=5 maxlength=4 value=\"$ct_monday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Tuesday Start:</td><td align=left><input type=text name=ct_tuesday_start size=5 maxlength=4 value=\"$ct_tuesday_start\"> </td><td align=right>Tuesday Stop:</td><td align=left><input type=text name=ct_tuesday_stop size=5 maxlength=4 value=\"$ct_tuesday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Wednesday Start:</td><td align=left><input type=text name=ct_wednesday_start size=5 maxlength=4 value=\"$ct_wednesday_start\"> </td><td align=right>Wednesday Stop:</td><td align=left><input type=text name=ct_wednesday_stop size=5 maxlength=4 value=\"$ct_wednesday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Thursday Start:</td><td align=left><input type=text name=ct_thursday_start size=5 maxlength=4 value=\"$ct_thursday_start\"> </td><td align=right>Thursday Stop:</td><td align=left><input type=text name=ct_thursday_stop size=5 maxlength=4 value=\"$ct_thursday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Friday Start:</td><td align=left><input type=text name=ct_friday_start size=5 maxlength=4 value=\"$ct_friday_start\"> </td><td align=right>Friday Stop:</td><td align=left><input type=text name=ct_friday_stop size=5 maxlength=4 value=\"$ct_friday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Saturday Start:</td><td align=left><input type=text name=ct_saturday_start size=5 maxlength=4 value=\"$ct_saturday_start\"> </td><td align=right>Saturday Stop:</td><td align=left><input type=text name=ct_saturday_stop size=5 maxlength=4 value=\"$ct_saturday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=4><input type=submit name=SUBMIT value=SUBMIT></FORM></td></tr>\n";

		$ct_srs=1;
		$b=0;
		$srs_SQL ='';
		if (strlen($ct_state_call_times)>2)
			{
			$state_rules = explode('|',$ct_state_call_times);
			$ct_srs = ((count($state_rules)) - 1);
			}
		echo "<tr bgcolor=#FFFFFF><td align=center rowspan=$ct_srs>Active State Call Time Definitions for this Record: </td>\n";
		echo "<td align=center colspan=3>&nbsp;</td></tr>\n";
		while($ct_srs >= $b)
			{
			if (strlen($state_rules[$b])>0)
				{
				$stmt="SELECT state_call_time_state,state_call_time_name from vicidial_state_call_times where state_call_time_id='$state_rules[$b]';";
				$rslt=mysql_query($stmt, $link);
				$row=mysql_fetch_row($rslt);
				echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=3111111111&call_time_id=$state_rules[$b]\">$state_rules[$b] </a> - <a href=\"$PHP_SELF?ADD=321111111&call_time_id=$call_time_id&state_rule=$state_rules[$b]&stage=REMOVE\">REMOVE </a></td><td align=left colspan=2>$row[0] - $row[1]</td></tr>\n";
				$srs_SQL .= "'$state_rules[$b]',";
				$srs_state_SQL .= "'$row[0]',";
				}
			$b++;
			}
		if (strlen($srs_SQL)>2)
			{
			$srs_SQL = "$srs_SQL''";
			$srs_state_SQL = "$srs_state_SQL''";
			$srs_SQL = "where state_call_time_id NOT IN($srs_SQL) and state_call_time_state NOT IN($srs_state_SQL)";
			}
		else
			{$srs_SQL='';}
		$stmt="SELECT state_call_time_id,state_call_time_name from vicidial_state_call_times $srs_SQL order by state_call_time_id;";
		$rslt=mysql_query($stmt, $link);
		$sct_to_print = mysql_num_rows($rslt);
		$sct_list='';

		$o=0;
		while ($sct_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$sct_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "<tr bgcolor=#FFFFFF><td align=right><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=321111111>\n";
		echo "<input type=hidden name=stage value=\"ADD\">\n";
		echo "<input type=hidden name=call_time_id value=\"$call_time_id\">\n";
		echo "Add state call time rule: </td><td align=left colspan=2><select size=1 name=state_rule>\n";
		echo "$sct_list";
		echo "</select></td>\n";
		echo "<td align=center colspan=4><input type=submit name=SUBMIT value=SUBMIT></FORM></td></tr>\n";

		echo "</TABLE><BR><BR>\n";
		echo "<B>CAMPAIGNS USING THIS CALL TIME:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT campaign_id,campaign_name from vicidial_campaigns where local_call_time='$call_time_id';";
		$rslt=mysql_query($stmt, $link);
		$camps_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($camps_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=31&campaign_id=$row[0]\">$row[0] </a></TD><TD> $row[1]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE>\n";
		echo "<B>INBOUND GROUPS USING THIS CALL TIME:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT group_id,group_name from vicidial_inbound_groups where call_time_id='$call_time_id';";
		$rslt=mysql_query($stmt, $link);
		$camps_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($camps_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=3111&group_id=$row[0]\">$row[0] </a></TD><TD> $row[1]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE>\n";
		echo "</center><BR><BR>\n";

		if ($LOGdelete_call_times > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=511111111&call_time_id=$call_time_id\">DELETE THIS CALL TIME DEFINITION</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=CALLTIMES&stage=$call_time_id\">Click here to see Admin chages to this call time</FONT>\n";
			}
		}
	else
		{
		echo "You are not authorized to view this page. Please go back.";
		}

	}


######################
# ADD=3111111111 modify state call time definition info in the system
######################

if ($ADD==3111111111)
	{
	if ($LOGmodify_call_times==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT state_call_time_id,state_call_time_state,state_call_time_name,state_call_time_comments,sct_default_start,sct_default_stop,sct_sunday_start,sct_sunday_stop,sct_monday_start,sct_monday_stop,sct_tuesday_start,sct_tuesday_stop,sct_wednesday_start,sct_wednesday_stop,sct_thursday_start,sct_thursday_stop,sct_friday_start,sct_friday_stop,sct_saturday_start,sct_saturday_stop from vicidial_state_call_times where state_call_time_id='$call_time_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$state_call_time_state =$row[1];
		$call_time_name =		$row[2];
		$call_time_comments =	$row[3];
		$ct_default_start =		$row[4];
		$ct_default_stop =		$row[5];
		$ct_sunday_start =		$row[6];
		$ct_sunday_stop =		$row[7];
		$ct_monday_start =		$row[8];
		$ct_monday_stop =		$row[9];
		$ct_tuesday_start =		$row[10];
		$ct_tuesday_stop =		$row[11];
		$ct_wednesday_start =	$row[12];
		$ct_wednesday_stop =	$row[13];
		$ct_thursday_start =	$row[14];
		$ct_thursday_stop =		$row[15];
		$ct_friday_start =		$row[16];
		$ct_friday_stop =		$row[17];
		$ct_saturday_start =	$row[18];
		$ct_saturday_stop =		$row[19];

		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>MODIFY A STATE CALL TIME<form onSubmit=\"return contentFilter('State Call Time State,state_call_time_state,1')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=4111111111>\n";
		echo "<input type=hidden name=DB value=\"$DB\">\n";
		echo "<input type=hidden name=call_time_id value=\"$call_time_id\">\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Call Time ID: </td><td align=left colspan=3><B>$call_time_id</B>$NWB#vicidial_call_times-call_time_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>State Call Time State: </td><td align=left colspan=3><input type=text name=state_call_time_state size=4 maxlength=2 value=\"$state_call_time_state\"> $NWB#vicidial_call_times-state_call_time_state$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>State Call Time Name: </td><td align=left colspan=3><input type=text name=call_time_name size=40 maxlength=50 value=\"$call_time_name\"> (short description of the call time)$NWB#vicidial_call_times-call_time_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>State Call Time Comments: </td><td align=left colspan=3><input type=text name=call_time_comments size=50 maxlength=255 value=\"$call_time_comments\"> $NWB#vicidial_call_times-call_time_comments$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Default Start:</td><td align=left><input type=text name=ct_default_start size=5 maxlength=4 value=\"$ct_default_start\"> </td><td align=right>Default Stop:</td><td align=left><input type=text name=ct_default_stop size=5 maxlength=4 value=\"$ct_default_stop\"> $NWB#vicidial_call_times-ct_default_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Sunday Start:</td><td align=left><input type=text name=ct_sunday_start size=5 maxlength=4 value=\"$ct_sunday_start\"> </td><td align=right>Sunday Stop:</td><td align=left><input type=text name=ct_sunday_stop size=5 maxlength=4 value=\"$ct_sunday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Monday Start:</td><td align=left><input type=text name=ct_monday_start size=5 maxlength=4 value=\"$ct_monday_start\"> </td><td align=right>Monday Stop:</td><td align=left><input type=text name=ct_monday_stop size=5 maxlength=4 value=\"$ct_monday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Tuesday Start:</td><td align=left><input type=text name=ct_tuesday_start size=5 maxlength=4 value=\"$ct_tuesday_start\"> </td><td align=right>Tuesday Stop:</td><td align=left><input type=text name=ct_tuesday_stop size=5 maxlength=4 value=\"$ct_tuesday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Wednesday Start:</td><td align=left><input type=text name=ct_wednesday_start size=5 maxlength=4 value=\"$ct_wednesday_start\"> </td><td align=right>Wednesday Stop:</td><td align=left><input type=text name=ct_wednesday_stop size=5 maxlength=4 value=\"$ct_wednesday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Thursday Start:</td><td align=left><input type=text name=ct_thursday_start size=5 maxlength=4 value=\"$ct_thursday_start\"> </td><td align=right>Thursday Stop:</td><td align=left><input type=text name=ct_thursday_stop size=5 maxlength=4 value=\"$ct_thursday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Friday Start:</td><td align=left><input type=text name=ct_friday_start size=5 maxlength=4 value=\"$ct_friday_start\"> </td><td align=right>Friday Stop:</td><td align=left><input type=text name=ct_friday_stop size=5 maxlength=4 value=\"$ct_friday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Saturday Start:</td><td align=left><input type=text name=ct_saturday_start size=5 maxlength=4 value=\"$ct_saturday_start\"> </td><td align=right>Saturday Stop:</td><td align=left><input type=text name=ct_saturday_stop size=5 maxlength=4 value=\"$ct_saturday_stop\"> $NWB#vicidial_call_times-ct_sunday_start$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=4><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE><BR><BR>\n";
		echo "<B>CALL TIMES USING THIS STATE CALL TIME:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT call_time_id,call_time_name from vicidial_call_times where ct_state_call_times LIKE \"%|$call_time_id|%\";";
		$rslt=mysql_query($stmt, $link);
		$camps_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($camps_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=311111111&call_time_id=$row[0]\">$row[0] </a></TD><TD> $row[1]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE>\n";
		echo "</center><BR><BR>\n";

		if ($LOGdelete_call_times > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=5111111111&call_time_id=$call_time_id\">DELETE THIS STATE CALL TIME DEFINITION</a>\n";
			}
		}
	else
		{
		echo "You are not authorized to view this page. Please go back.";
		}
	}


######################
# ADD=331111111 modify shift definition info in the system
######################

if ($ADD==331111111)
	{
	if ($LOGmodify_call_times==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT shift_id,shift_name,shift_start_time,shift_length,shift_weekdays from vicidial_shifts where shift_id='$shift_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$shift_name =		$row[1];
		$shift_start_time =	$row[2];
		$shift_length =		$row[3];
		$shift_weekdays =	$row[4];

		$shift_start_hour = substr($shift_start_time,0,2);
		$shift_start_min = substr($shift_start_time,2,2);
		$shift_length_hour = substr($shift_length,0,2);
		$shift_length_min = substr($shift_length,3,2);
		$shift_end_hour = ($shift_start_hour + $shift_length_hour);
		$shift_end_min = ($shift_start_min + $shift_length_min);
		if ($shift_end_min >=60) 
			{
			$shift_end_min = ($shift_end_min - 60);
			$shift_end_hour++;
			}
		if ($shift_end_hour >=24) 
			{
			$shift_end_hour = ($shift_end_hour - 24);
			}
		$shift_end_hour = sprintf("%02s", $shift_end_hour);	
		$shift_end_min = sprintf("%02s", $shift_end_min);	
		$shift_end = "$shift_end_hour$shift_end_min";

		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br>MODIFY A SHIFT<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=431111111>\n";
		echo "<input type=hidden name=DB value=\"$DB\">\n";
		echo "<input type=hidden name=shift_id value=\"$shift_id\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Shift ID: </td><td align=left><B>$shift_id</B></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Shift Name: </td><td align=left><input type=text name=shift_name size=50 maxlength=50 value=\"$shift_name\"> (short description of the shift)$NWB#vicidial_shifts-shift_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Shift Start Time: </td><td align=left><input type=text name=shift_start_time size=5 maxlength=4 id=shift_start_time value=\"$shift_start_time\">\n";
		echo " &nbsp; Shift End Time: <input type=text name=shift_end_time size=5 maxlength=4 id=shift_end_time value=\"$shift_end\">\n";
		echo "<input type=button name=shift_calc value=\"Calculate Shift Length\" onClick=\"shift_time();\"> $NWB#vicidial_shifts-shift_start_time$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Shift Length: </td><td align=left><input type=text name=shift_length id=shift_length size=6 maxlength=5 value=\"$shift_length\"> $NWB#vicidial_shifts-shift_length$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Shift Weekdays: <BR>$NWB#vicidial_shifts-shift_weekdays$NWE</td><td align=left>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"0\"";
			if (ereg('0',$shift_weekdays)) {echo " CHECKED";}
		echo ">Sunday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"1\"";
			if (ereg('1',$shift_weekdays)) {echo " CHECKED";}
		echo ">Monday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"2\"";
			if (ereg('2',$shift_weekdays)) {echo " CHECKED";}
		echo ">Tuesday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"3\"";
			if (ereg('3',$shift_weekdays)) {echo " CHECKED";}
		echo ">Wednesday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"4\"";
			if (ereg('4',$shift_weekdays)) {echo " CHECKED";}
		echo ">Thursday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"5\"";
			if (ereg('5',$shift_weekdays)) {echo " CHECKED";}
		echo ">Friday<BR>\n";
		echo "<input type=\"checkbox\" name=\"shift_weekdays[]\" value=\"6\"";
			if (ereg('6',$shift_weekdays)) {echo " CHECKED";}
		echo ">Saturday<BR>\n";
		echo "</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=SUBMIT value=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";

		echo "</TABLE><BR><BR>\n";
		echo "<B>USER GROUPS USING THIS SHIFT:</B><BR>\n";
		echo "<TABLE>\n";

		$stmt="SELECT user_group,group_name from vicidial_user_groups where group_shifts LIKE\"% $shift_id %\";";
		$rslt=mysql_query($stmt, $link);
		$camps_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($camps_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			echo "<TR><TD><a href=\"$PHP_SELF?ADD=311111&user_group=$row[0]\">$row[0] </a></TD><TD> $row[1]<BR></TD></TR>\n";
			$o++;
			}

		echo "</TABLE>\n";
		echo "</center><BR><BR>\n";

		if ($LOGdelete_call_times > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=531111111&shift_id=$shift_id\">DELETE THIS SHIFT DEFINITION</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=SHIFTS&stage=$shift_id\">Click here to see Admin chages to this shift</FONT>\n";
			}
		}
	else
		{
		echo "You are not authorized to view this page. Please go back.";
		}

	}


######################
# ADD=31111111111 modify phone record in the system
######################

if ($ADD==31111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT extension,dialplan_number,voicemail_id,phone_ip,computer_ip,server_ip,login,pass,status,active,phone_type,fullname,company,picture,messages,old_messages,protocol,local_gmt,ASTmgrUSERNAME,ASTmgrSECRET,login_user,login_pass,login_campaign,park_on_extension,conf_on_extension,VICIDIAL_park_on_extension,VICIDIAL_park_on_filename,monitor_prefix,recording_exten,voicemail_exten,voicemail_dump_exten,ext_context,dtmf_send_extension,call_out_number_group,client_browser,install_directory,local_web_callerID_URL,VICIDIAL_web_URL,AGI_call_logging_enabled,user_switching_enabled,conferencing_enabled,admin_hangup_enabled,admin_hijack_enabled,admin_monitor_enabled,call_parking_enabled,updater_check_enabled,AFLogging_enabled,QUEUE_ACTION_enabled,CallerID_popup_enabled,voicemail_button_enabled,enable_fast_refresh,fast_refresh_rate,enable_persistant_mysql,auto_dial_next_number,VDstop_rec_after_each_call,DBX_server,DBX_database,DBX_user,DBX_pass,DBX_port,DBY_server,DBY_database,DBY_user,DBY_pass,DBY_port,outbound_cid,enable_sipsak_messages,email,template_id,conf_override,phone_context,phone_ring_timeout,conf_secret,delete_vm_after_email from phones where extension='$extension' and server_ip='$server_ip';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);

		echo "<br>MODIFY A PHONE RECORD: $row[1]<form onSubmit=\"return contentFilter('Phone extension,extension,2&&&Dial Plan Number,dialplan_number,2&&&Voicemail Box,voicemail_id,2&&&Outbound CallerID,outbound_cid,2')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=41111111111>\n";
		echo "<input type=hidden name=old_extension value=\"$row[0]\">\n";
		echo "<input type=hidden name=old_server_ip value=\"$row[5]\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phone extension: </td><td align=left><input type=text name=extension size=20 maxlength=100 value=\"$row[0]\">$NWB#phones-extension$NWE <i>(Agent Screen Phone Login)</i></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Dial Plan Number: </td><td align=left><input type=text name=dialplan_number size=15 maxlength=20 value=\"$row[1]\"> (digits only)$NWB#phones-dialplan_number$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Voicemail Box: </td><td align=left><input type=text name=voicemail_id size=10 maxlength=10 value=\"$row[2]\"> (digits only)$NWB#phones-voicemail_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Outbound CallerID: </td><td align=left><input type=text name=outbound_cid size=10 maxlength=20 value=\"$row[65]\"> (digits only)$NWB#phones-outbound_cid$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phone IP address: </td><td align=left><input type=text name=phone_ip size=20 maxlength=15 value=\"$row[3]\"> (optional)$NWB#phones-phone_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Computer IP address: </td><td align=left><input type=text name=computer_ip size=20 maxlength=15 value=\"$row[4]\"> (optional)$NWB#phones-computer_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=311111111111&server_ip=$row[5]\">Server IP</a>: </td><td align=left><select size=1 name=server_ip>\n";

		echo "$servers_list";
		echo "<option SELECTED>$row[5]</option>\n";
		echo "</select>$NWB#phones-server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Login: </td><td align=left><input type=text name=login size=10 maxlength=10 value=\"$row[6]\">$NWB#phones-login$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Password: </td><td align=left><input type=text name=pass size=10 maxlength=10 value=\"$row[7]\">$NWB#phones-pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Status: </td><td align=left><select size=1 name=status><option>ACTIVE</option><option>SUSPENDED</option><option>CLOSED</option><option>PENDING</option><option>ADMIN</option><option selected>$row[8]</option></select>$NWB#phones-status$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active Account: </td><td align=left><select size=1 name=active><option>Y</option><option>N</option><option selected>$row[9]</option></select>$NWB#phones-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phone Type: </td><td align=left><input type=text name=phone_type size=20 maxlength=50 value=\"$row[10]\">$NWB#phones-phone_type$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Full Name: </td><td align=left><input type=text name=fullname size=20 maxlength=50 value=\"$row[11]\">$NWB#phones-fullname$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Email: </td><td align=left><input type=text name=email size=50 maxlength=100 value=\"$row[67]\"> $NWB#phones-email$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Delete Voicemail After Email: </td><td align=left><select size=1 name=delete_vm_after_email><option>Y</option><option>N</option><option selected>$row[73]</option></select>$NWB#phones-delete_vm_after_email$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Company: </td><td align=left><input type=text name=company size=10 maxlength=10 value=\"$row[12]\">$NWB#phones-company$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Picture: </td><td align=left><input type=text name=picture size=20 maxlength=19 value=\"$row[13]\">$NWB#phones-picture$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>New Messages: </td><td align=left><b>$row[14]</b>$NWB#phones-messages$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Old Messages: </td><td align=left><b>$row[15]</b>$NWB#phones-old_messages$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Client Protocol: </td><td align=left><select size=1 name=protocol><option>SIP</option><option>Zap</option><option>IAX2</option><option>EXTERNAL</option><option selected>$row[16]</option></select>$NWB#phones-protocol$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Local GMT: </td><td align=left><select size=1 name=local_gmt><option>12.75</option><option>12.00</option><option>11.00</option><option>10.00</option><option>9.50</option><option>9.00</option><option>8.00</option><option>7.00</option><option>6.50</option><option>6.00</option><option>5.75</option><option>5.50</option><option>5.00</option><option>4.50</option><option>4.00</option><option>3.50</option><option>3.00</option><option>2.00</option><option>1.00</option><option>0.00</option><option>-1.00</option><option>-2.00</option><option>-3.00</option><option>-3.50</option><option>-4.00</option><option>-5.00</option><option>-6.00</option><option>-7.00</option><option>-8.00</option><option>-9.00</option><option>-10.00</option><option>-11.00</option><option>-12.00</option><option selected>$row[17]</option></select> (Do NOT Adjust for DST)$NWB#phones-local_gmt$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phone Ring Timeout: </td><td align=left><input type=text name=phone_ring_timeout size=4 maxlength=5 value=\"$row[71]\">$NWB#phones-phone_ring_timeout$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Manager Login: </td><td align=left><input type=text name=ASTmgrUSERNAME size=20 maxlength=20 value=\"$row[18]\">$NWB#phones-ASTmgrUSERNAME$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Manager Secret: </td><td align=left><input type=text name=ASTmgrSECRET size=20 maxlength=20 value=\"$row[19]\">$NWB#phones-ASTmgrSECRET$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Default User: </td><td align=left><input type=text name=login_user size=20 maxlength=20 value=\"$row[20]\">$NWB#phones-login_user$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Default Pass: </td><td align=left><input type=text name=login_pass size=20 maxlength=20 value=\"$row[21]\">$NWB#phones-login_pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Default Campaign: </td><td align=left><input type=text name=login_campaign size=10 maxlength=10 value=\"$row[22]\">$NWB#phones-login_campaign$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Park Exten: </td><td align=left><input type=text name=park_on_extension size=10 maxlength=10 value=\"$row[23]\">$NWB#phones-park_on_extension$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Conf Exten: </td><td align=left><input type=text name=conf_on_extension size=10 maxlength=10 value=\"$row[24]\">$NWB#phones-conf_on_extension$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Park Exten: </td><td align=left><input type=text name=VICIDIAL_park_on_extension size=10 maxlength=10 value=\"$row[25]\">$NWB#phones-VICIDIAL_park_on_extension$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Park File: </td><td align=left><input type=text name=VICIDIAL_park_on_filename size=10 maxlength=10 value=\"$row[26]\">$NWB#phones-VICIDIAL_park_on_filename$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Monitor Prefix: </td><td align=left><input type=text name=monitor_prefix size=10 maxlength=10 value=\"$row[27]\">$NWB#phones-monitor_prefix$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Recording Exten: </td><td align=left><input type=text name=recording_exten size=10 maxlength=10 value=\"$row[28]\">$NWB#phones-recording_exten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>VMailMain Exten: </td><td align=left><input type=text name=voicemail_exten size=10 maxlength=10 value=\"$row[29]\">$NWB#phones-voicemail_exten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>VMailDump Exten: </td><td align=left><input type=text name=voicemail_dump_exten size=20 maxlength=20 value=\"$row[30]\">$NWB#phones-voicemail_dump_exten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Exten Context: </td><td align=left><input type=text name=ext_context size=20 maxlength=20 value=\"$row[31]\">$NWB#phones-ext_context$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phone Context: </td><td align=left><input type=text name=phone_context size=20 maxlength=20 value=\"$row[70]\">$NWB#phones-phone_context$NWE</td></tr>\n";
		echo "<tr bgcolor=#CCFFFF><td align=right>Conf File Secret: </td><td align=left><input type=text name=conf_secret size=20 maxlength=20 value=\"$row[72]\">$NWB#phones-conf_secret$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DTMFSend Channel: </td><td align=left><input type=text name=dtmf_send_extension size=40 maxlength=100 value=\"$row[32]\">$NWB#phones-dtmf_send_extension$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Outbound Call Group: </td><td align=left><input type=text name=call_out_number_group size=40 maxlength=100 value=\"$row[33]\">$NWB#phones-call_out_number_group$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Browser Location: </td><td align=left><input type=text name=client_browser size=40 maxlength=100 value=\"$row[34]\">$NWB#phones-client_browser$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Install Directory: </td><td align=left><input type=text name=install_directory size=40 maxlength=100 value=\"$row[35]\">$NWB#phones-install_directory$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CallerID URL: </td><td align=left><input type=text name=local_web_callerID_URL size=40 maxlength=255 value=\"$row[36]\">$NWB#phones-local_web_callerID_URL$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Default URL: </td><td align=left><input type=text name=VICIDIAL_web_URL size=40 maxlength=255 value=\"$row[37]\">$NWB#phones-VICIDIAL_web_URL$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Call Logging: </td><td align=left><select size=1 name=AGI_call_logging_enabled><option>1</option><option>0</option><option selected>$row[38]</option></select>$NWB#phones-AGI_call_logging_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>User Switching: </td><td align=left><select size=1 name=user_switching_enabled><option>1</option><option>0</option><option selected>$row[39]</option></select>$NWB#phones-user_switching_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Conferencing: </td><td align=left><select size=1 name=conferencing_enabled><option>1</option><option>0</option><option selected>$row[40]</option></select>$NWB#phones-conferencing_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Admin Hang Up: </td><td align=left><select size=1 name=admin_hangup_enabled><option>1</option><option>0</option><option selected>$row[41]</option></select>$NWB#phones-admin_hangup_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Admin Hijack: </td><td align=left><select size=1 name=admin_hijack_enabled><option>1</option><option>0</option><option selected>$row[42]</option></select>$NWB#phones-admin_hijack_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Admin Monitor: </td><td align=left><select size=1 name=admin_monitor_enabled><option>1</option><option>0</option><option selected>$row[43]</option></select>$NWB#phones-admin_monitor_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Call Park: </td><td align=left><select size=1 name=call_parking_enabled><option>1</option><option>0</option><option selected>$row[44]</option></select>$NWB#phones-call_parking_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Updater Check: </td><td align=left><select size=1 name=updater_check_enabled><option>1</option><option>0</option><option selected>$row[45]</option></select>$NWB#phones-updater_check_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>AF Logging: </td><td align=left><select size=1 name=AFLogging_enabled><option>1</option><option>0</option><option selected>$row[46]</option></select>$NWB#phones-AFLogging_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Queue Enabled: </td><td align=left><select size=1 name=QUEUE_ACTION_enabled><option>1</option><option>0</option><option selected>$row[47]</option></select>$NWB#phones-QUEUE_ACTION_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CallerID Popup: </td><td align=left><select size=1 name=CallerID_popup_enabled><option>1</option><option>0</option><option selected>$row[48]</option></select>$NWB#phones-CallerID_popup_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>VMail Button: </td><td align=left><select size=1 name=voicemail_button_enabled><option>1</option><option>0</option><option selected>$row[49]</option></select>$NWB#phones-voicemail_button_enabled$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Fast Refresh: </td><td align=left><select size=1 name=enable_fast_refresh><option>1</option><option>0</option><option selected>$row[50]</option></select>$NWB#phones-enable_fast_refresh$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Fast Refresh Rate: </td><td align=left><input type=text size=5 name=fast_refresh_rate value=\"$row[51]\">(in ms)$NWB#phones-fast_refresh_rate$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Persistant MySQL: </td><td align=left><select size=1 name=enable_persistant_mysql><option>1</option><option>0</option><option selected>$row[52]</option></select>$NWB#phones-enable_persistant_mysql$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Auto Dial Next Number: </td><td align=left><select size=1 name=auto_dial_next_number><option>1</option><option>0</option><option selected>$row[53]</option></select>$NWB#phones-auto_dial_next_number$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Stop Rec after each call: </td><td align=left><select size=1 name=VDstop_rec_after_each_call><option>1</option><option>0</option><option selected>$row[54]</option></select>$NWB#phones-VDstop_rec_after_each_call$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Enable SIPSAK Messages: </td><td align=left><select size=1 name=enable_sipsak_messages><option>1</option><option>0</option><option selected>$row[66]</option></select>$NWB#phones-enable_sipsak_messages$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DBX Server: </td><td align=left><input type=text name=DBX_server size=15 maxlength=15 value=\"$row[55]\"> (Primary DB Server)$NWB#phones-DBX_server$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DBX Database: </td><td align=left><input type=text name=DBX_database size=15 maxlength=15 value=\"$row[56]\"> (Primary Server Database)$NWB#phones-DBX_database$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DBX User: </td><td align=left><input type=text name=DBX_user size=15 maxlength=15 value=\"$row[57]\"> (Primary DB Login)$NWB#phones-DBX_user$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DBX Pass: </td><td align=left><input type=text name=DBX_pass size=15 maxlength=15 value=\"$row[58]\"> (Primary DB Secret)$NWB#phones-DBX_pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DBX Port: </td><td align=left><input type=text name=DBX_port size=6 maxlength=6 value=\"$row[59]\"> (Primary DB Port)$NWB#phones-DBX_port$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DBY Server: </td><td align=left><input type=text name=DBY_server size=15 maxlength=15 value=\"$row[60]\"> (Secondary DB Server)$NWB#phones-DBY_server$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DBY Database: </td><td align=left><input type=text name=DBY_database size=15 maxlength=15 value=\"$row[61]\"> (Secondary Server Database)$NWB#phones-DBY_database$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DBY User: </td><td align=left><input type=text name=DBY_user size=15 maxlength=15 value=\"$row[62]\"> (Secondary DB Login)$NWB#phones-DBY_user$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DBY Pass: </td><td align=left><input type=text name=DBY_pass size=15 maxlength=15 value=\"$row[63]\"> (Secondary DB Secret)$NWB#phones-DBY_pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DBY Port: </td><td align=left><input type=text name=DBY_port size=6 maxlength=6 value=\"$row[64]\"> (Secondary DB Port)$NWB#phones-DBY_port$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=331111111111&template_id=$row[68]\">Template ID</a>: </td><td align=left><select size=1 name=template_id>\n";
		$stmt="SELECT template_id,template_name from vicidial_conf_templates order by template_id";
		$rslt=mysql_query($stmt, $link);
		$templates_to_print = mysql_num_rows($rslt);
		$templates_list='<option SELECTED>--NONE--</option>';
		$o=0;
		while ($templates_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$templates_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "$templates_list";
		echo "<option SELECTED>$row[68]</option>\n";
		echo "</select>$NWB#phones-template_id$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Conf Override: </td><td align=left><TEXTAREA NAME=conf_override ROWS=10 COLS=70>$row[69]</TEXTAREA> $NWB#phones-conf_override$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";

		echo "<br><br><a href=\"./phone_stats.php?extension=$row[0]&server_ip=$row[5]\">Click here for phone stats</a>\n";

		if ($LOGast_delete_phones > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=51111111111&extension=$extension&server_ip=$server_ip\">DELETE THIS PHONE</a>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=32111111111 modify phone alias record in the system
######################

if ($ADD==32111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT alias_id,alias_name,logins_list from phones_alias where alias_id='$alias_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);

		echo "<br>MODIFY A PHONE ALIAS RECORD: $row[0]<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=42111111111>\n";
		echo "<input type=hidden name=alias_id value=\"$row[0]\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Alias ID: </td><td align=left><B>$row[0]</B> $NWB#phones-alias_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Alias Name: </td><td align=left><input type=text name=alias_name size=30 maxlength=50 value=\"$row[1]\"> $NWB#phones-alias_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Phones Logins List: </td><td align=left><input type=text name=logins_list size=50 maxlength=255 value=\"$row[2]\"> (comma separated)$NWB#phones-logins_list$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";


		### list of phones in this phones alias
		$phone_alias_SQL = ereg_replace(',',"','",$row[2]);
	 
		echo "<center>\n";
		echo "<br><b>PHONES WITHIN THIS PHONES ALIAS:</b><br>\n";
		echo "<TABLE width=600 cellspacing=3>\n";
		echo "<tr><td>LOGIN</td><td>EXTENSION</td><td>SERVER</td><td>PROTOCOL</td><td>IP</td></tr>\n";

			$stmt="SELECT login,extension,server_ip,protocol,phone_ip from phones where login IN ('$phone_alias_SQL');";
			if ($DB) {echo "|$stmt|";}
			$rsltx=mysql_query($stmt, $link);
			$lists_to_print = mysql_num_rows($rsltx);

			$o=0;
			while ($lists_to_print > $o) {
				$rowx=mysql_fetch_row($rsltx);
				$o++;

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31111111111&extension=$rowx[1]&server_ip=$rowx[2]\">$rowx[0]</a></td><td><font size=1>$rowx[1]</td><td><font size=1>$rowx[2]</td><td><font size=1>$rowx[3]</td><td><font size=1>$rowx[4]</td></tr>\n";
			}

		echo "</table></center><br>\n";

		if ($LOGast_delete_phones > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=52111111111&alias_id=$row[0]\">DELETE THIS PHONE ALIAS</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=PHONEALIASES&stage=$alias_id\">Click here to see Admin chages to this phone alias</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=33111111111 modify group alias record in the system
######################

if ($ADD==33111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT group_alias_id,group_alias_name,caller_id_number,caller_id_name,active from groups_alias where group_alias_id='$group_alias_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);

		echo "<br>MODIFY A GROUP ALIAS RECORD: $row[0]<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=43111111111>\n";
		echo "<input type=hidden name=group_alias_id value=\"$row[0]\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Group Alias ID: </td><td align=left><B>$row[0]</B> $NWB#phones-group_alias_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Group Alias Name: </td><td align=left><input type=text name=group_alias_name size=30 maxlength=50 value=\"$row[1]\"> $NWB#phones-group_alias_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CallerID Number: </td><td align=left><input type=text name=caller_id_number size=20 maxlength=20 value=\"$row[2]\"> $NWB#phones-caller_id_number$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CallerID Name: </td><td align=left><input type=text name=caller_id_name size=20 maxlength=20 value=\"$row[3]\"> $NWB#phones-caller_id_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option>N</option><option selected>$row[4]</option></select></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";


		if ($LOGast_delete_phones > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=53111111111&group_alias_id=$row[0]\">DELETE THIS GROUP ALIAS</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=GROUPALIASES&stage=$group_alias_id\">Click here to see Admin chages to this group alias</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=311111111111 modify server record in the system
######################

if ($ADD==311111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT server_id,server_description,server_ip,active,asterisk_version,max_vicidial_trunks,telnet_host,telnet_port,ASTmgrUSERNAME,ASTmgrSECRET,ASTmgrUSERNAMEupdate,ASTmgrUSERNAMElisten,ASTmgrUSERNAMEsend,local_gmt,voicemail_dump_exten,answer_transfer_agent,ext_context,sys_perf_log,vd_server_logs,agi_output,vicidial_balance_active,balance_trunks_offlimits,recording_web_link,alt_server_ip,active_asterisk_server,generate_vicidial_conf,rebuild_conf_files,outbound_calls_per_second,sysload,channels_total,cpu_idle_percent,disk_usage,sounds_update,vicidial_recording_limit,carrier_logging_active,vicidial_balance_rank,rebuild_music_on_hold,active_agent_login_server,conf_secret from servers where server_id='$server_id' or server_ip='$server_ip';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$server_id =					$row[0];
		$server_description =			$row[1];
		$server_ip =					$row[2];
		$active =						$row[3];
		$asterisk_version =				$row[4];
		$max_vicidial_trunks =			$row[5];
		$telnet_host =					$row[6];
		$telnet_port =					$row[7];
		$ASTmgrUSERNAME =				$row[8];
		$ASTmgrSECRET =					$row[9];
		$ASTmgrUSERNAMEupdate =			$row[10];
		$ASTmgrUSERNAMElisten =			$row[11];
		$ASTmgrUSERNAMEsend =			$row[12];
		$local_gmt =					$row[13];
		$voicemail_dump_exten =			$row[14];
		$answer_transfer_agent =		$row[15];
		$ext_context =					$row[16];
		$sys_perf_log =					$row[17];
		$vd_server_logs =				$row[18];
		$agi_output =					$row[19];
		$vicidial_balance_active =		$row[20];
		$balance_trunks_offlimits =		$row[21];
		$recording_web_link =			$row[22];
		$alt_server_ip =				$row[23];
		$active_asterisk_server =		$row[24];
		$generate_vicidial_conf =		$row[25];
		$rebuild_conf_files =			$row[26];
		$outbound_calls_per_second =	$row[27];
		$sysload =						$row[28];
		$channels_total =				$row[29];
		$cpu_idle_percent =				$row[30];
		$disk_usage =					$row[31];
		$sounds_update =				$row[32];
		$vicidial_recording_limit =		$row[33];
		$carrier_logging_active =		$row[34];
		$vicidial_balance_rank =		$row[35];
		$rebuild_music_on_hold =		$row[36];
		$active_agent_login_server =	$row[37];
		$conf_secret =					$row[38];

		$cpu = (100 - $cpu_idle_percent);
		$disk_usage = preg_replace("/ /"," - ",$disk_usage);
		$disk_usage = preg_replace("/\|/","% &nbsp; &nbsp; ",$disk_usage);

		echo "<br>MODIFY A SERVER RECORD: $row[0]<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=411111111111>\n";
		echo "<input type=hidden name=old_server_id value=\"$server_id\">\n";
		echo "<input type=hidden name=old_server_ip value=\"$server_ip\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server ID: </td><td align=left><input type=text name=server_id size=10 maxlength=10 value=\"$server_id\">$NWB#servers-server_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server Description: </td><td align=left><input type=text name=server_description size=30 maxlength=255 value=\"$server_description\">$NWB#servers-server_description$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server IP Address: </td><td align=left><input type=text name=server_ip size=20 maxlength=15 value=\"$server_ip\">$NWB#servers-server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option>N</option><option selected>$active</option></select>$NWB#servers-active$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>System Load: </td><td align=left>$sysload - $cpu% &nbsp; $NWB#servers-sysload$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Live Channels: </td><td align=left>$channels_total &nbsp; $NWB#servers-channels_total$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Disk Usage: </td><td align=left>$disk_usage &nbsp; $NWB#servers-disk_usage$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Asterisk Version: </td><td align=left><input type=text name=asterisk_version size=20 maxlength=20 value=\"$asterisk_version\">$NWB#servers-asterisk_version$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Max CCMS Trunks: </td><td align=left><input type=text name=max_vicidial_trunks size=5 maxlength=4 value=\"$max_vicidial_trunks\">$NWB#servers-max_vicidial_trunks$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Max Calls per Second: </td><td align=left><input type=text name=outbound_calls_per_second size=5 maxlength=4 value=\"$outbound_calls_per_second\">$NWB#servers-outbound_calls_per_second$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Balance Dialing: </td><td align=left><select size=1 name=vicidial_balance_active><option>Y</option><option>N</option><option selected>$vicidial_balance_active</option></select>$NWB#servers-vicidial_balance_active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Balance Rank: </td><td align=left><input type=text name=vicidial_balance_rank size=4 maxlength=2 value=\"$vicidial_balance_rank\">$NWB#servers-vicidial_balance_rank$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Balance Offlimits: </td><td align=left><input type=text name=balance_trunks_offlimits size=5 maxlength=4 value=\"$balance_trunks_offlimits\">$NWB#servers-balance_trunks_offlimits$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Telnet Host: </td><td align=left><input type=text name=telnet_host size=20 maxlength=20 value=\"$telnet_host\">$NWB#servers-telnet_host$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Telnet Port: </td><td align=left><input type=text name=telnet_port size=6 maxlength=5 value=\"$telnet_port\">$NWB#servers-telnet_port$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Manager User: </td><td align=left><input type=text name=ASTmgrUSERNAME size=20 maxlength=20 value=\"$ASTmgrUSERNAME\">$NWB#servers-ASTmgrUSERNAME$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Manager Secret: </td><td align=left><input type=text name=ASTmgrSECRET size=20 maxlength=20 value=\"$ASTmgrSECRET\">$NWB#servers-ASTmgrSECRET$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Manager Update User: </td><td align=left><input type=text name=ASTmgrUSERNAMEupdate size=20 maxlength=20 value=\"$ASTmgrUSERNAMEupdate\">$NWB#servers-ASTmgrUSERNAMEupdate$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Manager Listen User: </td><td align=left><input type=text name=ASTmgrUSERNAMElisten size=20 maxlength=20 value=\"$ASTmgrUSERNAMElisten\">$NWB#servers-ASTmgrUSERNAMElisten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Manager Send User: </td><td align=left><input type=text name=ASTmgrUSERNAMEsend size=20 maxlength=20 value=\"$ASTmgrUSERNAMEsend\">$NWB#servers-ASTmgrUSERNAMEsend$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Conf File Secret: </td><td align=left><input type=text name=conf_secret size=20 maxlength=20 value=\"$conf_secret\">$NWB#servers-conf_secret$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Local GMT: </td><td align=left><select size=1 name=local_gmt><option>12.75</option><option>12.00</option><option>11.00</option><option>10.00</option><option>9.50</option><option>9.00</option><option>8.00</option><option>7.00</option><option>6.50</option><option>6.00</option><option>5.75</option><option>5.50</option><option>5.00</option><option>4.50</option><option>4.00</option><option>3.50</option><option>3.00</option><option>2.00</option><option>1.00</option><option>0.00</option><option>-1.00</option><option>-2.00</option><option>-3.00</option><option>-3.50</option><option>-4.00</option><option>-5.00</option><option>-6.00</option><option>-7.00</option><option>-8.00</option><option>-9.00</option><option>-10.00</option><option>-11.00</option><option>-12.00</option><option selected>$local_gmt</option></select> (Do NOT Adjust for DST)$NWB#servers-local_gmt$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>VMail Dump Exten: </td><td align=left><input type=text name=voicemail_dump_exten size=20 maxlength=20 value=\"$voicemail_dump_exten\">$NWB#servers-voicemail_dump_exten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS AD extension: </td><td align=left><input type=text name=answer_transfer_agent size=20 maxlength=20 value=\"$answer_transfer_agent\">$NWB#servers-answer_transfer_agent$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Default Context: </td><td align=left><input type=text name=ext_context size=20 maxlength=20 value=\"$ext_context\">$NWB#servers-ext_context$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>System Performance: </td><td align=left><select size=1 name=sys_perf_log><option>Y</option><option>N</option><option selected>$sys_perf_log</option></select>$NWB#servers-sys_perf_log$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Server Logs: </td><td align=left><select size=1 name=vd_server_logs><option>Y</option><option>N</option><option selected>$vd_server_logs</option></select>$NWB#servers-vd_server_logs$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>AGI Output: </td><td align=left><select size=1 name=agi_output><option>NONE</option><option>STDERR</option><option>FILE</option><option>BOTH</option><option selected>$agi_output</option></select>$NWB#servers-agi_output$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Carrier Logging Active: </td><td align=left><select size=1 name=carrier_logging_active><option>Y</option><option>N</option><option selected>$carrier_logging_active</option></select>$NWB#servers-carrier_logging_active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Recording Web Link: </td><td align=left><select size=1 name=recording_web_link><option>SERVER_IP</option><option>ALT_IP</option><option selected>$recording_web_link</option></select>$NWB#servers-recording_web_link$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Alternate Recording Server IP: </td><td align=left><input type=text name=alt_server_ip size=30 maxlength=100 value=\"$alt_server_ip\">$NWB#servers-alt_server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active Asterisk Server: </td><td align=left><select size=1 name=active_asterisk_server><option>Y</option><option>N</option><option selected>$active_asterisk_server</option></select>$NWB#servers-active_asterisk_server$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active Agent Server: </td><td align=left><select size=1 name=active_agent_login_server><option>Y</option><option>N</option><option selected>$active_agent_login_server</option></select>$NWB#servers-active_agent_login_server$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Generate conf files: </td><td align=left><select size=1 name=generate_vicidial_conf><option>Y</option><option>N</option><option selected>$generate_vicidial_conf</option></select>$NWB#servers-generate_vicidial_conf$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Rebuild conf files: </td><td align=left><select size=1 name=rebuild_conf_files><option>Y</option><option>N</option><option selected>$rebuild_conf_files</option></select>$NWB#servers-rebuild_conf_files$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Rebuild Music On Hold: </td><td align=left><select size=1 name=rebuild_music_on_hold><option>Y</option><option>N</option><option selected>$rebuild_music_on_hold</option></select>$NWB#servers-rebuild_music_on_hold$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Sounds Update: </td><td align=left><select size=1 name=sounds_update><option>Y</option><option>N</option><option selected>$sounds_update</option></select>$NWB#servers-sounds_update$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Recording Limit: </td><td align=left><input type=text name=vicidial_recording_limit size=8 maxlength=6 value=\"$vicidial_recording_limit\">$NWB#servers-vicidial_recording_limit$NWE</td></tr>\n";


		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center></form>\n";


		### CCMS server trunk records for this server
		echo "<br><br><b>CCMS TRUNKS FOR THIS SERVER: &nbsp; $NWB#vicidial_server_trunks$NWE</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td> CAMPAIGN</td><td> TRUNKS </td><td> RESTRICTION </td><td> </td><td> DELETE </td></tr>\n";

		$stmt="SELECT server_ip,campaign_id,dedicated_trunks,trunk_restriction from vicidial_server_trunks where server_ip='$server_ip' order by campaign_id";
		$rslt=mysql_query($stmt, $link);
		$recycle_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($recycle_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$o++;

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=1>$rowx[1]<form action=$PHP_SELF method=POST>\n";
			echo "<input type=hidden name=server_ip value=\"$server_ip\">\n";
			echo "<input type=hidden name=campaign_id value=\"$rowx[1]\">\n";
			echo "<input type=hidden name=ADD value=421111111111></td>\n";
			echo "<td><font size=1><input size=6 maxlength=4 name=dedicated_trunks value=\"$rowx[2]\"></td>\n";
			echo "<td><select size=1 name=trunk_restriction><option>MAXIMUM_LIMIT</option><option>OVERFLOW_ALLOWED</option><option SELECTED>$rowx[3]</option></select></td>\n";
			echo "<td><font size=1><input type=submit name=submit value=MODIFY></form></td>\n";
			echo "<td><font size=1><a href=\"$PHP_SELF?ADD=621111111111&campaign_id=$rowx[1]&server_ip=$server_ip\">DELETE</a></td></tr>\n";
			}

		echo "</table>\n";

		echo "<br><b>ADD NEW SERVER CCMS TRUNK RECORD</b><BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=221111111111>\n";
		echo "<input type=hidden name=server_ip value=\"$server_ip\">\n";
		echo "TRUNKS: <input size=6 maxlength=4 name=dedicated_trunks><BR>\n";
		echo "CAMPAIGN: <select size=1 name=campaign_id>\n";
		echo "$campaigns_list\n";
		echo "</select><BR>\n";
		echo "RESTRICTION: <select size=1 name=trunk_restriction><option>MAXIMUM_LIMIT</option><option>OVERFLOW_ALLOWED</option></select><BR>\n";
		echo "<input type=submit name=submit value=ADD><BR>\n";

		echo "</center></FORM><br>\n";


		### list of carriers on this server
		echo "<center>\n";
		echo "<br><b>CARRIERS WITHIN THIS SERVER:</b><br>\n";
		echo "<TABLE width=600 cellspacing=3>\n";
		echo "<tr><td>CARRIER ID</td><td>NAME</td><td>REGISTRATION</td><td>ACTIVE</td></tr>\n";

		$active_carriers = 0;
		$inactive_carriers = 0;
		$stmt="SELECT carrier_id,carrier_name,registration_string,active from vicidial_server_carriers where server_ip='$row[2]'";
		$rsltx=mysql_query($stmt, $link);
		$carriers_to_print = mysql_num_rows($rsltx);
		$camp_lists='';

		$o=0;
		while ($carriers_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rsltx);
			$o++;
			if (ereg("Y", $rowx[3])) {$active_carriers++;}
			if (ereg("N", $rowx[3])) {$inactive_carriers++;}

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=341111111111&carrier_id=$rowx[0]\">$rowx[0]</a></td><td><font size=1>$rowx[1]</td><td><font size=1>$rowx[2]</td><td><font size=1>$rowx[3]</td></tr>\n";
			}

		echo "</table></center><br>\n";


		### list of phones on this server
		echo "<center>\n";
		echo "<br><b>PHONES WITHIN THIS SERVER:</b><br>\n";
		echo "<TABLE width=400 cellspacing=3>\n";
		echo "<tr><td>EXTENSION</td><td>NAME</td><td>ACTIVE</td></tr>\n";

		$active_phones = 0;
		$inactive_phones = 0;
		$stmt="SELECT extension,active,fullname from phones where server_ip='$row[2]'";
		$rsltx=mysql_query($stmt, $link);
		$lists_to_print = mysql_num_rows($rsltx);
		$camp_lists='';

		$o=0;
		while ($lists_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rsltx);
			$o++;
			if (ereg("Y", $rowx[1])) {$active_phones++;   $camp_lists .= "'$rowx[0]',";}
			if (ereg("N", $rowx[1])) {$inactive_phones++;}

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31111111111&extension=$rowx[0]&server_ip=$row[2]\">$rowx[0]</a></td><td><font size=1>$rowx[2]</td><td><font size=1>$rowx[1]</td></tr>\n";
			}

		echo "</table></center><br>\n";


		### list of conferences on this server
		echo "<center>\n";
		echo "<br><b>CONFERENCES WITHIN THIS SERVER:</b><br>\n";
		echo "<TABLE width=400 cellspacing=3>\n";
		echo "<tr><td>CONFERENCE</td><td>EXTENSION</td></tr>\n";

		$active_confs = 0;
		$stmt="SELECT conf_exten,extension from conferences where server_ip='$row[2]'";
		$rsltx=mysql_query($stmt, $link);
		$lists_to_print = mysql_num_rows($rsltx);
		$camp_lists='';

		$o=0;
		while ($lists_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rsltx);
			$o++;
			$active_confs++;

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=3111111111111&conf_exten=$rowx[0]&server_ip=$row[2]\">$rowx[0]</a></td><td><font size=1>$rowx[2]</td></tr>\n";
			}

		echo "</table></center><br>\n";


		### list of CCMS conferences on this server
		echo "<center>\n";
		echo "<br><b>CCMS CONFERENCES WITHIN THIS SERVER:</b><br>\n";
		echo "<TABLE width=400 cellspacing=3>\n";
		echo "<tr><td>VD CONFERENCE</td><td>EXTENSION</td></tr>\n";

		$active_vdconfs = 0;
		$stmt="SELECT conf_exten,extension from vicidial_conferences where server_ip='$row[2]'";
		$rsltx=mysql_query($stmt, $link);
		$lists_to_print = mysql_num_rows($rsltx);
		$camp_lists='';

		$o=0;
		while ($lists_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rsltx);
			$o++;
			$active_vdconfs++;

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31111111111111&conf_exten=$rowx[0]&server_ip=$row[2]\">$rowx[0]</a></td><td><font size=1>$rowx[2]</td></tr>\n";
			}

		echo "</table></center><br>\n";


		echo "<center><b>\n";

			$camp_lists = eregi_replace(".$","",$camp_lists);
		echo "This server has $active_carriers active carriers and $inactive_carriers inactive carriers<br><br>\n";
		echo "This server has $active_phones active phones and $inactive_phones inactive phones<br><br>\n";
		echo "This server has $active_confs active conferences<br><br>\n";
		echo "This server has $active_vdconfs active CCMS conferences<br><br>\n";
		echo "</b></center>\n";
		if ($LOGast_delete_phones > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=511111111111&server_id=$server_id&server_ip=$server_ip\">DELETE THIS SERVER</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=SERVERS&stage=$server_id\">Click here to see Admin chages to this server</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=331111111111 modify conf template record in the system
######################

if ($ADD==331111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT template_id,template_name,template_contents from vicidial_conf_templates where template_id='$template_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$template_id =			$row[0];
		$template_name =		$row[1];
		$template_contents =	$row[2];

		echo "<br>MODIFY A CONF TEMPLATE RECORD: $row[0]<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=431111111111>\n";
		echo "<input type=hidden name=template_id value=\"$template_id\">\n";

		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Template ID: </td><td align=left><B>$template_id</B></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Template Name: </td><td align=left><input type=text name=template_name size=40 maxlength=50 value=\"$template_name\">$NWB#vicidial_conf_templates-template_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Template Contents: </td><td align=left><TEXTAREA NAME=template_contents ROWS=10 COLS=70>$template_contents</TEXTAREA> $NWB#vicidial_conf_templates-template_contents$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";

		echo "<center><b>\n";

		### list of phones using this conf template
		echo "<center>\n";
		echo "<br><b>PHONES USING THIS CONF TEMPLATE:</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>EXTENSION</td><td>NAME</td><td>SERVER</td><td>ACTIVE</td></tr>\n";

		$active_phones = 0;
		$inactive_phones = 0;
		$stmt="SELECT extension,active,fullname,server_ip from phones where template_id='$template_id'";
		$rsltx=mysql_query($stmt, $link);
		$lists_to_print = mysql_num_rows($rsltx);
		$camp_lists='';

		$o=0;
		while ($lists_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rsltx);
			$o++;
			if (ereg("Y", $rowx[1])) {$active_phones++;   $camp_lists .= "'$rowx[0]',";}
			if (ereg("N", $rowx[1])) {$inactive_phones++;}

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31111111111&extension=$rowx[0]&server_ip=$rowx[3]\">$rowx[0]</a></td><td><font size=1>$rowx[2]</td><td><font size=1>$rowx[3]</td><td><font size=1>$rowx[1]</td></tr>\n";
			}

		echo "</table></center><br>\n";

		### list of carriers using this conf template
		echo "<center>\n";
		echo "<br><b>CARRIERS USING THIS CONF TEMPLATE:</b><br>\n";
		echo "<TABLE width=500 cellspacing=3>\n";
		echo "<tr><td>CARRIER</td><td>NAME</td><td>SERVER</td><td>ACTIVE</td></tr>\n";

		$active_phones = 0;
		$inactive_phones = 0;
		$stmt="SELECT carrier_id,active,carrier_name,server_ip from vicidial_server_carriers where template_id='$template_id'";
		$rsltx=mysql_query($stmt, $link);
		$lists_to_print = mysql_num_rows($rsltx);
		$camp_lists='';

		$o=0;
		while ($lists_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rsltx);
			$o++;
			if (ereg("Y", $rowx[1])) {$active_phones++;   $camp_lists .= "'$rowx[0]',";}
			if (ereg("N", $rowx[1])) {$inactive_phones++;}

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=341111111111&carrier_id=$rowx[0]\">$rowx[0]</a></td><td><font size=1>$rowx[2]</td><td><font size=1>$rowx[3]</td><td><font size=1>$rowx[1]</td></tr>\n";
			}

		echo "</table></center><br>\n";



		if ($LOGast_delete_phones > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=531111111111&template_id=$template_id&template_name=$template_name\">DELETE THIS CONF TEMPLATE</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=CONFTEMPLATES&stage=$template_id\">Click here to see Admin chages to this conf template</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=341111111111 modify carrier record in the system
######################

if ($ADD==341111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT carrier_id,carrier_name,registration_string,template_id,account_entry,protocol,globals_string,dialplan_entry,server_ip,active,carrier_description from vicidial_server_carriers where carrier_id='$carrier_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$carrier_id =			$row[0];
		$carrier_name =			$row[1];
		$registration_string =	$row[2];
		$template_id =			$row[3];
		$account_entry =		$row[4];
		$protocol =				$row[5];
		$globals_string =		$row[6];
		$dialplan_entry =		$row[7];
		$server_ip =			$row[8];
		$active =				$row[9];
		$carrier_description =	$row[10];

		echo "<br>MODIFY A CARRIER RECORD: $row[0]<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=441111111111>\n";
		echo "<input type=hidden name=carrier_id value=\"$carrier_id\">\n";

		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Carrier ID: </td><td align=left><B>$carrier_id</B></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Carrier Name: </td><td align=left><input type=text name=carrier_name size=40 maxlength=50 value=\"$carrier_name\">$NWB#vicidial_server_carriers-carrier_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Carrier Description: </td><td align=left><input type=text name=carrier_description size=70 maxlength=255 value=\"$carrier_description\">$NWB#vicidial_server_carriers-carrier_description$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Registration String: </td><td align=left><input type=text name=registration_string size=50 maxlength=255 value=\"$registration_string\">$NWB#vicidial_server_carriers-registration_string$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=331111111111&template_id=$template_id\">Template ID</a>: </td><td align=left><select size=1 name=template_id>\n";
		$stmt="SELECT template_id,template_name from vicidial_conf_templates order by template_id";
		$rslt=mysql_query($stmt, $link);
		$templates_to_print = mysql_num_rows($rslt);
		$templates_list='<option SELECTED>--NONE--</option>';
		$o=0;
		while ($templates_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$templates_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}
		echo "$templates_list";
		echo "<option SELECTED>$template_id</option>\n";
		echo "</select>$NWB#vicidial_server_carriers-template_id$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Account Entry: </td><td align=left><TEXTAREA NAME=account_entry ROWS=10 COLS=70>$account_entry</TEXTAREA> $NWB#vicidial_server_carriers-account_entry$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Protocol: </td><td align=left><select size=1 name=protocol><option>SIP</option><option>Zap</option><option>IAX2</option><option>EXTERNAL</option><option SELECTED>$protocol</option></select>$NWB#vicidial_server_carriers-protocol$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Globals String: </td><td align=left><input type=text name=globals_string size=50 maxlength=255 value=\"$globals_string\">$NWB#vicidial_server_carriers-globals_string$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Dialplan Entry: </td><td align=left><TEXTAREA NAME=dialplan_entry ROWS=10 COLS=70>$dialplan_entry</TEXTAREA> $NWB#vicidial_server_carriers-dialplan_entry$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Server IP: </td><td align=left><select size=1 name=server_ip>\n";
		##### get server listing for dynamic pulldown
		$stmt="SELECT server_ip,server_description from servers order by server_ip";
		$rsltx=mysql_query($stmt, $link);
		$servers_to_print = mysql_num_rows($rsltx);
		$servers_list='';

		$o=0;
		while ($servers_to_print > $o)
			{
			$rowx=mysql_fetch_row($rsltx);
			$servers_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}

		echo "$servers_list";
		echo "<option SELECTED>$server_ip</option>\n";
		echo "</select>$NWB#vicidial_server_carriers-server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>Y</option><option>N</option><option SELECTED>$active</option></select>$NWB#vicidial_server_carriers-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";

		echo "<center><b>\n";
		if ($LOGast_delete_phones > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=541111111111&carrier_id=$carrier_id&carrier_name=$carrier_name\">DELETE THIS CARRIER</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=CARRIERS&stage=$carrier_id\">Click here to see Admin chages to this carrier</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=351111111111 modify tts record in the system
######################

if ($ADD==351111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT tts_id,tts_name,active,tts_text from vicidial_tts_prompts where tts_id='$tts_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$tts_id =		$row[0];
		$tts_name =		$row[1];
		$active =		$row[2];
		$tts_text =		$row[3];

		echo "<br>MODIFY A TTS RECORD: $tts_id<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=451111111111>\n";
		echo "<input type=hidden name=tts_id value=\"$tts_id\">\n";

		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>TTS ID: </td><td align=left><B>$tts_id</B></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>TTS Name: </td><td align=left><input type=text name=tts_name size=50 maxlength=100 value=\"$tts_name\">$NWB#vicidial_tts_prompts-tts_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>N</option><option>Y</option><option SELECTED>$active</option></select>$NWB#vicidial_tts_prompts-active$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>TTS Text: </td><td align=left><TEXTAREA NAME=tts_text ROWS=20 COLS=70>$tts_text</TEXTAREA> $NWB#vicidial_tts_prompts-tts_text$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";

		echo "<center><b>\n";
		if ($LOGast_delete_phones > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=551111111111&tts_id=$tts_id&tts_name=$tts_name\">DELETE THIS TTS ENTRY</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=TTS&stage=$tts_id\">Click here to see Admin chages to this TTS entry</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=361111111111 modify music on hold record in the system
######################

if ($ADD==361111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT moh_id,moh_name,active,random from vicidial_music_on_hold where moh_id='$moh_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$moh_id =		$row[0];
		$moh_name =		$row[1];
		$active =		$row[2];
		$random =		$row[3];

		echo "<br>MODIFY A MUSIC ON HOLD RECORD: $moh_id<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=461111111111>\n";
		echo "<input type=hidden name=moh_id value=\"$moh_id\">\n";

		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Music On Hold ID: </td><td align=left><B>$moh_id</B></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Music On Hold Name: </td><td align=left><input type=text name=moh_name size=50 maxlength=100 value=\"$moh_name\">$NWB#vicidial_music_on_hold-moh_name$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>N</option><option>Y</option><option SELECTED>$active</option></select>$NWB#vicidial_music_on_hold-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Random Order: </td><td align=left><select size=1 name=random><option>N</option><option>Y</option><option SELECTED>$random</option></select>$NWB#vicidial_music_on_hold-random$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Audio Files: </td><td align=left>\n";
		##### get files listing for rank/delete options
		$stmt="SELECT filename,rank from vicidial_music_on_hold_files where moh_id='$moh_id' order by rank;";
		$rsltx=mysql_query($stmt, $link);
		$mohfiles_to_print = mysql_num_rows($rsltx);
		$ranks = ($mohfiles_to_print + 2);
		$o=0;
		while ($mohfiles_to_print > $o)
			{
			$rowx=mysql_fetch_row($rsltx);
			echo "<font size=2>Rank: </font><select size=1 name=$rowx[0]>\n";
			echo "<option SELECTED>$rowx[1]</option>\n";
			$k=1;
			while ($ranks > $k)
				{
				echo "<option>$k</option>\n";
				$k++;
				}
			echo "</select>\n";

			echo " &nbsp; <B>$rowx[0]</B> - <a href=\"$PHP_SELF?ADD=461111111111&moh_id=$moh_id&stage=FILEDELETE&filename=$rowx[0]\">DELETE</a><BR>\n";
			$o++;
			}

		echo "</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Add An Audio File: </td><td><input type=text size=50 maxlength=50 name=filename id=filename value=\"\"> <a href=\"javascript:launch_chooser('filename','date',30);\">audio chooser</a>  $NWB#vicidial_music_on_hold-filename$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";

		echo "<center><b>\n";
		if ($LOGast_delete_phones > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=561111111111&moh_id=$moh_id&moh_name=$moh_name\">DELETE MUSIC ON HOLD ENTRY</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=MOH&stage=$moh_id\">Click here to see Admin chages to this Music On Hold entry</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=371111111111 modify voicemail box in the system
######################

if ($ADD==371111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT voicemail_id,pass,fullname,active,email,messages,old_messages,delete_vm_after_email from vicidial_voicemail where voicemail_id='$voicemail_id';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$voicemail_id =				$row[0];
		$pass =						$row[1];
		$fullname =					$row[2];
		$active =					$row[3];
		$email =					$row[4];
		$messages =					$row[5];
		$old_messages =				$row[6];
		$delete_vm_after_email =	$row[7];

		echo "<br>MODIFY A VOICEMAIL BOX: $tts_id<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=471111111111>\n";
		echo "<input type=hidden name=voicemail_id value=\"$voicemail_id\">\n";

		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Voicemail ID: </td><td align=left><B>$voicemail_id</B></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Password: </td><td align=left><input type=text name=pass size=12 maxlength=10 value=\"$pass\">$NWB#vicidial_voicemail-pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Name: </td><td align=left><input type=text name=fullname size=50 maxlength=100 value=\"$fullname\">$NWB#vicidial_voicemail-fullname$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Email: </td><td align=left><input type=text name=email size=50 maxlength=100 value=\"$email\">$NWB#vicidial_voicemail-email$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Active: </td><td align=left><select size=1 name=active><option>N</option><option>Y</option><option SELECTED>$active</option></select>$NWB#vicidial_voicemail-active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Delete Voicemail After Email: </td><td align=left><select size=1 name=delete_vm_after_email><option>Y</option><option>N</option><option selected>$delete_vm_after_email</option></select>$NWB#vicidial_voicemail-delete_vm_after_email$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>New Messages: </td><td align=left><B>$messages</B></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Old Messages: </td><td align=left><B>$old_messages</B></td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";

		echo "<center><b>\n";
		if ($LOGast_delete_phones > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=571111111111&voicemail_id=$voicemail_id&fullname=$fullname\">DELETE THIS VOICEMAIL BOX</a>\n";
			}
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=VOICEMAIL&stage=$voicemail_id\">Click here to see Admin chages to this voicemail box</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=3111111111111 modify conference record in the system
######################

if ($ADD==3111111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT conf_exten,server_ip,extension from conferences where conf_exten='$conf_exten' and server_ip='$server_ip';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$conf_exten = $row[0];
		$server_ip = $row[1];

		echo "<br>MODIFY A CONFERENCE RECORD: $row[0]<form onSubmit=\"return contentFilter('Conference,conf_exten,2')\" action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=4111111111111>\n";
		echo "<input type=hidden name=old_conf_exten value=\"$row[0]\">\n";
		echo "<input type=hidden name=old_server_ip value=\"$row[1]\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Conference: </td><td align=left><input type=text name=conf_exten size=10 maxlength=7 value=\"$row[0]\">$NWB#conferences-conf_exten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=311111111111&server_ip=$row[1]\">Server IP</a>: </td><td align=left><select size=1 name=server_ip>\n";

		echo "$servers_list";
		echo "<option SELECTED>$row[1]</option>\n";
		echo "</select>$NWB#conferences-server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Current Extension: </td><td align=left><input type=text name=extension size=20 maxlength=20 value=\"$row[2]\"></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";

		echo "<center><b>\n";
		if ($LOGast_delete_phones > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=5111111111111&conf_exten=$conf_exten&server_ip=$server_ip\">DELETE THIS CONFERENCE</a>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=31111111111111 modify CCMS conference record in the system
######################

if ($ADD==31111111111111)
	{
	if ($LOGast_admin_access==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT conf_exten,server_ip,extension,leave_3way,leave_3way_datetime from vicidial_conferences where conf_exten='$conf_exten' and server_ip='$server_ip';";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$conf_exten = $row[0];
		$server_ip = $row[1];

		echo "<br>MODIFY A CCMS CONFERENCE RECORD: $row[0]<form onSubmit=\"return contentFilter('Conference,conf_exten,2')\"  action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=41111111111111>\n";
		echo "<input type=hidden name=old_conf_exten value=\"$row[0]\">\n";
		echo "<input type=hidden name=old_server_ip value=\"$row[1]\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Conference: </td><td align=left><input type=text name=conf_exten size=10 maxlength=7 value=\"$row[0]\">$NWB#conferences-conf_exten$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right><a href=\"$PHP_SELF?ADD=311111111111&server_ip=$row[1]\">Server IP</a>: </td><td align=left><select size=1 name=server_ip>\n";

		echo "$servers_list";
		echo "<option SELECTED>$row[1]</option>\n";
		echo "</select>$NWB#conferences-server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Current Extension: </td><td align=left><input type=text name=extension size=20 maxlength=20 value=\"$row[2]\"></td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";

		echo "<center><b>\n";
		if ($LOGast_delete_phones > 0)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=51111111111111&conf_exten=$conf_exten&server_ip=$server_ip\">DELETE THIS CCMS CONFERENCE</a>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}



######################
# ADD=311111111111111 modify CCMS system settings
######################

if ($ADD==311111111111111)
	{
	if ($LOGast_admin_access==1 && $LOGmodify_servers==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT version,install_date,use_non_latin,webroot_writable,enable_queuemetrics_logging,queuemetrics_server_ip,queuemetrics_dbname,queuemetrics_login,queuemetrics_pass,queuemetrics_url,queuemetrics_log_id,queuemetrics_eq_prepend,vicidial_agent_disable,allow_sipsak_messages,admin_home_url,enable_agc_xfer_log,db_schema_version,auto_user_add_value,timeclock_end_of_day,timeclock_last_reset_date,vdc_header_date_format,vdc_customer_date_format,vdc_header_phone_format,vdc_agent_api_active,qc_last_pull_time,enable_vtiger_integration,vtiger_server_ip,vtiger_dbname,vtiger_login,vtiger_pass,vtiger_url,qc_features_active,outbound_autodial_active,outbound_calls_per_second,enable_tts_integration,agentonly_callback_campaign_lock,sounds_central_control_active,sounds_web_server,sounds_web_directory,active_voicemail_server,auto_dial_limit,user_territories_active,allow_custom_dialplan,db_schema_update_date,enable_second_webform,ccms_report_url,ccms_url from system_settings;";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$version =						$row[0];
		$install_date =					$row[1];
		$use_non_latin =				$row[2];
		$webroot_writable =				$row[3];
		$enable_queuemetrics_logging =	$row[4];
		$queuemetrics_server_ip =		$row[5];
		$queuemetrics_dbname =			$row[6];
		$queuemetrics_login =			$row[7];
		$queuemetrics_pass =			$row[8];
		$queuemetrics_url =				$row[9];
		$queuemetrics_log_id =			$row[10];
		$queuemetrics_eq_prepend =		$row[11];
		$vicidial_agent_disable =		$row[12];
		$allow_sipsak_messages =		$row[13];
		$admin_home_url =				$row[14];
		$enable_agc_xfer_log =			$row[15];
		$db_schema_version =			$row[16];
		$auto_user_add_value =			$row[17];
		$timeclock_end_of_day =			$row[18];
		$timeclock_last_reset_date =	$row[19];
		$vdc_header_date_format =		$row[20];
		$vdc_customer_date_format =		$row[21];
		$vdc_header_phone_format =		$row[22];
		$vdc_agent_api_active =			$row[23];
		$qc_last_pull_time = 			$row[24];
		$enable_vtiger_integration = 	$row[25];
		$vtiger_server_ip = 			$row[26];
		$vtiger_dbname = 				$row[27];
		$vtiger_login = 				$row[28];
		$vtiger_pass = 					$row[29];
		$vtiger_url = 					$row[30];
		$qc_features_active =			$row[31];
		$outbound_autodial_active =		$row[32];
		$outbound_calls_per_second =	$row[33];
		$enable_tts_integration =		$row[34];
		$agentonly_callback_campaign_lock = $row[35];
		$sounds_central_control_active = $row[36];
		$sounds_web_server =			$row[37];
		$sounds_web_directory =			$row[38];
		$active_voicemail_server =		$row[39];
		$auto_dial_limit =				$row[40];
		$user_territories_active =		$row[41];
		$allow_custom_dialplan =		$row[42];
		$db_schema_update_date =		$row[43];
		$enable_second_webform =		$row[44];
		$ccms_report_url =				$row[45];
		$ccms_url =						$row[46];
		echo "<br>MODIFY CCMS SYSTEM SETTINGS<form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=411111111111111>\n";
		echo "<input type=hidden name=sounds_web_directory value=\"$sounds_web_directory\">\n";
		echo "<center><TABLE width=$section_width cellspacing=3>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Version: </td><td align=left> $version</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DB Schema Version: </td><td align=left> $db_schema_version</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>DB Schema Update Date: </td><td align=left> $db_schema_update_date</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Auto User-add Value: </td><td align=left> $auto_user_add_value</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Install Date: </td><td align=left> $install_date</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Use Non-Latin: </td><td align=left><select size=1 name=use_non_latin><option>1</option><option>0</option><option selected>$use_non_latin</option></select>$NWB#settings-use_non_latin$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Webroot Writable: </td><td align=left><select size=1 name=webroot_writable><option>1</option><option>0</option><option selected>$webroot_writable</option></select>$NWB#settings-webroot_writable$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Agent Disable Display: </td><td align=left><select size=1 name=vicidial_agent_disable>\n";
		echo "<option value=\"NOT_ACTIVE\">NOT_ACTIVE</option>\n";
		echo "<option value=\"LIVE_AGENT\">LIVE_AGENT</option>\n";
		echo "<option value=\"EXTERNAL\">EXTERNAL</option>\n";
		echo "<option value=\"ALL\">ALL</option>\n";
		echo "<option selected value=\"$vicidial_agent_disable\">$vicidial_agent_disable</option>\n";
		echo "</select>$NWB#settings-vicidial_agent_disable$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Allow SIPSAK Messages: </td><td align=left><select size=1 name=allow_sipsak_messages><option>1</option><option>0</option><option selected>$allow_sipsak_messages</option></select>$NWB#settings-allow_sipsak_messages$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Admin Home URL: </td><td align=left><input type=text name=admin_home_url size=50 maxlength=255 value=\"$admin_home_url\">$NWB#settings-admin_home_url$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS URL: </td><td align=left><input type=text name=ccms_url size=50 maxlength=255 value=\"$ccms_url\">$NWB#settings-ccms_url$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>CCMS Report URL: </td><td align=left><input type=text name=ccms_report_url size=50 maxlength=255 value=\"$ccms_report_url\">$NWB#settings-ccms_report_url$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Enable Agent Transfer Logfile: </td><td align=left><select size=1 name=enable_agc_xfer_log><option>1</option><option>0</option><option selected>$enable_agc_xfer_log</option></select>$NWB#settings-enable_agc_xfer_log$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Timeclock End Of Day: </td><td align=left><input type=text name=timeclock_end_of_day size=5 maxlength=4 value=\"$timeclock_end_of_day\">$NWB#settings-timeclock_end_of_day$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Timeclock Last Auto Logout: </td><td align=left> $timeclock_last_reset_date</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Agent Screen Header Date Format: </td><td align=left><select size=1 name=vdc_header_date_format>\n";
		echo "<option>MS_DASH_24HR  2008-06-24 23:59:59</option>\n";
		echo "<option>US_SLASH_24HR 06/24/2008 23:59:59</option>\n";
		echo "<option>EU_SLASH_24HR 24/06/2008 23:59:59</option>\n";
		echo "<option>AL_TEXT_24HR  JUN 24 23:59:59</option>\n";
		echo "<option>MS_DASH_AMPM  2008-06-24 11:59:59 PM</option>\n";
		echo "<option>US_SLASH_AMPM 06/24/2008 11:59:59 PM</option>\n";
		echo "<option>EU_SLASH_AMPM 24/06/2008 11:59:59 PM</option>\n";
		echo "<option>AL_TEXT_AMPM  JUN 24 11:59:59 PM</option>\n";
		echo "<option selected value=\"$vdc_header_date_format\">$vdc_header_date_format</option>\n";
		echo "</select>$NWB#settings-vdc_header_date_format$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Agent Screen Customer Date Format: </td><td align=left><select size=1 name=vdc_customer_date_format>\n";
		echo "<option>MS_DASH_24HR  2008-06-24 23:59:59</option>\n";
		echo "<option>US_SLASH_24HR 06/24/2008 23:59:59</option>\n";
		echo "<option>EU_SLASH_24HR 24/06/2008 23:59:59</option>\n";
		echo "<option>AL_TEXT_24HR  JUN 24 23:59:59</option>\n";
		echo "<option>MS_DASH_AMPM  2008-06-24 11:59:59 PM</option>\n";
		echo "<option>US_SLASH_AMPM 06/24/2008 11:59:59 PM</option>\n";
		echo "<option>EU_SLASH_AMPM 24/06/2008 11:59:59 PM</option>\n";
		echo "<option>AL_TEXT_AMPM  JUN 24 11:59:59 PM</option>\n";
		echo "<option selected value=\"$vdc_customer_date_format\">$vdc_customer_date_format</option>\n";
		echo "</select>$NWB#settings-vdc_customer_date_format$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Agent Screen Customer Phone Format: </td><td align=left><select size=1 name=vdc_header_phone_format>\n";
		### Add by fnatic start
		echo "<option>CN_NODS 0000000000</option>\n";
		### Add by fnatic end
		echo "<option>US_DASH 000-000-0000</option>\n";
		echo "<option>US_PARN (000)000-0000</option>\n";
		echo "<option>MS_NODS 0000000000</option>\n";
		echo "<option>UK_DASH 00 0000-0000</option>\n";
		echo "<option>AU_SPAC 000 000 000</option>\n";
		echo "<option>IT_DASH 0000-000-000</option>\n";
		echo "<option>FR_SPAC 00 00 00 00 00</option>\n";
		echo "<option selected value=\"$vdc_header_phone_format\">$vdc_header_phone_format</option>\n";
		echo "</select>$NWB#settings-vdc_header_phone_format$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Agent API Active: </td><td align=left><select size=1 name=vdc_agent_api_active><option>1</option><option>0</option><option selected>$vdc_agent_api_active</option></select>$NWB#settings-vdc_agent_api_active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Agent Only Callback Campaign Lock: </td><td align=left><select size=1 name=agentonly_callback_campaign_lock><option>1</option><option>0</option><option selected>$agentonly_callback_campaign_lock</option></select>$NWB#settings-agentonly_callback_campaign_lock$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Central Sound Control Active: </td><td align=left><select size=1 name=sounds_central_control_active><option>1</option><option>0</option><option selected>$sounds_central_control_active</option></select>$NWB#settings-sounds_central_control_active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Sounds Web Server: </td><td align=left><input type=text name=sounds_web_server size=30 maxlength=50 value=\"$sounds_web_server\">$NWB#settings-sounds_web_server$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>Sounds Web Directory: </td><td align=left><a href=\"http://$sounds_web_server/$sounds_web_directory\">$sounds_web_directory</a> $NWB#settings-sounds_web_directory$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Active Voicemail Server: </td><td align=left><select size=1 name=active_voicemail_server>\n";
		##### get server listing for dynamic pulldown
		$stmt="SELECT server_ip,server_description from servers order by server_ip";
		$rsltx=mysql_query($stmt, $link);
		$servers_to_print = mysql_num_rows($rsltx);
		$servers_list='';

		$o=0;
		while ($servers_to_print > $o)
			{
			$rowx=mysql_fetch_row($rsltx);
			$servers_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
			$o++;
			}

		echo "$servers_list";
		echo "<option SELECTED>$active_voicemail_server</option>\n";
		echo "</select>$NWB#settings-active_voicemail_server$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Auto Dial Limit: </td><td align=left><select size=1 name=auto_dial_limit><option selected>$auto_dial_limit</option>\n";
		$adl=1;
		while($adl < 1000)
			{
			echo "<option>$adl</option>\n";
			if ($adl < 3)
				{$adl = ($adl + 0.1);}
			else
				{
				if ($adl < 4)
					{$adl = ($adl + 0.25);}
				else
					{
					if ($adl < 5)
						{$adl = ($adl + 0.5);}
					else
						{
						if ($adl < 10)
							{$adl = ($adl + 1);}
						else
							{
							if ($adl < 20)
								{$adl = ($adl + 2);}
							else
								{
								if ($adl < 40)
									{$adl = ($adl + 5);}
								else
									{
									if ($adl < 200)
										{$adl = ($adl + 10);}
									else
										{
										if ($adl < 400)
											{$adl = ($adl + 50);}
										else
											{
											if ($adl < 1000)
												{$adl = ($adl + 100);}
											else
												{$adl = ($adl + 1);}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		echo "<option>$adl</option></select>$NWB#settings-auto_dial_limit$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Outbound Auto-Dial Active: </td><td align=left><select size=1 name=outbound_autodial_active><option>1</option><option>0</option><option selected>$outbound_autodial_active</option></select>$NWB#settings-outbound_autodial_active$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Max FILL Calls per Second: </td><td align=left><input type=text name=outbound_calls_per_second size=4 maxlength=3 value=\"$outbound_calls_per_second\">$NWB#settings-outbound_calls_per_second$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Allow Custom Dialplan Entries: </td><td align=left><select size=1 name=allow_custom_dialplan><option>1</option><option>0</option><option selected>$allow_custom_dialplan</option></select>$NWB#settings-allow_custom_dialplan$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>User Territories Active: </td><td align=left><select size=1 name=user_territories_active><option>1</option><option>0</option><option selected>$user_territories_active</option></select>$NWB#settings-user_territories_active$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Enable Second Webform: </td><td align=left><select size=1 name=enable_second_webform><option>1</option><option>0</option><option selected>$enable_second_webform</option></select>$NWB#settings-enable_second_webform$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>Enable TTS Integration: </td><td align=left><select size=1 name=enable_tts_integration><option>1</option><option>0</option><option selected>$enable_tts_integration</option></select>$NWB#settings-enable_tts_integration$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=right>QC Features Active: </td><td align=left><select size=1 name=qc_features_active><option>1</option><option>0</option><option selected>$qc_features_active</option></select>$NWB#settings-qc_features_active$NWE</td></tr>\n";
		echo "<tr bgcolor=#FFFFFF><td align=right>QC Last Pull Time: </td><td align=left> $qc_last_pull_time</td></tr>\n";

		echo "<tr bgcolor=#99FFCC><td align=right>Enable QueueMetrics Logging: </td><td align=left><select size=1 name=enable_queuemetrics_logging><option>1</option><option>0</option><option selected>$enable_queuemetrics_logging</option></select>$NWB#settings-enable_queuemetrics_logging$NWE</td></tr>\n";
		echo "<tr bgcolor=#99FFCC><td align=right>QueueMetrics Server IP: </td><td align=left><input type=text name=queuemetrics_server_ip size=18 maxlength=15 value=\"$queuemetrics_server_ip\">$NWB#settings-queuemetrics_server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#99FFCC><td align=right>QueueMetrics DB Name: </td><td align=left><input type=text name=queuemetrics_dbname size=18 maxlength=50 value=\"$queuemetrics_dbname\">$NWB#settings-queuemetrics_dbname$NWE</td></tr>\n";
		echo "<tr bgcolor=#99FFCC><td align=right>QueueMetrics DB Login: </td><td align=left><input type=text name=queuemetrics_login size=18 maxlength=50 value=\"$queuemetrics_login\">$NWB#settings-queuemetrics_login$NWE</td></tr>\n";
		echo "<tr bgcolor=#99FFCC><td align=right>QueueMetrics DB Password: </td><td align=left><input type=text name=queuemetrics_pass size=18 maxlength=50 value=\"$queuemetrics_pass\">$NWB#settings-queuemetrics_pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#99FFCC><td align=right>QueueMetrics URL: </td><td align=left><input type=text name=queuemetrics_url size=50 maxlength=255 value=\"$queuemetrics_url\">$NWB#settings-queuemetrics_url$NWE</td></tr>\n";
		echo "<tr bgcolor=#99FFCC><td align=right>QueueMetrics Log ID: </td><td align=left><input type=text name=queuemetrics_log_id size=12 maxlength=10 value=\"$queuemetrics_log_id\">$NWB#settings-queuemetrics_log_id$NWE</td></tr>\n";
		echo "<tr bgcolor=#99FFCC><td align=right>QueueMetrics EnterQueue Prepend: </td><td align=left><select size=1 name=queuemetrics_eq_prepend>\n";
		echo "<option value=\"NONE\">NONE</option>\n";
		echo "<option value=\"lead_id\">lead_id</option>\n";
		echo "<option value=\"list_id\">list_id</option>\n";
		echo "<option value=\"source_id\">source_id</option>\n";
		echo "<option value=\"vendor_lead_code\">vendor_lead_code</option>\n";
		echo "<option value=\"address3\">address3</option>\n";
		echo "<option value=\"security_phrase\">security_phrase</option>\n";
		echo "<option selected value=\"$queuemetrics_eq_prepend\">$queuemetrics_eq_prepend</option>\n";
		echo "</select>$NWB#settings-queuemetrics_eq_prepend$NWE</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>Enable CRM Integration: </td><td align=left><select size=1 name=enable_vtiger_integration><option>1</option><option>0</option><option selected>$enable_vtiger_integration</option></select>$NWB#settings-enable_vtiger_integration$NWE\n";
		echo " &nbsp; <a href=\"./vtiger_user.php\" target=\"_blank\">Click here to Synchronize users with CRM</a>\n";
		echo "</td></tr>\n";

		echo "<tr bgcolor=#CCFFFF><td align=right>CRM DB Server IP: </td><td align=left><input type=text name=vtiger_server_ip size=18 maxlength=15 value=\"$vtiger_server_ip\">$NWB#settings-vtiger_server_ip$NWE</td></tr>\n";
		echo "<tr bgcolor=#CCFFFF><td align=right>CRM DB Name: </td><td align=left><input type=text name=vtiger_dbname size=18 maxlength=50 value=\"$vtiger_dbname\">$NWB#settings-vtiger_dbname$NWE</td></tr>\n";
		echo "<tr bgcolor=#CCFFFF><td align=right>CRM DB Login: </td><td align=left><input type=text name=vtiger_login size=18 maxlength=50 value=\"$vtiger_login\">$NWB#settings-vtiger_login$NWE</td></tr>\n";
		echo "<tr bgcolor=#CCFFFF><td align=right>CRM DB Password: </td><td align=left><input type=text name=vtiger_pass size=18 maxlength=50 value=\"$vtiger_pass\">$NWB#settings-vtiger_pass$NWE</td></tr>\n";
		echo "<tr bgcolor=#CCFFFF><td align=right>CRM URL: </td><td align=left><input type=text name=vtiger_url size=50 maxlength=255 value=\"$vtiger_url\">$NWB#settings-vtiger_url$NWE</td></tr>\n";

		echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=submit VALUE=SUBMIT></td></tr>\n";
		echo "</TABLE></center>\n";
		echo "</form>\n";
		if ($LOGuser_level >= 9)
			{
			echo "<br><br><a href=\"$PHP_SELF?ADD=720000000000000&category=SYSTEMSETTINGS&stage=system_settings\">Click here to see Admin chages to the system settings</FONT>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}






######################
# ADD=321111111111111 modify CCMS system statuses
######################

if ($ADD==321111111111111)
	{
	if ($LOGast_admin_access==1 && $LOGmodify_servers==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br><center>\n";
		echo "<b>CCMS Call Result WITHIN THIS SYSTEM: &nbsp; $NWB#vicidial_statuses$NWE</b><br>\n";
		echo "<TABLE width=700 cellspacing=3>\n";
		echo "<tr><td>STATUS</td><td>DESCRIPTION</td><td>SELECT-<BR>ABLE</td><td>HUMAN<BR>ANSWER</td><td>CLASS</td><td>CATEGORY</td><td>TYPE</td><td>MODIFY/DELETE</td></tr>\n";

		##### 获取status type ---add by akin
		$stmt="select type,typedescription from vicidial_status_type where active='Y' and isdel='N' order by type asc";
		$rslt=mysql_query($stmt, $link);
		$status_type_list = "";
		$status_type_list_add = "";
		$status_type_result_array = array();
		if($rslt && mysql_num_rows($rslt)){
			while($status_type_row = mysql_fetch_row($rslt)){
				$status_type_list .= "<option value=$status_type_row[0]>$status_type_row[1]</option>";
				$selected_str = "";
				if($status_type_row[1] == 'Answer')	$selected_str = "selected=selected";
				$status_type_list_add .= "<option $selected_str value=$status_type_row[0]>$status_type_row[1]</option>";
				$status_type_result_array[$status_type_row[0]] = $status_type_row[1];
			}
		}
		##### get status category listings for dynamic pulldown
		$stmt="SELECT vsc_id,vsc_name from vicidial_status_categories order by vsc_id desc";
		$rslt=mysql_query($stmt, $link);
		$cats_to_print = mysql_num_rows($rslt);
		$cats_list="";

		$o=0;
		while ($cats_to_print > $o)
			{
			$rowx=mysql_fetch_row($rslt);
			$cats_list .= "<option value=\"$rowx[0]\">$rowx[0] - " . substr($rowx[1],0,20) . "</option>\n";
			$catsname_list["$rowx[0]"] = substr($rowx[1],0,20);
			$o++;
			}


		$stmt="SELECT status,status_name,selectable,human_answered,category,sale,dnc,customer_contact,not_interested,unworkable,class,status_type from vicidial_statuses order by status;";
		$rslt=mysql_query($stmt, $link);
		$statuses_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($statuses_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$AScategory = $rowx[4];
			$status_type = $rowx[11];
			$o++;

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><form action=$PHP_SELF method=POST>\n";
			echo "<input type=hidden name=ADD value=421111111111111>\n";
			echo "<input type=hidden name=stage value=modify>\n";
			echo "<input type=hidden name=status value=\"$rowx[0]\">\n";
			echo "<font size=2><B>$rowx[0]</B></td>\n";
			echo "<td><input type=text name=status_name size=20 maxlength=30 value=\"$rowx[1]\"></td>\n";
			echo "<td><select size=1 name=selectable><option>Y</option><option>N</option><option selected>$rowx[2]</option></select></td>\n";
			echo "<td><select size=1 name=human_answered><option>Y</option><option>N</option><option selected>$rowx[3]</option></select></td>\n";
			echo "<td><select size=1 name=status_class><option>inbound</option><option>outbound</option><option selected>$rowx[10]</option></select></td>\n";
			echo "<td>\n";
			echo "<select size=1 name=category>\n";
			echo "$cats_list";
			echo "<option selected value=\"$AScategory\">$AScategory - $catsname_list[$AScategory]</option>\n";
			echo "</select>\n";
			echo "</td>\n";
			echo "<td>";
			echo "<select size=1 name=status_type>\n";
			echo $status_type_list;
			echo "<option selected value=\"$status_type\">$status_type_result_array[$status_type]</option>\n";
			echo "</select>\n";
			echo "</td>\n";
			echo "<td align=center nowrap><font size=1><input type=submit name=submit value=MODIFY> &nbsp; &nbsp; &nbsp; &nbsp; \n";
			echo " &nbsp; \n";
			
			if (preg_match("/^B$|^NA$|^DNC$|^NA$|^DROP$|^INCALL$|^QUEUE$|^NEW$/i",$rowx[0]))
				{
				echo "<DEL>DELETE</DEL>\n";
				}
			else
				{
				echo "<a onClick=\"delete_confirm('$PHP_SELF?ADD=421111111111111&status=$rowx[0]&stage=delete')\" href='#'>DELETE</a>\n";
				}

			echo "</td></tr><tr $bgcolor style=\"display:none\"><td colspan=6 align=center><FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>\n";

			echo "&nbsp; Sale: <select size=1 name=sale><option>Y</option><option>N</option><option selected>$rowx[5]</option></select> &nbsp; \n";
			echo "&nbsp; DNC: <select size=1 name=dnc><option>Y</option><option>N</option><option selected>$rowx[6]</option></select> &nbsp; \n";
			echo "&nbsp; Customer Contact: <select size=1 name=customer_contact><option>Y</option><option>N</option><option selected>$rowx[7]</option></select> &nbsp; \n";
			echo "&nbsp; Not Interested: <select size=1 name=not_interested><option>Y</option><option>N</option><option selected>$rowx[8]</option></select> &nbsp; \n";
			echo "&nbsp; Unworkable: <select size=1 name=unworkable><option>Y</option><option>N</option><option selected>$rowx[9]</option></select> &nbsp; \n";

			echo "</form></td></tr>\n";
			}

		echo "</table>\n";
		
		echo "<script language='javascript'>
				function check_for_status_type(obj){
					var add_status_type_obj = document.getElementById('add_status_type');
					var select_length = add_status_type_obj.length;

					for(var i=0;i<select_length;i++){
						if(add_status_type_obj.options[i].value==1){	//Answer
								add_status_type_obj.options[i].selected = 'selected';
						}
						else{
							if(obj.value=='inbound'){
								add_status_type_obj.options[i].style.display = 'none';
								add_status_type_obj.options[i].disabled = true;
							}
							else{
								add_status_type_obj.options[i].style.display = '';
								add_status_type_obj.options[i].disabled = false;
							}
						}
					}


				}
				</script>";

		echo "<br>ADD NEW SYSTEM STATUS<BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=221111111111111>\n";
		echo "Status: <input type=text name=status_id size=20 maxlength=20> &nbsp; \n";
		echo "Description: <input type=text name=status_name size=30 maxlength=30><BR>\n";
		echo "Selectable: <select size=1 name=selectable><option>Y</option><option>N</option></select> &nbsp; \n";
		echo "Human Answer: <select size=1 name=human_answered><option>Y</option><option>N</option></select> &nbsp; \n";
		echo "Class: <select size=1 name=status_class onchange='check_for_status_type(this)'><option value=inbound>inbound</option><option SELECTED value=outbound>outbound</option></select> &nbsp; \n";
		echo "<span id = sale_unworkable  style=\"display:none\">";
		echo "Sale: <select size=1 name=sale><option>Y</option><option SELECTED>N</option></select> &nbsp; \n";
		echo "DNC: <select size=1 name=dnc><option>Y</option><option SELECTED>N</option></select> &nbsp; \n";
		echo "Customer Contact: <select size=1 name=customer_contact><option>Y</option><option SELECTED>N</option></select> &nbsp; <BR>\n";
		echo "Not Interested: <select size=1 name=not_interested><option>Y</option><option SELECTED>N</option></select> &nbsp; \n";
		echo "Unworkable: <select size=1 name=unworkable><option>Y</option><option SELECTED>N</option></select> &nbsp; \n";
		echo "</span>";
		echo "Category: \n";
		echo "<select size=1 name=category>\n";
		echo "$cats_list";
		echo "<option selected value=\"$AScategory\">$AScategory - $catsname_list[$AScategory]</option>\n";
		echo "</select> &nbsp; <BR>\n";
		echo "Type: 
				<select size=1 id=add_status_type name=status_type>
				$status_type_list_add
				</select> ";
		echo "<input type=submit name=submit value=ADD><BR>\n";

		echo "</FORM><br>\n";

		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}





######################
# ADD=331111111111111 modify CCMS status categories
######################

if ($ADD==331111111111111)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br><center>\n";
		echo "<b>CCMS STATUS CATEGORIES: &nbsp; $NWB#vicidial_status_categories$NWE</b><br>\n";
		echo "<TABLE width=700 cellspacing=3>\n";
		echo "<tr><td>CATEGORY</td><td>NAME</td><td>Call Result IN THIS CATEGORY</td></tr>\n";

		$stmt="SELECT vsc_id,vsc_name,vsc_description,tovdad_display,sale_category,dead_lead_category from vicidial_status_categories order by vsc_id;";
		$rslt=mysql_query($stmt, $link);
		$statuses_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($statuses_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$Avsc_id[$o] =				$rowx[0];
			$Avsc_name[$o] =			$rowx[1];
			$Avsc_description[$o] =		$rowx[2];
			$Atovdad_display[$o] =		$rowx[3];
			$Asale_category[$o] =		$rowx[4];
			$Adead_lead_category[$o] =	$rowx[5];
			$o++;
			}
		$p=0;
		while ($o > $p)
			{
			if (eregi("1$|3$|5$|7$|9$", $p))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			$CATstatuses='';
			$stmt="SELECT status from vicidial_statuses where category='$Avsc_id[$p]' order by status;";
			$rslt=mysql_query($stmt, $link);
			$statuses_to_print = mysql_num_rows($rslt);
			$q=0;
			while ($statuses_to_print > $q) 
				{
				$rowx=mysql_fetch_row($rslt);
				$CATstatuses.=" $rowx[0]";
				$q++;
				}
			$stmt="SELECT status from vicidial_campaign_statuses where category='$Avsc_id[$p]' order by status;";
			$rslt=mysql_query($stmt, $link);
			$statuses_to_print = mysql_num_rows($rslt);
			$q=0;
			while ($statuses_to_print > $q) 
				{
				$rowx=mysql_fetch_row($rslt);
				$CATstatuses.=" $rowx[0]";
				$q++;
				}

			echo "<tr $bgcolor><td><form action=$PHP_SELF method=POST>\n";
			echo "<input type=hidden name=ADD value=431111111111111>\n";
			echo "<input type=hidden name=stage value=modify>\n";
			echo "<input type=hidden name=vsc_id value=\"$Avsc_id[$p]\">\n";
			echo "<font size=2><B>$Avsc_id[$p]</B></td>\n";
			echo "<td><input type=text name=vsc_name size=30 maxlength=50 value=\"$Avsc_name[$p]\"></td>\n";
			echo "<td><font size=1>\n";
			echo "$CATstatuses";
			echo "</td></tr>\n";
			echo "<tr $bgcolor>\n";
			echo "<td colspan=3>TO VDAD Display: <select size=1 name=tovdad_display><option>Y</option><option>N</option><option selected>$Atovdad_display[$p]</option></select> &nbsp; &nbsp; Sale Category: <select size=1 name=sale_category><option>Y</option><option>N</option><option selected>$Asale_category[$p]</option></select> &nbsp; &nbsp; Dead Lead Category: <select size=1 name=dead_lead_category><option>Y</option><option>N</option><option selected>$Adead_lead_category[$p]</option></select> &nbsp; </td></tr>\n";
			echo "<tr $bgcolor><td colspan=3><font size=1>Description: <input type=text name=vsc_description size=90 maxlength=255 value=\"$Avsc_description[$p]\"></td></tr>\n";
			echo "<tr $bgcolor><td colspan=3 align=center><font size=1><input type=submit name=submit value=MODIFY> &nbsp; &nbsp; &nbsp; &nbsp; \n";
			echo " &nbsp; <a onClick=\"delete_confirm('$PHP_SELF?ADD=431111111111111&vsc_id=$Avsc_id[$p]&stage=delete')\" href='#'>DELETE</a></td></tr>\n";
			echo "<tr><td colspan=4><font size=1> &nbsp; </form></td></tr>\n";

			$p++;
			}
	
		echo "</table>\n";

		echo "<br>ADD NEW STATUS CATEGORY<BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=231111111111111>\n";
		echo "Category ID: <input type=text name=vsc_id size=20 maxlength=20> &nbsp; \n";
		echo "Name: <input type=text name=vsc_name size=20 maxlength=50> &nbsp; <BR>\n";
		echo "TimeOnVDAD Display: <select size=1 name=tovdad_display><option>Y</option><option selected>N</option></select> &nbsp; \n";
		echo "Sale Category: <select size=1 name=sale_category><option>Y</option><option selected>N</option></select> &nbsp; \n";
		echo "Dead Lead Category: <select size=1 name=dead_lead_category><option>Y</option><option selected>N</option></select> &nbsp; <BR>\n";
		echo "Description: <input type=text name=vsc_description size=80 maxlength=255> &nbsp; \n";
		echo "<input type=submit name=submit value=ADD><BR>\n";

		echo "</FORM><br>\n";

		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=331111111111111222 modify CCMS status categories
######################

if ($ADD==331111111111111222)
	{
	if ($LOGmodify_servers==1)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br><center>\n";
		echo "<b>System Call Result Type: &nbsp; $NWB#vicidial_status_categories$NWE</b><br>\n";
		echo "<TABLE width=700 cellspacing=3>\n";
		echo "<tr><td>Type</td><td>Type Description</td><td>Active</td><td>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; DELETE</td></tr>\n";

		$stmt="SELECT type,typedescription,active,isdel from vicidial_status_type order by type;";
		$rslt=mysql_query($stmt, $link);
		$statuses_to_print = mysql_num_rows($rslt);
		$o=0;
		while ($statuses_to_print > $o) 
			{
			$rowx=mysql_fetch_row($rslt);
			$type[$o] =				$rowx[0];
			$dypedescription[$o] =			$rowx[1];
			$active[$o] =		$rowx[2];
			$isdel[$o] =		$rowx[3];
			$o++;
			}
		$p=0;
		while ($o > $p)
			{
			if (eregi("1$|3$|5$|7$|9$", $p))
				{$bgcolor='bgcolor="#C2C2C2"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}

			echo "<tr $bgcolor><td><form action=$PHP_SELF method=POST>\n";
			echo "<input type=hidden name=ADD value=431111111111111222>\n";
			echo "<input type=hidden name=stage value=modify>\n";
			echo "<input type=hidden name=vsc_id value=\"$type[$p]\">\n";
			echo "<font size=2><B>$type[$p]</B></td>\n";
			echo "<td><input type=text name=vsc_name size=30 maxlength=50 value=\"$dypedescription[$p]\"></td>\n";
			echo "<td><font size=2><select size=1 name=tovdad_display><option>N</option><option>Y</option><option selected>$active[$p]</option></select></td>\n";
			echo "<td align=center nowrap><font size=1><input type=submit name=submit value=MODIFY> &nbsp; &nbsp; &nbsp; &nbsp; \n";
			echo "<a onClick=\"delete_confirm('$PHP_SELF?ADD=431111111111111222&vsc_id=$rowx[0]&stage=delete')\" href='#'>DELETE</a></tr>\n";
		
			echo "<tr><td colspan=4><font size=1> &nbsp; </form></td></tr>\n";

			$p++;
			}
	
		echo "</table>\n";

		echo "<br>ADD NEW System Call Result Type<BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=231111111111111222>\n";
		echo "Type: <input type=text name=vsc_id size=2 maxlength=2> &nbsp; \n";
		echo "Type Description: <input type=text name=vsc_name size=20 maxlength=50> &nbsp; \n";
		echo "Active: <select size=1 name=tovdad_display><option>N</option><option selected>Y</option></select> &nbsp;<BR> \n";
		echo "<input type=submit name=submit value=ADD><BR>\n";

		echo "</FORM><br>\n";

		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=341111111111111 modify CCMS QC status code
######################

if ($ADD==341111111111111)
	{
	if ( ($LOGmodify_servers==1) and ($SSqc_features_active > 0) )
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		echo "<br><center>\n";
		echo "<b>CCMS QC STATUS CODES WITHIN THIS SYSTEM: &nbsp; $NWB#vicidial_qc_status_codes$NWE</b><br>\n";
		echo "<TABLE width=600 cellspacing=3>\n";
		echo "<tr><td>STATUS CODE</td><td>DESCRIPTION</td><td>MODIFY/DELETE</td></tr>\n";

		##### go through each QC status code
		$stmt="SELECT count(*) from vicidial_qc_codes;";
		$rslt=mysql_query($stmt, $link);
		$rowx=mysql_fetch_row($rslt);
		if ($rowx[0] > 0)
			{
			$stmt="SELECT code,code_name from vicidial_qc_codes order by code;";
			$rslt=mysql_query($stmt, $link);
			$statuses_to_print = mysql_num_rows($rslt);
			$o=0;
			while ($statuses_to_print > $o) 
				{
				$rowx=mysql_fetch_row($rslt);
				$o++;

				if (eregi("1$|3$|5$|7$|9$", $o))
					{$bgcolor='bgcolor="#FFFFFF"';} 
				else
					{$bgcolor='bgcolor="#C2C2C2"';}

				echo "<tr $bgcolor><td><form action=$PHP_SELF method=POST>\n";
				echo "<input type=hidden name=ADD value=441111111111111>\n";
				echo "<input type=hidden name=stage value=modify>\n";
				echo "<input type=hidden name=code value=\"$rowx[0]\">\n";
				echo "<font size=2><B>$rowx[0]</B></td>\n";
				echo "<td><input type=text name=code_name size=20 maxlength=30 value=\"$rowx[1]\"></td>\n";
				echo "<td align=center nowrap><font size=1><input type=submit name=submit value=MODIFY> &nbsp; &nbsp; &nbsp; &nbsp; \n";
				echo " &nbsp; \n";
				
				if (preg_match("/^B$|^NA$|^DNC$|^NA$|^DROP$|^INCALL$|^QUEUE$|^NEW$/i",$rowx[0]))
					{
					echo "<DEL>DELETE</DEL>\n";
					}
				else
					{
					echo "<a href=\"$PHP_SELF?ADD=441111111111111&status=$rowx[0]&stage=delete\">DELETE</a>\n";
					}
				echo "</form></td></tr>\n";
				}
			}
		echo "</table>\n";

		echo "<br>ADD NEW QC STATUS CODE<BR><form action=$PHP_SELF method=POST>\n";
		echo "<input type=hidden name=ADD value=241111111111111>\n";
		echo "Status: <input type=text name=code size=20 maxlength=20 value='".$campaign_id."_'> &nbsp; \n";
		echo "Description: <input type=text name=code_name size=30 maxlength=30><BR>\n";
		echo "<input type=submit name=submit value=ADD><BR>\n";

		echo "</FORM><br>\n";

		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}






######################
# ADD=550 user search form
######################

if ($ADD==550)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	echo "<br>SEARCH FOR A USER<form action=$PHP_SELF method=POST>\n";
	echo "<input type=hidden name=ADD value=660>\n";
	echo "<center><TABLE width=$section_width cellspacing=3>\n";
	echo "<tr bgcolor=#FFFFFF><td align=right>User Number: </td><td align=left><input type=text name=user size=20 maxlength=20></td></tr>\n";
	echo "<tr bgcolor=#FFFFFF><td align=right>Full Name: </td><td align=left><input type=text name=full_name size=30 maxlength=30></td></tr>\n";
	echo "<tr bgcolor=#FFFFFF><td align=right>User Level: </td><td align=left><select size=1 name=user_level>";
	$user_level_arr = array("5"=>"Agent","6"=>"QA","7"=>"Supervisor","8"=>"Manager","9"=>"Admin");
	foreach($user_level_arr as $k=>$v){
		if($k<=$LOGuser_level){
			echo "<option value=\"".$k."\">" . $v . "</option>";
		}
	}
	echo "</select></td></tr>\n";
	echo "<tr bgcolor=#FFFFFF><td align=right>User Group: </td><td align=left><select size=1 name=user_group>\n";
  
  /*comment by heibo 2011-4-22 9:37:47 统一成一个函数
	if($LOGuser_level==9){
		$stmt="SELECT user_group,group_name from vicidial_user_groups order by user_group";
	}else{
		$stmt="SELECT user_group,group_name from vicidial_user_groups where supervisor='$LOGuser_name_id' or manager='$LOGuser_name_id' order by user_group";
	}
	*/
	$stmt = getUserGroupsList($LOGuser_level,$LOGuser_name_id,1);
	$rslt=mysql_query($stmt, $link);
	$groups_to_print = mysql_num_rows($rslt);
	$o=0;
	$groups_list='';
	while ($groups_to_print > $o) 
		{
		$rowx=mysql_fetch_row($rslt);
		$groups_list .= "<option value=\"$rowx[0]\">$rowx[0] - $rowx[1]</option>\n";
		$o++;
		}
	echo "$groups_list</select></td></tr>\n";

	echo "<tr bgcolor=#FFFFFF><td align=center colspan=2><input type=submit name=search value=search></td></tr>\n";
	echo "</TABLE></center>\n";
	}

######################
# ADD=660 user search results
######################

if ($ADD==660)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$SQL = '';
	if ($user) {$SQL .= " user LIKE \"%$user%\" and";}
	if ($full_name) {$SQL .= " full_name LIKE \"%$full_name%\" and";}
	if ($user_level > 0) {$SQL .= " user_level LIKE \"%$user_level%\" and";}
	if ($user_group) {$SQL .= " user_group = '$user_group' and";}
	$SQL = eregi_replace(" and$", "", $SQL);
	if (strlen($SQL)>5) {$SQL = "and $SQL";}

	//$stmt="SELECT user_id,user,pass,full_name,user_level,user_group,phone_login,phone_pass,delete_users,delete_user_groups,delete_lists,delete_campaigns,delete_ingroups,delete_remote_agents,load_leads,campaign_detail,ast_admin_access,ast_delete_phones,delete_scripts,modify_leads,hotkeys_active,change_agent_campaign,agent_choose_ingroups,closer_campaigns,scheduled_callbacks,agentonly_callbacks,agentcall_manual,vicidial_recording,vicidial_transfers,delete_filters,alter_agent_interface_options,closer_default_blended,delete_call_times,modify_call_times,modify_users,modify_campaigns,modify_lists,modify_scripts,modify_filters,modify_ingroups,modify_usergroups,modify_remoteagents,modify_servers,view_reports,vicidial_recording_override,alter_custdata_override,qc_enabled,qc_user_level,qc_pass,qc_finish,qc_commit,add_timeclock_log,modify_timeclock_log,delete_timeclock_log,alter_custphone_override,vdc_agent_api_access,modify_inbound_dids,delete_inbound_dids,active,alert_enabled,download_lists,agent_shift_enforcement_override,manager_shift_enforcement_override,shift_override_flag,export_reports,delete_from_dnc,email,user_code,territory,allow_alerts from vicidial_users where user_level <= $LOGuser_level $SQL order by full_name desc;";
	$stmt = getSearchUsersList($LOGuser_level,$LOGuser_name_id,$SQL);
#	echo "\n|$stmt|\n";
	$rslt=mysql_query($stmt, $link);
	$people_to_print = mysql_num_rows($rslt);

	echo "<br>SEARCH RESULTS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";

	$o=0;
	while ($people_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		$user_role = "";
		switch($row[4]){
			case 5:
				$user_role = "Agent";
				break;
			case 7:
				$user_role = "Supervisor";
				break;
			case 8:
				$user_role = "Manager";
				break;
			case 9:
				$user_role = "Admin";
				break;
			default:
				$user_role = $row[2];
		}
		
		echo "<tr $bgcolor><td><font size=1>$row[1]</td><td><font size=1>$row[3]</td><td><font size=1>$user_role</td><td><font size=1>$row[5]</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=3&user=$row[1]\">MODIFY</a> | <span id=user_stats style=\"display:none\"><a href=\"./user_stats.php?user=$row[1]\">STATS</a> | </span><a href=\"./user_status.php?user=$row[1]\">STATUS</a><span id=time_sheet style=\"display:none\"> | <a href=\"./AST_agent_time_sheet.php?agent=$row[1]\">TIME</a></span></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";

	}


######################################################################################################
######################################################################################################
#######   8 series, Callback lists
######################################################################################################
######################################################################################################

######################
# ADD=8 find all callbacks on hold by a User
######################
if ($ADD==8)
	{
	if ($LOGmodify_users==1)
		{
		if ($SUB==89)
			{
			$stmt="UPDATE vicidial_callbacks SET status='INACTIVE' where user='$user' and status IN('LIVE','ACTIVE') and callback_time < '$past_month_date';";
			$rslt=mysql_query($stmt, $link);
			echo "<br>User($user) callback listings LIVE for more than one month have been made INACTIVE\n";
			}
		if ($SUB==899)
			{
			$stmt="UPDATE vicidial_callbacks SET status='INACTIVE' where user='$user' and status IN('LIVE','ACTIVE') and callback_time < '$past_week_date';";
			$rslt=mysql_query($stmt, $link);
			echo "<br>User($user) callback listings LIVE for more than one week have been made INACTIVE\n";
			}
		}
	$CBinactiveLINK = "<BR><a href=\"$PHP_SELF?ADD=8&SUB=89&user=$user\">Remove LIVE Callbacks older than one month for this user</a><BR><a href=\"$PHP_SELF?ADD=8&SUB=899&user=$user\">Remove LIVE Callbacks older than one week for this user</a><BR>";

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$CBquerySQLwhere = "and user='$user'";

	echo "<br>USER CALLBACK HOLD LISTINGS: $user\n";
	$oldADD = "ADD=8&user=$user";
	$ADD='82';
	}

######################
# ADD=81 find all callbacks on hold within a Campaign
######################
if ($ADD==81)
	{
	if ($LOGmodify_campaigns==1)
		{
		if ($SUB==89)
			{
			$stmt="UPDATE vicidial_callbacks SET status='INACTIVE' where campaign_id='$campaign_id' and status IN('LIVE','ACTIVE') and callback_time < '$past_month_date';";
			$rslt=mysql_query($stmt, $link);
			echo "<br>campaign($campaign_id) callback listings LIVE for more than one month have been made INACTIVE\n";
			}
		if ($SUB==899)
			{
			$stmt="UPDATE vicidial_callbacks SET status='INACTIVE' where campaign_id='$campaign_id' and status IN('LIVE','ACTIVE') and callback_time < '$past_week_date';";
			$rslt=mysql_query($stmt, $link);
			echo "<br>campaign($campaign_id) callback listings LIVE for more than one week have been made INACTIVE\n";
			}
		}
	$CBinactiveLINK = "<BR><a href=\"$PHP_SELF?ADD=81&SUB=89&campaign_id=$campaign_id\">Remove LIVE Callbacks older than one month for this campaign</a><BR><a href=\"$PHP_SELF?ADD=81&SUB=899&campaign_id=$campaign_id\">Remove LIVE Callbacks older than one week for this campaign</a><BR>";

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$CBquerySQLwhere = "and campaign_id='$campaign_id'";

	echo "<br>CAMPAIGN CALLBACK HOLD LISTINGS: $campaign_id\n";
	$oldADD = "ADD=81&campaign_id=$campaign_id";
	$ADD='82';
	}

######################
# ADD=811 find all callbacks on hold within a List
######################
if ($ADD==811)
	{
	if ($LOGmodify_lists==1)
		{
		if ($SUB==89)
			{
			$stmt="UPDATE vicidial_callbacks SET status='INACTIVE' where list_id='$list_id' and status IN('LIVE','ACTIVE') and callback_time < '$past_month_date';";
			$rslt=mysql_query($stmt, $link);
			echo "<br>list($list_id) callback listings LIVE for more than one month have been made INACTIVE\n";
			}
		if ($SUB==899)
			{
			$stmt="UPDATE vicidial_callbacks SET status='INACTIVE' where list_id='$list_id' and status IN('LIVE','ACTIVE') and callback_time < '$past_week_date';";
			$rslt=mysql_query($stmt, $link);
			echo "<br>list($list_id) callback listings LIVE for more than one week have been made INACTIVE\n";
			}
		}
	$CBinactiveLINK = "<BR><a href=\"$PHP_SELF?ADD=811&SUB=89&list_id=$list_id\">Remove LIVE Callbacks older than one month for this list</a><BR><a href=\"$PHP_SELF?ADD=811&SUB=899&list_id=$list_id\">Remove LIVE Callbacks older than one week for this list</a><BR>";

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$CBquerySQLwhere = "and list_id='$list_id'";

	echo "<br>LIST CALLBACK HOLD LISTINGS: $list_id\n";
	$oldADD = "ADD=811&list_id=$list_id";
	$ADD='82';
	}

######################
# ADD=8111 find all callbacks on hold within a user group
######################
if ($ADD==8111)
	{
	if ($LOGmodify_usergroups==1)
		{
		if ($SUB==89)
			{
			$stmt="UPDATE vicidial_callbacks SET status='INACTIVE' where user_group='$user_group' and status IN('LIVE','ACTIVE') and callback_time < '$past_month_date';";
			$rslt=mysql_query($stmt, $link);
			echo "<br>user group($user_group) callback listings LIVE for more than one month have been made INACTIVE\n";
			}
		if ($SUB==899)
			{
			$stmt="UPDATE vicidial_callbacks SET status='INACTIVE' where user_group='$user_group' and status IN('LIVE','ACTIVE') and callback_time < '$past_week_date';";
			$rslt=mysql_query($stmt, $link);
			echo "<br>user group($user_group) callback listings LIVE for more than one week have been made INACTIVE\n";
			}
		}
	$CBinactiveLINK = "<BR><a href=\"$PHP_SELF?ADD=8111&SUB=89&user_group=$user_group\">Remove LIVE Callbacks older than one month for this user group</a><BR><a href=\"$PHP_SELF?ADD=8111&SUB=899&user_group=$user_group\">Remove LIVE Callbacks older than one week for this user group</a><BR>";

	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$CBquerySQLwhere = "and user_group='$user_group'";

	echo "<br>USER GROUP CALLBACK HOLD LISTINGS: $list_id\n";
	$oldADD = "ADD=8111&user_group=$user_group";
	$ADD='82';
	}

######################
# ADD=82 display all callbacks on hold
######################
if ($ADD==82)
	{
	$USERlink='stage=USERIDDOWN';
	$GROUPlink='stage=GROUPDOWN';
	$ENDATElink='stage=ENDATEDOWN';
	$SQLorder='order by ';
	if (eregi("USERIDDOWN",$stage)) {$SQLorder='order by user desc,';   $USERlink='stage=USERIDUP';}
	if (eregi("GROUPDOWN",$stage)) {$SQLorder='order by user_group desc,';   $NAMElink='stage=NAMEUP';}
	if (eregi("ENDATEDOWN",$stage)) {$SQLorder='order by entry_time desc,';   $LEVELlink='stage=LEVELUP';}

	$stmt="SELECT callback_id,lead_id,list_id,campaign_id,status,entry_time,callback_time,modify_date,user,recipient,comments,user_group from vicidial_callbacks where status IN('ACTIVE','LIVE') $CBquerySQLwhere $SQLorder recipient,status desc,callback_time";
	$rslt=mysql_query($stmt, $link);
	$cb_to_print = mysql_num_rows($rslt);

	echo "<TABLE><TR><TD>\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>\n";
	echo "<td><font size=1 color=white>LEAD</td><td><font size=1 color=white>LIST</td>\n";
	echo "<td><font size=1 color=white> CAMPAIGN</td>\n";
	echo "<td><a href=\"$PHP_SELF?$oldADD&$ENDATElink\"><font size=1 color=white><B>ENTRY DATE</B></a></td>\n";
	echo "<td><font size=1 color=white>CALLBACK DATE</td>\n";
	echo "<td><a href=\"$PHP_SELF?$oldADD&$USERlink\"><font size=1 color=white><B>USER</B></a></td>\n";
	echo "<td><font size=1 color=white>RECIPIENT</td>\n";
	echo "<td><font size=1 color=white>STATUS</td>\n";
	echo "<td><a href=\"$PHP_SELF?$oldADD&$GROUPlink\"><font size=1 color=white><B>GROUP</B></a></td></tr>\n";

	$o=0;
	while ($cb_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor>";
		echo "<td><font size=1><A HREF=\"admin_modify_lead.php?lead_id=$row[1]\" target=\"_blank\">$row[1]</A></td>";
		echo "<td><font size=1><A HREF=\"$PHP_SELF?ADD=311&list_id=$row[2]\">$row[2]</A></td>";
		echo "<td><font size=1><A HREF=\"$PHP_SELF?ADD=31&campaign_id=$row[3]\">$row[3]</A></td>";
		echo "<td><font size=1>$row[5]</td>";
		echo "<td><font size=1>$row[6]</td>";
		echo "<td><font size=1><A HREF=\"$PHP_SELF?ADD=3&user=$row[8]\">$row[8]</A></td>";
		echo "<td><font size=1>$row[9]</td>";
		echo "<td><font size=1>$row[4]</td>";
		echo "<td><font size=1><A HREF=\"$PHP_SELF?ADD=311111&user_group=$row[11]\">$row[11]</A></td>";
		echo "</tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";

	echo "$CBinactiveLINK";
	}



######################################################################################################
######################################################################################################
#######   0 series, displays and searches
######################################################################################################
######################################################################################################

######################
# ADD=0 display all active users
######################
### Mod by fnatic if ($ADD==0)

if($ADD==0 && !isset($_GET["ccms_admin_modules"]))
	{
	require_once("SubPages.php");
	if (isset($_GET["user_search_user"])) 					{$user_search_user=$_GET["user_search_user"];}
    elseif (isset($_POST["user_search_user"])) 				{$user_search_user=$_POST["user_search_user"];}
	if (isset($_GET["user_search_user_1"])) 				{$user_search_user_1=$_GET["user_search_user_1"];}
    elseif (isset($_POST["user_search_user_1"]))			{$user_search_user_1=$_POST["user_search_user_1"];}
	if (isset($_GET["user_search_full_name"])) 				{$user_search_full_name=$_GET["user_search_full_name"];}
    elseif (isset($_POST["user_search_full_name"])) 		{$user_search_full_name=$_POST["user_search_full_name"];}
	if (isset($_GET["user_search_full_name_1"])) 			{$user_search_full_name_1=$_GET["user_search_full_name_1"];}
    elseif (isset($_POST["user_search_full_name_1"]))		{$user_search_full_name_1=$_POST["user_search_full_name_1"];}
	if (isset($_GET["user_search_user_level"])) 			{$user_search_user_level=$_GET["user_search_user_level"];}
    elseif (isset($_POST["user_search_user_level"]))		{$user_search_user_level=$_POST["user_search_user_level"];}
	if (isset($_GET["user_search_user_user_group"])) 		{$user_search_user_user_group=$_GET["user_search_user_user_group"];}
    elseif (isset($_POST["user_search_user_user_group"]))	{$user_search_user_user_group=$_POST["user_search_user_user_group"];}
	
	if((!isset($user_search_user))||trim($user_search_user)=='') $user_search_user = '=';
	if((!isset($user_search_user_1))||trim($user_search_user_1)=='') $user_search_user_1 = '';
	if((!isset($user_search_user_2))||trim($user_search_user_2)=='') $user_search_user_2 = '';
	$user_search_user = strtoupper(trim($user_search_user));
	
	$query_where_array = array();
	$display_2a = 0;
	
	if(($user_search_user == '='||$user_search_user == 'LIKE') && $user_search_user_1!=''){
		$query_where_array[] = "user $user_search_user '$user_search_user_1'";
	}
	if(($user_search_full_name == '='||$user_search_full_name == 'LIKE') && $user_search_full_name_1!=''){
		$query_where_array[] = "full_name $user_search_full_name '$user_search_full_name_1'";
	}
	
	if($user_search_user_level!=''){
		$query_where_array[] = "user_level='$user_search_user_level'";
	}
	if($user_search_user_user_group!=''){
		$query_where_array[] = "user_group='$user_search_user_user_group'";
	}
	
	
	$stmt = "SELECT user_group,group_name FROM vicidial.vicidial_user_groups order by user_group asc;";
    $rslt_user_groups=mysql_query($stmt, $link);
    $user_search_user_groups_count = mysql_num_rows($rslt_user_groups);
		?>
	<form action='?' name="user_search_form" method='POST' style="background-color:#ffffff">
	<input type="hidden" name="SubPages_page_size" id="SubPages_page_size"  value="<?=$SubPages_page_size?>">
	<input type="hidden" name="ADD" id="ADD"  value="0">
	<table border=0 cellpadding=2 cellspacing=0 width="97%" bgcolor="#fffff">
		<tr class=tr_bg_color>
			<td height="20" colspan="4"><font size="1" color="white"><b>QUERY CONDITION</b></font></td>
		</tr>
  <tr bgcolor='#c2c2c2'>
    <td class="small cellLabel3" align="left">User Number:</td>
    <td class="small cellLabel3" align="left">
	<select id="user_search_user" name="user_search_user">
		<option value="=" <?php if($user_search_user == '='){?>selected="selected"<?php }?>>=</option>
		<option value="LIKE" <?php if($user_search_user == 'LIKE'){?>selected="selected"<?php }?>>LIKE</option>
	</select>
	<input type="text" size="5" name="user_search_user_1" id="user_search_user_1" value="<?=$user_search_user_1?>" /></td>
    <td class="small cellLabel3" align="left">User Level:</td>
    <td class="small cellLabel3" align="left">
	<select name="user_search_user_level" size="1" class="importBox small" id="user_search_user_level" onchange="">
    <option value="">[ALL]</option>
	<option value="5" <?php if($user_search_user_level == '5'){?>selected="selected"<?php }?>>Agent</option>
	<option value="6" <?php if($user_search_user_level == '6'){?>selected="selected"<?php }?>>QA</option>
	<option value="7" <?php if($user_search_user_level == '7'){?>selected="selected"<?php }?>>Supervisor</option>
	<option value="8" <?php if($user_search_user_level == '8'){?>selected="selected"<?php }?>>Manager</option>
	<option value="9" <?php if($user_search_user_level == '9'){?>selected="selected"<?php }?>>Admin</option>
    </select> </td>
  </tr>
  
  <tr bgcolor='#c2c2c2'>
    <td class="small cellLabel3" align="left">Full Name:</td>
    <td class="small cellLabel3" align="left">
	<select id="user_search_full_name" name="user_search_full_name">
		<option value="=" <?php if($user_search_full_name == '='){?>selected="selected"<?php }?>>=</option>
		<option value="LIKE" <?php if($user_search_full_name == 'LIKE'){?>selected="selected"<?php }?>>LIKE</option>
	</select>
	<input type="text" size="5" name="user_search_full_name_1" id="user_search_full_name_1" value="<?=$user_search_full_name_1?>" /></td>
    <td class="small cellLabel3" align="left">User Group:</td>
    <td class="small cellLabel3" align="left">
	<select name="user_search_user_user_group" size="1" class="importBox small" id="user_search_user_user_group" onchange="">
    <option value="">[ALL]</option>
	<?php
    $o=0;
    while ($user_search_user_groups_count > $o){
    $row=mysql_fetch_row($rslt_user_groups);
    ?>
    <option value="<?=$row[0]?>" <?php if($row[0] == $user_search_user_user_group){?>selected="selected"<?php }?>><?=$row[0]." - ".$row[1]?></option>
    <?php
    $o++;
    }
    ?>

    </select> </td>
  </tr>

  <tr bgcolor='#ffffff'>
    <td colspan=4 align=right>
<?php
	if($errmsg=="")
	{

?>
		<!--<input type="button" class="inputsubmit" name="add" value="SEARCH" onclick="checkdate();">-->
<?php
	}
	else
	{
  		echo $errmsg;
	}
?>
		<input type='submit' name='log_submit' onclick="document.getElementById('stage').value=''" value='SEARCH'>    </td>
  </tr>
</table>
</form>
<?php
	
	
	echo "<TABLE><TR><TD>\n";
	//echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	//echo "USER LISTINGS: ";
	if (ereg('display_all',$status)) 
		{
		$SQLstatus = '';
		echo " &nbsp; <a href=\"$PHP_SELF?ADD=0\">show only active users</a>\n";
		}
	else
		{
		$SQLstatus = "and active='Y'";
		echo " &nbsp; <a href=\"$PHP_SELF?ADD=0&status=display_all\">show all users</a>\n";
		}

	$USERlink='stage=USERIDDOWN';
	$NAMElink='stage=NAMEDOWN';
	$LEVELlink='stage=LEVELDOWN';
	$GROUPlink='stage=GROUPDOWN';
	$SQLorder='order by full_name';
	if (eregi("USERIDUP",$stage)) {$SQLorder='order by user asc';   $USERlink='stage=USERIDDOWN';}
	if (eregi("USERIDDOWN",$stage)) {$SQLorder='order by user desc';   $USERlink='stage=USERIDUP';}
	if (eregi("NAMEUP",$stage)) {$SQLorder='order by full_name asc';   $NAMElink='stage=NAMEDOWN';}
	if (eregi("NAMEDOWN",$stage)) {$SQLorder='order by full_name desc';   $NAMElink='stage=NAMEUP';}
	if (eregi("LEVELUP",$stage)) {$SQLorder='order by user_level asc';   $LEVELlink='stage=LEVELDOWN';}
	if (eregi("LEVELDOWN",$stage)) {$SQLorder='order by user_level desc';   $LEVELlink='stage=LEVELUP';}
	if (eregi("GROUPUP",$stage)) {$SQLorder='order by user_group asc';   $GROUPlink='stage=GROUPDOWN';}
	if (eregi("GROUPDOWN",$stage)) {$SQLorder='order by user_group desc';   $GROUPlink='stage=GROUPUP';}
	
	$wherecondition_sql = "";
	/*comment by heibo 2011-4-20 17:50:46 bug 1581 统一成一个函数
	if($LOGuser_level == 9){
		$wherecondition_sql = " where 1 $SQLstatus $SQLorder";
	}else{
		$wherecondition_sql = " where user_level<=$LOGuser_level and user_group in (select distinct(user_group) from vicidial_user_groups where manager='$LOGuser_name_id' or supervisor='$LOGuser_name_id') $SQLstatus $SQLorder";
	}
	*/
	//echo $wherecondition_sql;exit;
	//$stmt="SELECT user,full_name,user_level,user_group,active from vicidial_users $wherecondition_sql";
	
	$query_where_str = '';
	$query_limit = '';
	if(count($query_where_array)>0){
		$query_where_str = " and ";
		$query_where_str .= implode(" and ",$query_where_array);
	}
	$row_start = ($SubPages_pageCurrent-1)*$SubPages_page_size;
	$query_limit = " limit $row_start,$SubPages_page_size ";
	
	$SQLstatus .= $query_where_str;
	
  	$stmt = getUsersList($LOGuser_level,$LOGuser_name_id,$SQLstatus,$SQLorder);
	$rslt=mysql_query($stmt, $link);
	$people_to_print = mysql_num_rows($rslt);
	$SubPages_nums = $people_to_print;
	
	$SQLorder .= $query_limit;
	
  	$stmt = getUsersList($LOGuser_level,$LOGuser_name_id,$SQLstatus,$SQLorder);
  	echo "$stmt";
	$rslt=mysql_query($stmt, $link);
	$people_to_print = mysql_num_rows($rslt);

	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><a href=\"$PHP_SELF?ADD=0&status=$status&$USERlink\"><font size=1 color=white><B>USER ID</B></a></td>";
	echo "<td><a href=\"$PHP_SELF?ADD=0&status=$status&$NAMElink\"><font size=1 color=white><B>FULL NAME</B></a></td>";
	echo "<td><a href=\"$PHP_SELF?ADD=0&status=$status&$LEVELlink\"><font size=1 color=white><B>LEVEL</B></a></td>";
	echo "<td><a href=\"$PHP_SELF?ADD=0&status=$status&$GROUPlink\"><font size=1 color=white><B>GROUP</B></a></td>";
	echo "<td><font size=1 color=white><B>ACTIVE</B></td>";
	echo "<td align=center><font size=1 color=white><B>LINKS</B></td></tr>\n";

	$o=0;
	while ($people_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		$user_role = "";
		switch($row[2]){
			case 5:
				$user_role = "Agent";
				break;
			case 6:
				$user_role = "QA";
				break;
			case 7:
				$user_role = "Supervisor";
				break;
			case 8:
				$user_role = "Manager";
				break;
			case 9:
				$user_role = "Admin";
				break;
			default:
				$user_role = $row[2];
		}
		echo "<tr $bgcolor><td><a href=\"$PHP_SELF?ADD=3&user=$row[0]\"><font size=1 color=black>$row[0]</a></td>";
		echo "<td title=\"$row[1]\"><font size=1>".cutstr($row[1],20)."</td>";
		echo "<td><font size=1>$user_role</td>";
		echo "<td><font size=1>$row[3]</td>";
		echo "<td><font size=1>$row[4]</td>";
		echo "<td><font size=1><CENTER><a href=\"$PHP_SELF?ADD=3&user=$row[0]\">MODIFY</a> | <span id=user_stats style=\"display:none\"><a href=\"./user_stats.php?user=$row[0]\">STATS</a> | </span><a href=\"./user_status.php?user=$row[0]\">STATUS</a><span id=time_sheet style=\"display:none\"> | <a href=\"./AST_agent_time_sheet.php?agent=$row[0]\">TIME</a></span></CENTER></td></tr>\n";
		$o++;
		}

	echo "<tr><td colspan=\"10\" align=\"right\">";
	$subPages=new SubPages($SubPages_page_size,$SubPages_nums,$SubPages_pageCurrent,$SubPages_sub_pages,$_SERVER['PHP_SELF']."?ADD=0&user_search_user=$user_search_user&user_search_user_1=$user_search_user_1&user_search_full_name=$user_search_full_name&user_search_full_name_1=$user_search_full_name_1&user_search_user_level=$user_search_user_level&user_search_user_user_group=$user_search_user_user_group&SubPages_page_size=$SubPages_page_size&SubPages_pageCurrent=",2);
	if($SubPages_page_size==20) $SubPages_page_size_20 = 'selected="selected"';
	if($SubPages_page_size==50) $SubPages_page_size_50 = 'selected="selected"';
	if($SubPages_page_size==100) $SubPages_page_size_100 = 'selected="selected"';
	echo "<select onchange=\"change_SubPages_page_size('user_search_form',this.value)\"><option $SubPages_page_size_20 value=\"20\">20</option><option $SubPages_page_size_50 value=\"50\">50</option><option $SubPages_page_size_100 value=\"100\">100</option></select></td></tr>";

	echo "</TABLE></center>\n";
	}

######################
# ADD=10 display all campaigns
######################
if ($ADD==10)
	{
		echo "<TABLE><TR><TD>\n";
		//echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
		$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id,'Y');
		//echo $stmt;
		$rslt=mysql_query($stmt, $link);
		$campaigns_to_print = mysql_num_rows($rslt);

		//echo "CAMPAIGN LISTINGS:\n";
		echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
		echo "<tr class=tr_bg_color>";
		echo "<td><font size=1 color=white align=left><B>CAMPAIGN ID</B></td>";
		echo "<td><font size=1 color=white><CENTER><B>NAME</B></CENTER></td>";
		echo "<td><font size=1 color=white><B>ACTIVE &nbsp; </B></td>";
		if ($SSoutbound_autodial_active > 0)
			{
			echo "<td><font size=1 color=white><B>DIAL METHOD &nbsp; </B></td>";
			echo "<td><font size=1 color=white><B> LEVEL &nbsp; </B></td>";
			echo "<td><font size=1 color=white><B>LEAD ORDER &nbsp; </B></td>";
			echo "<td><font size=1 color=white><B>DIAL Call Result &nbsp; </B></td>";
			}
		echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

		$o=0;
		while ($campaigns_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}
			echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=34&campaign_id=$row[0]\">$row[0]</a> &nbsp; </td>";
			echo "<td><font size=1>$row[1] &nbsp; </td>";
			echo "<td><font size=1>$row[2] &nbsp; </td>";
			if ($SSoutbound_autodial_active > 0)
				{
				echo "<td><font size=1>$row[3] &nbsp; </td>";
				echo "<td><font size=1>$row[4] &nbsp; </td>";
				echo "<td><font size=1>$row[5] &nbsp; </td>";
				echo "<td><font size=1>$row[6]</td>";
				}
			echo "<td><font size=1><a href=\"$PHP_SELF?ADD=31&campaign_id=$row[0]\">MODIFY</a></td></tr>\n";
			$o++;
			}

		echo "</TABLE></center>\n";
	}
######################
# ADD=100 display all lists
######################
if ($ADD==100)
	{
	require_once("SubPages.php");

	$campaign_limit = getListCampaign_limit($LOGuser_level,$LOGuser_name_id);
	
	if (isset($_GET["list_search_list_id"])) 						{$list_search_list_id=$_GET["list_search_list_id"];}
    elseif (isset($_POST["list_search_list_id"])) 					{$list_search_list_id=$_POST["list_search_list_id"];}
	if (isset($_GET["list_search_list_id_1"])) 						{$list_search_list_id_1=$_GET["list_search_list_id_1"];}
    elseif (isset($_POST["list_search_list_id_1"]))					{$list_search_list_id_1=$_POST["list_search_list_id_1"];}
	if (isset($_GET["list_search_list_id_2"])) 						{$list_search_list_id_2=$_GET["list_search_list_id_2"];}
    elseif (isset($_POST["list_search_list_id_2"]))					{$list_search_list_id_2=$_POST["list_search_list_id_2"];}
	
	if (isset($_GET["list_search_list_name"])) 						{$list_search_list_name=$_GET["list_search_list_name"];}
    elseif (isset($_POST["list_search_list_name"])) 				{$list_search_list_name=$_POST["list_search_list_name"];}
	if (isset($_GET["list_search_list_name_1"])) 					{$list_search_list_name_1=$_GET["list_search_list_name_1"];}
    elseif (isset($_POST["list_search_list_name_1"]))				{$list_search_list_name_1=$_POST["list_search_list_name_1"];}
	
	if (isset($_GET["list_search_list_description"])) 				{$list_search_list_description=$_GET["list_search_list_description"];}
    elseif (isset($_POST["list_search_list_description"])) 			{$list_search_list_description=$_POST["list_search_list_description"];}
	if (isset($_GET["list_search_list_description_1"])) 			{$list_search_list_description_1=$_GET["list_search_list_description_1"];}
    elseif (isset($_POST["list_search_list_description_1"]))		{$list_search_list_description_1=$_POST["list_search_list_description_1"];}
	
	if (isset($_GET["list_search_campaign_id"])) 						{$list_search_campaign_id=$_GET["list_search_campaign_id"];}
    elseif (isset($_POST["list_search_campaign_id"]))					{$list_search_campaign_id=$_POST["list_search_campaign_id"];}
	
	if((!isset($list_search_list_id))||trim($list_search_list_id)=='') $list_search_list_id = '=';
	if((!isset($list_search_list_id_1))||trim($list_search_list_id_1)=='') $list_search_list_id_1 = '';
	if((!isset($list_search_list_id_2))||trim($list_search_list_id_2)=='') $list_search_list_id_2 = '';
	$list_search_list_id = strtoupper(trim($list_search_list_id));
	
	$query_where_array = array();
	$display_2a = 0;
	if($list_search_list_id == 'BETWEEN' && ($list_search_list_id_1!=''||$list_search_list_id_2!='')){
		if($list_search_list_id_1==''||$list_search_list_id_2=='') $errmsg .= "[BETWEEN] cannot fill with blank";
		else{
			$query_where_array[] = "list_id between $list_search_list_id_1 and $list_search_list_id_2";
			$display_2a = 1;
		}
	}
	elseif(($list_search_list_id == '='||$list_search_list_id == 'LIKE') && $list_search_list_id_1!=''){
		$query_where_array[] = "list_id $list_search_list_id '$list_search_list_id_1'";
	}
	
	
	if(($list_search_list_name == '='||$list_search_list_name == 'LIKE') && $list_search_list_name_1!=''){
		$query_where_array[] = "list_name $list_search_list_name '$list_search_list_name_1'";
	}
	
	if(($list_search_list_description == '='||$list_search_list_description == 'LIKE') && $list_search_list_description_1!=''){
		$query_where_array[] = "list_description $list_search_list_description '$list_search_list_description_1'";
	}
	
	if($list_search_campaign_id!=''){
		$query_where_array[] = "campaign_id='$list_search_campaign_id'";
	}
	
	
	$stmt = "select DISTINCT(campaign_id) from vicidial_lists order by campaign_id asc";
    $rslt_campaign_id=mysql_query($stmt, $link);
    $list_search_campaign_id_count = mysql_num_rows($rslt_campaign_id);
		?>
	<form action='?' name="list_search_form" method='POST' style="background-color:#ffffff">
	<input type="hidden" name="SubPages_page_size" id="SubPages_page_size"  value="<?=$SubPages_page_size?>">
	<input type="hidden" name="ADD" id="ADD"  value="100">
	<table border=0 cellpadding=2 cellspacing=0 width="97%" bgcolor="#fffff">
		<tr class=tr_bg_color>
			<td height="20" colspan="4"><font size="1" color="white"><b>QUERY CONDITION</b></font></td>
		</tr>
  		<tr bgcolor='#c2c2c2'>
    <td class="small cellLabel3" align="left">List ID:</td>
    <td class="small cellLabel3" align="left">
	<select id="list_search_list_id" name="list_search_list_id"  onchange="query_type_select(this.id)">
		<option value="=" <?php if($list_search_list_id == '='){?>selected="selected"<?php }?>>=</option>
		<option value="LIKE" <?php if($list_search_list_id == 'LIKE'){?>selected="selected"<?php }?>>LIKE</option>
		<option value="BETWEEN" <?php if($list_search_list_id == 'BETWEEN'){?>selected="selected"<?php }?>>BETWEEN</option>
	</select>
	<input type="text" size="5" name="list_search_list_id_1" id="list_search_list_id_1" value="<?=$list_search_list_id_1?>" /><a id="list_search_list_id_2a" <?php if(!$display_2a){?>style="display:none"<?php }?>>&nbsp;and&nbsp;<input type="text" size="5" name="list_search_list_id_2" id="list_search_list_id_2" value="<?=$list_search_list_id_2?>" /></a></td>
    <td class="small cellLabel3" align="left">Campaign:</td>
    <td class="small cellLabel3" align="left">
	<select name="list_search_campaign_id" size="1" class="importBox small" id="list_search_campaign_id" onchange="">
    <option value="">[ALL]</option>
    <?php
    $o=0;
    while ($list_search_campaign_id_count > $o){
    $row=mysql_fetch_row($rslt_campaign_id);
    ?>
    <option value="<?=$row[0]?>" <?php if($row[0] == $list_search_campaign_id){?>selected="selected"<?php }?>><?=$row[0]?></option>
    <?php
    $o++;
    }
    ?>
    </select> </td>
  </tr>
  
  <tr bgcolor='#c2c2c2'>
    <td class="small cellLabel3" align="left">List Name:</td>
    <td class="small cellLabel3" align="left">
	<select id="list_search_list_name" name="list_search_list_name" >
		<option value="=" <?php if($list_search_list_name == '='){?>selected="selected"<?php }?>>=</option>
		<option value="LIKE" <?php if($list_search_list_name == 'LIKE'){?>selected="selected"<?php }?>>LIKE</option>
	</select>
	<input type="text" size="5" name="list_search_list_name_1" id="list_search_list_name_1" value="<?=$list_search_list_name_1?>" /></td>
	
    <td class="small cellLabel3" align="left">List Description:</td>
    <td class="small cellLabel3" align="left">
	<select id="list_search_list_description" name="list_search_list_description" >
		<option value="=" <?php if($list_search_list_description == '='){?>selected="selected"<?php }?>>=</option>
		<option value="LIKE" <?php if($list_search_list_description == 'LIKE'){?>selected="selected"<?php }?>>LIKE</option>
	</select>
	<input type="text" size="5" name="list_search_list_description_1" id="list_search_list_description_1" value="<?=$list_search_list_description_1?>" /></td>
  </tr>

  
  <tr bgcolor='#ffffff'>
    <td colspan=4 align=right>
<?php
	if($errmsg=="")
	{

?>
		<!--<input type="button" class="inputsubmit" name="add" value="SEARCH" onclick="checkdate();">-->
<?php
	}
	else
	{
  		echo $errmsg;
	}
?>
		<input type='submit' name='log_submit' onclick="document.getElementById('stage').value=''" value='SEARCH'>    </td>
  </tr>
</table>
</form>
	<?php
	
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	
	$LISTlink='stage=LISTIDDOWN';
	$TALLYlink='stage=TALLYDOWN';
	$ACTIVElink='stage=ACTIVEDOWN';
	$CAMPAIGNlink='stage=CAMPAIGNDOWN';
	$CALLDATElink='stage=CALLDATEDOWN';
	$SQLorder='order by list_id';
	if (eregi("LISTIDUP",$stage))		{$SQLorder='order by list_id asc';				$LISTlink='stage=LISTIDDOWN';}
	if (eregi("LISTIDDOWN",$stage))		{$SQLorder='order by list_id desc';				$LISTlink='stage=LISTIDUP';}
	if (eregi("TALLYUP",$stage))		{$SQLorder='order by tally asc';				$TALLYlink='stage=TALLYDOWN';}
	if (eregi("TALLYDOWN",$stage))		{$SQLorder='order by tally desc';				$TALLYlink='stage=TALLYUP';}
	if (eregi("ACTIVEUP",$stage))		{$SQLorder='order by active asc';				$ACTIVElink='stage=ACTIVEDOWN';}
	if (eregi("ACTIVEDOWN",$stage))		{$SQLorder='order by active desc';				$ACTIVElink='stage=ACTIVEUP';}
	if (eregi("CAMPAIGNUP",$stage))		{$SQLorder='order by campaign_id asc';			$CAMPAIGNlink='stage=CAMPAIGNDOWN';}
	if (eregi("CAMPAIGNDOWN",$stage))	{$SQLorder='order by campaign_id desc';			$CAMPAIGNlink='stage=CAMPAIGNUP';}
	if (eregi("CALLDATEUP",$stage))		{$SQLorder='order by list_lastcalldate asc';	$CALLDATElink='stage=CALLDATEDOWN';}
	if (eregi("CALLDATEDOWN",$stage))	{$SQLorder='order by list_lastcalldate desc';	$CALLDATElink='stage=CALLDATEUP';}
	
	$query_where_str = '';
	$query_limit = '';
	$SubPages_nums_query_where_str = '';
	if(count($query_where_array)>0){
		$implode_str = implode(" and ",$query_where_array);
		$query_where_str = " and ".$implode_str;
		$SubPages_nums_query_where_str = " where ".$implode_str;
	}
	$row_start = ($SubPages_pageCurrent-1)*$SubPages_page_size;
	$query_limit = " limit $row_start,$SubPages_page_size ";
	
	$stmt="SELECT count(*) from vicidial_lists $SubPages_nums_query_where_str";
	$rslt=mysql_query($stmt, $link);
	$row = mysql_fetch_row($rslt);
	$SubPages_nums = $row[0];



	   $stmt="SELECT vls.list_id,list_name,list_description,0 as tally,active,list_lastcalldate,campaign_id,reset_time,0 as tally from vicidial_lists vls where " . $campaign_limit . " 1=1 $query_where_str group by list_id $SQLorder $query_limit";
	   
	  // echo  $stmt;

	   $rslt=mysql_query($stmt, $link);
     $lists_to_print = mysql_num_rows($rslt);
     
			require("dbconnect_report.php");
			mysql_query("SET NAMES 'UTF8'");
			
			$stmt_bak = "SELECT vls.list_id,count(*) as tally from vicidial_lists vls,vicidial_list vl where vls.list_id=vl.list_id  group by list_id";
			$rslt_bak = mysql_query($stmt_bak, $link);
			$lists_to_print_bak = mysql_num_rows($rslt_bak);

			$o=0;
			$list_bak = array();
			while ($lists_to_print_bak > $o){			
			  $row=mysql_fetch_row($rslt_bak);
			  $list_bak[$row[0]] = $row[1];
				$o++;
			}
			
			$stmt_bak2 = "SELECT vls.list_id,count(*) as tally from vicidial_lists vls,vicidial_list vl where vls.list_id=vl.list_id and vl.called_since_last_reset='N'  group by list_id";
			$rslt_bak2 = mysql_query($stmt_bak2, $link);
			$lists_to_print_bak2 = mysql_num_rows($rslt_bak2);

			$o=0;
			$list_bak2 = array();
			while ($lists_to_print_bak2 > $o){			
			  $row=mysql_fetch_row($rslt_bak2);
			  $list_bak2[$row[0]] = $row[1];
				$o++;
			}
			
      require("dbconnect.php");
      mysql_query("SET NAMES 'UTF8'");
	

	//echo "LIST LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<TR class=tr_bg_color>";
	echo "<TD><a href=\"$PHP_SELF?ADD=100&$LISTlink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>LIST ID</B></a></TD>";
	echo "<TD><a href=\"$PHP_SELF?ADD=100&$CAMPAIGNlink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>CAMPAIGN</B></a></TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>LIST NAME</B></TD>";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>DESCRIPTION</B></TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>RTIME</B></TD>\n";
	echo "<TD><a href=\"$PHP_SELF?ADD=100&$TALLYlink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>TOTAL LEADS</B></a></TD>\n";
	echo "<TD><a href=\"$PHP_SELF?ADD=100&$TALLYlink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>SURPLUS LEADS</B></a></TD>\n";
	echo "<TD><a href=\"$PHP_SELF?ADD=100&$ACTIVElink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>ACTIVE</B></a></TD>";
	echo "<TD><a href=\"$PHP_SELF?ADD=100&$CALLDATElink\"><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>LAST CALL DATE</B></a></TD>";
	
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>MODIFY</TD>\n";
	echo "</TR>\n";

	$lists_printed = '';
	$o=0;
	while ($lists_to_print > $o)
		{
		$row=mysql_fetch_row($rslt);
		
		$lists_printed = $lists_printed . "'" . $row[0] . "',";
		
		$row[3] = isset($list_bak[$row[0]])?$list_bak[$row[0]]:0;
		
		$row[8] = isset($list_bak2[$row[0]])?$list_bak2[$row[0]]:0;

		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=311&list_id=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[6]</td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td title=\"$row[2]\"><font size=1>".cutstr($row[2],20)."</td>";
		echo "<td><font size=1> $row[7]</td>";
		echo "<td><font size=1> $row[3]</td>";
		echo "<td><font size=1> $row[8]</td>";
		echo "<td><font size=1> $row[4]</td>";
		echo "<td><font size=1> $row[5]</td>";	
		
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=311&list_id=$row[0]\">MODIFY</a></td></tr>\n";
		
		$o++;
		}
/*if(false){				##show list列表内容混乱，以下内容有重复 by akin
//if(trim($query_where_str) == ''){
	$stmt="SELECT list_id,list_name,list_description,0,active,list_lastcalldate,campaign_id,reset_time from vicidial_lists vls where " . $campaign_limit . "list_id NOT IN($lists_printed'');";
  //echo "========>".$stmt;
	$rslt=mysql_query($stmt, $link);
	$lists_to_print = mysql_num_rows($rslt);
	$o=0;
	while ($lists_to_print > $o)
		{
		$row=mysql_fetch_row($rslt);
		
		$row[3] = isset($list_bak[$row[0]])?$list_bak[$row[0]]:0;
		
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=311&list_id=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[6]</td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td><font size=1> $row[2]</td>";
		echo "<td><font size=1> $row[7]</td>";
		echo "<td><font size=1> $row[3]</td>";
		echo "<td><font size=1> $row[4]</td>";
		echo "<td><font size=1> $row[5]</td>";
		
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=311&list_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}
	}*/
	echo "<tr><td colspan=\"10\" align=\"right\">";
	$subPages=new SubPages($SubPages_page_size,$SubPages_nums,$SubPages_pageCurrent,$SubPages_sub_pages,$_SERVER['PHP_SELF']."?ADD=100&list_search_list_id=$list_search_list_id&list_search_list_id_1=$list_search_list_id_1&list_search_list_id_2=$list_search_list_id_2&list_search_list_description=$list_search_list_description&list_search_list_description_1=$list_search_list_description_1&list_search_campaign_id=$list_search_campaign_id&list_search_list_name=$list_search_list_name&list_search_list_name_1=$list_search_list_name_1&SubPages_page_size=$SubPages_page_size&SubPages_pageCurrent=",2);
	if($SubPages_page_size==20) $SubPages_page_size_20 = 'selected="selected"';
	if($SubPages_page_size==50) $SubPages_page_size_50 = 'selected="selected"';
	if($SubPages_page_size==100) $SubPages_page_size_100 = 'selected="selected"';
	echo "<select onchange=\"change_SubPages_page_size('list_search_form',this.value)\"><option $SubPages_page_size_20 value=\"20\">20</option><option $SubPages_page_size_50 value=\"50\">50</option><option $SubPages_page_size_100 value=\"100\">100</option></select></td></tr>";
	echo "</TABLE></center>\n";
	}



######################
# ADD=1000 display all inbound groups
######################
if ($ADD==1000)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT group_id,group_name,queue_priority,active,call_time_id,group_color from vicidial_inbound_groups order by group_id";
	$rslt=mysql_query($stmt, $link);
	$ingroups_to_print = mysql_num_rows($rslt);

	//echo "<br>INBOUND GROUP LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<TR class=tr_bg_color>";
	echo "<TD><font size=1 color=white>IN-GROUP</TD>";
	echo "<TD><font size=1 color=white>NAME</TD>";
	echo "<TD><font size=1 color=white>PRIORITY</TD>\n";
	echo "<TD><font size=1 color=white>ACTIVE</TD>";
	echo "<TD><font size=1 color=white>TIME</TD>";
	echo "<TD><font size=1 color=white>COLOR</TD>\n";
	echo "<TD><font size=1 color=white>MODIFY</TD>\n";
	echo "</TR>\n";

	$o=0;
	while ($ingroups_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=3111&group_id=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td><font size=1> $row[2]</td>";
		echo "<td><font size=1> $row[3]</td>";
		echo "<td><font size=1> $row[4]</td>";
		echo "<td bgcolor=\"$row[5]\"><font size=1> &nbsp;</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=3111&group_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}


######################
# ADD=1300 display all inbound dids
######################
if ($ADD==1300)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT did_id,did_pattern,did_description,did_active,did_route from vicidial_inbound_dids order by did_pattern";
	$rslt=mysql_query($stmt, $link);
	$dids_to_print = mysql_num_rows($rslt);

	echo "<br>INBOUND DID LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<TR class=tr_bg_color>";
	echo "<TD><font size=1 color=white>#</TD>";
	echo "<TD><font size=1 color=white>DID</TD>";
	echo "<TD><font size=1 color=white>DESCRIPTION</TD>\n";
	echo "<TD><font size=1 color=white>ACTIVE</TD>";
	echo "<TD><font size=1 color=white>ROUTE</TD>";
	echo "<TD><font size=1 color=white>MODIFY</TD>\n";
	echo "</TR>\n";

	$o=0;
	while ($dids_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=3311&did_id=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td><font size=1> $row[2]</td>";
		echo "<td><font size=1> $row[3]</td>";
		echo "<td><font size=1> $row[4]</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=3311&did_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}


######################
# ADD=1500 display all IVRs
######################
if ($ADD==1500)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT menu_id,menu_name,menu_prompt,menu_timeout from vicidial_call_menu order by menu_id";
	$rslt=mysql_query($stmt, $link);
	$menus_to_print = mysql_num_rows($rslt);

	echo "<br>IVR LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<TR class=tr_bg_color>";
	echo "<TD><font size=1 color=white>MENU ID</TD>";
	echo "<TD><font size=1 color=white>NAME</TD>";
	echo "<TD><font size=1 color=white>PROMPT</TD>\n";
	echo "<TD><font size=1 color=white>TIMEOUT</TD>";
	echo "<TD><font size=1 color=white>OPTIONS</TD>";
	echo "<TD><font size=1 color=white>MODIFY</TD>\n";
	echo "</TR>\n";

	$o=0;
	$menu_id = $MT;

	while ($menus_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$menu_id[$o] =		$row[0];
		$menu_name[$o] =	$row[1];
		$menu_prompt[$o] =	$row[2];
		$menu_timeout[$o] =	$row[3];
		$o++;
		}

	$o=0;
	while ($menus_to_print > $o) 
		{
		$stmt="SELECT count(*) from vicidial_call_menu_options where menu_id=\"$menu_id[$o]\";";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td title=\"$menu_id[$o]\"><font size=1><a href=\"$PHP_SELF?ADD=3511&menu_id=$menu_id[$o]\">".cutstr($menu_id[$o],20)."</a></td>";
		echo "<td title=\"$menu_name[$o]\"><font size=1>".cutstr($menu_name[$o],25)."</td>";
		echo "<td><font size=1> $menu_prompt[$o]</td>";
		echo "<td><font size=1> $menu_timeout[$o]</td>";
		echo "<td><font size=1> $row[0]</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=3511&menu_id=$menu_id[$o]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}
if ($ADD==15000)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT menu_id,menu_name,menu_prompt,menu_timeout from vicidial_call_menu order by menu_id";
	$rslt=mysql_query($stmt, $link);
	$menus_to_print = mysql_num_rows($rslt);

	echo "<br>Intelligent Route LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<TR class=tr_bg_color>";
	echo "<TD><font size=1 color=white>MENU ID</TD>";
	echo "<TD><font size=1 color=white>NAME</TD>";
	echo "<TD><font size=1 color=white>PROMPT</TD>\n";
	echo "<TD><font size=1 color=white>TIMEOUT</TD>";
	echo "<TD><font size=1 color=white>OPTIONS</TD>";
	echo "<TD><font size=1 color=white>MODIFY</TD>\n";
	echo "</TR>\n";

	$o=0;
	$menu_id = $MT;

	while ($menus_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$menu_id[$o] =		$row[0];
		$menu_name[$o] =	$row[1];
		$menu_prompt[$o] =	$row[2];
		$menu_timeout[$o] =	$row[3];
		$o++;
		}

	$o=0;
	while ($menus_to_print > $o) 
		{
		$stmt="SELECT count(*) from vicidial_call_menu_options where menu_id=\"$menu_id[$o]\";";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=35113511&menu_id=$menu_id[$o]\">$menu_id[$o]</a></td>";
		echo "<td><font size=1> $menu_name[$o]</td>";
		echo "<td><font size=1> $menu_prompt[$o]</td>";
		echo "<td><font size=1> $menu_timeout[$o]</td>";
		echo "<td><font size=1> $row[0]</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=3511&menu_id=$menu_id[$o]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}

######################
# ADD=10000 display all remote agents
######################
if ($ADD==10000)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT remote_agent_id,user_start,number_of_lines,server_ip,conf_exten,status,campaign_id from vicidial_remote_agents order by server_ip,campaign_id,user_start";
	$rslt=mysql_query($stmt, $link);
	$remoteagents_to_print = mysql_num_rows($rslt);

	//echo "<br>REMOTE AGENTS LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>USER</B></td>";
	echo "<td><font size=1 color=white><B>LINES</B></td>";
	echo "<td><font size=1 color=white><B>SERVER &nbsp; </B></td>";
	echo "<td><font size=1 color=white><B>CONF-EXTEN &nbsp; </B></td>";
	echo "<td><font size=1 color=white><B>STATUS &nbsp; </B></td>";
	echo "<td><font size=1 color=white><B>CAMPAIGN &nbsp; </B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($remoteagents_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31111&remote_agent_id=$row[0]\">$row[1]</a></td>";
		echo "<td><font size=1> $row[2]</td>";
		echo "<td><font size=1> $row[3]</td>";
		echo "<td><font size=1> $row[4]</td>";
		echo "<td><font size=1> $row[5]</td>";
		echo "<td><font size=1> $row[6]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=31111&remote_agent_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}


######################
# ADD=100000 display all user groups
######################
if ($ADD==100000)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";
	/* comment by heibo 统一成一个函数
	$stmt="SELECT user_group,group_name,forced_timeclock_login from vicidial_user_groups order by user_group";
	if($LOGuser_level==7 || $LOGuser_level==8){
		$stmt="SELECT user_group,group_name,forced_timeclock_login from vicidial_user_groups where manager='$LOGuser_name_id' or supervisor='$LOGuser_name_id' order by user_group";
	}
	*/
	
	$stmt = getUserGroupsList($LOGuser_level,$LOGuser_name_id,2);

	$rslt=mysql_query($stmt, $link);
	$usergroups_to_print = mysql_num_rows($rslt);

	//echo "<br>USER GROUPS LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>USER GROUP</B></td>";
	echo "<td><font size=1 color=white><B>GROUP NAME</B></td>";
	echo "<td><font size=1 color=white><B>FORCE TIMECLOCK &nbsp; </B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($usergroups_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=311111&user_group=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td><font size=1> $row[2]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=311111&user_group=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}


######################
# ADD=1000000 display all scripts
######################
if ($ADD==1000000)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT script_id,script_name,active from vicidial_scripts order by script_id";
	$rslt=mysql_query($stmt, $link);
	$scripts_to_print = mysql_num_rows($rslt);

	//echo "<br>SCRIPTS LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>SCRIPT ID</B></td>";
	echo "<td><font size=1 color=white><B>SCRIPT NAME</B></td>";
	echo "<td><font size=1 color=white><B>ACTIVE &nbsp; </B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($scripts_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=3111111&script_id=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td><font size=1> $row[2]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=3111111&script_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}


######################
# ADD=10000000 display all filters
######################
if ($ADD==10000000)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT lead_filter_id,lead_filter_name from vicidial_lead_filters order by lead_filter_id";
	$rslt=mysql_query($stmt, $link);
	$filters_to_print = mysql_num_rows($rslt);

	//echo "<br>LEAD FILTER LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>FILTER ID</B></td>";
	echo "<td><font size=1 color=white><B>FILTER NAME</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($filters_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31111111&lead_filter_id=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=31111111&lead_filter_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}

if ($ADD=="99998888" || $ADD=="999988888"){
	require("csat.php");
}
if ($ADD=="1500099"){
	require("intelligent_route.php");
}
######################
# ADD=100000000 display all call times
######################
if ($ADD==100000000)
	{
		if ($LOGast_admin_access==1)
		{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT call_time_id,call_time_name,ct_default_start,ct_default_stop from vicidial_call_times order by call_time_id";
	$rslt=mysql_query($stmt, $link);
	$calltimes_to_print = mysql_num_rows($rslt);

	echo "<br>CALL TIME LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>CALLTIME ID</B></td>";
	echo "<td><font size=1 color=white><B>CALLTIME NAME</B></td>";
	echo "<td><font size=1 color=white><B>DEFAULT START</B></td>";
	echo "<td><font size=1 color=white><B>DEFAULT STOP</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($calltimes_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=311111111&call_time_id=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td><font size=1> $row[2] </td>";
		echo "<td><font size=1> $row[3] </td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=311111111&call_time_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
			}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	
	}

######################
# ADD=1000000000 display all state call times
######################
if ($ADD==1000000000)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT state_call_time_id,state_call_time_state,state_call_time_name,sct_default_start,sct_default_stop from vicidial_state_call_times order by state_call_time_id";
	$rslt=mysql_query($stmt, $link);
	$statecalltimes_to_print = mysql_num_rows($rslt);

	echo "<br>STATE CALL TIME LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>CALLTIME ID</B></td>";
	echo "<td><font size=1 color=white><B>CALLTIME STATE</B></td>";
	echo "<td><font size=1 color=white><B>CALLTIME NAME</B></td>";
	echo "<td><font size=1 color=white><B>DEFAULT START</B></td>";
	echo "<td><font size=1 color=white><B>DEFAULT STOP</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($statecalltimes_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=3111111111&call_time_id=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td><font size=1> $row[2]</td>";
		echo "<td><font size=1> $row[3] </td>";
		echo "<td><font size=1> $row[4] </td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=3111111111&call_time_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}

######################
# ADD=130000000 display all shifts
######################
if ($ADD==130000000)
	{
	if ($LOGast_admin_access==1)
		{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT shift_id,shift_name,shift_start_time,shift_length,shift_weekdays from vicidial_shifts order by shift_id";
	$rslt=mysql_query($stmt, $link);
	$shifts_to_print = mysql_num_rows($rslt);

	echo "<br>SHIFT LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>SHIFT ID</B></td>";
	echo "<td><font size=1 color=white><B>SHIFT NAME</B></td>";
	echo "<td><font size=1 color=white><B>SHIFT START</B></td>";
	echo "<td><font size=1 color=white><B>SHIFT LENGTH</B></td>";
	echo "<td><font size=1 color=white><B>WEEKDAYS</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($shifts_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=331111111&shift_id=$row[0]\">$row[0]</a></td>";
		echo "<td title=\"$row[1]\"><font size=1>".cutstr($row[1],25)."</td>";
		echo "<td><font size=1> $row[2] </td>";
		echo "<td><font size=1> $row[3] </td>";
		echo "<td><font size=1> $row[4] </td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=331111111&shift_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
			}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}

######################
# ADD=10000000000 display all phones
######################
if ($ADD==10000000000)
	{
	require_once("SubPages.php");
	if ($LOGast_admin_access==1)
		{	
		
	if (isset($_GET["phone_search_exten"])) 				{$phone_search_exten=$_GET["phone_search_exten"];}
    elseif (isset($_POST["phone_search_exten"])) 			{$phone_search_exten=$_POST["phone_search_exten"];}
	if (isset($_GET["phone_search_exten_1"])) 				{$phone_search_exten_1=$_GET["phone_search_exten_1"];}
    elseif (isset($_POST["phone_search_exten_1"]))			{$phone_search_exten_1=$_POST["phone_search_exten_1"];}
	if (isset($_GET["phone_search_exten_2"])) 				{$phone_search_exten_2=$_GET["phone_search_exten_2"];}
    elseif (isset($_POST["phone_search_exten_2"]))			{$phone_search_exten_2=$_POST["phone_search_exten_2"];}
	if (isset($_GET["phone_search_server"])) 				{$phone_search_server=$_GET["phone_search_server"];}
    elseif (isset($_POST["phone_search_server"]))			{$phone_search_server=$_POST["phone_search_server"];}
	
	if((!isset($phone_search_exten))||trim($phone_search_exten)=='') $phone_search_exten = '=';
	if((!isset($phone_search_exten_1))||trim($phone_search_exten_1)=='') $phone_search_exten_1 = '';
	if((!isset($phone_search_exten_2))||trim($phone_search_exten_2)=='') $phone_search_exten_2 = '';
	$phone_search_exten = strtoupper(trim($phone_search_exten));
	
	$query_where_array = array();
	$display_2a = 0;
	if($phone_search_exten == 'BETWEEN' && ($phone_search_exten_1!=''||$phone_search_exten_2!='')){
		if($phone_search_exten_1==''||$phone_search_exten_2=='') $errmsg .= "[BETWEEN] cannot fill with blank";
		else{
			$query_where_array[] = "extension between $phone_search_exten_1 and $phone_search_exten_2";
			$display_2a = 1;
		}
	}
	elseif(($phone_search_exten == '='||$phone_search_exten == 'LIKE') && $phone_search_exten_1!=''){
		$query_where_array[] = "extension $phone_search_exten '$phone_search_exten_1'";
	}
	if($phone_search_server!=''){
		$query_where_array[] = "server_ip='$phone_search_server'";
	}
	
	
	$stmt = "select DISTINCT(server_ip) from phones";
    $rslt_server_ip=mysql_query($stmt, $link);
    $phone_search_server_ip = mysql_num_rows($rslt_server_ip);
		?>
	<form action='?' name="phone_search_form" method='POST' style="background-color:#ffffff">
	<input type="hidden" name="SubPages_page_size" id="SubPages_page_size"  value="<?=$SubPages_page_size?>">
	<input type="hidden" name="ADD" id="ADD"  value="10000000000">
	<table border=0 cellpadding=2 cellspacing=0 width="97%" bgcolor="#fffff">
		<tr class=tr_bg_color>
			<td height="20" colspan="4"><font size="1" color="white"><b>QUERY CONDITION</b></font></td>
		</tr>
  		<tr bgcolor='#c2c2c2'>
    <td class="small cellLabel3" align="left">EXTEN:</td>
    <td class="small cellLabel3" align="left">
	<select id="phone_search_exten" name="phone_search_exten"  onchange="query_type_select(this.id)">
		<option value="=" <?php if($phone_search_exten == '='){?>selected="selected"<?php }?>>=</option>
		<option value="LIKE" <?php if($phone_search_exten == 'LIKE'){?>selected="selected"<?php }?>>LIKE</option>
		<option value="BETWEEN" <?php if($phone_search_exten == 'BETWEEN'){?>selected="selected"<?php }?>>BETWEEN</option>
	</select>
	<input type="text" size="5" name="phone_search_exten_1" id="phone_search_exten_1" value="<?=$phone_search_exten_1?>" /><a id="phone_search_exten_2a" <?php if(!$display_2a){?>style="display:none"<?php }?>>&nbsp;and&nbsp;<input type="text" size="5" name="phone_search_exten_2" id="phone_search_exten_2" value="<?=$phone_search_exten_2?>" /></a></td>
    <td class="small cellLabel3" align="left">SERVER:</td>
    <td class="small cellLabel3" align="left">
	<select name="phone_search_server" size="1" class="importBox small" id="phone_search_server" onchange="">
    <option value="">[ALL]</option>
    <?php
    $o=0;
    while ($phone_search_server_ip > $o){
    $row=mysql_fetch_row($rslt_server_ip);
    ?>
    <option value="<?=$row[0]?>" <?php if($row[0] == $phone_search_server){?>selected="selected"<?php }?>><?=$row[0]?></option>
    <?php
    $o++;
    }
    ?>
    </select> </td>
  </tr>
  <tr bgcolor='#ffffff'>
    <td colspan=4 align=right>
<?php
	if($errmsg=="")
	{
?>
		<!--<input type="button" class="inputsubmit" name="add" value="SEARCH" onclick="checkdate();">-->
<?php
	}
	else
	{
  		echo $errmsg;
	}
?>
		<input type='submit' name='log_submit' onclick="document.getElementById('stage').value=''" value='SEARCH'>    </td>
  </tr>
</table>
</form>
	<?php
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$EXTENlink='stage=EXTENDOWN';
	$PROTOlink='stage=PROTODOWN';
	$SERVERlink='stage=SERVERDOWN';
	$STATUSlink='stage=STATUSDOWN';
	$SQLorder='order by extension,server_ip';
	if (eregi("EXTENUP",$stage)) {$SQLorder='order by extension asc';   $EXTENlink='stage=EXTENDOWN';}
	if (eregi("EXTENDOWN",$stage)) {$SQLorder='order by extension desc';   $EXTENlink='stage=EXTENUP';}
	if (eregi("PROTOUP",$stage)) {$SQLorder='order by protocol asc';   $PROTOlink='stage=PROTODOWN';}
	if (eregi("PROTODOWN",$stage)) {$SQLorder='order by protocol desc';   $PROTOlink='stage=PROTOUP';}
	if (eregi("SERVERUP",$stage)) {$SQLorder='order by server_ip asc';   $SERVERlink='stage=SERVERDOWN';}
	if (eregi("SERVERDOWN",$stage)) {$SQLorder='order by server_ip desc';   $SERVERlink='stage=SERVERUP';}
	if (eregi("STATUSUP",$stage)) {$SQLorder='order by status asc';   $STATUSlink='stage=STATUSDOWN';}
	if (eregi("STATUSDOWN",$stage)) {$SQLorder='order by status desc';   $STATUSlink='stage=STATUSUP';}
	
	$query_where_str = '';
	$query_limit = '';
	if(count($query_where_array)>0){
		$query_where_str = " where ";
		$query_where_str .= implode(" and ",$query_where_array);
	}
	$row_start = ($SubPages_pageCurrent-1)*$SubPages_page_size;
	$query_limit = " limit $row_start,$SubPages_page_size ";
	
	$stmt="SELECT count(*) from phones $query_where_str";
	$rslt=mysql_query($stmt, $link);
	$row = mysql_fetch_row($rslt);
	$SubPages_nums = $row[0];
	
	$stmt="SELECT extension,protocol,server_ip,dialplan_number,voicemail_id,status,fullname,messages,old_messages from phones $query_where_str $SQLorder $query_limit";
	$rslt=mysql_query($stmt, $link);
	$phones_to_print = mysql_num_rows($rslt);
	
	//echo "<br>PHONE LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><a href=\"$PHP_SELF?ADD=10000000000&$EXTENlink\"><font size=1 color=white><B>EXTEN</B></a></td>";
	echo "<td><a href=\"$PHP_SELF?ADD=10000000000&$PROTOlink\"><font size=1 color=white><B>PROTO</B></a></td>";
	echo "<td><a href=\"$PHP_SELF?ADD=10000000000&$SERVERlink\"><font size=1 color=white><B>SERVER</B></a></td>";
	echo "<td colspan=2><font size=1 color=white><B>DIAL PLAN</B></td>";
	echo "<td><a href=\"$PHP_SELF?ADD=10000000000&$STATUSlink\"><font size=1 color=white><B>STATUS</B></a></td>";
	echo "<td><font size=1 color=white><B>NAME</B></td>";
	echo "<td colspan=2><font size=1 color=white><B>VMAIL</B></td>";
	echo "<td align=center><font size=1 color=white><B>LINKS</B></td></tr>\n";

	$o=0;
	while ($phones_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td title=\"$row[0]\"><a href=\"$PHP_SELF?ADD=31111111111&extension=$row[0]&server_ip=$row[2]\"><font size=1 color=black>".cutstr($row[0],7)."</font></a></td>
		<td><font size=1>$row[1]</td>
		<td><font size=1>$row[2]</td>
		<td><font size=1>$row[3]</td>
		<td><font size=1>$row[4]</td>
		<td><font size=1>$row[5]</td>
		<td><font size=1>$row[6]</td>
		<td><font size=1>$row[7]</td>
		<td><font size=1>$row[8]</td>";
		echo "<td><font size=1><a href=\"$PHP_SELF?ADD=31111111111&extension=$row[0]&server_ip=$row[2]\">MODIFY</a> | <a href=\"./phone_stats.php?extension=$row[0]&server_ip=$row[2]\">STATS</a></td></tr>\n";
		$o++;
		}

	echo "<tr><td colspan=\"10\" align=\"right\">";
	$subPages=new SubPages($SubPages_page_size,$SubPages_nums,$SubPages_pageCurrent,$SubPages_sub_pages,$_SERVER['PHP_SELF']."?ADD=10000000000&phone_search_exten=$phone_search_exten&phone_search_exten_1=$phone_search_exten_1&phone_search_exten_2=$phone_search_exten_2&phone_search_server=$phone_search_server&SubPages_page_size=$SubPages_page_size&SubPages_pageCurrent=",2);
	if($SubPages_page_size==20) $SubPages_page_size_20 = 'selected="selected"';
	if($SubPages_page_size==50) $SubPages_page_size_50 = 'selected="selected"';
	if($SubPages_page_size==100) $SubPages_page_size_100 = 'selected="selected"';
	echo "<select onchange=\"change_SubPages_page_size('phone_search_form',this.value)\"><option $SubPages_page_size_20 value=\"20\">20</option><option $SubPages_page_size_50 value=\"50\">50</option><option $SubPages_page_size_100 value=\"100\">100</option></select></td></tr>";
	echo "</TABLE></center>\n";
	
	   
			}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}

######################
# ADD=12000000000 display all phones alias
######################
if ($ADD==12000000000)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT alias_id,alias_name,logins_list from phones_alias order by alias_id;";
	$rslt=mysql_query($stmt, $link);
	$phonealias_to_print = mysql_num_rows($rslt);

	echo "<br>PHONE ALIAS LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white><B>ALIAS ID</B></a></td>";
	echo "<td><font size=1 color=white><B>ALIAS NAME</B></a></td>";
	echo "<td><font size=1 color=white><B>PHONE LOGINS LIST</B></a></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($phonealias_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><a href=\"$PHP_SELF?ADD=32111111111&alias_id=$row[0]\"><font size=1 color=black>$row[0]</font></a></td>";
		echo "<td><font size=1>$row[1]</td>";
		echo "<td><font size=1>$row[2]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=32111111111&alias_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}

######################
# ADD=13000000000 display all group alias
######################
if ($ADD==13000000000)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT group_alias_id,group_alias_name,caller_id_number,caller_id_name,active from groups_alias order by group_alias_id;";
	$rslt=mysql_query($stmt, $link);
	$phonealias_to_print = mysql_num_rows($rslt);

	echo "<br>GROUP ALIAS LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white><B>GROUP ALIAS ID</B></a></td>";
	echo "<td><font size=1 color=white><B>GROUP ALIAS NAME</B></a></td>";
	echo "<td><font size=1 color=white><B>CID NUMBER</B></a></td>";
	echo "<td><font size=1 color=white><B>CID NAME</B></a></td>";
	echo "<td><font size=1 color=white><B>ACTIVE</B></a></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($phonealias_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><a href=\"$PHP_SELF?ADD=33111111111&group_alias_id=$row[0]\"><font size=1 color=black>$row[0]</font></a></td>";
		echo "<td><font size=1>$row[1]</td>";
		echo "<td><font size=1>$row[2]</td>";
		echo "<td><font size=1>$row[3]</td>";
		echo "<td><font size=1>$row[4]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=33111111111&group_alias_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}

######################
# ADD=100000000000 display all servers
######################
if ($ADD==100000000000)
	{
	if ($LOGast_admin_access==1)
		{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT server_id,server_description,server_ip,active,asterisk_version,max_vicidial_trunks,local_gmt from servers order by server_id";
	$rslt=mysql_query($stmt, $link);
	$servers_to_print = mysql_num_rows($rslt);

	echo "<br>SERVER LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>SERVER ID</B></td>";
	echo "<td><font size=1 color=white><B>NAME</B></td>";
	echo "<td><font size=1 color=white><B>SERVER IP</B></td>";
	echo "<td><font size=1 color=white><B>ACTIVE</B></td>";
	echo "<td><font size=1 color=white><B>ASTERISK</B></td>";
	echo "<td><font size=1 color=white><B>TRUNKS</B></td>";
	echo "<td><font size=1 color=white><B>GMT</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($servers_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=311111111111&server_id=$row[0]\">$row[0]</a></td>";
		echo "<td title=\"$row[1]\"><font size=1>".cutstr($row[1],20)."</td>";
		echo "<td><font size=1>$row[2]</td>";
		echo "<td><font size=1>$row[3]</td>";
		echo "<td><font size=1>$row[4]</td>";
		echo "<td><font size=1>$row[5]</td>";
		echo "<td><font size=1>$row[6]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=311111111111&server_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
			}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}

######################
# ADD=130000000000 display all conf templates
######################
if ($ADD==130000000000)
	{
	if ($LOGast_admin_access==1)
		{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT template_id,template_name from vicidial_conf_templates order by template_id";
	$rslt=mysql_query($stmt, $link);
	$templates_to_print = mysql_num_rows($rslt);

	echo "<br>CONF TEMPLATE LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>Template ID</B></td>";
	echo "<td><font size=1 color=white><B>Template Name</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($templates_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=331111111111&template_id=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1>$row[1]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=331111111111&template_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}

######################
# ADD=140000000000 display all carriers
######################
if ($ADD==140000000000)
	{
		if ($LOGast_admin_access==1)
		{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT carrier_id,carrier_name,server_ip,protocol,registration_string,active from vicidial_server_carriers order by carrier_id";
	$rslt=mysql_query($stmt, $link);
	$carriers_to_print = mysql_num_rows($rslt);

	echo "<br>CARRIER LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>Carrier ID</B></td>";
	echo "<td><font size=1 color=white><B>Carrier Name</B></td>";
	echo "<td><font size=1 color=white><B>Server IP</B></td>";
	echo "<td><font size=1 color=white><B>Protocol</B></td>";
	echo "<td><font size=1 color=white><B>Registration</B></td>";
	echo "<td><font size=1 color=white><B>Active</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($carriers_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=341111111111&carrier_id=$row[0]\">$row[0]</a></td>";
		echo "<td title=\"$row[1]\"><font size=1>".cutstr($row[1],25)."</td>";
		echo "<td><font size=1>$row[2]</td>";
		echo "<td><font size=1>$row[3]</td>";
		echo "<td title=\"$row[4]\"><font size=1>".cutstr($row[4],45)."</td>";
		echo "<td><font size=1>$row[5]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=341111111111&carrier_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
			}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=150000000000 display all tts entries
######################
if ($ADD==150000000000)
	{
		if ($LOGast_admin_access==1)
		{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT tts_id,tts_name,active,tts_text from vicidial_tts_prompts order by tts_id";
	$rslt=mysql_query($stmt, $link);
	$tts_to_print = mysql_num_rows($rslt);

	echo "<br>TEXT-TO-SPEECH(TTS) LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>TTS ID</B></td>";
	echo "<td><font size=1 color=white><B>TTS Name</B></td>";
	echo "<td><font size=1 color=white><B>Active</B></td>";
	echo "<td><font size=1 color=white><B>TTS Text</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($tts_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$row[3]=ereg_replace(";|<|>","",$row[3]);
		while(strlen($row[3]) > 50) {$row[3] = substr("$row[3]", 0, -1);}
		if(strlen($row[3]) > 47) {$row[3] = "$row[3]...";}

		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td title=\"$row[0]\"><font size=1><a href=\"$PHP_SELF?ADD=351111111111&tts_id=$row[0]\">".cutstr($row[0],10)."</a></td>";
		echo "<td title=\"$row[1]\"><font size=1>".cutstr($row[1],25)."</td>";
		echo "<td><font size=1>$row[2]</td>";
		echo "<td title=\"$row[3]\"><font size=1>".cutstr($row[3],25)."</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=351111111111&tts_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
			}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=160000000000 display all music on hold entries
######################
if ($ADD==160000000000)
	{
		if ($LOGast_admin_access==1)
		{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT moh_id,moh_name,active,random from vicidial_music_on_hold where remove='N' order by moh_id";
	$rslt=mysql_query($stmt, $link);
	$moh_to_print = mysql_num_rows($rslt);

	echo "<br>MUSIC-ON-HOLD(MOH) LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>MOH ID</B></td>";
	echo "<td><font size=1 color=white><B>MOH Name</B></td>";
	echo "<td><font size=1 color=white><B>Active</B></td>";
	echo "<td><font size=1 color=white><B>Random Order</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($moh_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		$row[3]=ereg_replace(";|<|>","",$row[3]);
		while(strlen($row[3]) > 50) {$row[3] = substr("$row[3]", 0, -1);}
		if(strlen($row[3]) > 47) {$row[3] = "$row[3]...";}

		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td title=\"$row[0]\"><font size=1><a href=\"$PHP_SELF?ADD=361111111111&moh_id=$row[0]\">".cutstr($row[0],20)."</a></td>";
		echo "<td title=\"$row[1]\"><font size=1>".cutstr($row[1],25)."</td>";
		echo "<td><font size=1>$row[2]</td>";
		echo "<td><font size=1>$row[3]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=361111111111&moh_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
			}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=170000000000 display all voicemail entries
######################
if ($ADD==170000000000)
	{
		if ($LOGast_admin_access==1)
		{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT voicemail_id,fullname,active,messages,old_messages,delete_vm_after_email from vicidial_voicemail order by voicemail_id";
	$rslt=mysql_query($stmt, $link);
	$vm_to_print = mysql_num_rows($rslt);

	echo "<br>VOICEMAIL BOXES:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>VOICEMAIL ID</B></td>";
	echo "<td><font size=1 color=white><B>Name</B></td>";
	echo "<td><font size=1 color=white><B>Active</B></td>";
	echo "<td><font size=1 color=white><B>New Messages</B></td>";
	echo "<td><font size=1 color=white><B>Old Messages</B></td>";
	echo "<td><font size=1 color=white><B>Delete</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($vm_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);

		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=371111111111&voicemail_id=$row[0]\">$row[0]</a></td>";
		echo "<td title=\"$row[1]\"><font size=1>".cutstr($row[1],20)."</td>";
		echo "<td><font size=1>$row[2]</td>";
		echo "<td><font size=1>$row[3]</td>";
		echo "<td><font size=1>$row[4]</td>";
		echo "<td><font size=1>$row[5]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=371111111111&voicemail_id=$row[0]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=1000000000000 display all conferences
######################
if ($ADD==1000000000000)
	{
	if ($LOGast_admin_access==1)
		{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT conf_exten,server_ip,extension from conferences order by conf_exten";
	$rslt=mysql_query($stmt, $link);
	$conferences_to_print = mysql_num_rows($rslt);

	echo "<br>CONFERENCE LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>CONFERENCE</B></td>";
	echo "<td><font size=1 color=white><B>SERVER IP</B></td>";
	echo "<td><font size=1 color=white><B>EXTENSION</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($conferences_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=3111111111111&conf_exten=$row[0]&server_ip=$row[1]\">$row[0]</a></td>";
		echo "<td><font size=1>$row[1]</td>";
		echo "<td><font size=1>$row[2]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=3111111111111&conf_exten=$row[0]&server_ip=$row[1]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}

######################
# ADD=10000000000000 display all CCMS conferences
######################
if ($ADD==10000000000000)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT conf_exten,server_ip,extension from vicidial_conferences order by conf_exten";
	$rslt=mysql_query($stmt, $link);
	$vicidialconf_to_print = mysql_num_rows($rslt);

	echo "<br>CCMS CONFERENCE LISTINGS:\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<tr class=tr_bg_color>";
	echo "<td><font size=1 color=white align=left><B>CONFERENCE</B></td>";
	echo "<td><font size=1 color=white><B>SERVER IP</B></td>";
	echo "<td><font size=1 color=white><B>EXTENSION</B></td>";
	echo "<td align=center><font size=1 color=white><B>MODIFY</B></td></tr>\n";

	$o=0;
	while ($vicidialconf_to_print > $o) 
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=31111111111111&conf_exten=$row[0]&server_ip=$row[1]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td><font size=1> $row[2]</td>";
		echo "<td align=center><font size=1><a href=\"$PHP_SELF?ADD=31111111111111&conf_exten=$row[0]&server_ip=$row[1]\">MODIFY</a></td></tr>\n";
		$o++;
		}

	echo "</TABLE></center>\n";
	}





######################
# ADD=700000000000000 view all activity in the admin log
######################

if ($ADD==700000000000000)
	{
	
if (isset($_GET["admin_log_section"]))			{$admin_log_section=$_GET["admin_log_section"];}
	elseif (isset($_POST["admin_log_section"]))	{$admin_log_section=$_POST["admin_log_section"];}
if (isset($_GET["admin_log_type"]))			{$admin_log_type=$_GET["admin_log_type"];}
	elseif (isset($_POST["admin_log_type"]))	{$admin_log_type=$_POST["admin_log_type"];}
if (isset($_GET["admin_log_recordid"]))			{$admin_log_recordid=$_GET["admin_log_recordid"];}
	elseif (isset($_POST["admin_log_recordid"]))	{$admin_log_recordid=$_POST["admin_log_recordid"];}
if (isset($_GET["admin_log_datefrom_ymd"]))			{$admin_log_datefrom_ymd=$_GET["admin_log_datefrom_ymd"];}
	elseif (isset($_POST["admin_log_datefrom_ymd"]))	{$admin_log_datefrom_ymd=$_POST["admin_log_datefrom_ymd"];}
if (isset($_GET["admin_log_dateto_ymd"]))			{$admin_log_dateto_ymd=$_GET["admin_log_dateto_ymd"];}
	elseif (isset($_POST["admin_log_dateto_ymd"]))	{$admin_log_dateto_ymd=$_POST["admin_log_dateto_ymd"];}
if (isset($_GET["admin_log_datefrom_h"]))			{$admin_log_datefrom_h=$_GET["admin_log_datefrom_h"];}
	elseif (isset($_POST["admin_log_datefrom_h"]))	{$admin_log_datefrom_h=$_POST["admin_log_datefrom_h"];}
if (isset($_GET["admin_log_datefrom_m"]))			{$admin_log_datefrom_m=$_GET["admin_log_datefrom_m"];}
	elseif (isset($_POST["admin_log_datefrom_m"]))	{$admin_log_datefrom_m=$_POST["admin_log_datefrom_m"];}
if (isset($_GET["admin_log_datefrom_s"]))			{$admin_log_datefrom_s=$_GET["admin_log_datefrom_s"];}
	elseif (isset($_POST["admin_log_datefrom_s"]))	{$admin_log_datefrom_s=$_POST["admin_log_datefrom_s"];}
if (isset($_GET["admin_log_dateto_h"]))			{$admin_log_dateto_h=$_GET["admin_log_dateto_h"];}
	elseif (isset($_POST["admin_log_dateto_h"]))	{$admin_log_dateto_h=$_POST["admin_log_dateto_h"];}
if (isset($_GET["admin_log_dateto_m"]))			{$admin_log_dateto_m=$_GET["admin_log_dateto_m"];}
	elseif (isset($_POST["admin_log_dateto_m"]))	{$admin_log_dateto_m=$_POST["admin_log_dateto_m"];}
if (isset($_GET["admin_log_dateto_s"]))			{$admin_log_dateto_s=$_GET["admin_log_dateto_s"];}
	elseif (isset($_POST["admin_log_dateto_s"]))	{$admin_log_dateto_s=$_POST["admin_log_dateto_s"];}
if (isset($_GET["admin_log_datecheckbox"]))			{$admin_log_datecheckbox=$_GET["admin_log_datecheckbox"];}
	elseif (isset($_POST["admin_log_datecheckbox"]))	{$admin_log_datecheckbox=$_POST["admin_log_datecheckbox"];}

$NOW_DATE = date("Y-m-d");

if (!isset($admin_log_datefrom_ymd)) $admin_log_datefrom_ymd = $NOW_DATE;
if (!isset($admin_log_dateto_ymd)) $admin_log_dateto_ymd = $NOW_DATE;
if (!isset($admin_log_datefrom_h)) $admin_log_datefrom_h = "00";
if (!isset($admin_log_datefrom_m)) $admin_log_datefrom_m = "00";
if (!isset($admin_log_datefrom_s)) $admin_log_datefrom_s = "00";
if (!isset($admin_log_dateto_h)) $admin_log_dateto_h = "23";
if (!isset($admin_log_dateto_m)) $admin_log_dateto_m = "59";
if (!isset($admin_log_dateto_s)) $admin_log_dateto_s = "59";

$dateerror = 0;
function is_date($date)
{
	global $dateerror;
	if($date == date('Y-m-d H:i:s',strtotime($date))){
		return true;
	}else{
		$dateerror = 1;
		return false;
	}
}
$sqlwhere_array = array();
if(isset($admin_log_section)&&trim($admin_log_section)!="") $sqlwhere_array[] = "event_section='$admin_log_section'";
if(isset($admin_log_type)&&trim($admin_log_type)!="") $sqlwhere_array[] = "event_type='$admin_log_type'";
if(isset($admin_log_recordid)&&trim($admin_log_recordid)!="") $sqlwhere_array[] = "record_id='$admin_log_recordid'";
if(isset($admin_log_datecheckbox)&&trim($admin_log_datecheckbox)!=""){
	$admin_log_datefrom = $admin_log_datefrom_ymd." ".$admin_log_datefrom_h.":".$admin_log_datefrom_m.":".$admin_log_datefrom_s;
	$admin_log_dateto = $admin_log_dateto_ymd." ".$admin_log_dateto_h.":".$admin_log_dateto_m.":".$admin_log_dateto_s;
	
	if(!is_date($admin_log_datefrom)) $errmsg .= "$admin_log_datefrom is invalid format||";
	if(!is_date($admin_log_dateto)) $errmsg .= "$admin_log_dateto is invalid format||";
	if((!$dateerror)&&(strtotime($admin_log_datefrom)>=strtotime($admin_log_dateto))) $errmsg .= "[DATE TIME From] must be early than [DATE TIME To]||";
	
	if(!$errmsg) $sqlwhere_array[] = "event_date between '$admin_log_datefrom' and '$admin_log_dateto'";
}
	
	
	echo "<link rel=\"stylesheet\" href=\"ccms_jquery1.4.2/themes/base/jquery.ui.all.css\">";
	echo "<script src=\"ccms_jquery1.4.2/jquery-1.4.2.js\"></script>";
	echo "<script src=\"ccms_jquery1.4.2/ui/jquery.ui.core.js\"></script>";
	echo "<script src=\"ccms_jquery1.4.2/ui/jquery.ui.widget.js\"></script>";
	echo "<script src=\"ccms_jquery1.4.2/ui/jquery.ui.datepicker.js\"></script>";
    echo "<script language=\"JavaScript\" src=\"js/datefunctions.js\"></script>";
	echo "<script language=\"javascript\">
		$(function() {
			$( \"#admin_log_datefrom_ymd\" ).datepicker();
			$( \"#admin_log_datefrom_ymd\" ).datepicker( \"option\", \"dateFormat\", \"yy-mm-dd\" );
			$( \"#admin_log_dateto_ymd\" ).datepicker();
			$( \"#admin_log_dateto_ymd\" ).datepicker( \"option\", \"dateFormat\", \"yy-mm-dd\" );
			$( \"#admin_log_datefrom_ymd\" ).val(\"$admin_log_datefrom_ymd\");
			$( \"#admin_log_dateto_ymd\" ).val(\"$admin_log_dateto_ymd\");
		});
		function time_control(element_id,myValue){
			var element_id_array = Array();
			var type;
			myValue = parseInt(myValue,10);
			if(!myValue){document.getElementById(element_id).value = \"00\";}
					
			element_id_array = element_id.split(\"_\");
			type = element_id_array[element_id_array.length-1];
			
			if(type == \"h\"){
				if(myValue > 23){document.getElementById(element_id).value = \"23\";}
				else if(myValue < 0){document.getElementById(element_id).value = \"00\";}
			}
			else if(type == \"m\"){
				if(myValue > 59){document.getElementById(element_id).value = \"59\";}
				else if(myValue < 0){document.getElementById(element_id).value = \"00\";}
			}
			else if(type == \"s\"){
				if(myValue > 59){document.getElementById(element_id).value = \"59\";}
				else if(myValue < 0){document.getElementById(element_id).value = \"00\";}
			}
		}

	</script>";

	if ($LOGast_admin_access==1)
		{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	if ($stage > 9999)
		{
		$next_limit = ($stage + 10000);
		$limitSQL = "10000 offset $stage";
		}
	else
		{
		$next_limit = "10000";
		$limitSQL = "10000";
		}
	
	$stmt = "select DISTINCT(event_section) from vicidial_admin_log";
	$rslt_section=mysql_query($stmt, $link);
	$logs_to_print_section = mysql_num_rows($rslt_section);
	
	$stmt = "select DISTINCT(event_type) from vicidial_admin_log";
	$rslt_type=mysql_query($stmt, $link);
	$logs_to_print_type = mysql_num_rows($rslt_type);
	?>
	<form action='' name="admin_log_form" method='POST' style="background-color:#ffffff">
	<input type="hidden" name="stage" id="stage"  value="<?=$next_limit?>">
	<input type="hidden" name="ADD" id="ADD"  value="700000000000000">
	<table border=0 cellpadding=2 cellspacing=0 width="100%" bgcolor="#fffff">
		<tr class=tr_bg_color>
			<td height="20" colspan="4"><font size="1" color="white"><b>QUERY CONDITION</b></font></td>
		</tr>
  		<tr bgcolor='#c2c2c2'>
    <td class="small cellLabel3" align="left">SECTION:</td>
    <td class="small cellLabel3" align="left">
    <select name="admin_log_section" size="1" class="importBox small" id="admin_log_section" onchange="" style="width:200px">
	<option value="">[ALL]</option>
	<?php
	$o=0;
	while ($logs_to_print_section > $o){
	$row=mysql_fetch_row($rslt_section);
	?>
	<option value="<?=$row[0]?>" <?php if($row[0] == $admin_log_section){?>selected="selected"<?php }?>><?=$row[0]?></option>
	<?php
	$o++;
	}
	?>
	</select>    </td>
    <td class="small cellLabel3" align="left">TYPE:</td>
    <td class="small cellLabel3" align="left">
    <select name="admin_log_type" size="1" class="importBox small" id="admin_log_type" onchange="" style="width:200px">
	<option value="">[ALL]</option>
	<?php
	$o=0;
	while ($logs_to_print_type > $o){
	$row=mysql_fetch_row($rslt_type);
	?>
	<option value="<?=$row[0]?>" <?php if($row[0] == $admin_log_type){?>selected="selected"<?php }?>><?=$row[0]?></option>
	<?php
	$o++;
	}
	?>
	</select>    </td>
  </tr>
  <tr bgcolor='#ffffff'>
    <td class="small cellLabel3"  align="left">RECORD ID:</td>
    <td class="small cellLabel3"  align="left">
	<input type="text" name="admin_log_recordid" id="admin_log_recordid" value="<?=$admin_log_recordid?>" />
	</td>
	<td class="small cellLabel3" align="left"></td>
	<td class="small cellLabel3" align="left">
	</td>
  </tr>
    <tr bgcolor='#c2c2c2'>
    <td class="small cellLabel3" align="left" nowrap="nowrap"><input type="checkbox" name="admin_log_datecheckbox" id="admin_log_datecheckbox" <?php if($admin_log_datecheckbox){?>checked="checked" <?php }?>/>DATE TIME From:</td>
    <td class="small cellLabel3" align="left"> 
	<input type="text" name='admin_log_datefrom_ymd' id='admin_log_datefrom_ymd'  size="6" value="<?= $admin_log_datefrom_ymd ?>">
	<input type="text" class="inputtext" name="admin_log_datefrom_h" id ="admin_log_datefrom_h" maxlength=2 value="<?= $admin_log_datefrom_h ?>" onChange="time_control(this.id,this.value)" style="font-family: Arial, Helvetica, sans-serif;font-size: 11px;color: #000000;border:0px #solid#bababa;padding-left:0px;	width:20px;background-color:#CCFF66;">:
	<input type="text" class="inputtext" name="admin_log_datefrom_m" id ="admin_log_datefrom_m" maxlength=2 value="<?= $admin_log_datefrom_m ?>" onChange="time_control(this.id,this.value)" style="font-family: Arial, Helvetica, sans-serif;font-size: 11px;color: #000000;border:0px #solid#bababa;padding-left:0px;	width:20px;background-color:#CCFF66;">:
    <input type="text" class="inputtext" name="admin_log_datefrom_s" id ="admin_log_datefrom_s" maxlength=2 value="<?= $admin_log_datefrom_s ?>" onChange="time_control(this.id,this.value)" style="font-family: Arial, Helvetica, sans-serif;font-size: 11px;color: #000000;border:0px #solid#bababa;padding-left:0px;	width:20px;background-color:#CCFF66;"></td>
	<td class="small cellLabel3" align="left" nowrap="nowrap">DATE TIME To:</td>
    <td class="small cellLabel3" align="left">
	<input type="text" name='admin_log_dateto_ymd' id='admin_log_dateto_ymd'  size="6" value="<?= $admin_log_dateto_ymd ?>">
	<input type="text" class="inputtext" name="admin_log_dateto_h" id ="admin_log_dateto_h" maxlength=2 value="<?= $admin_log_dateto_h ?>" onChange="time_control(this.id,this.value)" style="font-family: Arial, Helvetica, sans-serif;font-size: 11px;color: #000000;border:0px#solid; #bababa;padding-left:0px;	width:20px;background-color:#CCFF66;">:
	<input type="text" class="inputtext" name="admin_log_dateto_m" id ="admin_log_dateto_m" maxlength=2 value="<?= $admin_log_dateto_m ?>" onChange="time_control(this.id,this.value)" style="font-family: Arial, Helvetica, sans-serif;font-size: 11px;color: #000000;border:0px #solid#bababa;padding-left:0px;	width:20px;background-color:#CCFF66;">:
    <input type="text" class="inputtext" name="admin_log_dateto_s" id ="admin_log_dateto_s" maxlength=2 value="<?= $admin_log_dateto_s ?>" onChange="time_control(this.id,this.value)" style="font-family: Arial, Helvetica, sans-serif;font-size: 11px;color: #000000;border:0px #solid#bababa;padding-left:0px;	width:20px;background-color:#CCFF66;">	</td>
  </tr>

  <tr bgcolor='#ffffff'>
    <td colspan=4 align=right>
<?php
	if($errmsg=="")
	{
?>
		<!--<input type="button" class="inputsubmit" name="add" value="SEARCH" onclick="checkdate();">-->
<?php
	}
	else
	{
  		echo $errmsg;
	}
?>
		<input type='submit' name='log_submit' onclick="document.getElementById('stage').value=''" value='SEARCH'>    </td>
  </tr>
</table>
</form>
	<?php
	$sqlwhere = '';
	if(!$errmsg&&count($sqlwhere_array)>0){
		$sqlwhere = " where ".implode(" and ",$sqlwhere_array);
	}
	
	$stmt="SELECT admin_log_id,event_date,user,ip_address,event_section,event_type,record_id,event_code from vicidial_admin_log $sqlwhere order by event_date desc limit $limitSQL;";
	$rslt=mysql_query($stmt, $link);
	$logs_to_print = mysql_num_rows($rslt);
	

	echo "<br>ADMIN CHANGE LOG: (Last 10000 records)\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<TR class=tr_bg_color>";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>ID</B></TD>";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>DATE TIME</B></TD>";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>USER</B></TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>IP</TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>SECTION</TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>TYPE</TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>RECORD ID</TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>DESCRIPTION</TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>GOTO</TD>\n";
	echo "</TR>\n";

	$logs_printed = '';
	$o=0;
	while ($logs_to_print > $o)
		{
		$row=mysql_fetch_row($rslt);
		if (eregi("USER|AGENT",$row[4])) {$record_link = "ADD=3&user=$row[6]";}
		if (eregi('CAMPAIGN',$row[4])) {$record_link = "ADD=31&campaign_id=$row[6]";}
		if (eregi('LIST',$row[4])) {$record_link = "ADD=311&list_id=$row[6]";}
		if (eregi('SCRIPT',$row[4])) {$record_link = "ADD=3111111&script_id=$row[6]";}
		if (eregi('FILTER',$row[4])) {$record_link = "ADD=31111111&lead_filter_id=$row[6]";}
		if (eregi('INGROUP',$row[4])) {$record_link = "ADD=3111&group_id=$row[6]";}
		if (eregi('DID',$row[4])) {$record_link = "ADD=3311&did_id=$row[6]";}
		if (eregi('USERGROUP',$row[4])) {$record_link = "ADD=311111&user_group=$row[6]";}
		if (eregi('REMOTEAGENT',$row[4])) {$record_link = "ADD=31111&remote_agent_id=$row[6]";}
		if (eregi('PHONE',$row[4])) {$record_link = "ADD=10000000000";}
		if (eregi('CALLTIME',$row[4])) {$record_link = "ADD=311111111&call_time_id=$row[6]";}
		if (eregi('SHIFT',$row[4])) {$record_link = "ADD=331111111&shift_id=$row[6]";}
		if (eregi('CONFTEMPLATE',$row[4])) {$record_link = "ADD=331111111111&template_id=$row[6]";}
		if (eregi('CARRIER',$row[4])) {$record_link = "ADD=341111111111&carrier_id=$row[6]";}
		if (eregi('SERVER',$row[4])) {$record_link = "ADD=311111111111&server_id=$row[6]";}
		if (eregi('CONFERENCE',$row[4])) {$record_link = "ADD=1000000000000";}
		if (eregi('SYSTEM',$row[4])) {$record_link = "ADD=311111111111111";}
		if (eregi('CATEGOR',$row[4])) {$record_link = "ADD=331111111111111";}
		if (eregi('GROUPALIAS',$row[4])) {$record_link = "ADD=33111111111&group_alias_id=$row[6]";}

		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=730000000000000&stage=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td><font size=1> <a href=\"$PHP_SELF?ADD=710000000000000&stage=$row[2]\">$row[2]</a></td>";
		echo "<td><font size=1> $row[3]</td>";
		echo "<td><font size=1> $row[4]</td>";
		echo "<td><font size=1> $row[5]</td>";
		echo "<td><font size=1> <a href=\"$PHP_SELF?ADD=720000000000000&category=$row[4]&stage=$row[6]\">$row[6]</a></td>";
		echo "<td><font size=1> $row[7]</td>";
		echo "<td><font size=1> <a href=\"$PHP_SELF?$record_link\">GOTO</a></td>";
		echo "</tr>\n";
		$logs_printed .= "'$row[0]',";
		$o++;
		}
	echo "</TABLE><BR><BR>\n";
	echo "<a href=\"#\" onclick=\"document.admin_log_form.submit();\" >NEXT</a>\n";
	echo "</center>\n";
			}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=710000000000000 view all activity in the admin log made by one user
######################

if ($ADD==710000000000000)
	{
	echo "<TABLE><TR><TD>\n";
	echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

	$stmt="SELECT full_name from vicidial_users where user='$stage';";
	$rslt=mysql_query($stmt, $link);
	$names_to_print = mysql_num_rows($rslt);
	if ($names_to_print > 0)
		{
		$row=mysql_fetch_row($rslt);
		$user_name = $row[0];
		}

	$stmt="SELECT admin_log_id,event_date,user,ip_address,event_section,event_type,record_id,event_code from vicidial_admin_log where user='$stage' order by event_date desc limit 10000;";
	$rslt=mysql_query($stmt, $link);
	$logs_to_print = mysql_num_rows($rslt);

	echo "<br>ADMIN CHANGE LOG: Changes made by $stage - $user_name\n";
	echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
	echo "<TR class=tr_bg_color>";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>ID</B></TD>";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>DATE TIME</B></TD>";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>USER</B></TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>IP</TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>SECTION</TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>TYPE</TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>RECORD ID</TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>DESCRIPTION</TD>\n";
	echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>GOTO</TD>\n";
	echo "</TR>\n";

	$logs_printed = '';
	$o=0;
	while ($logs_to_print > $o)
		{
		$row=mysql_fetch_row($rslt);

		if (eregi("USER|AGENT",$row[4])) {$record_link = "ADD=3&user=$row[6]";}
		if (eregi('CAMPAIGN',$row[4])) {$record_link = "ADD=31&campaign_id=$row[6]";}
		if (eregi('LIST',$row[4])) {$record_link = "ADD=311&list_id=$row[6]";}
		if (eregi('SCRIPT',$row[4])) {$record_link = "ADD=3111111&script_id=$row[6]";}
		if (eregi('FILTER',$row[4])) {$record_link = "ADD=31111111&lead_filter_id=$row[6]";}
		if (eregi('INGROUP',$row[4])) {$record_link = "ADD=3111&group_id=$row[6]";}
		if (eregi('DID',$row[4])) {$record_link = "ADD=3311&did_id=$row[6]";}
		if (eregi('USERGROUP',$row[4])) {$record_link = "ADD=311111&user_group=$row[6]";}
		if (eregi('REMOTEAGENT',$row[4])) {$record_link = "ADD=31111&remote_agent_id=$row[6]";}
		if (eregi('PHONE',$row[4])) {$record_link = "ADD=10000000000";}
		if (eregi('CALLTIME',$row[4])) {$record_link = "ADD=311111111&call_time_id=$row[6]";}
		if (eregi('SHIFT',$row[4])) {$record_link = "ADD=331111111&shift_id=$row[6]";}
		if (eregi('CONFTEMPLATE',$row[4])) {$record_link = "ADD=331111111111&template_id=$row[6]";}
		if (eregi('CARRIER',$row[4])) {$record_link = "ADD=341111111111&carrier_id=$row[6]";}
		if (eregi('SERVER',$row[4])) {$record_link = "ADD=311111111111&server_id=$row[6]";}
		if (eregi('CONFERENCE',$row[4])) {$record_link = "ADD=1000000000000";}
		if (eregi('SYSTEM',$row[4])) {$record_link = "ADD=311111111111111";}
		if (eregi('CATEGOR',$row[4])) {$record_link = "ADD=331111111111111";}
		if (eregi('GROUPALIAS',$row[4])) {$record_link = "ADD=33111111111&group_alias_id=$row[6]";}

		if (eregi("1$|3$|5$|7$|9$", $o))
			{$bgcolor='bgcolor="#FFFFFF"';} 
		else
			{$bgcolor='bgcolor="#C2C2C2"';}
		echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=730000000000000&stage=$row[0]\">$row[0]</a></td>";
		echo "<td><font size=1> $row[1]</td>";
		echo "<td><font size=1> <a href=\"$PHP_SELF?ADD=710000000000000&stage=$row[2]\">$row[2]</a></td>";
		echo "<td><font size=1> $row[3]</td>";
		echo "<td><font size=1> $row[4]</td>";
		echo "<td><font size=1> $row[5]</td>";
		echo "<td><font size=1> <a href=\"$PHP_SELF?ADD=720000000000000&category=$row[4]&stage=$row[6]\">$row[6]</a></td>";
		echo "<td><font size=1> $row[7]</td>";
		echo "<td><font size=1> <a href=\"$PHP_SELF?$record_link\">GOTO</a></td>";
		echo "</tr>\n";
		$logs_printed .= "'$row[0]',";
		$o++;
		}
	echo "</TABLE><BR><BR>\n";
	echo "\n";
	echo "</center>\n";
	}


######################
# ADD=720000000000000 view all activity in the admin log made to one section/value
######################

if ($ADD==720000000000000)
	{
	if ($LOGuser_level >= 9)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT admin_log_id,event_date,user,ip_address,event_section,event_type,record_id,event_code from vicidial_admin_log where event_section='$category' and record_id='$stage' order by event_date desc limit 10000;";
		$rslt=mysql_query($stmt, $link);
		$logs_to_print = mysql_num_rows($rslt);

		echo "<br>ADMIN CHANGE LOG: Section Records - $category - $stage\n";
		echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
		echo "<TR class=tr_bg_color>";
		echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>ID</B></TD>";
		echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>DATE TIME</B></TD>";
		echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>USER</B></TD>\n";
		echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>IP</TD>\n";
		echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>SECTION</TD>\n";
		echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>TYPE</TD>\n";
		echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>RECORD ID</TD>\n";
		echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>DESCRIPTION</TD>\n";
		echo "<TD><B><FONT FACE=\"Arial,Helvetica\" size=1 color=white>GOTO</TD>\n";
		echo "</TR>\n";

		$logs_printed = '';
		$o=0;
		while ($logs_to_print > $o)
			{
			$row=mysql_fetch_row($rslt);

			if (eregi("USER|AGENT",$row[4])) {$record_link = "ADD=3&user=$row[6]";}
			if (eregi('CAMPAIGN',$row[4])) {$record_link = "ADD=31&campaign_id=$row[6]";}
			if (eregi('LIST',$row[4])) {$record_link = "ADD=311&list_id=$row[6]";}
			if (eregi('SCRIPT',$row[4])) {$record_link = "ADD=3111111&script_id=$row[6]";}
			if (eregi('FILTER',$row[4])) {$record_link = "ADD=31111111&lead_filter_id=$row[6]";}
			if (eregi('INGROUP',$row[4])) {$record_link = "ADD=3111&group_id=$row[6]";}
			if (eregi('DID',$row[4])) {$record_link = "ADD=3311&did_id=$row[6]";}
			if (eregi('USERGROUP',$row[4])) {$record_link = "ADD=311111&user_group=$row[6]";}
			if (eregi('REMOTEAGENT',$row[4])) {$record_link = "ADD=31111&remote_agent_id=$row[6]";}
			if (eregi('PHONE',$row[4])) {$record_link = "ADD=10000000000";}
			if (eregi('CALLTIME',$row[4])) {$record_link = "ADD=311111111&call_time_id=$row[6]";}
			if (eregi('SHIFT',$row[4])) {$record_link = "ADD=331111111&shift_id=$row[6]";}
			if (eregi('CONFTEMPLATE',$row[4])) {$record_link = "ADD=331111111111&template_id=$row[6]";}
			if (eregi('CARRIER',$row[4])) {$record_link = "ADD=341111111111&carrier_id=$row[6]";}
			if (eregi('SERVER',$row[4])) {$record_link = "ADD=311111111111&server_id=$row[6]";}
			if (eregi('CONFERENCE',$row[4])) {$record_link = "ADD=1000000000000";}
			if (eregi('SYSTEM',$row[4])) {$record_link = "ADD=311111111111111";}
			if (eregi('CATEGOR',$row[4])) {$record_link = "ADD=331111111111111";}
			if (eregi('GROUPALIAS',$row[4])) {$record_link = "ADD=33111111111&group_alias_id=$row[6]";}

			if (eregi("1$|3$|5$|7$|9$", $o))
				{$bgcolor='bgcolor="#FFFFFF"';} 
			else
				{$bgcolor='bgcolor="#C2C2C2"';}
			echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=730000000000000&stage=$row[0]\">$row[0]</a></td>";
			echo "<td><font size=1> $row[1]</td>";
			echo "<td><font size=1> <a href=\"$PHP_SELF?ADD=710000000000000&stage=$row[2]\">$row[2]</a></td>";
			echo "<td><font size=1> $row[3]</td>";
			echo "<td><font size=1> $row[4]</td>";
			echo "<td><font size=1> $row[5]</td>";
			echo "<td><font size=1> $row[6]</td>";
			echo "<td><font size=1> $row[7]</td>";
			echo "<td><font size=1> <a href=\"$PHP_SELF?$record_link\">GOTO</a></td>";
			echo "</tr>\n";
			$logs_printed .= "'$row[0]',";
			$o++;
			}
		echo "</TABLE><BR><BR>\n";
		echo "\n";
		echo "</center>\n";
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=730000000000000 detail view of one admin log entry
######################

if ($ADD==730000000000000)
	{
	if ($LOGuser_level >= 9)
		{
		echo "<TABLE><TR><TD>\n";
		echo "<FONT FACE=\"ARIAL,HELVETICA\" COLOR=BLACK SIZE=2>";

		$stmt="SELECT admin_log_id,event_date,val.user,ip_address,event_section,event_type,record_id,event_code,event_notes,event_sql,full_name from vicidial_admin_log val, vicidial_users vu where admin_log_id='$stage' and val.user=vu.user;";
		$rslt=mysql_query($stmt, $link);
		$logs_to_print = mysql_num_rows($rslt);

		if ($logs_to_print > 0)
			{
			$row=mysql_fetch_row($rslt);
			echo "<br>ADMIN CHANGE LOG: Record Detail - $stage<BR><BR>\n";
			echo "<center><TABLE width=$section_width cellspacing=5 cellpadding=0>\n";
			echo "<TR>";
			echo "<TD ALIGN=RIGHT><B><FONT FACE=\"Arial,Helvetica\" size=2>ID: </B></TD>";
			echo "<TD ALIGN=LEFT><FONT FACE=\"Arial,Helvetica\" size=2>$row[0]</TD>";
			echo "</TR><TR>\n";
			echo "<TD ALIGN=RIGHT><B><FONT FACE=\"Arial,Helvetica\" size=2>DATE TIME: </B></TD>";
			echo "<TD ALIGN=LEFT><FONT FACE=\"Arial,Helvetica\" size=2>$row[1]</TD>";
			echo "</TR><TR>\n";
			echo "<TD ALIGN=RIGHT><B><FONT FACE=\"Arial,Helvetica\" size=2>USER: </B></TD>";
			echo "<TD ALIGN=LEFT><FONT FACE=\"Arial,Helvetica\" size=2>$row[2] - $row[10]</TD>";
			echo "</TR><TR>\n";
			echo "<TD ALIGN=RIGHT><B><FONT FACE=\"Arial,Helvetica\" size=2>IP: </B></TD>";
			echo "<TD ALIGN=LEFT><FONT FACE=\"Arial,Helvetica\" size=2>$row[3]</TD>";
			echo "</TR><TR>\n";
			echo "<TD ALIGN=RIGHT><B><FONT FACE=\"Arial,Helvetica\" size=2>SECTION: </B></TD>";
			echo "<TD ALIGN=LEFT><FONT FACE=\"Arial,Helvetica\" size=2>$row[4]</TD>";
			echo "</TR><TR>\n";
			echo "<TD ALIGN=RIGHT><B><FONT FACE=\"Arial,Helvetica\" size=2>TYPE: </B></TD>";
			echo "<TD ALIGN=LEFT><FONT FACE=\"Arial,Helvetica\" size=2>$row[5]</TD>";
			echo "</TR><TR>\n";
			echo "<TD ALIGN=RIGHT><B><FONT FACE=\"Arial,Helvetica\" size=2>RECORD ID: </B></TD>";
			echo "<TD ALIGN=LEFT><FONT FACE=\"Arial,Helvetica\" size=2>$row[6]</TD>";
			echo "</TR><TR>\n";
			echo "<TD ALIGN=RIGHT><B><FONT FACE=\"Arial,Helvetica\" size=2>DESCRIPTION: </B></TD>";
			echo "<TD ALIGN=LEFT><FONT FACE=\"Arial,Helvetica\" size=1>$row[7]</TD>";
			echo "</TR><TR>\n";
			echo "<TD ALIGN=RIGHT><B><FONT FACE=\"Arial,Helvetica\" size=2>NOTES: </B></TD>";
			echo "<TD ALIGN=LEFT><FONT FACE=\"Arial,Helvetica\" size=1>$row[8]</TD>";
			echo "</TR><TR>\n";
			$row[9] = eregi_replace("',","' ,",$row[9]);
			$row[9] = preg_replace("/\|/","<BR>",$row[9]);
			echo "<TD ALIGN=RIGHT><B><FONT FACE=\"Arial,Helvetica\" size=2>SQL: </B></TD>";
			echo "<TD ALIGN=LEFT width=700><p style=\"width: 700; text-wrap: normal; word-wrap: break-word\"><FONT FACE=\"Arial,Helvetica\" size=1>$row[9]</TD>";
			echo "</TR>\n";
			echo "</TABLE><BR><BR>\n";
			echo "\n";
			echo "</center>\n";
			}
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
	}


######################
# ADD=999999 display reports section
######################
if ($ADD==9999999999){
?>
			  <?php
					if ($LOGview_reports==1){
			  ?>
		<table width="750" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td class="right_centerbg">
			<div><img src="./new_style/images/empty.gif" /></div>
			<div id="right_menu">
			  <table border=0 cellspacing=0 cellpadding=0 width="100%"  backgroundxx="#ffcc00">
			   <tr class=tr_bg_color>
				<td><font size="1" color="white"><b>Real-Time Reports</b></font></td>
			   </tr>
			  </table>
			</div>
			<table width="100%" border="0" cellpadding="0" cellspacing="0" align="center">
              <tr style="display:none">
                <td valign="top">&nbsp;</td>
                <td valign="top">&nbsp;</td>
              </tr>

              <tr bgcolor="#c2c2c2">
				<td classxx="font_red_b"><font size="1" color="black">[ Real-Time Reports ]</font></td>
				<td >&nbsp;</td>
              </tr>
			  <tr>
                <td width="50%" valign="top" align="center">
				<table width="100%" border="0"  cellpadding="0" cellspacing="0">
                  <tr >
                    <td class="report_link"><a onclick="small_menu_openwindow('AST_timeonVDADallAJAX.php');" href="#">Real-Time Main Report</a></td>
                  </tr>
                  <tr>
                    <td class="report_link"><a onclick="small_menu_openwindow('AST_timeonVDADallAJAX.php?sumreport=Y');" href="#">Real-Time Summary Report</a></td>
                  </tr>
                  <tr >
                    <td class="report_link"><a onclick="small_menu_openwindow('AST_remote_timeonVDADallAJAX.php');" href="#">Remote Agent Real-Time Report</a></td>
                  </tr>                  
                </table>
				</td>
                <td width="50%" valign="top" align="center">&nbsp;</td>
              </tr>

			</table>
		</td></tr></table>
					  <?php
					}else{
						echo "You do not have permission to view this page\n";
					}
			  ?>
			  
<?php
}

if ($ADD==999999){
	if ($LOGview_historical_reports==1){
	
	$stmt="select server_id,server_description,server_ip,active,sysload,channels_total,cpu_idle_percent,disk_usage from servers order by server_id;";
		$rslt=mysql_query($stmt, $link);
		if ($DB) {echo "$stmt\n";}
		$servers_to_print = mysql_num_rows($rslt);
		$i=0;
		while ($i < $servers_to_print)
			{
			$row=mysql_fetch_row($rslt);
			$server_id[$i] =			$row[0];
			$server_description[$i] =	$row[1];
			$server_ip[$i] =			$row[2];
			$active[$i] =				$row[3];
			$sysload[$i] =				$row[4];
			$channels_total[$i] =		$row[5];
			$cpu_idle_percent[$i] =		$row[6];
			$disk_usage[$i] =			$row[7];
			$i++;
			}

		$stmt="SELECT queuemetrics_url,vtiger_url,ccms_report_url from system_settings;";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$queuemetrics_url_LU =				$row[0];
		$vtiger_url_LU =					$row[1];
		$Report_Server_URL =				$row[2];

		$stmt="SELECT count(*) from vicidial_list_update_log;";
		$rslt=mysql_query($stmt, $link);
		$row=mysql_fetch_row($rslt);
		$list_update_count =				$row[0];
	
		$query = "select title,link,category from ccms_report_manager where is_open='Y' and cn_en='en';";
		$rslt=mysql_query($query, $link);
		
		$num = mysql_num_rows($rslt);
		$o=0;
		$arr = array();
		while($num > $o){		 
			$row=mysql_fetch_row($rslt);
			/*
			$dir = explode("/",$row[1]);
			$prpt_arr = explode(" ",$dir[1]);
			$prpt = implode("+",$prpt_arr);
			
			echo "<a href=\"#\" onclick=\"small_menu_openwindow('".$Report_Server_URL."/content/reporting/reportviewer/report.html?userid=joe&password=password&solution=CCMS&path=%2F".$dir[0]."&name=".$prpt."&locale=zh_CN&autoSubmit=false&VIEWER=".$LOGuser_name_id."');\">$row[0]</a>";
			*/					
			$arr[$row[2]][] = array($row[0],$row[1]);
			$o++;			
		}	
?>
<table width="750" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td class="right_centerbg">
<style>
.out{
	width:100%;

}
.in{
	width:50%;
	float:left;
overflow:hidden;
display:inline;
*margin-left:-1px; 
}
.in li{
	list-style-type:none;
	color: #555;
	text-decoration: none;
	font-size: 12px;

}
h3{		
	padding:0px;
	margin:0px;
	background-color:#c2c2c2;
	font-size: x-small;
	color: black;
	font-weight : normal;
}
</style>
<div class="out">
<?php
foreach($arr as $key=>$arr1){
	echo "<div class=\"in\">";
	echo "<h3>[ $key ]</h3>";
	foreach($arr1 as $key=>$arr2){	
		$dir = explode("/",$arr2[1]);
		$prpt_arr = explode(" ",$dir[1]);
		$prpt = implode("+",$prpt_arr);
		echo "<li><a href=\"#\" onclick=\"small_menu_openwindow('".$Report_Server_URL."/content/reporting/reportviewer/report.html?userid=joe&password=password&solution=CCMS&path=%2F".$dir[0]."&name=".$prpt."&locale=zh_CN&autoSubmit=false&VIEWER=".$LOGuser_name_id."');\">$arr2[0]</a></li>";
	}
	echo "</div>";
}

?>
</div>
</td></tr></table>
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tr><td><div class="out"><div class="in">
<h3>[ Campaign Report ]</h3>
<?php
    $stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id,'Y');
    $rslt=mysql_query($stmt, $link);
    $campaigns_to_print = mysql_num_rows($rslt);
    
    if($campaigns_to_print>0){
        $o=0;
        $campaigns_arr_temp = array();
        while ($campaigns_to_print > $o) 
            {
            $rowx=mysql_fetch_row($rslt);
            $campaigns_arr_temp[] = "'" . $rowx[0] . "'";
            $o++;
            }
        foreach($campaigns_arr_temp as $campaign){
            $query = "select title,link from ccms_report_manager where campaign_id=$campaign and is_open='N' and cn_en='en';";
            $rslt=mysql_query($query, $link);
            $num = mysql_num_rows($rslt);
            $o=0;
            while($num > $o){
                $row=mysql_fetch_row($rslt);
                
                $dir = explode("/",$row[1]);
                $prpt_arr = explode(" ",$dir[1]);
                $prpt = implode("+",$prpt_arr);
                
                echo "<li><a href=\"#\" onclick=\"small_menu_openwindow('".$Report_Server_URL."/content/reporting/reportviewer/report.html?userid=joe&password=password&solution=CCMS&path=%2F".$dir[0]."&name=".$prpt."&locale=zh_CN&autoSubmit=false&VIEWER=".$LOGuser_name_id."');\">$row[0]</a></li>";
                $o++;
            }
        }
    }
    
    ?>
</div></div></td></tr></table>
<?php
		
		
	}else{
		echo "You do not have permission to view this page\n";
	}


}
	
if ($ADD==9999991)
{
	require("History_Report_Menu_CH.php");
}
if ($ADD==9999999)
{
	require("Base_History_Report.php");
}
if ($ADD==99999999)
{
	require("BaseEF_History_Report.php");
}
if ($ADD==9999992)
{
	require("EF_History_Report.php");
}
if ($ADD==9999998)
{
	require("EFSMART_History_Report.php");

}
if ($ADD==9999993)
{
	require("CSC_History_Report.php");
}
if ($ADD==9999996)
{
	require("TVB_History_Report.php");
}
//add by fox for 2353
if ($ADD==9999994)
{
	require("report_setting.php");
}


//add by fox for 0002374
if($ADD == 201211161052){ 
	$id = $_REQUEST['id'];
	$name = $_REQUEST['name'];
	echo "<a href=\"$PHP_SELF?ADD=201211231049&id=$id&CoNfIrM=YES\">Click here to delete report $name!</a>";
}

if($ADD == 201211231049){ //delete report
	$id = $_REQUEST['id'];
	
	$query = "select attachment from ccms_report_manager where id='$id'";
	$rslt=mysql_query($query);
	$num = mysql_affected_rows();
	
	if($num >0 ){
		$row = mysql_fetch_row($rslt);
		
		//$attachment = $row[0];
		$attachments = explode("-",$row[0]);
		$attachment = array_shift($attachments);
		
		foreach($attachments as $att){
			chmod("upload/$id/$att",0777);
			unlink("upload/$id/$att");
		}
		chmod("upload/$id",0777);
		rmdir("upload/$id");
	}
	
	$query = "delete from ccms_report_manager where id='$id'";
	$rslt=mysql_query($query);
	$num = mysql_affected_rows();
	
	if($num >0 ){
		echo "Delete Success!!!";
	}
}

if($ADD == 20121123){//delete attachment
	$file = $_REQUEST['file'];
	$id = $_REQUEST['id'];
	$attachment = $_REQUEST['attachment'];
	function deleteAttachment($file){
		if(chmod($file,0777) && unlink($file)){
			return true;
		}else return false;
	}
	if(deleteAttachment($file)){
		
		$query = "UPDATE ccms_report_manager SET attachment=REPLACE(attachment,'$attachment','') where id='$id'";
		$rslt=mysql_query($query);
		$num = mysql_affected_rows();
		
		if($num >0 ){
			$ADD=201211131143;
		}
	}	
}

if ($ADD==201211151704){//add report view;
	require("report_add.php");
}



if ($ADD==201211200945){//add report
		$category = $_POST['category'];
		$campaign_id = $_POST['campaign_id'];
		$title = $_POST['title'];
		$url = $_POST['url'];
		$cn_en = $_POST['cn_en'];
		$is_open = $_POST['is_open'];
		//$max_file_size = $_POST['max_file_size'];
		
		if($category == null){
			echo "Category is null !!!";exit;
		}
		if($title == null){
			echo "Title is null !!!";exit;
		}
		if($url == null){
			echo "Link is null !!!";exit;
		}
		
		$stmt="SELECT * FROM ccms_report_manager WHERE title='$title' and campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt);
		$num = mysql_num_rows($rslt);
		if($num>0){
			echo "Title is Repeat !!!";exit;
		}
		
		//$stmt="SELECT * FROM ccms_report_manager WHERE link='$url' and campaign_id='$campaign_id';";
		//$rslt=mysql_query($stmt);
		//$num = mysql_num_rows($rslt);
		//if($num>0){
		//	echo "Link is Repeat !!!";exit;
		//}
		
		if($_FILES['file']['error'] == false){
				include("upload.php");
				//var_dump($_FILES['file']);		
				
				$filename = $_FILES['file']['name'];
				
				if (preg_match('/\-/', $filename)) {
					echo "The file names can not contain '-' ,Please change the file name!!!";exit;
				} 
				
				$stmt="SELECT attachment FROM ccms_report_manager WHERE campaign_id='$campaign_id';";
				$rslt=mysql_query($stmt);
				while($row = mysql_fetch_row($rslt)){
					$attachment .= $row[0];
					}
				
				if (preg_match("/^$filename/", $attachment)) {
					echo "Duplicate File Names !!!";exit;
				}
				
				$up = new up($_FILES['file'],"./upload/".$campaign_id,"2",$_FILES['file']['name']);
				$attachment = $_FILES['file']['name'];
				if($up->is_success = true){
					$query = "insert into ccms_report_manager set category='$category',campaign_id='$campaign_id',title='$title',link='$url',is_open='$is_open',cn_en='$cn_en',attachment='$attachment';";
					//echo $query;
					$rslt=mysql_query($query, $link);
					//var_dump($rslt);
				}
		}else{
			$query = "insert into ccms_report_manager set category='$category',campaign_id='$campaign_id',title='$title',link='$url',is_open='$is_open',cn_en='$cn_en';";
					//echo $query;
			$rslt=mysql_query($query, $link);
		}	
		$ADD=201211131143;
}

if ($ADD==201211151027)//add attachment
{
    if(isset($_FILES['file'])){
        include("upload.php");
        //var_dump($_FILES['file']);
        $id = $_POST['id'];
        $campaign_id = $_POST['campaign_id'];
        
        $filename = $_FILES['file']['name'];
		
		$stmt="SELECT attachment FROM ccms_report_manager WHERE campaign_id='$campaign_id';";
		$rslt=mysql_query($stmt);
		while($row = mysql_fetch_row($rslt)){
			$attachment .= $row[0];
			}
		
		if (preg_match("/$filename/", $attachment)) {
			echo "Duplicate File Names !!!";exit;
		}
        
        if (preg_match('/\-/', $filename)) {
            echo "The file names can not contain '-' ,Please change the file name!!!";exit;
        } 
        
        $stmt = "select attachment from ccms_report_manager WHERE id='$id';";
        //echo $query;
        $rslt=mysql_query($stmt, $link);
        $row = mysql_fetch_row($rslt);
       	
		$up = new up($_FILES['file'],"./upload/".$campaign_id,"2",$_FILES['file']['name']);
		$attachment = $_FILES['file']['name'];
		if($up->is_success = true){
			$query = "update ccms_report_manager set attachment=concat(attachment,'-','$attachment') WHERE id='$id';";
			//echo $query;
			$rslt=mysql_query($query, $link);
			//var_dump($rslt);
		}		
    }
    $ADD=201211131143;
}

if ($ADD==201211151034)//update report
{
    $id = $_POST[id];
    $category = $_POST[category];
    $campaign_id = $_POST[campaign_id];
    $url = $_POST[url];
    $title = $_POST[title];
    $is_open = $_POST['is_open'];
    $cn_en = $_POST['cn_en'];
    $stmtA="UPDATE ccms_report_manager SET title='$title',category='$category',campaign_id='$campaign_id',link='$url',is_open='$is_open',cn_en='$cn_en' WHERE id='$id';";
    $rslt=mysql_query($stmtA, $link) or die(mysql_error());
    $ADD=201211131143;	
}

if ($ADD==201211131535)//modify report;
{
	require("report_manager.php");
}



if ($ADD==201211131143)//show report list
{
	if ($LOGast_admin_access==1)
	{	
		//echo "<TABLE><TR><TD>\n";
		echo "<center><a href=\"$PHP_SELF?ADD=201211151704\">Add A New Report</a></center>";
		echo "<center><TABLE width=$section_width cellspacing=0 cellpadding=1>\n";
		echo "<tr class=tr_bg_color>";
		//echo "<td><font size=1 color=white align=left><B>CAMPAIGN ID</B></td>";
		echo "<td><font size=2 color=white><B>REPORT NAME</B></CENTER></td>";
		echo "<td><font size=2 color=white><B>MODIFY</B></td></tr>\n";
		$stmt = "select id,title from ccms_report_manager;";
		
		$rslt=mysql_query($stmt);
		$campaigns_to_print = mysql_num_rows($rslt);
		$o=0;
		
		while ($campaigns_to_print > $o) 
			{
			$row=mysql_fetch_row($rslt);
			//echo "<tr $bgcolor><td><font size=1><a href=\"$PHP_SELF?ADD=201211131458&campaign_id=$row[0]&campaign_name=$row[1]\">$row[0]</a> &nbsp; </td>";
			echo "<td><font size=2>$row[1]</td>";
			echo "<td><font size=2><a href=\"$PHP_SELF?ADD=201211131535&report_id=$row[0]\">MODIFY</a>&nbsp|&nbsp<a href=\"$PHP_SELF?ADD=201211161052&id=$row[0]&name=$row[1]\">DELETE</a></td></tr>\n";
			$o++;
			}
		echo "</TABLE></center>\n";
	}
	//require("report_manager.php");
}
//end by fox 0002374
require("remote_agent_group.php");
if ($ADD==9999996)
{	
	$campaign_id = $_REQUEST['campaign_id']; 
	$workstart_hour = $_REQUEST['work_start_hour']; 
	$workstart_min = $_REQUEST['work_start_min']; 
	$workend_hour = $_REQUEST['work_end_hour']; 
	$workend_min = $_REQUEST['work_end_min']; 
	$work_limit = $_REQUEST['work_limit']; 
	$nowork_limit = $_REQUEST['no_work_limit']; 	
	//$config_dir = $_REQUEST['config_dir']; 	
	$stmt = "update ccms_report 
	set workstart_hour='$workstart_hour',
	workstart_min='$workstart_min',
	workend_hour='$workend_hour',
	workend_min='$workend_min',
	work_limit='$work_limit',
	nowork_limit='$nowork_limit'
	where campaign_id='$campaign_id'";
	//echo $stmt;
	mysql_query($stmt,$link);
	
	function writelog($temp){
		$efp = fopen ("pentaho_config_time.js", "w");
		fwrite ($efp, "$temp");
		fclose($efp);
	}
	
	$config_content = "var work_start_hour = $workstart_hour;\nvar work_start_min = $workstart_min;\nvar work_end_hour = $workend_hour;\nvar work_end_min = $workend_min;\nvar work_limit = $work_limit;\nvar no_work_limit = $nowork_limit;";
	//echo $config_content;
	writelog($config_content);
	
	$ADD=9999995;
}
if ($ADD==9999995)
{
	require("report_setting_edit.php");
}
//end 2353
?>

<?php

$ENDtime = date("U");

$RUNtime = ($ENDtime - $STARTtime);

if($ccms_admin_modules=='forecast_outbound_handle'){
?>
<TABLE></TR><TD>
<?php
if ($LOGmodify_campaigns==1){
?>
<center><iframe id="module_iframe" name="forecast_outbound_handle" width="760px" onload="SetIframeHeight(this)" frameborder="0" scrolling="no"></iframe></center>
<?php
}else{
echo "You do not have permission to view this page\n";
?>
<?php }}

################ vtigercrm module ############
if($ccms_admin_modules=='vtigercrm')
  {
   //$stmt="SELECT vtiger_url from system_settings;";
   if(empty($campaign_id)){
		$stmt = getCampaignSql($LOGuser_level,$LOGuser_name_id);
   }else{
		$stmt = "SELECT campaign_id,campaign_name,active,dial_method,auto_dial_level,lead_order,dial_statuses,vtiger_url,enable_vtiger_integration from vicidial_campaigns where campaign_id='$campaign_id'";
   }
   $rslt=mysql_query($stmt, $link);
   $row=mysql_fetch_row($rslt);
   $vtiger_url = $row[7];	
   $VtigeRall = $vtiger_url."/index.php?module=Users&action=Authenticate&return_module=Users&return_action=Login&user_name=".$PHP_AUTH_USER."&user_password=" .$PHP_AUTH_PW."&login_theme=softed"; 
   //echo $VtigeRall;exit;
?>

<TABLE></TR><TD>

<script type="text/javascript"> 
function SetCwinHeight(iframeObj){ 
if (document.getElementById){ 
   if (iframeObj && !window.opera){ 
   if (iframeObj.contentDocument && iframeObj.contentDocument.body.offsetHeight){ 
   iframeObj.height = iframeObj.contentDocument.body.offsetHeight; 
   iframeObj.width = iframeObj.contentDocument.body.offsetWidth;
   }else if(document.frames[iframeObj.name].document && document.frames[iframeObj.name].document.body.scrollHeight){ 
   iframeObj.height = document.frames[iframeObj.name].document.body.scrollHeight+30+'px'; 
   //iframeObj.width = document.frames[iframeObj.name].document.body.scrollWidth+150+'px';
   } 
   } 
} 
} 
</script> 

<center><iframe id="module_iframe" src="<?php echo $VtigeRall;?>" name="module_iframe"  width="1000px" onload="SetCwinHeight(this)"  frameborder="0" ></iframe></center>

<?php } 
if($ccms_admin_modules=='search_call_log'){
?>

<TABLE></TR><TD>
<?php
	if ($LOGsearch_historical_call==1){
?>

<center><iframe id="module_iframe" src="./search_call_log.php" name="search_call_log"  width="1000px" onload="SetIframeHeight(this)"  frameborder="0" scrolling="no"></iframe></center>
<?php
	}else{
		echo "You do not have permission to view this page\n";
?>

<?php }}
if($ccms_admin_modules=='performance_report'){
	if ($LOGast_admin_access==1)
		{
?>
<TABLE></TR><TD>
<center><iframe id="module_iframe" src="./AST_server_performance.php" name="AST_server_performance"  width="900px" height="800px"  frameborder="0" ></iframe></center>

<?php 
		}
	else
		{
		echo "You do not have permission to view this page\n";
		exit;
		}
} 
if($ccms_admin_modules=='list_leads'){
	if (isset($_GET["vtiger_url"]))					{$vtiger_url=$_GET["vtiger_url"];}	
	elseif (isset($_POST["vtiger_url"]))			{$vtiger_url=$_POST["vtiger_url"];}
	
	if (isset($_GET["vtiger_type"]))					{$vtiger_type=$_GET["vtiger_type"];}	
	elseif (isset($_POST["vtiger_type"]))			{$vtiger_type=$_POST["vtiger_type"];}
	
	if (isset($_GET["campaign_id"]))					{$campaign_id=$_GET["campaign_id"];}	
	elseif (isset($_POST["campaign_id"]))			{$campaign_id=$_POST["campaign_id"];}
	
	if($vtiger_type == 1){
		$vtiger_leads_url = "$vtiger_url/index.php?authbypara=true&user_name=$PHP_AUTH_USER&user_password=$PHP_AUTH_PW&module=Leads&action=Import&step=1&return_module=Leads&return_action=index&parenttab=My Home Page";
	}else if($vtiger_type == 2){
		$vtiger_leads_url = "$vtiger_url/index.php?authbypara=true&user_name=$PHP_AUTH_USER&user_password=$PHP_AUTH_PW&module=Leads&action=Import&step=1&return_module=Leads&return_action=index&parenttab=My Home Page";
		$vtiger_leads_url = "$vtiger_url/index.php?authbypara=true&user_name=$PHP_AUTH_USER&user_password=$PHP_AUTH_PW&action=ListView&module=Leads&parenttab=My Home Page";
	}else if($vtiger_type == 3){
		$vtiger_leads_url = "$vtiger_url/index.php?authbypara=true&user_name=$PHP_AUTH_USER&user_password=$PHP_AUTH_PW&action=ListView&module=Leads&campaign_id=$campaign_id&parenttab=My Home Page";
	}else{
		$vtiger_leads_url = "$vtiger_url/index.php?authbypara=true&user_name=$PHP_AUTH_USER&user_password=$PHP_AUTH_PW&action=ListView&module=Leads&parenttab=My Home Page";
	}
?>
<TABLE></TR><TD>
<center><iframe id="module_iframe" src="<?php echo $vtiger_leads_url; ?>" width="950px" height="800px"  frameborder="0" ></iframe></center>
<?php
}
if($ccms_admin_modules=='search_voice_mail'){
?>

<TABLE></TR><TD>
<?php
	
?>
<center><iframe id="module_iframe" src="./search_voice_mail.php" name="search_voice_mail"  width="750px"  onload="SetIframeHeight(this)"  frameborder="0" scrolling="no"></iframe></center>
<?php
	
?>
<?php
}
if($ccms_admin_modules=='live_monitor'){
	echo "You do not have permission to view this page\n";
}
?>

</TD></TR></TABLE>
<?php
if($ADD==20121009){
	echo $_POST['add_new_users'];
}
?>
<?php 
if ($ADD!=999999){ ?>
</div>
<?php } ?>

<b class="xbottom"><b class="xb4"></b><b class="xb3"></b><b class="xb2"></b><b class="xb1"></b></b>
</div></td></tr></table></div><div id="clear"></div></div></td></tr></table></center>
<?php
//echo "<TR><TD BGCOLOR=#FFFFFF ALIGN=CENTER>\n";
//echo "<font size=0 color=black><br><br><!-- RUNTIME: $RUNtime seconds<BR> -->";
//echo "VERSION: $admin_version<BR>";
//echo "BUILD: $build</font>\n";

exit;




##### CALCULATE DIALABLE LEADS #####
function dialable_leads($DB,$link,$local_call_time,$dial_statuses,$camp_lists,$drop_lockout_time,$fSQL)
{
##### BEGIN calculate what gmt_offset_now values are within the allowed local_call_time setting ###
if (isset($camp_lists))
	{
	if (strlen($camp_lists)>1)
		{
		if (strlen($dial_statuses)>2)
			{
			$g=0;
			$p='13';
			$GMT_gmt[0] = '';
			$GMT_hour[0] = '';
			$GMT_day[0] = '';
			while ($p > -13)
				{
				$pzone=3600 * $p;
				$pmin=(gmdate("i", time() + $pzone));
				$phour=( (gmdate("G", time() + $pzone)) * 100);
				$pday=gmdate("w", time() + $pzone);
				$tz = sprintf("%.2f", $p);	
				$GMT_gmt[$g] = "$tz";
				$GMT_day[$g] = "$pday";
				$GMT_hour[$g] = ($phour + $pmin);
				$p = ($p - 0.25);
				$g++;
				}

			$stmt="SELECT call_time_id,call_time_name,call_time_comments,ct_default_start,ct_default_stop,ct_sunday_start,ct_sunday_stop,ct_monday_start,ct_monday_stop,ct_tuesday_start,ct_tuesday_stop,ct_wednesday_start,ct_wednesday_stop,ct_thursday_start,ct_thursday_stop,ct_friday_start,ct_friday_stop,ct_saturday_start,ct_saturday_stop,ct_state_call_times FROM vicidial_call_times where call_time_id='$local_call_time';";
			if ($DB) {echo "$stmt\n";}
			$rslt=mysql_query($stmt, $link);
			$rowx=mysql_fetch_row($rslt);
			$Gct_default_start =	"$rowx[3]";
			$Gct_default_stop =		"$rowx[4]";
			$Gct_sunday_start =		"$rowx[5]";
			$Gct_sunday_stop =		"$rowx[6]";
			$Gct_monday_start =		"$rowx[7]";
			$Gct_monday_stop =		"$rowx[8]";
			$Gct_tuesday_start =	"$rowx[9]";
			$Gct_tuesday_stop =		"$rowx[10]";
			$Gct_wednesday_start =	"$rowx[11]";
			$Gct_wednesday_stop =	"$rowx[12]";
			$Gct_thursday_start =	"$rowx[13]";
			$Gct_thursday_stop =	"$rowx[14]";
			$Gct_friday_start =		"$rowx[15]";
			$Gct_friday_stop =		"$rowx[16]";
			$Gct_saturday_start =	"$rowx[17]";
			$Gct_saturday_stop =	"$rowx[18]";
			$Gct_state_call_times = "$rowx[19]";

			$ct_states = '';
			$ct_state_gmt_SQL = '';
			$ct_srs=0;
			$b=0;
			if (strlen($Gct_state_call_times)>2)
				{
				$state_rules = explode('|',$Gct_state_call_times);
				$ct_srs = ((count($state_rules)) - 2);
				}
			while($ct_srs >= $b)
				{
				if (strlen($state_rules[$b])>1)
					{
					$stmt="SELECT state_call_time_id,state_call_time_state,state_call_time_name,state_call_time_comments,sct_default_start,sct_default_stop,sct_sunday_start,sct_sunday_stop,sct_monday_start,sct_monday_stop,sct_tuesday_start,sct_tuesday_stop,sct_wednesday_start,sct_wednesday_stop,sct_thursday_start,sct_thursday_stop,sct_friday_start,sct_friday_stop,sct_saturday_start,sct_saturday_stop from vicidial_state_call_times where state_call_time_id='$state_rules[$b]';";
					$rslt=mysql_query($stmt, $link);
					$row=mysql_fetch_row($rslt);
					$Gstate_call_time_id =		"$row[0]";
					$Gstate_call_time_state =	"$row[1]";
					$Gsct_default_start =		"$row[4]";
					$Gsct_default_stop =		"$row[5]";
					$Gsct_sunday_start =		"$row[6]";
					$Gsct_sunday_stop =			"$row[7]";
					$Gsct_monday_start =		"$row[8]";
					$Gsct_monday_stop =			"$row[9]";
					$Gsct_tuesday_start =		"$row[10]";
					$Gsct_tuesday_stop =		"$row[11]";
					$Gsct_wednesday_start =		"$row[12]";
					$Gsct_wednesday_stop =		"$row[13]";
					$Gsct_thursday_start =		"$row[14]";
					$Gsct_thursday_stop =		"$row[15]";
					$Gsct_friday_start =		"$row[16]";
					$Gsct_friday_stop =			"$row[17]";
					$Gsct_saturday_start =		"$row[18]";
					$Gsct_saturday_stop =		"$row[19]";

					$ct_states .="'$Gstate_call_time_state',";

					$r=0;
					$state_gmt='';
					while($r < $g)
						{
						if ($GMT_day[$r]==0)	#### Sunday local time
							{
							if (($Gsct_sunday_start==0) and ($Gsct_sunday_stop==0))
								{
								if ( ($GMT_hour[$r]>=$Gsct_default_start) and ($GMT_hour[$r]<$Gsct_default_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							else
								{
								if ( ($GMT_hour[$r]>=$Gsct_sunday_start) and ($GMT_hour[$r]<$Gsct_sunday_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							}
						if ($GMT_day[$r]==1)	#### Monday local time
							{
							if (($Gsct_monday_start==0) and ($Gsct_monday_stop==0))
								{
								if ( ($GMT_hour[$r]>=$Gsct_default_start) and ($GMT_hour[$r]<$Gsct_default_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							else
								{
								if ( ($GMT_hour[$r]>=$Gsct_monday_start) and ($GMT_hour[$r]<$Gsct_monday_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							}
						if ($GMT_day[$r]==2)	#### Tuesday local time
							{
							if (($Gsct_tuesday_start==0) and ($Gsct_tuesday_stop==0))
								{
								if ( ($GMT_hour[$r]>=$Gsct_default_start) and ($GMT_hour[$r]<$Gsct_default_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							else
								{
								if ( ($GMT_hour[$r]>=$Gsct_tuesday_start) and ($GMT_hour[$r]<$Gsct_tuesday_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							}
						if ($GMT_day[$r]==3)	#### Wednesday local time
							{
							if (($Gsct_wednesday_start==0) and ($Gsct_wednesday_stop==0))
								{
								if ( ($GMT_hour[$r]>=$Gsct_default_start) and ($GMT_hour[$r]<$Gsct_default_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							else
								{
								if ( ($GMT_hour[$r]>=$Gsct_wednesday_start) and ($GMT_hour[$r]<$Gsct_wednesday_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							}
						if ($GMT_day[$r]==4)	#### Thursday local time
							{
							if (($Gsct_thursday_start==0) and ($Gsct_thursday_stop==0))
								{
								if ( ($GMT_hour[$r]>=$Gsct_default_start) and ($GMT_hour[$r]<$Gsct_default_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							else
								{
								if ( ($GMT_hour[$r]>=$Gsct_thursday_start) and ($GMT_hour[$r]<$Gsct_thursday_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							}
						if ($GMT_day[$r]==5)	#### Friday local time
							{
							if (($Gsct_friday_start==0) and ($Gsct_friday_stop==0))
								{
								if ( ($GMT_hour[$r]>=$Gsct_default_start) and ($GMT_hour[$r]<$Gsct_default_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							else
								{
								if ( ($GMT_hour[$r]>=$Gsct_friday_start) and ($GMT_hour[$r]<$Gsct_friday_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							}
						if ($GMT_day[$r]==6)	#### Saturday local time
							{
							if (($Gsct_saturday_start==0) and ($Gsct_saturday_stop==0))
								{
								if ( ($GMT_hour[$r]>=$Gsct_default_start) and ($GMT_hour[$r]<$Gsct_default_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							else
								{
								if ( ($GMT_hour[$r]>=$Gsct_saturday_start) and ($GMT_hour[$r]<$Gsct_saturday_stop) )
									{$state_gmt.="'$GMT_gmt[$r]',";}
								}
							}
						$r++;
						}
					$state_gmt = "$state_gmt'99'";
					$ct_state_gmt_SQL .= "or (state='$Gstate_call_time_state' and gmt_offset_now IN($state_gmt)) ";
					}

				$b++;
				}
			if (strlen($ct_states)>2)
				{
				$ct_states = eregi_replace(",$",'',$ct_states);
				$ct_statesSQL = "and state NOT IN($ct_states)";
				}
			else
				{
				$ct_statesSQL = "";
				}

			$r=0;
			$default_gmt='';
			while($r < $g)
				{
				if ($GMT_day[$r]==0)	#### Sunday local time
					{
					if (($Gct_sunday_start==0) and ($Gct_sunday_stop==0))
						{
						if ( ($GMT_hour[$r]>=$Gct_default_start) and ($GMT_hour[$r]<$Gct_default_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					else
						{
						if ( ($GMT_hour[$r]>=$Gct_sunday_start) and ($GMT_hour[$r]<$Gct_sunday_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					}
				if ($GMT_day[$r]==1)	#### Monday local time
					{
					if (($Gct_monday_start==0) and ($Gct_monday_stop==0))
						{
						if ( ($GMT_hour[$r]>=$Gct_default_start) and ($GMT_hour[$r]<$Gct_default_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					else
						{
						if ( ($GMT_hour[$r]>=$Gct_monday_start) and ($GMT_hour[$r]<$Gct_monday_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					}
				if ($GMT_day[$r]==2)	#### Tuesday local time
					{
					if (($Gct_tuesday_start==0) and ($Gct_tuesday_stop==0))
						{
						if ( ($GMT_hour[$r]>=$Gct_default_start) and ($GMT_hour[$r]<$Gct_default_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					else
						{
						if ( ($GMT_hour[$r]>=$Gct_tuesday_start) and ($GMT_hour[$r]<$Gct_tuesday_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					}
				if ($GMT_day[$r]==3)	#### Wednesday local time
					{
					if (($Gct_wednesday_start==0) and ($Gct_wednesday_stop==0))
						{
						if ( ($GMT_hour[$r]>=$Gct_default_start) and ($GMT_hour[$r]<$Gct_default_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					else
						{
						if ( ($GMT_hour[$r]>=$Gct_wednesday_start) and ($GMT_hour[$r]<$Gct_wednesday_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					}
				if ($GMT_day[$r]==4)	#### Thursday local time
					{
					if (($Gct_thursday_start==0) and ($Gct_thursday_stop==0))
						{
						if ( ($GMT_hour[$r]>=$Gct_default_start) and ($GMT_hour[$r]<$Gct_default_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					else
						{
						if ( ($GMT_hour[$r]>=$Gct_thursday_start) and ($GMT_hour[$r]<$Gct_thursday_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					}
				if ($GMT_day[$r]==5)	#### Friday local time
					{
					if (($Gct_friday_start==0) and ($Gct_friday_stop==0))
						{
						if ( ($GMT_hour[$r]>=$Gct_default_start) and ($GMT_hour[$r]<$Gct_default_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					else
						{
						if ( ($GMT_hour[$r]>=$Gct_friday_start) and ($GMT_hour[$r]<$Gct_friday_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					}
				if ($GMT_day[$r]==6)	#### Saturday local time
					{
					if (($Gct_saturday_start==0) and ($Gct_saturday_stop==0))
						{
						if ( ($GMT_hour[$r]>=$Gct_default_start) and ($GMT_hour[$r]<$Gct_default_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					else
						{
						if ( ($GMT_hour[$r]>=$Gct_saturday_start) and ($GMT_hour[$r]<$Gct_saturday_stop) )
							{$default_gmt.="'$GMT_gmt[$r]',";}
						}
					}
				$r++;
				}

			$default_gmt = "$default_gmt'99'";
			$all_gmtSQL = "(gmt_offset_now IN($default_gmt) $ct_statesSQL) $ct_state_gmt_SQL";

			$dial_statuses = preg_replace("/ -$/","",$dial_statuses);
			$Dstatuses = explode(" ", $dial_statuses);
			$Ds_to_print = (count($Dstatuses) - 0);
			$Dsql = '';
			$o=0;
			while ($Ds_to_print > $o) 
				{
				$o++;
				$Dsql .= "'$Dstatuses[$o]',";
				}
			$Dsql = preg_replace("/,$/","",$Dsql);
			if (strlen($Dsql) < 2) {$Dsql = "''";}

			$DLTsql='';
			if ($drop_lockout_time > 0)
				{
				$DLseconds = ($drop_lockout_time * 3600);
				$DLseconds = floor($DLseconds);
				$DLseconds = intval("$DLseconds");
				$DLTsql = "and ( ( (status IN('DROP','XDROP')) and (last_local_call_time < CONCAT(DATE_ADD(NOW(), INTERVAL -$DLseconds SECOND),' ',CURTIME()) ) ) or (status NOT IN('DROP','XDROP')) )";
				}

			$stmt="SELECT count(*) FROM vicidial_list where called_since_last_reset='N' and status IN($Dsql) and list_id IN($camp_lists) and ($all_gmtSQL) $DLTsql $fSQL";
			#$DB=1;
			if ($DB) {echo "$stmt\n";}
			$rslt=mysql_query($stmt, $link);
			$rslt_rows = mysql_num_rows($rslt);
			if ($rslt_rows)
				{
				$rowx=mysql_fetch_row($rslt);
				$active_leads = "$rowx[0]";
				}
			else {$active_leads = '0';}

			echo "|$DB|\n";
			echo "This campaign has $active_leads leads to be dialed in those lists\n";
			}
		else
			{
			echo "no dial Call Result selected for this campaign\n";
			}
		}
	else
		{
		echo "no active lists selected for this campaign\n";
		}
	}
else
	{
	echo "no active lists selected for this campaign\n";
	}
##### END calculate what gmt_offset_now values are within the allowed local_call_time setting ###
}


function systemStatus_campaigns_synchronous($link){

	$vicidial_campaigns_stmt = "select `campaign_id` from vicidial_campaigns";
	$vicidial_campaigns_rslt = mysql_query($vicidial_campaigns_stmt,$link);
	$vicidial_system_status_stmt = "select `campaign_id` from vicidial_system_status group by campaign_id";
	$vicidial_system_status_rslt = mysql_query($vicidial_system_status_stmt,$link);

	$vicidial_campaigns_array = array();
	$system_status_campaigns_array = array();

	if($vicidial_campaigns_rslt && mysql_num_rows($vicidial_campaigns_rslt)){
		while($row=mysql_fetch_row($vicidial_campaigns_rslt)){
			$vicidial_campaigns_array[] = $row[0];
		}
	}
	
	if($vicidial_system_status_rslt && mysql_num_rows($vicidial_system_status_rslt)){
		while($row=mysql_fetch_row($vicidial_system_status_rslt)){
			$system_status_campaigns_array[] = $row[0];
		}
	}
	
	$add_campaigns_array = array_diff($vicidial_campaigns_array,$system_status_campaigns_array);
	$delete_campaigns_array = array_diff($system_status_campaigns_array,$vicidial_campaigns_array);


	if(count($add_campaigns_array)){
		foreach($add_campaigns_array as $this_campaign_id){
			$stmt = "insert into vicidial_system_status (`state`,`description`,`trans_switch`,`campaign_id`) values 
																						('READY','READY','Y','$this_campaign_id'),
																						('CLOSER','CLOSER','Y','$this_campaign_id'),
																						('INCALL','INCALL','N','$this_campaign_id'),
																						('QUEUE','QUEUE','N','$this_campaign_id'),
																						('PAUSED','PAUSED','Y','$this_campaign_id')
																						";
			$rslt = mysql_query($stmt,$link);
		}
	}

	if(count($delete_campaigns_array)){
		$re_delete_campaigns_array = array();
		foreach($delete_campaigns_array as $this_campaign_id){
			$re_delete_campaigns_array[] = "'$this_campaign_id'";
		}
		$delete_campaigns_array = implode(",",$re_delete_campaigns_array);
		$stmt = "delete from vicidial_system_status where campaign_id in ($delete_campaigns_array)";
		$rslt = mysql_query($stmt,$link);
	}

}
?>             